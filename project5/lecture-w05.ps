%!PS-Adobe-3.0
%%Creator: groff version 1.19.1
%%CreationDate: Fri Nov 11 02:27:25 2016
%%DocumentNeededResources: font Times-Roman
%%+ font Times-Bold
%%+ font Courier
%%+ font Times-Italic
%%DocumentSuppliedResources: file obj.eps
%%+ file compile.eps
%%+ file maps.eps
%%+ file procaddr.eps
%%+ file ptestates.eps
%%+ file faultlogic.eps
%%+ file cow.eps
%%+ file trinity.eps
%%+ file exec.eps
%%+ file arch.eps
%%+ file pagetables.eps
%%+ file pt64.eps
%%+ file pt32.eps
%%+ file multilev.eps
%%+ file addtrans-schem.eps
%%+ file addtrans.eps
%%+ procset grops 1.19 1
%%Pages: 59
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.19 1
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/MF{
findfont
[5 2 roll
0 3 1 roll
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}bind def
/DA{
newpath arcn stroke
}bind def
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
/DL{
SN
moveto
SN
lineto stroke
}bind def
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
/Fr{
setrgbcolor fill
}bind def
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
/Fg{
setgray fill
}bind def
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
/setpagedevice{}def
}bind def
/PEND{
clear
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
%%IncludeResource: font Times-Bold
%%IncludeResource: font Courier
%%IncludeResource: font Times-Italic
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Italic@0 ENC0/Times-Italic RE/Courier@0 ENC0/Courier RE
/Times-Bold@0 ENC0/Times-Bold RE/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)69.336 60 Q
(Unit 5/pg 1)55.998 E(\2512016 Jef)126.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Bold@0 SF -.481(Vi)221.907 120 S(rtual Memory).481 E/F2 13
/Times-Roman@0 SF 2.657 -1.04(We h)33.336 156 T -2.925 -.26(av e)1.04 H
.576(stated that a UNIX process is a virtual computer in which a thread\
 of e)4.086 F -.195(xe)-.195 G(cution).195 E .555
(\(virtual processor\) runs within a pri)33.336 171 R -.325(va)-.325 G
.555(te virtual address space.).325 F .556(In this unit, we will be)
7.055 F(gin)-.195 E .975(to e)33.336 186 R .975(xplore the mechanisms b\
y which this is implemented, both from a generic hardw)-.195 F(are)-.13
E 2.518(and a generic k)33.336 201 R 2.518(ernel standpoint.)-.13 F
2.518(In a later unit, we will return to this topic and see)9.018 F
(speci\214c hardw)33.336 216 Q(are architecture and k)-.13 E
(ernel code.)-.13 E 1.941(All addresses used in a program are)33.336 237
R F1 1.941(virtual addr)5.191 F(esses)-.234 E F2 8.441(.B)C 1.941
(efore being used to address)-8.441 F(ph)33.336 252 Q 1.729
(ysical memory or memory-mapped I/O, virtual addresses are)-.065 F F1
(translated)4.979 E F2(to)4.979 E F1(ph)4.979 E(ysical)-.195 E(addr)
33.336 267 Q(esses)-.234 E F2 6.526(.T)C .026
(his translation is performed)-6.526 F F1 .026(by hard)3.276 F(war)-.195
E(e)-.234 E F2 .026(within the processor kno)3.276 F .026(wn as the)
-.325 F F1(Memory Management Unit \(MMU\))33.336 282 Q F2(.)A .541
(Since the operating system k)33.336 303 R .542
(ernel has sole access to the MMU')-.13 F 3.792(sl)-.715 G .542
(ookup tables, it has the)-3.792 F
(ability to completely control the vie)33.336 318 Q 3.25(wo)-.325 G 3.25
(fm)-3.25 G(emory a gi)-3.25 E -.195(ve)-.325 G 3.25(np).195 G
(rocess can see.)-3.25 E 1.391
(Address translation is performed with the granularity of a)33.336 339 R
F1(page)4.641 E F2 7.891(.A)C 4.641(na)-7.891 G 1.391(ddress is di)
-4.641 F(vided)-.325 E 1.261(into tw)33.336 354 R 4.511(op)-.13 G 4.511
(arts: The)-4.511 F F1 1.261(page number)4.511 F F2 4.511(,c)C 1.261
(omprising the most signi\214cant bits, and the)-4.511 F F1(offset)4.511
E F2(,)A 1.94(comprising the least signi\214cant bits.)33.336 369 R
1.939(Address translation operates on the)8.439 F F1 1.939(virtual page)
5.189 F(number)33.336 384 Q F2 5.912(,r)C 2.663(eplacing it with the)
-5.912 F F1(ph)5.913 E 2.663(ysical page number)-.195 F F2 9.163(.T)C
2.663(he of)-9.163 F 2.663(fset is passed through)-.325 F 6.4
(unchanged. T)33.336 399 R 3.15(ypical page sizes are 2K, 4K and 8K.)
-1.04 F 3.149(On the X86 32-bit and 64-bit)9.65 F
(architectures a page size of 4K is used.)33.336 414 Q .846
(Another name for a ph)33.336 435 R .847(ysical page of memory is a)
-.065 F F1 .847(page frame)4.097 F F2 4.097(,b)C .847
(ecause we can think of)-4.097 F(ph)33.336 450 Q .761(ysical pages as e\
mpty frames into which the actual meaningful content is placed from)
-.065 F 1.861(time to time.)33.336 465 R -1.04(We)8.361 G -.13('l)1.04 G
5.111(ls).13 G 1.861(ee that a gi)-5.111 F -.195(ve)-.325 G 5.112(np)
.195 G 1.862(age frame will hold man)-5.112 F 5.112(yd)-.195 G(if)-5.112
E 1.862(ferent virtual page)-.325 F(images o)33.336 480 Q -.195(ve)-.195
G 3.25(rt).195 G(ime.)-3.25 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 2)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E 0 0 468 485 -398.524 413 33.336 518.524 PBEGIN
%%BeginDocument: addtrans.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: addtrans.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Tue Nov  1 21:47:49 2016
%%For: hak@lex ()
%%BoundingBox: 0 0 485 413
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 413 moveto 0 0 lineto 485 0 lineto 485 413 lineto closepath clip newpath
-21.8 432.7 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
7.500 slw
gs  clippath
2967 4551 m 3013 4590 l 3111 4475 l 3011 4547 l 3066 4436 l cp
eoclip
n 3720 3720 m
 3000 4560 l gs col0 s gr gr

% arrowhead
n 3066 4436 m 3011 4547 l 3111 4475 l  col0 s
% Polyline
n 600 1875 m 375 1875 l 375 5700 l 600 5700 l
 cp gs col0 s gr 
% here ends figure;
% 
% here starts figure with depth 0
% Polyline
7.500 slw
n 5700 600 m
 5700 1200 l gs col-1 s gr 
% Polyline
n 5700 6600 m
 5700 7200 l gs col-1 s gr 
% Polyline
n 8400 1200 m 8400 600 l 2400 600 l 2400 1200 l
 cp gs col-1 s gr 
% Polyline
n 375 4500 m
 5700 4500 l gs col-1 s gr 
% Polyline
n 375 4800 m
 5700 4800 l gs col-1 s gr 
% Polyline
n 375 3000 m
 5700 3000 l gs col-1 s gr 
% Polyline
n 900 1875 m
 900 5700 l gs col-1 s gr 
% Polyline
n 1200 1875 m
 1200 5700 l gs col-1 s gr 
% Polyline
n 1500 1875 m
 1500 5700 l gs col-1 s gr 
% Polyline
n 1800 1875 m
 1800 5700 l gs col-1 s gr 
% Polyline
n 2100 1875 m
 2100 5700 l gs col-1 s gr 
% Polyline
n 8400 7200 m 8400 6600 l 2400 6600 l 2400 7200 l
 cp gs col-1 s gr 
% Polyline
n 2400 1875 m
 2400 5700 l gs col-1 s gr 
% Polyline
n 3600 4800 m 3600 6300 l 3300 6300 l 3900 6600 l 4500 6300 l 4200 6300 l
 4200 4800 l
 cp gs col-1 s gr 
% Polyline
n 6600 1200 m 6600 6300 l 6300 6300 l 6900 6600 l 7500 6300 l 7200 6300 l
 7200 1200 l
 cp gs col-1 s gr 
% Polyline
gs  clippath
5685 4620 m 5685 4680 l 5837 4680 l 5717 4650 l 5837 4620 l cp
eoclip
n 4725 1200 m 4725 1650 l 6000 1650 l 6000 4650 l
 5700 4650 l gs col-1 s gr gr

% arrowhead
n 5837 4620 m 5717 4650 l 5837 4680 l  col-1 s
% Polyline
n 5700 5700 m 5700 1875 l 600 1875 l 600 5700 l
 cp gs col-1 s gr 
/Times-Roman ff 200.00 scf sf
8325 525 m
gs 1 -1 sc (0) col-1 sh gr
/Times-Roman ff 200.00 scf sf
2475 525 m
gs 1 -1 sc (31) col-1 sh gr
/Times-Roman ff 200.00 scf sf
8250 6525 m
gs 1 -1 sc (0) col-1 sh gr
/Times-Roman ff 200.00 scf sf
2325 2925 m
gs 1 -1 sc  90.0 rot (Execute) col-1 sh gr
/Times-Roman ff 200.00 scf sf
1725 2925 m
gs 1 -1 sc  90.0 rot (Read) col-1 sh gr
/Times-Roman ff 233.33 scf sf
1125 2925 m
gs 1 -1 sc  90.0 rot (Dirty) col-1 sh gr
/Times-Roman ff 200.00 scf sf
825 2925 m
gs 1 -1 sc  90.0 rot (User) col-1 sh gr
/Times-Roman ff 200.00 scf sf
2100 2925 m
gs 1 -1 sc  90.0 rot (Write) col-1 sh gr
/Times-Roman ff 200.00 scf sf
2400 6450 m
gs 1 -1 sc (31) col-1 sh gr
/Times-Roman ff 233.33 scf sf
3375 525 m
gs 1 -1 sc (Virtual Page Number) col-1 sh gr
/Times-Roman ff 233.33 scf sf
6300 525 m
gs 1 -1 sc (Offset) col-1 sh gr
/Times-Roman ff 233.33 scf sf
675 1050 m
gs 1 -1 sc (Virtual Address:) col-1 sh gr
/Times-Roman ff 233.33 scf sf
1425 6900 m
gs 1 -1 sc (Physical Address:) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
4200 2775 m
gs 1 -1 sc (Physical Page Number \(PFN\)) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
5625 1125 m
gs 1 -1 sc (0111 0000 1011 1111 0101) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
5850 1125 m
gs 1 -1 sc (1111 0000 0111) col-1 sh gr
/Times-Roman ff 233.33 scf sf
5775 7050 m
gs 1 -1 sc (1111 0000 0111) col-1 sh gr
/Times-Roman ff 233.33 scf sf
5550 4800 m
gs 1 -1 sc (0100 0000 1111 1010 0111) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
5625 7050 m
gs 1 -1 sc (0100 0000 1111 1010 0111) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
1050 4800 m
gs 1 -1 sc (0) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
1350 4800 m
gs 1 -1 sc (1) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
1650 4800 m
gs 1 -1 sc (1) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
1950 4800 m
gs 1 -1 sc (1) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
2250 4800 m
gs 1 -1 sc (1) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
825 4800 m
gs 1 -1 sc (1) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 233.33 scf sf
4200 3600 m
gs 1 -1 sc (Page Table Entry) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Roman ff 200.00 scf sf
525 2925 m
gs 1 -1 sc  90.0 rot (Present) col-1 sh gr
/Times-Roman ff 233.33 scf sf
525 4800 m
gs 1 -1 sc (1) dup sw pop neg 0 rm  col-1 sh gr
/Times-Roman ff 200.00 scf sf
1425 2925 m
gs 1 -1 sc  90.0 rot (Accessed) col-1 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F1 13/Times-Roman@0 SF
(The virtual page number \(conceptually\) inde)33.336 560.524 Q -.195
(xe)-.195 G 3.25(st).195 G(he follo)-3.25 E(wing per)-.325 E
(-page data:)-.26 E<83>43.336 575.524 Q/F2 13/Times-Bold@0 SF(Pr)4.419 E
1.169(esent bit)-.234 F F1 4.419(:I)C 4.418(fs)-4.419 G 1.168
(et, this virtual page is resident \(maps to a ph)-4.418 F 1.168
(ysical page frame\) and)-.065 F 2.334(the ph)69.336 590.524 R 2.334
(ysical page number \214eld is v)-.065 F 5.585(alid. If)-.325 F 2.335
(the Present bit is clear)5.585 F 5.585(,t)-.52 G 2.335(here is no)
-5.585 F(ph)69.336 605.524 Q .503
(ysical page frame allocated to this virtual address.)-.065 F .502
(When there is no translation)7.002 F .491
(\(page table entry has clear Present bit\), it results in a)69.336
620.524 R F2 -.13(Pa)3.742 G .492(ge F).13 F(ault)-.325 E F1 6.992(.A)C
3.742(sw)-6.992 G 3.742(ew)-3.742 G .492(ill see,)-3.742 F
(this is not necessarily a bad thing.)69.336 635.524 Q 3.327<8354>43.336
665.524 S(he)-3.327 E F2(Ph)3.327 E .077(ysical P)-.195 F .077
(age Number)-.13 F F1 .077(\(also kno)3.327 F .077(wn as the P)-.325 F
.077(age Frame number or PFN\) which is)-.195 F
(translated for this virtual page.)69.336 680.524 Q
(If the Present bit is clear)6.5 E 3.25(,t)-.52 G(his \214eld is in)
-3.25 E -.325(va)-.52 G(lid.).325 E<83>43.336 710.524 Q F2(Pr)5.403 E
2.153(otection bits)-.234 F F1 5.403(:D)C 2.154
(etermines what type of accesses are allo)-5.403 F 2.154
(wed to this page: read,)-.325 F .728(write, e)69.336 725.524 R -.195
(xe)-.195 G 3.978(cute. An).195 F .728(attempt to perform a disallo)
3.978 F .728(wed access results in a)-.325 F F2(pr)3.977 E(otection)
-.234 E(fault)69.336 740.524 Q F1 7.081(.\()C .581(Not all hardw)-7.081
F .582(are maintains all three of these protection bits.)-.13 F .582
(In particular)7.082 F(,)-.52 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 3)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF 2.717
(the x86 architecture prior to Pentium-4 has only tw)69.336 120 R 5.967
(ol)-.13 G -2.795 -.325(ev e)-5.967 H 2.716(ls of access control:).325 F
2.306
(readonly and readwrite, and does not distinguish between protection f)
69.336 135 R 2.306(aults and)-.13 F(page f)69.336 150 Q(aults.\))-.13 E
<83>43.336 180 Q/F2 13/Times-Bold@0 SF 1.429(Dirty bit)4.679 F F1 4.679
(:S)C 1.429(et by hardw)-4.679 F 1.428
(are when a page is written to via this PTE.)-.13 F 1.428
(Cleared by the)7.928 F -.13(ke)69.336 195 S
(rnel when the page has been synced to backing storage.).13 E<83>43.336
225 Q F2 1.24(Accessed bit)4.49 F F1 4.491(:S)C 1.241(et by hardw)-4.491
F 1.241(are when a page is accessed \(read, write or e)-.13 F -.195(xe)
-.195 G 1.241(cute\) via).195 F(this PTE.)69.336 240 Q(Cleared by the k)
6.5 E(ernel while aging \(scanning\) page frames for re-use.)-.13 E<83>
43.336 270 Q F2(User/Super)4.418 E 1.168(visor Bit)-.13 F F1 4.418(:W)C
1.168(hen set, this page can be accessed while the processor is in)
-4.418 F 1.36(user mode.)69.336 285 R 1.36(If clear)7.86 F 4.611(,t)-.52
G 1.361(he processor must be in Supervisor \(aka "k)-4.611 F 1.361
(ernel"\) mode to)-.13 F .355(access the page.)69.336 300 R .355
(This allo)6.855 F .355(ws k)-.325 F .355
(ernel memory to be mapped into the virtual address)-.13 F 1.727
(space of a process and be visible only when the process enters the k)
69.336 315 R 4.977(ernel. The)-.13 F 6.147
(Linux X86 architecture uses the User/Supervisor Bit approach, b)69.336
330 R 6.147(ut other)-.26 F(architectures switch to a dif)69.336 345 Q
(ferent set of page tables upon entry to the k)-.325 E(ernel.)-.13 E 0 0
144 339 -184.354 434 231.336 565.354 PBEGIN
%%BeginDocument: addtrans-schem.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: addtrans-schem.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Tue Nov  1 21:49:42 2016
%%For: hak@lex ()
%%BoundingBox: 0 0 339 434
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 434 moveto 0 0 lineto 339 0 lineto 339 434 lineto closepath clip newpath
-26.5 477.7 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
7.500 slw
n 1500 1350 m 3675 1350 l 3675 7950 l 1500 7950 l
 cp gs col0 s gr 
% Polyline
n 1500 3975 m 3675 3975 l 3675 4350 l 1500 4350 l
 cp gs col0 s gr 
% Polyline
n 5100 3975 m 5775 3975 l 5775 4425 l 5100 4425 l
 cp gs col0 s gr 
% Polyline
gs  clippath
5441 3898 m 5493 3927 l 5568 3796 l 5483 3886 l 5516 3766 l cp
eoclip
n 6075 2850 m
 5475 3900 l gs col0 s gr gr

% arrowhead
n 5516 3766 m 5483 3886 l 5568 3796 l  col0 s
% Polyline
gs  clippath
5115 4155 m 5115 4095 l 4963 4095 l 5083 4125 l 4963 4155 l cp
eoclip
n 3675 4125 m
 5100 4125 l gs col0 s gr gr

% arrowhead
n 4963 4155 m 5083 4125 l 4963 4095 l  col0 s
/Times-Roman-iso ff 200.00 scf sf
1800 900 m
gs 1 -1 sc (VA Space, PID 123) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1350 4050 m
gs 1 -1 sc (70BF6000) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6075 2775 m
gs 1 -1 sc (Page Frame) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4500 4050 m
gs 1 -1 sc (-rwx-a) dup sw pop neg 0 rm  col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND F2(Multi-Le)200.275 616.354 Q -.13(ve)-.195 G 3.25(lP).13 G
(age T)-3.38 E(ables)-1.196 E F1(Conceptually)33.336 652.354 Q 5.266(,a)
-.845 G 5.266(sd)-5.266 G 2.017(epicted abo)-5.266 F -.195(ve)-.195 G
5.267(,t).195 G 2.017(he virtual page number is an inde)-5.267 F 5.267
(xi)-.195 G 2.017(nto an array of)-5.267 F -.195(Pa)33.336 667.354 S
2.901(ge T).195 F 2.9(able Entries \(PTEs\), located at a speci\214c ph)
-1.04 F 2.9(ysical address.)-.065 F 2.9(There are se)9.4 F -.195(ve)
-.325 G(ral).195 E(problems which pre)33.336 682.354 Q -.195(ve)-.325 G
(nt this from being a realistic implementation.).195 E 1.324(Let us con\
sider a 32-bit architecture with 4K pages, therefore the page numbers a\
re 20)33.336 703.354 R 1.651
(bits long and there are 2^20 possible page numbers.)33.336 718.354 R
1.651(If each PTE is 32 bits long, then)8.151 F .639(each page table w)
33.336 733.354 R .64(ould consume 4MB.)-.13 F .64
(Although this might seem lik)7.14 F 3.89(eas)-.13 G .64(mall amount of)
-3.89 F 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 4)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF(memory)33.336 120 Q 4.913(,r)-.845 G 1.662
(emember that each process on the system has its o)-4.913 F 1.662
(wn page table.)-.325 F 4.912(As)8.162 G(ystem)-4.912 E .17
(with 100 processes w)33.336 135 R .171(ould therefore be w)-.13 F .171
(asting a lar)-.13 F .171(ge amount of memory on page tables.)-.234 F
.648(The problem is e)33.336 156 R -.195(ve)-.325 G 3.897(nm).195 G .647
(ore se)-3.897 F -.195(ve)-.325 G .647(re on 64-bit machines which ha)
.195 F 1.037 -.195(ve a l)-.26 H(ar).195 E .647(ger virtual address)
-.234 F 4.623(space. Ev)33.336 171 R 1.374(en if only 48 bits of the ad\
dress space are recognized, with a 4K page, there)-.195 F -.13(wo)33.336
186 S 4.089(uld be 2^36 PTEs \(each PTE must be 64 bits to handle the l\
onger addresses\)).13 F(consuming 2^39, or 512GB, of ph)33.336 201 Q
(ysical memory per process!)-.065 E .305(The problem of lar)33.336 222 R
.305(ge page tables is addressed with)-.234 F/F2 13/Times-Bold@0 SF
(multi-le)3.555 E -.13(ve)-.195 G(l).13 E F1 .305(page tables.)3.555 F
.305(The ph)6.805 F(ysical)-.065 E 1.139(address of the top-le)33.336
237 R -.195(ve)-.325 G 4.389(lp).195 G 1.139(age table is gi)-4.389 F
-.195(ve)-.325 G 4.389(ni).195 G 4.389(nt)-4.389 G 1.139(he CPU/MMU "B)
-4.389 F 1.139(ASE" re)-.455 F 1.139(gister \(re)-.195 F(gister)-.195 E
1.239(%cr3 on X86\).)33.336 252 R 1.24
(The most signi\214cant bits of the virtual address inde)7.739 F 4.49
(xi)-.195 G 1.24(nto this top-le)-4.49 F -.195(ve)-.325 G(l).195 E 7.81
(table. The)33.336 267 R 4.56(result is not the page table entry)7.81 F
7.809(,b)-.845 G 4.559(ut is the ph)-8.069 F 4.559
(ysical address of the)-.065 F .94(corresponding table at the ne)33.336
282 R .94(xt lo)-.195 F .94(wer le)-.325 F -.195(ve)-.325 G 4.19(lo).195
G 4.19(ft)-4.19 G .94(he hierarch)-4.19 F 5.88 -.845(y. T)-.065 H .94
(hat ph).845 F .94(ysical address, plus)-.065 F .67
(the bits from the ne)33.336 297 R .669(xt most signi\214cant part of t\
he virtual address, locates the entry in the)-.195 F(ne)33.336 312 Q
.672(xt page table, etc.)-.195 F .673(At the last step, the actual PTE \
\(page table entry\) is fetched, which)7.172 F
(contains the PFN and the \215ags.)33.336 327 Q .632
(On modern computer architectures, 2-, 3- or 4-le)33.336 348 R -.195(ve)
-.325 G 3.882(lp).195 G .632(aging structures are the norm.)-3.882 F
(The)7.132 E 3.414(illustration belo)33.336 363 R 6.664(ws)-.325 G(ho)
-6.664 E 3.414(ws 3 le)-.325 F -.195(ve)-.325 G 3.414
(ls, and is meant to be schematic, not an).195 F 6.664(yp)-.195 G
(articular)-6.664 E .726(processor type.)33.336 378 R(2-le)7.226 E -.195
(ve)-.325 G 3.976(lo).195 G 3.975(r3)-3.976 G(-le)-3.975 E -.195(ve)
-.325 G 3.975(ls).195 G .725
(tructures are typical for 32 bit machines, while 64 bit)-3.975 F
(virtual addresses mandate 4-le)33.336 393 Q -.195(ve)-.325 G 3.25(ls)
.195 G(tructures to achie)-3.25 E .39 -.195(ve a)-.325 H .39 -.195(ny k)
.195 H(ind of memory ef).195 E(\214cienc)-.325 E -.845(y.)-.195 G 0 Cg
EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 5)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E 0 0 455 455 -338 338 39.836 458 PBEGIN
%%BeginDocument: multilev.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: multilev.eps
%%Creator: fig2dev Version 3.2.3 Patchlevel 
%%CreationDate: Thu Feb 22 21:25:56 2001
%%For: hak@astor.cooper.edu (hak)
%%BoundingBox: 0 0 455 338
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 338 moveto 0 0 lineto 455 0 lineto 455 338 lineto closepath clip newpath
-53.0 361.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hypen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
%%Page: 1 1
10 setmiterlimit
 0.06000 0.06000 sc
% Polyline
7.500 slw
n 7140 1500 m
 7140 4500 l gs col0 s gr 
% Polyline
gs  clippath
2132 1731 m 2073 1718 l 2040 1866 l 2096 1756 l 2099 1879 l cp
eoclip
n 1980 2280 m
 2100 1740 l gs col0 s gr gr

% arrowhead
n 2099 1879 m 2096 1756 l 2040 1866 l  col0 s
% Polyline
gs  clippath
7245 3750 m 7245 3810 l 7397 3810 l 7277 3780 l 7397 3750 l cp
eoclip
n 7860 3780 m
 7260 3780 l gs col0 s gr gr

% arrowhead
n 7397 3750 m 7277 3780 l 7397 3810 l  col0 s
/Times-Roman-iso ff 180.00 scf sf
3360 1440 m
gs 1 -1 sc (Top-Level) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
5280 1440 m
gs 1 -1 sc (Mid-Level) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
6840 1440 m
gs 1 -1 sc (PTE's) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 210.00 scf sf
3420 1980 m
gs 1 -1 sc  270.0 rot (2  5  6   e  n  t  r  i  e  s) col0 sh gr
/Times-Roman-iso ff 210.00 scf sf
5160 2040 m
gs 1 -1 sc  270.0 rot (6  4      e  n  t  r  i  e  s) col0 sh gr
/Times-Roman-iso ff 210.00 scf sf
6840 2040 m
gs 1 -1 sc  270.0 rot (6  4      e  n  t  r  i  e  s) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
1140 2280 m
gs 1 -1 sc (Phys Addr) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
5460 4920 m
gs 1 -1 sc (20 bits) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
2760 3060 m
gs 1 -1 sc (32) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
4080 3000 m
gs 1 -1 sc (32) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
4440 2520 m
gs 1 -1 sc (32) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
5820 2520 m
gs 1 -1 sc (32) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
6240 3900 m
gs 1 -1 sc (32) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
2040 1620 m
gs 1 -1 sc (32) col0 sh gr
/Times-Roman-iso ff 180.00 scf sf
7860 3840 m
gs 1 -1 sc (FLAGS) col0 sh gr
% Polyline
n 3075 1500 m 3900 1500 l 3900 4500 l 3075 4500 l
 cp gs col-1 s gr 
% Polyline
n 3075 4200 m
 3900 4200 l gs col-1 s gr 
% Polyline
n 3075 3900 m
 3900 3900 l gs col-1 s gr 
% Polyline
n 3075 3600 m
 3900 3600 l gs col-1 s gr 
% Polyline
n 3075 3300 m
 3900 3300 l gs col-1 s gr 
% Polyline
n 3075 3000 m
 3900 3000 l gs col-1 s gr 
% Polyline
n 3075 2700 m
 3900 2700 l gs col-1 s gr 
% Polyline
n 3075 2400 m
 3900 2400 l gs col-1 s gr 
% Polyline
n 3075 2100 m
 3900 2100 l gs col-1 s gr 
% Polyline
n 3075 1800 m
 3900 1800 l gs col-1 s gr 
% Polyline
n 4800 1500 m 5625 1500 l 5625 4500 l 4800 4500 l
 cp gs col-1 s gr 
% Polyline
n 4800 4200 m
 5625 4200 l gs col-1 s gr 
% Polyline
n 4800 3900 m
 5625 3900 l gs col-1 s gr 
% Polyline
n 4800 3600 m
 5625 3600 l gs col-1 s gr 
% Polyline
n 4800 3300 m
 5625 3300 l gs col-1 s gr 
% Polyline
n 4800 3000 m
 5625 3000 l gs col-1 s gr 
% Polyline
n 4800 2700 m
 5625 2700 l gs col-1 s gr 
% Polyline
n 4800 2400 m
 5625 2400 l gs col-1 s gr 
% Polyline
n 4800 2100 m
 5625 2100 l gs col-1 s gr 
% Polyline
n 4800 1800 m
 5625 1800 l gs col-1 s gr 
% Polyline
n 6525 1500 m 7350 1500 l 7350 4500 l 6525 4500 l
 cp gs col-1 s gr 
% Polyline
n 6525 4200 m
 7350 4200 l gs col-1 s gr 
% Polyline
n 6525 3900 m
 7350 3900 l gs col-1 s gr 
% Polyline
n 6525 3600 m
 7350 3600 l gs col-1 s gr 
% Polyline
n 6525 3300 m
 7350 3300 l gs col-1 s gr 
% Polyline
n 6525 3000 m
 7350 3000 l gs col-1 s gr 
% Polyline
n 6525 2700 m
 7350 2700 l gs col-1 s gr 
% Polyline
n 6525 2400 m
 7350 2400 l gs col-1 s gr 
% Polyline
n 6525 2100 m
 7350 2100 l gs col-1 s gr 
% Polyline
n 6525 1800 m
 7350 1800 l gs col-1 s gr 
% Ellipse
n 2550 1650 225 225 0 360 DrawEllipse gs col-1 s gr

% Ellipse
n 4362 1650 225 225 0 360 DrawEllipse gs col-1 s gr

% Ellipse
n 6150 1650 225 225 0 360 DrawEllipse gs col-1 s gr

% Polyline
n 8400 1200 m 8400 600 l 2400 600 l 2400 1200 l
 cp gs col-1 s gr 
% Polyline
n 6300 600 m
 6300 1200 l gs col-1 s gr 
% Polyline
 [60] 0 sd
n 3600 600 m
 3600 1200 l gs col-1 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5100 600 m
 5100 1200 l gs col-1 s gr  [] 0 sd
% Polyline
gs  clippath
2520 1440 m 2580 1440 l 2580 1288 l 2550 1408 l 2520 1288 l cp
eoclip
n 2550 1200 m
 2550 1425 l gs col-1 s gr gr

% arrowhead
n 2520 1288 m 2550 1408 l 2580 1288 l  col-1 s
% Polyline
n 1800 1950 m 1800 1350 l 900 1350 l 900 1950 l
 cp gs col-1 s gr 
% Polyline
gs  clippath
2340 1680 m 2340 1620 l 2188 1620 l 2308 1650 l 2188 1680 l cp
eoclip
n 1800 1650 m
 2325 1650 l gs col-1 s gr gr

% arrowhead
n 2188 1680 m 2308 1650 l 2188 1620 l  col-1 s
% Polyline
gs  clippath
3090 3180 m 3090 3120 l 2938 3120 l 3058 3150 l 2938 3180 l cp
eoclip
n 2550 1875 m 2550 3150 l
 3075 3150 l gs col-1 s gr gr

% arrowhead
n 2938 3180 m 3058 3150 l 2938 3120 l  col-1 s
% Polyline
gs  clippath
4320 1440 m 4380 1440 l 4380 1288 l 4350 1408 l 4320 1288 l cp
eoclip
n 4350 1200 m
 4350 1425 l gs col-1 s gr gr

% arrowhead
n 4320 1288 m 4350 1408 l 4380 1288 l  col-1 s
% Polyline
gs  clippath
4215 1680 m 4215 1620 l 4063 1620 l 4183 1650 l 4063 1680 l cp
eoclip
n 3825 3150 m 4050 3150 l 4050 1650 l
 4200 1650 l gs col-1 s gr gr

% arrowhead
n 4063 1680 m 4183 1650 l 4063 1620 l  col-1 s
% Polyline
gs  clippath
4815 2580 m 4815 2520 l 4663 2520 l 4783 2550 l 4663 2580 l cp
eoclip
n 4350 1875 m 4350 2550 l
 4800 2550 l gs col-1 s gr gr

% arrowhead
n 4663 2580 m 4783 2550 l 4663 2520 l  col-1 s
% Polyline
gs  clippath
6120 1440 m 6180 1440 l 6180 1288 l 6150 1408 l 6120 1288 l cp
eoclip
n 6150 1200 m
 6150 1425 l gs col-1 s gr gr

% arrowhead
n 6120 1288 m 6150 1408 l 6180 1288 l  col-1 s
% Polyline
gs  clippath
6540 3780 m 6540 3720 l 6388 3720 l 6508 3750 l 6388 3780 l cp
eoclip
n 6150 1875 m 6150 3750 l
 6525 3750 l gs col-1 s gr gr

% arrowhead
n 6388 3780 m 6508 3750 l 6388 3720 l  col-1 s
% Polyline
gs  clippath
5940 1680 m 5940 1620 l 5788 1620 l 5908 1650 l 5788 1680 l cp
eoclip
n 5475 2550 m 5775 2550 l 5775 1650 l
 5925 1650 l gs col-1 s gr gr

% arrowhead
n 5788 1680 m 5908 1650 l 5788 1620 l  col-1 s
% Polyline
gs  clippath
4470 5415 m 4530 5415 l 4530 5263 l 4500 5383 l 4470 5263 l cp
eoclip
n 6900 3750 m 6900 4950 l 4500 4950 l
 4500 5400 l gs col-1 s gr gr

% arrowhead
n 4470 5263 m 4500 5383 l 4530 5263 l  col-1 s
% Polyline
gs  clippath
7620 5415 m 7680 5415 l 7680 5263 l 7650 5383 l 7620 5263 l cp
eoclip
n 7650 1200 m
 7650 5400 l gs col-1 s gr gr

% arrowhead
n 7620 5263 m 7650 5383 l 7680 5263 l  col-1 s
% Polyline
n 6300 5400 m
 6300 6000 l gs col-1 s gr 
% Polyline
n 2550 5400 m 8400 5400 l 8400 6000 l 2550 6000 l
 cp gs col-1 s gr 
/Times-Roman-iso ff 210.00 scf sf
7200 1050 m
gs 1 -1 sc (offset) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
8325 525 m
gs 1 -1 sc (0) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
6075 600 m
gs 1 -1 sc (12) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
4950 600 m
gs 1 -1 sc (18) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
3450 600 m
gs 1 -1 sc (24) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
2475 600 m
gs 1 -1 sc (31) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
2475 1725 m
gs 1 -1 sc (+) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
2475 1725 m
gs 1 -1 sc (+) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
4350 1725 m
gs 1 -1 sc (+) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
6075 1725 m
gs 1 -1 sc (+) col-1 sh gr
/Times-Roman-iso ff 210.00 scf sf
4425 975 m
gs 1 -1 sc (Virtual Page Number) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Roman-iso ff 210.00 scf sf
4200 5760 m
gs 1 -1 sc (Physical Page Number) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Times-Roman-iso ff 210.00 scf sf
960 5700 m
gs 1 -1 sc (Physical Address) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
1680 1260 m
gs 1 -1 sc (0) col-1 sh gr
/Times-Roman-iso ff 180.00 scf sf
960 1260 m
gs 1 -1 sc (31) col-1 sh gr
/Times-Roman-iso ff 210.00 scf sf
1380 1740 m
gs 1 -1 sc (BASE) dup sw pop 2 div neg 0 rm  col-1 sh gr
$F2psEnd
rs
%%EndDocument
end PEND/F1 13/Times-Roman@0 SF -.195(Pa)33.336 485 S .035
(ge tables are in ef).195 F .036(fect a data structure, k)-.325 F .036
(ept in ph)-.13 F .036(ysical memory)-.065 F 6.536(.T)-.845 G .036
(he layout of this data)-6.536 F 1.254
(structure is mandated by the processor architecture. The k)33.336 500 R
1.253(ernel has been compiled with)-.13 F 4.901(architecture-speci\214c\
 code that understands the layout of the page tables and can)33.336 515
R(manipulate and manage them.)33.336 530 Q/F2 13/Times-Bold@0 SF
(X86-32, 2-le)184.578 560 Q -.13(ve)-.195 G 3.25(lp).13 G(age structur)
-3.25 E(e)-.234 E F1 .308
(On the X86 32 bit system, the page table is 2-le)33.336 596 R -.195(ve)
-.325 G 3.558(lw).195 G .308(ith the page number split 10/10 bits.)
-3.558 F .172(The %cr3 special control re)33.336 611 R .173
(gister in the CPU \(which must be running in Supervisor mode)-.195 F
.753(to change it\) gi)33.336 626 R -.195(ve)-.325 G 4.003(st).195 G
.752(he 32-bit ph)-4.003 F .752
(ysical memory address of the start of the top-le)-.065 F -.195(ve)-.325
G 4.002(lt).195 G(able.)-4.002 E 1.399(The Linux k)33.336 641 R 1.399
(ernel calls this the P)-.13 F 1.4(age Global Directory \(PGD\).)-.195 F
1.4(The PGD is an array of)7.9 F .535
(1024 entries, each 32 bits long, and each entry \(kno)33.336 656 R .534
(wn as a PDE: P)-.325 F .534(age Directory Entry \))-.195 F 1.3
(is in the same format as a P)33.336 671 R 1.3(age T)-.195 F 1.3
(able Entry \(PTE\).)-1.04 F(Ho)7.8 E(we)-.325 E -.195(ve)-.325 G 2.34
-.52(r, t).195 H 1.3(he P).52 F 1.3(age Frame Number)-.195 F .905
(\(PFN\) \214eld of the PDE is a pointer to the ne)33.336 686 R .905
(xt le)-.195 F -.195(ve)-.325 G 4.154(lo).195 G 4.154(ft)-4.154 G .904
(he 2-le)-4.154 F -.195(ve)-.325 G 4.154(ls).195 G 4.154(tructure. Each)
-4.154 F(PGD)4.154 E
(entry represents 2^22 \(4MB\) of virtual address space.)33.336 701 Q
3.819 -1.04(We s)33.336 722 T 1.739
(ee that the PGD consumes 4096 bytes, or one ph)1.04 F 1.74
(ysical page.)-.065 F 1.74(The ne)8.24 F 1.74(xt le)-.195 F -.195(ve)
-.325 G 1.74(l, the).195 F -.195(Pa)33.336 737 S .049(ge T).195 F .049
(able \(PT\), contains 1024 PTE \(P)-1.04 F .049(age T)-.195 F .048
(able Entries\) each 32 bits \(4 bytes\) long, thus)-1.04 F 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 6)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF 1.237(each PT also \214ts within a 4K page.)
33.336 120 R 1.238(The virtual address space and the ph)7.738 F 1.238
(ysical address)-.065 F 2.46(space are both 32 bits, or 4GB.)33.336 135
R 2.46(There is a mode called Ph)8.96 F 2.459(ysical Address Extension)
-.065 F(\(P)33.336 150 Q .533(AE\), which we will not co)-1.196 F -.195
(ve)-.195 G 3.783(rh).195 G .533(ere, that mak)-3.783 F .533(es ph)-.13
F .533(ysical addresses 64 bits so more than)-.065 F 1.571(4GB of ph)
33.336 165 R 1.571(ysical RAM can be accessed.)-.065 F(Ho)8.071 E(we)
-.325 E -.195(ve)-.325 G 2.611 -.52(r, i).195 H 4.821(nP).52 G 1.571
(AE mode, virtual addresses are)-6.017 F .113(still limited to 32 bits.)
33.336 180 R -1.196(PA)6.613 G 3.363(Ei)1.196 G 3.363(sr)-3.363 G .114
(arely used since most modern computers w)-3.363 F .114(ould operate in)
-.13 F(64 bit mode.)33.336 195 Q 0 0 468 548 -431.277 505 33.336 647.278
PBEGIN
%%BeginDocument: pt32.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: pt32.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Tue Nov  1 22:07:37 2016
%%For: hak@lex ()
%%BoundingBox: 0 0 548 505
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 505 moveto 0 0 lineto 548 0 lineto 548 505 lineto closepath clip newpath
-35.3 558.7 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 2175 3450 168 168 0 360 DrawEllipse gs col0 s gr

% Ellipse
n 4725 5700 168 168 0 360 DrawEllipse gs col0 s gr

% Polyline
n 1200 1200 m 9600 1200 l 9600 2100 l 1200 2100 l
 cp gs col0 s gr 
% Polyline
n 3000 1200 m
 3000 2100 l gs col0 s gr 
% Polyline
n 5100 1200 m
 5100 2100 l gs col0 s gr 
% Polyline
n 600 3300 m 1500 3300 l 1500 3600 l 600 3600 l
 cp gs col0 s gr 
% Polyline
gs  clippath
2715 3480 m 2715 3420 l 2563 3420 l 2683 3450 l 2563 3480 l cp
eoclip
n 1500 3450 m
 2700 3450 l gs col0 s gr gr

% arrowhead
n 2563 3480 m 2683 3450 l 2563 3420 l  col0 s
% Polyline
gs  clippath
2715 5130 m 2715 5070 l 2563 5070 l 2683 5100 l 2563 5130 l cp
eoclip
n 2175 2100 m 2175 5100 l
 2700 5100 l gs col0 s gr gr

% arrowhead
n 2563 5130 m 2683 5100 l 2563 5070 l  col0 s
% Polyline
n 2700 3300 m 4125 3300 l 4125 6900 l 2700 6900 l
 cp gs col0 s gr 
% Polyline
n 2700 4950 m 4125 4950 l 4125 5250 l 2700 5250 l
 cp gs col0 s gr 
% Polyline
n 2700 4950 m 3600 4950 l 3600 5250 l 2700 5250 l
 cp gs col0 s gr 
% Polyline
gs  clippath
5715 5730 m 5715 5670 l 5563 5670 l 5683 5700 l 5563 5730 l cp
eoclip
n 3225 5250 m 3225 5700 l
 5700 5700 l gs col0 s gr gr

% arrowhead
n 5563 5730 m 5683 5700 l 5563 5670 l  col0 s
% Polyline
n 5700 5700 m 7125 5700 l 7125 9300 l 5700 9300 l
 cp gs col0 s gr 
% Polyline
n 5700 7200 m 7125 7200 l 7125 7500 l 5700 7500 l
 cp gs col0 s gr 
% Polyline
n 5700 7200 m 6600 7200 l 6600 7500 l 5700 7500 l
 cp gs col0 s gr 
% Polyline
gs  clippath
5715 7380 m 5715 7320 l 5563 7320 l 5683 7350 l 5563 7380 l cp
eoclip
n 4725 2100 m 4725 7350 l
 5700 7350 l gs col0 s gr gr

% arrowhead
n 5563 7380 m 5683 7350 l 5563 7320 l  col0 s
% Polyline
n 2025 2850 m
 2325 2550 l gs col0 s gr 
% Polyline
n 4575 2925 m
 4875 2625 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
825 1650 m
gs 1 -1 sc (VA) col0 sh gr
/Times-Roman ff 200.00 scf sf
9600 1050 m
gs 1 -1 sc (0) col0 sh gr
/Times-Roman ff 200.00 scf sf
5250 1050 m
gs 1 -1 sc (11) col0 sh gr
/Times-Roman ff 200.00 scf sf
4950 1050 m
gs 1 -1 sc (12) col0 sh gr
/Times-Roman ff 200.00 scf sf
3075 1050 m
gs 1 -1 sc (21) col0 sh gr
/Times-Roman ff 200.00 scf sf
2775 1050 m
gs 1 -1 sc (22) col0 sh gr
/Times-Roman ff 200.00 scf sf
1275 1050 m
gs 1 -1 sc (31) col0 sh gr
/Times-Roman ff 200.00 scf sf
7200 1725 m
gs 1 -1 sc (Offset) col0 sh gr
/Times-Roman ff 200.00 scf sf
750 3525 m
gs 1 -1 sc (%cr3) col0 sh gr
/Times-Roman ff 200.00 scf sf
3150 4800 m
gs 1 -1 sc (PDE) col0 sh gr
/Times-Roman ff 200.00 scf sf
2925 5175 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman ff 200.00 scf sf
3675 5175 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman ff 200.00 scf sf
6600 7425 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman ff 200.00 scf sf
5925 7425 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman ff 200.00 scf sf
2400 2625 m
gs 1 -1 sc (10) col0 sh gr
/Times-Roman ff 200.00 scf sf
4950 2625 m
gs 1 -1 sc (10) col0 sh gr
/Times-Roman ff 200.00 scf sf
6300 7050 m
gs 1 -1 sc (PTE) col0 sh gr
/Times-Roman ff 200.00 scf sf
5850 5250 m
gs 1 -1 sc (PT instance) col0 sh gr
/Times-Roman ff 200.00 scf sf
5850 5550 m
gs 1 -1 sc (\(1024 entries\)) col0 sh gr
/Times-Roman ff 200.00 scf sf
2850 3225 m
gs 1 -1 sc (\(1024 entries\)) col0 sh gr
/Times-Roman ff 200.00 scf sf
3150 2925 m
gs 1 -1 sc (PGD) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F2 13/Times-Bold@0 SF(X86-64, 4-le)184.578 683.278 Q -.13(ve)
-.195 G 3.25(lp).13 G(age structur)-3.25 E(e)-.234 E F1 .815
(Under the X86 64 bit architecture, re)33.336 719.278 R .815
(gisters are 64 bits wide.)-.195 F -.78(Vi)7.315 G .815
(rtual addresses ho).78 F(we)-.325 E -.195(ve)-.325 G(r).195 E 1.745
(are actually only 48 bits wide, and are sign-e)33.336 734.278 R 1.746
(xtended into the remaining 16 bits.)-.195 F(This)8.246 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 7)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF(mak)33.336 120 Q 2.104(es addressing some)-.13
F 2.104(what confusing.)-.325 F 2.103(E.g. v)8.604 F 2.103
(alid addresses jump from 0x0000 7FFF)-.325 F .819
(FFFF FFFF to 0xFFFF 8000 0000 0000 \(spaces inserted for clarity\).)
33.336 135 R .819(Therefore, a gi)7.319 F -.195(ve)-.325 G(n).195 E
2.714(virtual address space is limited to "only" 256TB.)33.336 150 R
2.714(This point at which the addresses)9.214 F 2.645(become "ne)33.336
165 R -.065(ga)-.195 G(ti).065 E -.195(ve)-.325 G 5.895("i).195 G 5.895
(st)-5.895 G 2.645(he di)-5.895 F 2.645
(viding line in the Linux x86-64 k)-.325 F 2.645(ernel between user and)
-.13 F -.13(ke)33.336 180 S 2.238(rnel virtual memory).13 F 8.738(.A)
-.845 G 5.488(sw)-8.738 G 2.238(ith the 32-bit model, the k)-5.488 F
2.238(ernel tak)-.13 F 2.238(es the upper portion.)-.13 F(No)33.336 195
Q 4.489(wh)-.325 G -.325(ow)-4.489 G -2.795 -.325(ev e).325 H 4.489(rt)
.325 G 1.239
(he user process has 2^47=128TB of virtual address space and the k)
-4.489 F(ernel)-.13 E 3.592(also has 128TB.)33.336 210 R 3.592
(The Intel X86-64 architecture supports up to 52 bits of ph)10.092 F
(ysical)-.065 E 1.917(addressing which is 4PB, although contemporary im\
plementations use a much smaller)33.336 225 R(ph)33.336 240 Q
(ysical address b)-.065 E(us size.)-.26 E -.195(Pa)33.336 261 S .62
(ge size continues to be 4K to retain compatibility with older code.)
.195 F .62(Therefore we ha)7.12 F -.195(ve)-.26 G .827
(48-12 = 36 bits remaining as a virtual page number)33.336 276 R 7.327
(.T)-.715 G .827(his is split e)-7.327 F -.195(ve)-.325 G .828
(nly into four le).195 F -.195(ve)-.325 G(ls).195 E 4.794
(\(9/9/9/9\). Each)33.336 291 R 1.544
(PTE must be 64 bits wide since 32 bits w)4.794 F 1.543
(ould not be enough room to)-.13 F(encode the 40-bit PFN.)33.336 306 Q
(Therefore within one 4K table we get 2^9=512 entries.)6.5 E .833
(The %cr3 re)33.336 327 R .833(gister \(no)-.195 F 4.083(w6)-.325 G
4.084(4b)-4.083 G .834
(its wide\) points to the PGD, as with the 32-bit architecture.)-4.084 F
.689(Entries in the PGD gi)33.336 342 R 1.078 -.195(ve t)-.325 H .688
(he PFNs pointing to instances of the ne).195 F .688(xt le)-.195 F -.195
(ve)-.325 G .688(l, which is called).195 F -.195(Pa)33.336 357 S 1.714
(ge Upper Directory \(PUD\).).195 F 1.714
(The PUD in turn contains PFN pointers to instances of)8.214 F -.195(Pa)
33.336 372 S 1.899(ge Middle Directories \(PMD\), which \214nally conta\
in the pointers to the P).195 F 1.899(age T)-.195 F(ables)-1.04 E
(which contain the PTEs.)33.336 387 Q 1.465
(Each entry of the PGD in 64 bit mode no)33.336 408 R 4.716(wr)-.325 G
1.466(eferences 2^39=512 GB of address space.)-4.716 F .011(Each PUD re\
ferences 2^30=1GB, each PMD 2^21=2MB and \214nally each PTE 2^12=4KB.)
33.336 423 R 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 8)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E 0 0 468 729 -402.519 627 33.336 522.518 PBEGIN
%%BeginDocument: pt64.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: pt64.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Tue Nov  1 22:21:34 2016
%%For: hak@lex ()
%%BoundingBox: 0 0 729 627
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 627 moveto 0 0 lineto 729 0 lineto 729 627 lineto closepath clip newpath
22.5 680.2 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 2175 3450 168 168 0 360 DrawEllipse gs col0 s gr

% Ellipse
n 4725 5700 168 168 0 360 DrawEllipse gs col0 s gr

% Ellipse
n 7575 6675 168 168 0 360 DrawEllipse gs col0 s gr

% Ellipse
n 9825 7800 168 168 0 360 DrawEllipse gs col0 s gr

% Polyline
n 3000 1200 m
 3000 2100 l gs col0 s gr 
% Polyline
n 600 3300 m 1500 3300 l 1500 3600 l 600 3600 l
 cp gs col0 s gr 
% Polyline
gs  clippath
2715 3480 m 2715 3420 l 2563 3420 l 2683 3450 l 2563 3480 l cp
eoclip
n 1500 3450 m
 2700 3450 l gs col0 s gr gr

% arrowhead
n 2563 3480 m 2683 3450 l 2563 3420 l  col0 s
% Polyline
gs  clippath
2715 5130 m 2715 5070 l 2563 5070 l 2683 5100 l 2563 5130 l cp
eoclip
n 2175 2100 m 2175 5100 l
 2700 5100 l gs col0 s gr gr

% arrowhead
n 2563 5130 m 2683 5100 l 2563 5070 l  col0 s
% Polyline
n 2700 3300 m 4125 3300 l 4125 6900 l 2700 6900 l
 cp gs col0 s gr 
% Polyline
n 2700 4950 m 4125 4950 l 4125 5250 l 2700 5250 l
 cp gs col0 s gr 
% Polyline
n 2700 4950 m 3600 4950 l 3600 5250 l 2700 5250 l
 cp gs col0 s gr 
% Polyline
gs  clippath
5715 5730 m 5715 5670 l 5563 5670 l 5683 5700 l 5563 5730 l cp
eoclip
n 3225 5250 m 3225 5700 l
 5700 5700 l gs col0 s gr gr

% arrowhead
n 5563 5730 m 5683 5700 l 5563 5670 l  col0 s
% Polyline
gs  clippath
5715 7380 m 5715 7320 l 5563 7320 l 5683 7350 l 5563 7380 l cp
eoclip
n 4725 2100 m 4725 7350 l
 5700 7350 l gs col0 s gr gr

% arrowhead
n 5563 7380 m 5683 7350 l 5563 7320 l  col0 s
% Polyline
n 2025 2850 m
 2325 2550 l gs col0 s gr 
% Polyline
n 4575 2925 m
 4875 2625 l gs col0 s gr 
% Polyline
n 1500 1200 m
 1500 2100 l gs col0 s gr 
% Polyline
n 4950 1200 m
 4950 2100 l gs col0 s gr 
% Polyline
n 150 1200 m 11325 1200 l 11325 2100 l 150 2100 l
 cp gs col0 s gr 
% Polyline
n 8250 1200 m
 8250 2100 l gs col0 s gr 
% Polyline
n 6675 1200 m
 6675 2100 l gs col0 s gr 
% Polyline
n 8025 6675 m 9450 6675 l 9450 10275 l 8025 10275 l
 cp gs col0 s gr 
% Polyline
n 5700 5700 m 7125 5700 l 7125 9300 l 5700 9300 l
 cp gs col0 s gr 
% Polyline
n 5700 6225 m 7125 6225 l 7125 6525 l 5700 6525 l
 cp gs col0 s gr 
% Polyline
n 5700 6225 m 6600 6225 l 6600 6525 l 5700 6525 l
 cp gs col0 s gr 
% Polyline
gs  clippath
8040 6705 m 8040 6645 l 7888 6645 l 8008 6675 l 7888 6705 l cp
eoclip
n 6225 6525 m 6225 6675 l
 8025 6675 l gs col0 s gr gr

% arrowhead
n 7888 6705 m 8008 6675 l 7888 6645 l  col0 s
% Polyline
gs  clippath
8040 7530 m 8040 7470 l 7888 7470 l 8008 7500 l 7888 7530 l cp
eoclip
n 6150 2100 m 6150 3600 l 7575 3600 l 7575 7500 l
 8025 7500 l gs col0 s gr gr

% arrowhead
n 7888 7530 m 8008 7500 l 7888 7470 l  col0 s
% Polyline
n 8025 7350 m 9450 7350 l 9450 7650 l 8025 7650 l
 cp gs col0 s gr 
% Polyline
n 8025 7350 m 8925 7350 l 8925 7650 l 8025 7650 l
 cp gs col0 s gr 
% Polyline
n 10275 7725 m 11700 7725 l 11700 11325 l 10275 11325 l
 cp gs col0 s gr 
% Polyline
gs  clippath
10290 9180 m 10290 9120 l 10138 9120 l 10258 9150 l 10138 9180 l cp
eoclip
n 7725 2100 m 7725 3225 l 9825 3225 l 9825 9150 l
 10275 9150 l gs col0 s gr gr

% arrowhead
n 10138 9180 m 10258 9150 l 10138 9120 l  col0 s
% Polyline
gs  clippath
10215 7830 m 10215 7770 l 10063 7770 l 10183 7800 l 10063 7830 l cp
eoclip
n 8475 7650 m 8475 7800 l
 10200 7800 l gs col0 s gr gr

% arrowhead
n 10063 7830 m 10183 7800 l 10063 7770 l  col0 s
% Polyline
n 10275 9000 m 11700 9000 l 11700 9300 l 10275 9300 l
 cp gs col0 s gr 
% Polyline
n 10275 9000 m 11175 9000 l 11175 9300 l 10275 9300 l
 cp gs col0 s gr 
% Polyline
n 6075 2925 m
 6375 2625 l gs col0 s gr 
% Polyline
n 7575 2925 m
 7875 2625 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
5250 1050 m
gs 1 -1 sc (29) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3075 1050 m
gs 1 -1 sc (38) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2775 1050 m
gs 1 -1 sc (39) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1275 1050 m
gs 1 -1 sc (48) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
750 3525 m
gs 1 -1 sc (%cr3) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3150 4800 m
gs 1 -1 sc (PDE) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2925 5175 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3675 5175 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2400 2625 m
gs 1 -1 sc (9) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4950 2625 m
gs 1 -1 sc (9) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2850 3225 m
gs 1 -1 sc (\(512 entries\)) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3150 2925 m
gs 1 -1 sc (PGD) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
-375 1575 m
gs 1 -1 sc (VA) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
225 1050 m
gs 1 -1 sc (63) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
450 1500 m
gs 1 -1 sc (XXXXX) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
450 1755 m
gs 1 -1 sc (sign-extend) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
450 2010 m
gs 1 -1 sc (bit 47) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1575 1050 m
gs 1 -1 sc (47) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11100 1050 m
gs 1 -1 sc (0) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10050 1725 m
gs 1 -1 sc (Offset) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6375 1050 m
gs 1 -1 sc (21) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6825 1050 m
gs 1 -1 sc (20) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7875 1050 m
gs 1 -1 sc (12) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8325 1050 m
gs 1 -1 sc (11) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4650 1050 m
gs 1 -1 sc (30) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5850 5250 m
gs 1 -1 sc (PUD instance) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5850 5550 m
gs 1 -1 sc (\(512 entries\)) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6300 6075 m
gs 1 -1 sc (PDE) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5925 6450 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6600 6450 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8475 6150 m
gs 1 -1 sc (PMD instance) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8175 6450 m
gs 1 -1 sc (\(512 entries\)) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8925 7575 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8325 7575 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10725 7275 m
gs 1 -1 sc (PT instance) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10425 7575 m
gs 1 -1 sc (\(512 entries\)) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10500 9225 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11175 9225 m
gs 1 -1 sc (Flags) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10800 8850 m
gs 1 -1 sc (PTE) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6525 2625 m
gs 1 -1 sc (9) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8025 2625 m
gs 1 -1 sc (9) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8550 7200 m
gs 1 -1 sc (PDE) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F1 13/Times-Bold@0 SF(Sparse and Shar)146.397 558.518 Q
(ed Multi-Le)-.234 E -.13(ve)-.195 G 3.25(lP).13 G(age T)-3.38 E(ables)
-1.196 E/F2 13/Times-Roman@0 SF 1.385
(It is possible for entries in these tables \(other than the lo)33.336
588.518 R(west-le)-.325 E -.195(ve)-.325 G 4.635(lp).195 G 1.385
(age table itself\) to)-4.635 F 4.392(contain "NULL pointers".)33.336
603.518 R 4.392(This means that the entire contiguous range of virtual)
10.892 F 5.901(addresses corresponding to that entry is not mapped.)
33.336 618.518 R 5.901(This "NULL" pointer is)12.401 F 1.814
(implemented by ha)33.336 633.518 R 1.814
(ving the Present bit of the entry set to 0.)-.26 F(Whene)8.314 E -.195
(ve)-.325 G 5.064(rs).195 G 1.814(uch a NULL)-5.064 F 3.067
(pointer is encountered during the tra)33.336 648.518 R -.195(ve)-.26 G
3.067(rsal of the multi-le).195 F -.195(ve)-.325 G 6.317(lp).195 G 3.067
(age table structure, it)-6.317 F(causes a P)33.336 663.518 Q(age F)
-.195 E(ault, the same as if the Present bit of the PTE were 0.)-.195 E
3.552(The Linux k)33.336 684.518 R 3.551(ernel uses this adv)-.13 F
3.551(antageously in performing "just in time" page table)-.325 F 5.523
(allocations. All)33.336 699.518 R 2.274
(processes get allocated an indi)5.523 F 2.274(vidual PGD.)-.325 F(Ho)
8.774 E(we)-.325 E -.195(ve)-.325 G 3.314 -.52(r, t).195 H 2.274(he lo)
.52 F(wer)-.325 E(-le)-.26 E -.195(ve)-.325 G(l).195 E 2.393
(tables hanging of)33.336 714.518 R 5.643(ft)-.325 G 2.393
(he PGD entries are not allocated until the corresponding areas of)
-5.643 F .882(virtual memory are created \(or gro)33.336 729.518 R .882
(wn\) AND a page f)-.325 F .882(ault happens \(see more under P)-.13 F
(age)-.195 E -.195(Fa)33.336 744.518 S .888(ult Resolution\) Areas of v\
irtual memory which are not used \(these can be quite lar).195 F(ge,)
-.234 E 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 9)73.998 E(\2512016 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF .726
(especially with a 64-bit system\) do not consume additional resources.)
33.336 120 R .726(This is analogous)7.226 F .108(to sparse \214le alloc\
ation \(recall from unit 2 that when one lseeks be)33.336 135 R .108
(yond the current end of)-.195 F 1.037(\214le and writes, this creates \
a "hole" in the \214le for which actual disk storage may not be)33.336
150 R(allocated\))33.336 165 Q .761(It is also possible for a gi)33.336
186 R -.195(ve)-.325 G 4.01(nP).195 G .76(age T)-4.205 F .76
(able or PUD or PMD to be pointed at by more than)-1.04 F .372(one PGD.)
33.336 201 R .372(The Linux k)6.872 F .373
(ernel uses this trick so it can create just one instance of the multi-)
-.13 F(le)33.336 216 Q -.195(ve)-.325 G 4.085(lp).195 G .835
(age table structure for the shared k)-4.085 F .835(ernel memory)-.13 F
4.085(,a)-.845 G .835(nd allo)-4.085 F 4.085(wa)-.325 G .834
(ll processes to share)-4.085 F
(that \(see more under Linux Address Space\).)33.336 231 Q 0 0 288 719
-347.683 868 123.336 614.683 PBEGIN
%%BeginDocument: pagetables.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: pagetables.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Wed Dec  2 23:19:30 2015
%%For: hak@lex ()
%%BoundingBox: 0 0 719 868
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 868 moveto 0 0 lineto 719 0 lineto 719 868 lineto closepath clip newpath
-39.8 891.8 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
7.500 slw
n 7650 5325 m 8250 5325 l 8250 8925 l 7650 8925 l
 cp gs col0 s gr 
% Polyline
n 7650 5625 m
 8250 5625 l gs col0 s gr 
% Polyline
n 7650 5925 m
 8250 5925 l gs col0 s gr 
% Polyline
n 7650 6225 m
 8250 6225 l gs col0 s gr 
% Polyline
n 7650 8625 m
 8250 8625 l gs col0 s gr 
% Polyline
n 7650 8325 m
 8250 8325 l gs col0 s gr 
% Polyline
n 7650 7725 m
 8250 7725 l gs col0 s gr 
% Polyline
n 7650 8025 m
 8250 8025 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
7800 5100 m
gs 1 -1 sc (PUD) col0 sh gr
/Times-Roman ff 200.00 scf sf
7875 6825 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 7650 10050 m 8250 10050 l 8250 13650 l 7650 13650 l
 cp gs col0 s gr 
% Polyline
n 7650 10350 m
 8250 10350 l gs col0 s gr 
% Polyline
n 7650 10650 m
 8250 10650 l gs col0 s gr 
% Polyline
n 7650 10950 m
 8250 10950 l gs col0 s gr 
% Polyline
n 7650 13350 m
 8250 13350 l gs col0 s gr 
% Polyline
n 7650 13050 m
 8250 13050 l gs col0 s gr 
% Polyline
n 7650 12450 m
 8250 12450 l gs col0 s gr 
% Polyline
n 7650 12750 m
 8250 12750 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
7800 9825 m
gs 1 -1 sc (PUD) col0 sh gr
/Times-Roman ff 200.00 scf sf
7875 11550 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 8700 900 m 9300 900 l 9300 4500 l 8700 4500 l
 cp gs col0 s gr 
% Polyline
n 8700 1200 m
 9300 1200 l gs col0 s gr 
% Polyline
n 8700 1500 m
 9300 1500 l gs col0 s gr 
% Polyline
n 8700 1800 m
 9300 1800 l gs col0 s gr 
% Polyline
n 8700 4200 m
 9300 4200 l gs col0 s gr 
% Polyline
n 8700 3900 m
 9300 3900 l gs col0 s gr 
% Polyline
n 8700 3300 m
 9300 3300 l gs col0 s gr 
% Polyline
n 8700 3600 m
 9300 3600 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
8850 675 m
gs 1 -1 sc (PMD) col0 sh gr
/Times-Roman ff 200.00 scf sf
8925 2400 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 9900 900 m 10500 900 l 10500 4500 l 9900 4500 l
 cp gs col0 s gr 
% Polyline
n 9900 1200 m
 10500 1200 l gs col0 s gr 
% Polyline
n 9900 1500 m
 10500 1500 l gs col0 s gr 
% Polyline
n 9900 1800 m
 10500 1800 l gs col0 s gr 
% Polyline
n 9900 4200 m
 10500 4200 l gs col0 s gr 
% Polyline
n 9900 3900 m
 10500 3900 l gs col0 s gr 
% Polyline
n 9900 3300 m
 10500 3300 l gs col0 s gr 
% Polyline
n 9900 3600 m
 10500 3600 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
10050 675 m
gs 1 -1 sc (PT) col0 sh gr
/Times-Roman ff 200.00 scf sf
10125 2400 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 8700 5325 m 9300 5325 l 9300 8925 l 8700 8925 l
 cp gs col0 s gr 
% Polyline
n 8700 5625 m
 9300 5625 l gs col0 s gr 
% Polyline
n 8700 5925 m
 9300 5925 l gs col0 s gr 
% Polyline
n 8700 6225 m
 9300 6225 l gs col0 s gr 
% Polyline
n 8700 8625 m
 9300 8625 l gs col0 s gr 
% Polyline
n 8700 8325 m
 9300 8325 l gs col0 s gr 
% Polyline
n 8700 7725 m
 9300 7725 l gs col0 s gr 
% Polyline
n 8700 8025 m
 9300 8025 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
8850 5100 m
gs 1 -1 sc (PMD) col0 sh gr
/Times-Roman ff 200.00 scf sf
8925 6825 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 9900 5325 m 10500 5325 l 10500 8925 l 9900 8925 l
 cp gs col0 s gr 
% Polyline
n 9900 5625 m
 10500 5625 l gs col0 s gr 
% Polyline
n 9900 5925 m
 10500 5925 l gs col0 s gr 
% Polyline
n 9900 6225 m
 10500 6225 l gs col0 s gr 
% Polyline
n 9900 8625 m
 10500 8625 l gs col0 s gr 
% Polyline
n 9900 8325 m
 10500 8325 l gs col0 s gr 
% Polyline
n 9900 7725 m
 10500 7725 l gs col0 s gr 
% Polyline
n 9900 8025 m
 10500 8025 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
10050 5100 m
gs 1 -1 sc (PT) col0 sh gr
/Times-Roman ff 200.00 scf sf
10125 6825 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 8700 10050 m 9300 10050 l 9300 13650 l 8700 13650 l
 cp gs col0 s gr 
% Polyline
n 8700 10350 m
 9300 10350 l gs col0 s gr 
% Polyline
n 8700 10650 m
 9300 10650 l gs col0 s gr 
% Polyline
n 8700 10950 m
 9300 10950 l gs col0 s gr 
% Polyline
n 8700 13350 m
 9300 13350 l gs col0 s gr 
% Polyline
n 8700 13050 m
 9300 13050 l gs col0 s gr 
% Polyline
n 8700 12450 m
 9300 12450 l gs col0 s gr 
% Polyline
n 8700 12750 m
 9300 12750 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
8850 9825 m
gs 1 -1 sc (PMD) col0 sh gr
/Times-Roman ff 200.00 scf sf
8925 11550 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 9900 10050 m 10500 10050 l 10500 13650 l 9900 13650 l
 cp gs col0 s gr 
% Polyline
n 9900 10350 m
 10500 10350 l gs col0 s gr 
% Polyline
n 9900 10650 m
 10500 10650 l gs col0 s gr 
% Polyline
n 9900 10950 m
 10500 10950 l gs col0 s gr 
% Polyline
n 9900 13350 m
 10500 13350 l gs col0 s gr 
% Polyline
n 9900 13050 m
 10500 13050 l gs col0 s gr 
% Polyline
n 9900 12450 m
 10500 12450 l gs col0 s gr 
% Polyline
n 9900 12750 m
 10500 12750 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
10050 9825 m
gs 1 -1 sc (PT) col0 sh gr
/Times-Roman ff 200.00 scf sf
10125 11550 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
n 7650 900 m 8250 900 l 8250 4500 l 7650 4500 l
 cp gs col0 s gr 
% Polyline
n 7650 1200 m
 8250 1200 l gs col0 s gr 
% Polyline
n 7650 1500 m
 8250 1500 l gs col0 s gr 
% Polyline
n 7650 1800 m
 8250 1800 l gs col0 s gr 
% Polyline
n 7650 4200 m
 8250 4200 l gs col0 s gr 
% Polyline
n 7650 3900 m
 8250 3900 l gs col0 s gr 
% Polyline
n 7650 3300 m
 8250 3300 l gs col0 s gr 
% Polyline
n 7650 3600 m
 8250 3600 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
7800 675 m
gs 1 -1 sc (PUD) col0 sh gr
/Times-Roman ff 200.00 scf sf
7875 2400 m
gs 1 -1 sc (. . .) col0 sh gr
% Polyline
gs  clippath
7605 989 m 7568 942 l 7448 1034 l 7562 985 l 7485 1081 l cp
eoclip
n 6600 1725 m
 7575 975 l gs col0 s gr gr

% arrowhead
n 7485 1081 m 7562 985 l 7448 1034 l  col0 s
% Polyline
n 675 5100 m 2625 5100 l 2625 6750 l 675 6750 l
 cp gs col0 s gr 
% Polyline
n 3375 5325 m 5250 5325 l 5250 6975 l 3375 6975 l
 cp gs col0 s gr 
% Polyline
gs  clippath
3313 5355 m 3316 5295 l 3164 5287 l 3283 5324 l 3161 5347 l cp
eoclip
n 1875 5250 m
 3300 5325 l gs col0 s gr gr

% arrowhead
n 3161 5347 m 3283 5324 l 3164 5287 l  col0 s
% Polyline
gs  clippath
6174 5347 m 6153 5291 l 6011 5345 l 6134 5331 l 6032 5401 l cp
eoclip
n 4350 6000 m
 6150 5325 l gs col0 s gr gr

% arrowhead
n 6032 5401 m 6134 5331 l 6011 5345 l  col0 s
% Polyline
n 6300 5325 m 6900 5325 l 6900 8925 l 6300 8925 l
 cp gs col0 s gr 
% Polyline
n 6300 5625 m
 6900 5625 l gs col0 s gr 
% Polyline
n 6300 5925 m
 6900 5925 l gs col0 s gr 
% Polyline
n 6300 6225 m
 6900 6225 l gs col0 s gr 
% Polyline
n 6300 8625 m
 6900 8625 l gs col0 s gr 
% Polyline
n 6300 8325 m
 6900 8325 l gs col0 s gr 
% Polyline
30.000 slw
n 6300 7725 m
 6900 7725 l gs col0 s gr 
% Polyline
7.500 slw
n 6300 8025 m
 6900 8025 l gs col0 s gr 
% Polyline
n 675 675 m 2625 675 l 2625 2325 l 675 2325 l
 cp gs col0 s gr 
% Polyline
n 3375 900 m 5250 900 l 5250 2550 l 3375 2550 l
 cp gs col0 s gr 
% Polyline
gs  clippath
3313 930 m 3316 870 l 3164 862 l 3283 899 l 3161 922 l cp
eoclip
n 1875 825 m
 3300 900 l gs col0 s gr gr

% arrowhead
n 3161 922 m 3283 899 l 3164 862 l  col0 s
% Polyline
gs  clippath
6174 922 m 6153 866 l 6011 920 l 6134 906 l 6032 976 l cp
eoclip
n 4350 1575 m
 6150 900 l gs col0 s gr gr

% arrowhead
n 6032 976 m 6134 906 l 6011 920 l  col0 s
% Polyline
n 6300 900 m 6900 900 l 6900 4500 l 6300 4500 l
 cp gs col0 s gr 
% Polyline
n 6300 1200 m
 6900 1200 l gs col0 s gr 
% Polyline
n 6300 1500 m
 6900 1500 l gs col0 s gr 
% Polyline
n 6300 1800 m
 6900 1800 l gs col0 s gr 
% Polyline
n 6300 4200 m
 6900 4200 l gs col0 s gr 
% Polyline
n 6300 3900 m
 6900 3900 l gs col0 s gr 
% Polyline
30.000 slw
n 6300 3300 m
 6900 3300 l gs col0 s gr 
% Polyline
7.500 slw
n 6300 3600 m
 6900 3600 l gs col0 s gr 
% Polyline
gs  clippath
8657 893 m 8599 877 l 8561 1024 l 8621 916 l 8619 1039 l cp
eoclip
n 7950 3450 m
 8625 900 l gs col0 s gr gr

% arrowhead
n 8619 1039 m 8621 916 l 8561 1024 l  col0 s
% Polyline
gs  clippath
9932 909 m 9887 868 l 9786 980 l 9889 912 l 9830 1020 l cp
eoclip
n 9150 1725 m
 9900 900 l gs col0 s gr gr

% arrowhead
n 9830 1020 m 9889 912 l 9786 980 l  col0 s
% Polyline
gs  clippath
7628 10075 m 7683 10051 l 7621 9913 l 7643 10035 l 7566 9937 l cp
eoclip
n 6675 7875 m
 7650 10050 l gs col0 s gr gr

% arrowhead
n 7566 9937 m 7643 10035 l 7621 9913 l  col0 s
% Polyline
gs  clippath
7545 9916 m 7605 9913 l 7596 9761 l 7574 9883 l 7536 9765 l cp
eoclip
n 6750 3375 m 7350 6300 l
 7575 9900 l gs col0 s gr gr

% arrowhead
n 7536 9765 m 7574 9883 l 7596 9761 l  col0 s
% Polyline
gs  clippath
7604 5340 m 7569 5291 l 7446 5380 l 7562 5335 l 7481 5429 l cp
eoclip
n 6525 6075 m
 7575 5325 l gs col0 s gr gr

% arrowhead
n 7481 5429 m 7562 5335 l 7446 5380 l  col0 s
% Polyline
gs  clippath
8732 5332 m 8685 5294 l 8591 5412 l 8690 5338 l 8638 5450 l cp
eoclip
n 8100 6075 m
 8700 5325 l gs col0 s gr gr

% arrowhead
n 8638 5450 m 8690 5338 l 8591 5412 l  col0 s
% Polyline
gs  clippath
9932 5318 m 9874 5302 l 9836 5449 l 9896 5341 l 9894 5464 l cp
eoclip
n 9225 7875 m
 9900 5325 l gs col0 s gr gr

% arrowhead
n 9894 5464 m 9896 5341 l 9836 5449 l  col0 s
% Polyline
n 675 8775 m 2625 8775 l 2625 10425 l 675 10425 l
 cp gs col0 s gr 
% Polyline
gs  clippath
3333 5471 m 3277 5450 l 3223 5591 l 3294 5490 l 3279 5612 l cp
eoclip
n 1950 9000 m
 3300 5475 l gs col0 s gr gr

% arrowhead
n 3279 5612 m 3294 5490 l 3223 5591 l  col0 s
% Polyline
2 slj
 [60] 0 sd
n 7275 9525 m 7346 9502 l 7417 9481 l 7485 9461 l 7550 9443 l 7611 9427 l
 7666 9413 l 7716 9400 l 7761 9390 l 7800 9381 l 7834 9373 l
 7862 9367 l 7887 9362 l 7907 9358 l 7924 9355 l 7937 9353 l
 7949 9352 l 7958 9351 l 7967 9350 l 7975 9350 l 7983 9350 l
 7993 9350 l 8003 9350 l 8016 9349 l 8032 9349 l 8052 9348 l
 8076 9347 l 8104 9345 l 8139 9343 l 8179 9340 l 8226 9337 l
 8280 9333 l 8342 9329 l 8411 9324 l 8487 9319 l 8570 9314 l
 8658 9309 l 8752 9304 l 8850 9300 l 8932 9297 l 9014 9294 l
 9094 9292 l 9172 9290 l 9248 9288 l 9320 9286 l 9388 9284 l
 9452 9282 l 9511 9280 l 9567 9277 l 9618 9275 l 9665 9272 l
 9708 9269 l 9748 9266 l 9784 9262 l 9817 9259 l 9847 9255 l
 9876 9251 l 9902 9247 l 9926 9243 l 9949 9239 l 9972 9235 l
 9994 9231 l 10016 9228 l 10038 9224 l 10061 9221 l 10084 9219 l
 10109 9216 l 10136 9215 l 10165 9214 l 10197 9213 l 10231 9214 l
 10268 9216 l 10308 9218 l 10351 9222 l 10398 9227 l 10449 9234 l
 10503 9242 l 10561 9252 l 10621 9264 l 10685 9277 l 10751 9293 l
 10819 9310 l 10888 9330 l 10957 9351 l 11025 9375 l 11104 9406 l
 11178 9438 l 11247 9471 l 11309 9504 l 11365 9535 l 11414 9566 l
 11457 9594 l 11493 9621 l 11523 9645 l 11548 9668 l 11567 9688 l
 11582 9706 l 11593 9723 l 11601 9738 l 11606 9752 l 11608 9765 l
 11609 9777 l 11608 9788 l 11606 9800 l 11604 9812 l 11603 9824 l
 11601 9838 l 11601 9852 l 11603 9869 l 11606 9887 l 11612 9908 l
 11620 9931 l 11631 9958 l 11646 9988 l 11664 10022 l 11686 10059 l
 11711 10101 l 11741 10146 l 11773 10196 l 11808 10249 l 11846 10305 l
 11885 10364 l 11925 10425 l 11966 10490 l 12005 10553 l 12043 10615 l
 12077 10673 l 12109 10726 l 12137 10776 l 12163 10820 l 12186 10860 l
 12206 10895 l 12223 10925 l 12238 10952 l 12251 10975 l 12262 10994 l
 12272 11011 l 12280 11026 l 12287 11039 l 12294 11051 l 12300 11063 l
 12306 11074 l 12312 11086 l 12318 11099 l 12325 11114 l 12332 11131 l
 12341 11150 l 12350 11173 l 12361 11200 l 12373 11230 l 12386 11265 l
 12400 11305 l 12416 11349 l 12433 11399 l 12451 11452 l 12470 11510 l
 12489 11572 l 12508 11635 l 12525 11700 l 12543 11772 l 12558 11841 l
 12571 11905 l 12582 11963 l 12591 12015 l 12598 12060 l 12604 12098 l
 12609 12130 l 12613 12155 l 12615 12176 l 12617 12191 l 12618 12203 l
 12619 12211 l 12619 12217 l 12619 12221 l 12619 12225 l 12618 12229 l
 12617 12233 l 12615 12239 l 12614 12247 l 12611 12259 l 12609 12274 l
 12605 12295 l 12601 12320 l 12596 12352 l 12590 12390 l 12584 12435 l
 12575 12487 l 12565 12545 l 12554 12609 l 12540 12678 l 12525 12750 l
 12511 12811 l 12496 12872 l 12481 12930 l 12468 12986 l 12456 13038 l
 12446 13087 l 12439 13131 l 12433 13172 l 12430 13208 l 12430 13240 l
 12431 13268 l 12435 13293 l 12440 13315 l 12447 13334 l 12455 13352 l
 12464 13367 l 12474 13381 l 12484 13394 l 12494 13406 l 12503 13419 l
 12511 13432 l 12518 13445 l 12523 13460 l 12525 13477 l 12524 13495 l
 12520 13517 l 12512 13541 l 12499 13568 l 12480 13599 l 12456 13633 l
 12425 13671 l 12388 13713 l 12343 13759 l 12290 13808 l 12229 13860 l
 12160 13914 l 12084 13969 l 12000 14025 l 11935 14065 l 11868 14104 l
 11800 14142 l 11732 14178 l 11665 14213 l 11599 14247 l 11535 14279 l
 11474 14309 l 11415 14337 l 11360 14364 l 11308 14389 l 11259 14412 l
 11214 14434 l 11171 14455 l 11132 14474 l 11096 14492 l 11063 14509 l
 11032 14524 l 11004 14539 l 10977 14553 l 10953 14567 l 10929 14579 l
 10907 14591 l 10886 14603 l 10865 14614 l 10844 14625 l 10822 14636 l
 10801 14646 l 10777 14656 l 10753 14667 l 10727 14677 l 10698 14687 l
 10667 14697 l 10633 14708 l 10596 14718 l 10555 14729 l 10510 14740 l
 10461 14750 l 10406 14761 l 10347 14772 l 10282 14783 l 10212 14793 l
 10137 14803 l 10055 14813 l 9968 14822 l 9875 14830 l 9777 14837 l
 9674 14843 l 9567 14848 l 9456 14851 l 9341 14852 l 9225 14850 l
 9120 14846 l 9016 14841 l 8912 14834 l 8811 14826 l 8712 14817 l
 8617 14808 l 8525 14798 l 8437 14788 l 8353 14777 l 8273 14767 l
 8198 14757 l 8127 14748 l 8060 14739 l 7998 14730 l 7940 14722 l
 7886 14715 l 7835 14707 l 7788 14701 l 7744 14695 l 7703 14689 l
 7665 14684 l 7629 14679 l 7596 14675 l 7564 14671 l 7535 14666 l
 7506 14662 l 7478 14658 l 7451 14654 l 7425 14650 l 7399 14645 l
 7372 14640 l 7346 14635 l 7318 14629 l 7290 14622 l 7260 14614 l
 7229 14605 l 7196 14595 l 7161 14583 l 7124 14570 l 7085 14556 l
 7043 14539 l 6998 14521 l 6950 14501 l 6900 14478 l 6846 14453 l
 6789 14426 l 6729 14396 l 6665 14363 l 6599 14328 l 6530 14289 l
 6458 14247 l 6384 14203 l 6309 14155 l 6232 14104 l 6154 14051 l
 6077 13995 l 6000 13936 l 5925 13875 l 5845 13805 l 5768 13733 l
 5696 13661 l 5629 13589 l 5566 13517 l 5508 13448 l 5455 13380 l
 5407 13314 l 5364 13251 l 5325 13190 l 5291 13132 l 5260 13077 l
 5234 13025 l 5211 12976 l 5192 12929 l 5176 12885 l 5162 12843 l
 5151 12804 l 5143 12766 l 5136 12730 l 5131 12695 l 5128 12662 l
 5126 12630 l 5125 12599 l 5125 12568 l 5125 12537 l 5126 12507 l
 5127 12476 l 5128 12445 l 5129 12413 l 5129 12380 l 5130 12346 l
 5129 12311 l 5128 12274 l 5126 12235 l 5123 12194 l 5119 12151 l
 5114 12105 l 5107 12057 l 5099 12006 l 5091 11953 l 5081 11897 l
 5069 11839 l 5057 11778 l 5044 11715 l 5030 11651 l 5016 11584 l
 5002 11517 l 4987 11449 l 4974 11381 l 4961 11315 l 4950 11250 l
 4938 11162 l 4929 11080 l 4924 11007 l 4923 10942 l 4924 10886 l
 4928 10838 l 4934 10799 l 4941 10767 l 4950 10741 l 4960 10723 l
 4971 10710 l 4983 10701 l 4995 10697 l 5008 10697 l 5021 10700 l
 5034 10705 l 5048 10711 l 5063 10719 l 5077 10727 l 5092 10735 l
 5107 10743 l 5123 10749 l 5139 10755 l 5155 10758 l 5172 10759 l
 5190 10757 l 5208 10753 l 5227 10745 l 5246 10734 l 5267 10719 l
 5288 10701 l 5309 10680 l 5331 10656 l 5354 10630 l 5377 10602 l
 5400 10575 l 5440 10529 l 5477 10488 l 5509 10455 l 5534 10428 l
 5554 10408 l 5569 10395 l 5579 10385 l 5586 10380 l 5590 10377 l
 5594 10375 l 5597 10374 l 5601 10372 l 5608 10369 l 5618 10364 l
 5631 10356 l 5650 10345 l 5674 10331 l 5704 10314 l 5738 10294 l
 5775 10275 l 5816 10256 l 5852 10242 l 5880 10233 l 5899 10229 l
 5910 10231 l 5914 10237 l 5912 10246 l 5907 10257 l 5900 10269 l
 5894 10280 l 5891 10290 l 5893 10297 l 5903 10299 l 5925 10296 l
 5959 10285 l 6008 10266 l 6072 10238 l 6150 10200 l 6193 10178 l
 6236 10156 l 6279 10132 l 6320 10109 l 6359 10086 l 6395 10064 l
 6428 10043 l 6458 10023 l 6484 10004 l 6507 9986 l 6527 9970 l
 6545 9954 l 6560 9940 l 6572 9926 l 6584 9912 l 6594 9900 l
 6603 9887 l 6613 9875 l 6622 9863 l 6632 9850 l 6644 9837 l
 6657 9824 l 6673 9810 l 6692 9794 l 6714 9778 l 6740 9761 l
 6770 9742 l 6805 9722 l 6846 9701 l 6892 9678 l 6943 9654 l
 7000 9629 l 7063 9603 l 7130 9577 l 7201 9551 l
 cp gs col0 s gr  [] 0 sd
/Times-Roman ff 200.00 scf sf
825 5025 m
gs 1 -1 sc (task_struct) col0 sh gr
/Times-Roman ff 200.00 scf sf
1425 5400 m
gs 1 -1 sc (mm) col0 sh gr
/Times-Roman ff 200.00 scf sf
3825 5100 m
gs 1 -1 sc (mm_struct) col0 sh gr
/Times-Roman ff 200.00 scf sf
3900 6075 m
gs 1 -1 sc (pgd) col0 sh gr
/Times-Roman ff 200.00 scf sf
6450 5100 m
gs 1 -1 sc (PGD) col0 sh gr
/Times-Roman ff 200.00 scf sf
6525 6825 m
gs 1 -1 sc (. . .) col0 sh gr
/Times-Roman ff 200.00 scf sf
6525 8175 m
gs 1 -1 sc (. . .) col0 sh gr
/Times-Roman ff 200.00 scf sf
6150 7725 m
gs 1 -1 sc (C0000000) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman ff 200.00 scf sf
825 600 m
gs 1 -1 sc (task_struct) col0 sh gr
/Times-Roman ff 200.00 scf sf
1425 975 m
gs 1 -1 sc (mm) col0 sh gr
/Times-Roman ff 200.00 scf sf
3825 675 m
gs 1 -1 sc (mm_struct) col0 sh gr
/Times-Roman ff 200.00 scf sf
3900 1650 m
gs 1 -1 sc (pgd) col0 sh gr
/Times-Roman ff 200.00 scf sf
6450 675 m
gs 1 -1 sc (PGD) col0 sh gr
/Times-Roman ff 200.00 scf sf
6525 2400 m
gs 1 -1 sc (. . .) col0 sh gr
/Times-Roman ff 200.00 scf sf
6525 3750 m
gs 1 -1 sc (. . .) col0 sh gr
/Times-Roman ff 200.00 scf sf
6150 3300 m
gs 1 -1 sc (C0000000) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman ff 200.00 scf sf
1200 1425 m
gs 1 -1 sc (pid=123) col0 sh gr
/Times-Roman ff 200.00 scf sf
1275 5925 m
gs 1 -1 sc (pid=456) col0 sh gr
/Times-Roman ff 200.00 scf sf
10050 1125 m
gs 1 -1 sc (pte) col0 sh gr
/Times-Roman ff 200.00 scf sf
10050 5550 m
gs 1 -1 sc (pte) col0 sh gr
/Times-Roman ff 200.00 scf sf
10050 10275 m
gs 1 -1 sc (pte) col0 sh gr
/Times-Roman ff 200.00 scf sf
5625 10875 m
gs 1 -1 sc (Kernel's page) col0 sh gr
/Times-Roman ff 200.00 scf sf
5625 11130 m
gs 1 -1 sc (tables.  Generally) col0 sh gr
/Times-Roman ff 200.00 scf sf
5625 11385 m
gs 1 -1 sc (never paged out.) col0 sh gr
/Times-Roman ff 200.00 scf sf
825 8475 m
gs 1 -1 sc (task_struct) col0 sh gr
/Times-Roman ff 200.00 scf sf
1425 9075 m
gs 1 -1 sc (mm) col0 sh gr
/Times-Roman ff 200.00 scf sf
1275 9600 m
gs 1 -1 sc (pid=789) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F2 13/Times-Bold@0 SF -.962(Tr)162.738 650.683 S
(anslations Cache & Context Switch).962 E F1 -.195(Pa)33.336 686.683 S
1.818(ge table entries reside in main memory).195 F 5.068(,a)-.845 G
1.818(nd thus consume tw)-5.068 F 5.068(oi)-.13 G 1.818
(mportant resources:)-5.068 F 5.09(The memory needed to store the page \
tables and the time required to perform)33.336 701.683 R 3.815
(translations. W)33.336 716.683 R 3.815(eh)-1.04 G -2.925 -.26(av e)
-3.815 H .565(seen ho)4.075 F 3.815(wm)-.325 G(ulti-le)-3.815 E -.195
(ve)-.325 G 3.815(lp).195 G .566(age tables address the former concern.)
-3.815 F(The)7.066 E .06(latter is e)33.336 731.683 R .06
(xtremely signi\214cant too, since a translation must be performed on e)
-.195 F -.195(ve)-.325 G .06(ry memory).195 F 5.11(access. If)33.336
746.683 R 1.86(the MMU w)5.11 F(ork)-.13 E 1.861
(ed literally as described thus f)-.13 F(ar)-.13 E 5.111(,f)-.52 G 1.861
(or a 2-le)-5.111 F -.195(ve)-.325 G 5.111(lp).195 G 1.861(age table, 2)
-5.111 F 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 10)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.317(additional memory accesses w)33.336
120 R 1.317(ould be required for e)-.13 F -.195(ve)-.325 G 1.316
(ry access attempted, i.e. memory).195 F .178(performance w)33.336 135 R
.178(ould be reduced to one third.)-.13 F .178
(Therefore, a cache, often called the)6.678 F/F2 13/Times-Bold@0 SF
(Addr)3.428 E(ess)-.234 E -.962(Tr)33.336 150 S 1.863
(anslation Cache \(A).962 F(TC\))-1.235 E F1(or)5.113 E F2 -.962(Tr)
5.113 G 1.863(anslation Lookaside Buffer \(TLB\)).962 F F1 5.112(,i)C
5.112(su)-5.112 G 1.862(sed to speed)-5.112 F(translations.)33.336 165 Q
(Lik)33.336 186 Q 3.35(ea)-.13 G .49 -.195(ny c)-3.35 H .1(ache, the A)
.195 F .1(TC is a content-addressable memory)-1.443 F 6.6(.A)-.845 G F2
-.13(ke)-3.25 G(y).13 E F1 .101(is presented, and either)3.351 F 2.12
(the stored)33.336 201 R F2 -.13(va)5.37 G(lue).13 E F1 2.12
(is accessed \(a)5.37 F F2("hit)5.37 E F1 2.12("\), or the k)B 2.51
-.195(ey i)-.13 H 5.37(sn).195 G 2.119(ot found in the cache, which is)
-5.37 F(kno)33.336 216 Q .039(wn as a)-.325 F F2 .039(cache miss)3.289 F
F1 6.539(.R)C .039(ecall that the address translation process tak)-6.539
F .039(es the page number)-.13 F .374
(portion of a virtual address and returns a page table entry)33.336 231
R 6.874(.T)-.845 G .374(herefore, the k)-6.874 F .763 -.195(ey i)-.13 H
3.623(nt).195 G .373(his case)-3.623 F .763
(is the virtual address being translated \(or more correctly)33.336 246
R 4.013(,t)-.845 G .764(he page number portion of the)-4.013 F -1.755
(VA)33.336 261 S(\), and the v)1.755 E(alue accessed is the PTE.)-.325 E
-.195(Fo)33.336 282 S 3.469(re).195 G -.195(ve)-3.794 G .219
(ry virtual memory access, the A).195 F .218
(TC is searched to see if a v)-1.443 F .218(alid, cached PTE e)-.325 F
(xists)-.195 E 2.674(for the referenced virtual page number)33.336 297 R
9.174(.I)-.715 G 5.924(fs)-9.174 G 2.674
(o, the translation is performed using the)-5.924 F .222
(cached page table entry)33.336 312 R 6.722(.O)-.845 G .222
(therwise, hardw)-6.722 F .222(are tra)-.13 F -.195(ve)-.26 G .222
(rses the page table structure and loads).195 F .352
(the correct translation, k)33.336 327 R .353
(eeping it cached for possible future re-use.)-.13 F .353
(The cache is of \214nite)6.853 F .123
(\(and typically rather small\) size, so the insertion of a ne)33.336
342 R 3.373(wc)-.325 G .123(ached translation into the A)-3.373 F(TC)
-1.443 E(generally eradicates an older cache entry to mak)33.336 357 Q
3.25(er)-.13 G(oom.)-3.25 E(A)33.336 378 Q F2 .583(context switch)3.833
F F1 .583(is when the k)3.833 F .583
(ernel changes from one process to another which implies)-.13 F 3.375
(ac)33.336 393 S .125(hange in both the task and the address space.)
-3.375 F .125(\(in contrast, a)6.625 F F2 .125(task switch)3.375 F F1
3.375(,a)C 3.375(tl)-3.375 G .125(east in the)-3.375 F 1.603(Linux k)
33.336 408 R 1.603(ernel, could be a change from one thread to another \
while staying in the same)-.13 F .026(address space\).)33.336 423 R
2.106 -1.04(To p)6.526 H .026(erform a conte)1.04 F .026
(xt switch on X86, the k)-.195 F .026(ernel simply modi\214es the %cr3)
-.13 F(re)33.336 438 Q 1.645(gister with the ph)-.195 F 1.646
(ysical address of the PGD representing the ne)-.065 F 4.896(wp)-.325 G
4.896(rocess. Ho)-4.896 F(we)-.325 E -.195(ve)-.325 G -.52(r,).195 G
1.476(this creates a problem with the TLB, since the cached virtual add\
ress mappings are no)33.336 453 R(longer v)33.336 468 Q(alid in the ne)
-.325 E 3.25(wv)-.325 G(irtual address space.)-3.25 E .846
(On some architectures \(e.g. SP)33.336 489 R .846
(ARC, MIPS and X86-64\), a)-1.196 F F2 .846(context number)4.096 F F1
(or)4.096 E F2(Addr)4.097 E(ess)-.234 E .307(Space ID)33.336 504 R F1
.307(is used in conjunction with the A)3.557 F .307
(TC/TLB to disambiguate the virtual addresses)-1.443 F 1.534(of multipl\
e processes' translations which might be resident in the cache at once.)
33.336 519 R(Each)8.034 E .23(process is assigned a unique conte)33.336
534 R .23(xt number)-.195 F 6.73(.A)-.715 G .23(CPU special re)-3.25 F
.23(gister contains the current)-.195 F(conte)33.336 549 Q .115
(xt number and it is that number)-.195 F 3.365(,c)-.52 G .115
(ombined with the virtual page number)-3.365 F 3.366(,w)-.52 G .116
(hich k)-3.366 F -.195(ey)-.13 G(s).195 E 2.597(the associati)33.336 564
R 2.987 -.195(ve a)-.325 H(rray).195 E 9.097(.T)-.845 G 5.847(op)-10.137
G 2.597(erform a conte)-5.847 F 2.597
(xt switch, both the page table base address)-.195 F(re)33.336 579 Q
(gister and the conte)-.195 E(xt number re)-.195 E
(gister are changed at the same time.)-.195 E .695(While the ne)33.336
600 R .696(wer 64-bit X86 processors ha)-.325 F 1.086 -.195(ve s)-.26 H
.696(upport for a conte).195 F .696(xt number \(it is 12 bits\),)-.195 F
1.43(neither the older 64-bit processors nor the 32-bit processors ha)
33.336 615 R 1.82 -.195(ve t)-.26 H 1.43(his feature.).195 F(Lacking)
7.93 E(conte)33.336 630 Q 2.967(xt numbers, when the page table B)-.195
F 2.967(ASE re)-.455 F 2.968(gister \(%cr3\) is changed, meaning a)-.195
F 3.035(switch to a dif)33.336 645 R 3.034
(ferent address space, the CPU hardw)-.325 F 3.034(are in)-.13 F -.325
(va)-.52 G 3.034(lidates \(\215ushes\) all TLB).325 F .598(entries, e)
33.336 660 R .598(xcept those where the cached PTE has a special G \(Gl\
obal\) \215ag set.)-.195 F .598(The Linux)7.098 F -.13(ke)33.336 675 S
.516(rnel creates the PTEs for the shared k).13 F .516
(ernel virtual address space so the)-.13 F 3.766(ya)-.195 G .516(ll ha)
-3.766 F .906 -.195(ve t)-.26 H .515(he G).195 F 4.587
(\215ag. Therefore,)33.336 690 R 1.338(when making a conte)4.588 F 1.338
(xt switch, while the user)-.195 F 1.338(-mode PTEs get \215ushed,)-.26
F(all of the k)33.336 705 Q(ernel-mode PTEs can remain in the TLB.)-.13
E(This is a big performance boost.)6.5 E .569
(Another complication arises when the k)33.336 726 R .568
(ernel has to change the PTE mapping for a gi)-.13 F -.195(ve)-.325 G(n)
.195 E 1.4(virtual page, e.g. an area of memory is being un-mapped, or \
changed from readonly to)33.336 741 R 0 Cg EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 11)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 4.009(readwrite. If)33.336 120 R .759
(the PTE is cached in the TLB it must be \215ushed.)4.009 F .758
(On older v)7.258 F .758(ersions of the)-.195 F 2.38
(X86 processors, it w)33.336 135 R 2.38
(as necessary to \215ush the entire TLB, b)-.13 F 2.38(ut modern v)-.26
F 2.38(ersions allo)-.195 F(w)-.325 E 2.102
(speci\214c entries to be \215ushed indi)33.336 150 R 2.101
(vidually with a special \(supervisor mode\) instruction)-.325 F(called)
33.336 165 Q/F2 13/Courier@0 SF(INVLPG)3.25 E F1(.)A(Ev)33.336 186 Q
.139(en more fun with TLB \215ushing comes on multiprocessor systems an\
d especially multi-)-.195 F .764
(threaded programs, because each processor maintains its o)33.336 201 R
.764(wn TLB.)-.325 F .764(It could be that tw)7.264 F(o)-.13 E .24
(or more ph)33.336 216 R .24(ysical processors are e)-.065 F -.195(xe)
-.195 G .24(cuting threads in the same address space \(process\).).195 F
(If)6.74 E 3(the address space is changed in a w)33.336 231 R 2.999
(ay that w)-.13 F 2.999(ould in)-.13 F -.325(va)-.52 G 2.999
(lidate TLB entries, the other).325 F
(processors need to be alerted so the)33.336 246 Q 3.25(yc)-.195 G
(an \215ush their corresponding entries.)-3.25 E 1.155
(Because the TLB is small, performance is greatly impro)33.336 267 R
-.195(ve)-.195 G 4.405(dw).195 G 1.155(hen memory accesses are)-4.405 F
.311(clustered so that, other than the \214rst access, the)33.336 282 R
3.56(y")-.195 G .31(hit" the TLB cache.)-3.56 F .31(The k)6.81 F .31
(ernel tries to)-.13 F .267
(optimize its internal data structures layout so as to k)33.336 297 R
.267(eep frequently accessed data together)-.13 F 1.321
(within the same page.)33.336 312 R 1.321
(Thus the choice of memory address allocation within the k)7.821 F
(ernel)-.13 E(can ha)33.336 327 Q .39 -.195(ve a p)-.26 H
(rofound impact on performance.).195 E 1.444(The \214gure belo)33.336
348 R 4.694(wd)-.325 G 1.444(epicts the \215o)-4.694 F 4.694(wo)-.325 G
4.695(fa)-4.694 G 1.445(ddress on a generic system with an MMU and a)
-4.695 F(TLB, ha)33.336 363 Q(ving the conte)-.26 E(xt number feature.)
-.195 E 0 0 468 586 -236.396 296 33.336 620.396 PBEGIN
%%BeginDocument: arch.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: arch.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Tue Oct  6 22:47:46 2009
%%For: hak@lex ()
%%BoundingBox: 0 0 586 296
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 296 moveto 0 0 lineto 586 0 lineto 586 296 lineto closepath clip newpath
-162.0 389.6 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 6719 5635 1875 825 0 360 DrawEllipse gs col0 s gr

% Polyline
n 3150 1950 m 4650 1950 l 4650 3750 l 3150 3750 l
 cp gs col0 s gr 
% Polyline
n 3600 4050 m 4500 4050 l 4500 5700 l 3600 5700 l
 cp gs col0 s gr 
% Polyline
n 10950 2100 m 11250 2400 l
 10950 2700 l gs col0 s gr 
% Polyline
n 11100 2250 m
 4650 2250 l gs col0 s gr 
% Polyline
n 11100 2550 m
 4650 2550 l gs col0 s gr 
% Polyline
n 4650 3150 m
 6000 3150 l gs col0 s gr 
% Polyline
n 4650 3450 m
 5850 3450 l gs col0 s gr 
% Polyline
n 6000 3150 m
 11100 3150 l gs col0 s gr 
% Polyline
n 6000 3300 m
 11100 3300 l gs col0 s gr 
% Polyline
n 5850 3450 m
 5850 4350 l gs col0 s gr 
% Polyline
n 6000 3300 m
 6000 4650 l gs col0 s gr 
% Polyline
n 3600 4425 m
 4500 4425 l gs col0 s gr 
% Polyline
n 3600 4725 m
 4500 4725 l gs col0 s gr 
% Polyline
n 4500 4350 m 5400 4350 l 5700 4350 l
 5700 4650 l gs col0 s gr 
% Polyline
n 4500 4200 m 5850 4200 l
 5850 4650 l gs col0 s gr 
% Polyline
n 5625 4650 m 5850 4950 l
 6075 4650 l gs col0 s gr 
% Polyline
n 5550 4950 m 7800 4950 l 7800 6150 l 5550 6150 l
 cp gs col0 s gr 
% Polyline
n 6600 4950 m
 6600 6150 l gs col0 s gr 
% Polyline
n 6750 5400 m
 6750 3300 l gs col0 s gr 
% Polyline
n 6900 5400 m 6900 3450 l
 11100 3450 l gs col0 s gr 
% Polyline
n 10950 3000 m 11250 3300 l
 10950 3600 l gs col0 s gr 
% Polyline
n 11250 1575 m 12450 1575 l 12450 4575 l 11250 4575 l
 cp gs col0 s gr 
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
gs  clippath
8715 4605 m 8715 4545 l 8563 4545 l 8683 4575 l 8563 4605 l cp
eoclip
n 4500 4575 m
 8700 4575 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 8563 4605 m 8683 4575 l 8563 4545 l  col0 s
% Polyline
n 8700 4125 m 9825 4125 l 9825 5025 l 8700 5025 l
 cp gs col0 s gr 
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
n 8850 4125 m
 8850 2550 l gs col0 s gr  [] 0 sd
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
n 9075 4125 m
 9075 2550 l gs col0 s gr  [] 0 sd
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
n 9450 4125 m
 9450 3450 l gs col0 s gr  [] 0 sd
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
n 9675 4125 m
 9675 3450 l gs col0 s gr  [] 0 sd
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
n 8700 4725 m
 8175 5025 l gs col0 s gr  [] 0 sd
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
n 8700 4950 m
 8325 5175 l gs col0 s gr  [] 0 sd
% Polyline
 [60 24 15 18 15 18 15 24 ] 0 sd
n 8625 5250 m 8175 5250 l
 8175 4875 l gs col0 s gr  [] 0 sd
% Polyline
n 5550 5550 m
 7800 5550 l gs col0 s gr 
% Polyline
n 5550 5700 m
 7800 5700 l gs col0 s gr 
% Polyline
n 5550 5850 m
 7800 5850 l gs col0 s gr 
% Polyline
n 5550 6000 m
 7800 6000 l gs col0 s gr 
% Polyline
n 5550 5400 m
 7800 5400 l gs col0 s gr 
/Times-Roman ff 200.00 scf sf
3525 2850 m
gs 1 -1 sc (CPU) col0 sh gr
/Times-Roman ff 200.00 scf sf
2700 4275 m
gs 1 -1 sc (Registers) col0 sh gr
/Times-Roman ff 200.00 scf sf
6750 2475 m
gs 1 -1 sc (DATA BUS) col0 sh gr
/Times-Roman ff 200.00 scf sf
4800 3375 m
gs 1 -1 sc (VIRT ADDR) col0 sh gr
/Times-Roman ff 200.00 scf sf
3675 4350 m
gs 1 -1 sc (CNTXT) col0 sh gr
/Times-Roman ff 200.00 scf sf
3750 4650 m
gs 1 -1 sc (BASE) col0 sh gr
/Times-Roman ff 200.00 scf sf
3900 5025 m
gs 1 -1 sc (Gen) col0 sh gr
/Times-Roman ff 200.00 scf sf
3900 5325 m
gs 1 -1 sc (Purp) col0 sh gr
/Times-Roman ff 200.00 scf sf
5625 5250 m
gs 1 -1 sc (CTX/VA) col0 sh gr
/Times-Roman ff 200.00 scf sf
7050 5250 m
gs 1 -1 sc (PTE) col0 sh gr
/Times-Roman ff 200.00 scf sf
5850 6375 m
gs 1 -1 sc (Key) col0 sh gr
/Times-Roman ff 200.00 scf sf
7050 6375 m
gs 1 -1 sc (Contents) col0 sh gr
/Times-Roman ff 200.00 scf sf
11550 1950 m
gs 1 -1 sc (Physical) col0 sh gr
/Times-Roman ff 200.00 scf sf
11550 2460 m
gs 1 -1 sc (Memory) col0 sh gr
/Times-Roman ff 200.00 scf sf
11550 2970 m
gs 1 -1 sc (Address) col0 sh gr
/Times-Roman ff 200.00 scf sf
11550 3480 m
gs 1 -1 sc (Space) col0 sh gr
/Times-Roman ff 200.00 scf sf
8625 5925 m
gs 1 -1 sc (Translations) col0 sh gr
/Times-Roman ff 200.00 scf sf
8625 6180 m
gs 1 -1 sc (Lookaside) col0 sh gr
/Times-Roman ff 200.00 scf sf
8625 6435 m
gs 1 -1 sc (Buffer \(TLB\)) col0 sh gr
/Times-Roman ff 200.00 scf sf
9075 4350 m
gs 1 -1 sc (MMU) col0 sh gr
/Times-Roman ff 200.00 scf sf
9075 4605 m
gs 1 -1 sc (Logic) col0 sh gr
/Times-Roman ff 200.00 scf sf
7500 3375 m
gs 1 -1 sc (PHYS ADDR) col0 sh gr
/Times-Roman ff 200.00 scf sf
7125 4500 m
gs 1 -1 sc (\(Phys Addr\)) col0 sh gr
/Times-Roman ff 166.67 scf sf
6750 5550 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman ff 166.67 scf sf
7275 5550 m
gs 1 -1 sc (FLAGS) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F3 13/Times-Bold@0 SF(The UNIX user)167.008 656.396 Q(-le)-.481
E -.13(ve)-.195 G 3.25(lm).13 G(emory model)-3.25 E F1 2.667 -1.04(We h)
33.336 692.396 T -2.925 -.26(av e)1.04 H .587(seen that the virtual add\
ress space of a process consists of a number of re)4.097 F(gions.)-.195
E(These include:)33.336 707.396 Q 3.25<8374>33.336 722.396 S -.195(ex)
-3.25 G 3.25(tr).195 G -.195(eg)-3.25 G(ion: holds the e).195 E -.195
(xe)-.195 G(cutable code).195 E 3.25<8364>33.336 737.396 S(ata re)-3.25
E(gion: initialized global v)-.195 E(ariables)-.325 E 0 Cg EP
%%Page: 12 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 12)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 6.904<8362>33.336 120 S 3.654(ss re)
-6.904 F 3.655(gion: uninitialized \(0-\214lled\) global v)-.195 F 3.655
(ariables including dynamically-allocated)-.325 F -.325(va)33.336 135 S
4.017(riables. The).325 F .766(ending address of this re)4.017 F .766
(gion is kno)-.195 F .766(wn as the)-.325 F/F2 13/Times-Bold@0 SF(br)
4.016 E .766(eak addr)-.234 F(ess)-.234 E F1 4.016(,a)C .766(nd can be)
-4.016 F .596(queried or set with the)33.336 150 R/F3 13/Courier@0 SF
(brk)3.846 E F1 .596(system call.)3.846 F .597
(The break address may turn out to not f)7.096 F .597(all on a)-.13 F
1.837(page boundary)33.336 165 R 5.087(,i)-.845 G 5.087(nw)-5.087 G
1.837(hich case the bss re)-5.087 F 1.837(gion really e)-.195 F 1.836
(xtends to the ne)-.195 F 1.836(xt page boundary)-.195 F(be)33.336 180 Q
.37(yond the break address.)-.195 F .37(The standard C library function)
6.87 F F3(malloc)3.621 E F1 .371(ultimately uses)3.621 F F3(brk)3.621 E
F1 1.943(to request additional bss memory from the k)33.336 195 R 5.192
(ernel. Another)-.13 F 1.942(name for the dynamically)5.192 F 1.197
(allocated part of the bss re)33.336 210 R 1.197(gion is the)-.195 F F3
(heap)4.448 E F1 7.698(.T)C(ypically)-8.738 E 4.448(,t)-.845 G 1.198
(he static part of the bss re)-4.448 F(gion)-.195 E .936
(\(corresponding to the declared v)33.336 225 R .936
(ariables\) is the \214rst part \(lo)-.325 F .936
(wer memory addresses\), and)-.325 F(the heap is contiguous with it.)
33.336 240 Q 5.072<8373>33.336 255 S 1.822(tack re)-5.072 F 1.822
(gion: function call stack and local v)-.195 F 8.323(ariables. W)-.325 F
1.823(ith multi-threaded processes,)-.52 F 3.957(each thread has its o)
33.336 270 R 3.957(wn stack.)-.325 F 3.957(Stack re)10.457 F 3.957
(gions ha)-.195 F 4.347 -.195(ve t)-.26 H 3.957
(he unusual property that the).195 F(y)-.195 E 1.006(automatically gro)
33.336 285 R 4.256(w\()-.325 G 1.006
(in the direction in which stacks usually gro)-4.256 F 2.697 -.845(w, t)
-.325 H -2.73 -.325(ow a).845 H 1.007(rds lo).325 F 4.257(wm)-.325 G
(emory)-4.257 E(addresses on most architectures\) without an e)33.336
300 Q(xplicit system call.)-.195 E 3.25<8364>33.336 315 S
(ynamically-link)-3.25 E(ed libraries code)-.13 E 3.25<8369>33.336 330 S
(nitialized global v)-3.25 E(ariables for dynamically-link)-.325 E
(ed libraries)-.13 E 3.25<8375>33.336 345 S(ninitialized global v)-3.25
E(ariables for dynamically-link)-.325 E(ed libraries)-.13 E 3.25<8373>
33.336 360 S(hared memory being used for inter)-3.25 E
(-process communication)-.26 E 3.25<836d>33.336 375 S
(emory-mapped \214les)-3.25 E 3.09 -1.04(We w)33.336 396 T 1.01(ill no)
1.04 F 4.26(ws)-.325 G 1.01(ee that from the k)-4.26 F(ernel')-.13 E
4.259(ss)-.715 G 1.009(tandpoint, these memory re)-4.259 F 1.009
(gion names ha)-.195 F 1.399 -.195(ve n)-.26 H(o).195 E .39
(particular signi\214cance.)33.336 411 R .39(The k)6.89 F .39(ernel vie)
-.13 F .39(ws a virtual address space as a list of re)-.325 F .39
(gions, each)-.195 F(of which has associated with it:)33.336 426 Q 3.25
<8354>33.336 441 S(he starting virtual address of the re)-3.25 E
(gion \(al)-.195 E -.13(wa)-.13 G(ys aligned to a page boundary\)).13 E
3.678<8354>33.336 456 S .428(he length of the re)-3.678 F .427
(gion \(a multiple of the page size\), or equi)-.195 F -.325(va)-.325 G
.427(lently the ending virtual).325 F(address of the re)33.336 471 Q
(gion.)-.195 E 3.647<8342>33.336 486 S .398
(itwise \215ags which describe properties of the re)-3.647 F .398
(gion such as the protections, or the f)-.195 F(act)-.13 E(that the re)
33.336 501 Q(gion automatically gro)-.195 E(ws to)-.325 E -.13(wa)-.325
G(rds lo).13 E 3.25(wm)-.325 G(emory)-3.25 E 4.862<8342>33.336 516 S
1.612(acking store: If the memory re)-4.862 F 1.612(gion is back)-.195 F
1.612(ed by a node in the \214lesystem, then this)-.13 F .048
(mapping is described by de)33.336 531 R .048(vice#/inode# and of)-.325
F 3.299(fset. Otherwise,)-.325 F .049(the re)3.299 F .049(gion is)-.195
F F2(anonymous)3.299 E F1(,)A(and has no corresponding \214le.)33.336
546 Q F2 -.962(Tr)133.67 576 S(acking the Addr).962 E
(ess Space in the Linux K)-.234 E(er)-.325 E(nel)-.195 E F1 .617
(As depicted in the diagram later in this unit, each)33.336 612 R F3
(task_struct)3.866 E F1 .616(in the k)3.866 F .616(ernel contains)-.13 F
4.984(ap)33.336 627 S 1.734(ointer to a)-4.984 F F3 1.734
(struct mm_struct)4.984 F F1 1.735
(which represents an entire virtual address space)4.984 F .869
(\(think of "mm" as "memory map"\).)33.336 642 R .869(One of the man)
7.369 F 4.119(ye)-.195 G .869(lements of)-4.119 F F3(mm_struct)4.119 E
F1(is)4.119 E F3(pgd)4.119 E F1(,)A 2.453(the ph)33.336 657 R 2.453
(ysical address of the PGD.)-.065 F 2.454
(There is also the head of a link)8.954 F 2.454(ed list of memory)-.13 F
(re)33.336 672 Q .753(gions, which are k)-.195 F .753
(ept in ascending order of starting virtual address, and each of which)
-.13 F(are described by a)33.336 687 Q F3(struct vm_area_struct)3.25 E
F1(:)A 0 Cg EP
%%Page: 13 13
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 13)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF(struct mm_struct {)39.336 117 Q
(struct vm_area_struct *mmap;)90.936 129 Q
(/* Head of linked list of regions */)4.8 E(void *pgd;)90.936 141 Q
(/* Addr of PGD */)112.8 E(struct list_head mmlist;)90.936 153 Q
(/* Linkage to all mm_structs in system */)28.8 E
(int _file_rss,_anon_rss;)90.936 165 Q(/* Current Resident Set Sizes */)
28.8 E(int total_vm;)90.936 177 Q(/* Total VM size, in pages */)94.8 E
(int hiwater_rss;)90.936 189 Q(/* High water mark of RSS usage */)76.8 E
(int hiwater_vm;)90.936 201 Q(/* High water mark of total VM size */)
82.8 E(/* There's plenty more to this structure that we're skipping */)
39.336 213 Q(};)33.336 225 Q(struct vm_area_struct {)39.336 249 Q
(struct mm_struct *vm_mm;)90.936 261 Q
(/* Pointer back to address space */)86.4 E
(struct vm_area_struct *vm_next;)90.936 273 Q(/* Linked list pointer */)
44.4 E(void *vm_start;)90.936 285 Q
(/* Start \(virt\) address of this region */)140.4 E(void *vm_end;)
90.936 297 Q(/* End address + 1 */)152.4 E(unsigned long vm_flags;)
90.936 309 Q(/* VM_XXX flags */)92.4 E(pgprot_t vm_page_prot;)90.936 321
Q(/* PTE flags \(see text about COW \) */)98.4 E(struct file *vm_file;)
90.936 333 Q(/* Mapped file, or NULL */)104.4 E(unsigned long vm_pgoff;)
90.936 345 Q(/* Offset \(#pages\) into mapped file */)92.4 E
(/* And there is more to this structure to be seen later */)90.936 357 Q
(};)33.336 369 Q(/* Explanation of vm_flags \(bitwise combinations \))
33.336 393 Q 48(VM_READ Read)33.336 405 R(permission)6 E 42
(VM_WRITE Write)33.336 417 R(permission)6 E 48(VM_EXEC Execute)33.336
429 R(permission)6 E 36(VM_SHARED Region)33.336 441 R
(may be shared among multiple processes)6 E 18(VM_GROWSDOWN Region)
33.336 453 R(automatically grows towards lower addresses)6 E 12
(VM_EXECUTABLE Region)33.336 465 R(maps to an executable file)6 E 36
(VM_LOCKED Region)33.336 477 R
(should be locked in memory and never swapped out)6 E 60(VM_IO Special)
33.336 489 R(region for memory-mapped I/O)6 E 24(VM_DONTCOPY Discard)
33.336 501 R(this region when forking instead of copying)6 E 12
(VM_DONTEXPAND Disallow)33.336 513 R(expansion of region with mremap)6 E
18(VM_DENYWRITE Disallow)33.336 525 R(over-write of active text pages)6
E(*/)33.336 537 Q/F2 13/Times-Bold@0 SF(Establishing a new r)162.9 594 Q
(egion with mmap)-.234 E F1
(void *mmap\(void *addr, size_t len, int prot, int flags,)33.336 627 Q
(int file_descriptor, off_t offset\))148.536 639 Q/F3 13/Times-Roman@0
SF 1.368(The mmap\(2\) system call causes the speci\214ed \214le which \
has already been opened with)33.336 654 R/F4 13/Courier@0 SF
(file_descriptor)33.336 669 Q F3 2.532(to be mapped into the process')
5.782 F 5.781(sa)-.715 G 2.531(ddress space, creating a ne)-5.781 F(w)
-.325 E(re)33.336 684 Q 3.494(gion. It)-.195 F .244
(can also be used to create a ne)3.494 F 3.495(wa)-.325 G(non)-3.495 E
.245(ymous memory re)-.195 F .245(gion; these tw)-.195 F 3.495(oc)-.13 G
(hoices)-3.495 E 1.881(are mutually e)33.336 699 R(xclusi)-.195 E -.195
(ve)-.325 G 8.381(.T).195 G 1.881(he \214rst address of the mapped re)
-8.381 F 1.881(gion will correspond to the)-.195 F(speci\214ed)33.336
714 Q F4(offset)3.668 E F3 .418(in the \214le, which must be a multiple\
 of the page size, for the speci\214ed)3.668 F(length)33.336 729 Q F4
(len)3.881 E F3 7.131(.T)C .631
(he virtual address at which to map the se)-7.131 F .63
(gment can be speci\214ed e)-.195 F(xplicitly)-.195 E(as)33.336 744 Q F4
(addr)3.25 E F3 3.25(,b)C(ut usually it is left to the k)-3.51 E
(ernel to choose by passing NULL.)-.13 E 0 Cg EP
%%Page: 14 14
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 14)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Courier@0 SF(prot)33.336 120 Q/F2 13/Times-Roman@0 SF
5.861(is a bitwise \215ag combination which can include the bits PR)9.11
F -.52(OT)-.52 G(_READ,).52 E(PR)33.336 135 Q -.52(OT)-.52 G
(_WRITE or PR).52 E -.52(OT)-.52 G(_EXEC.).52 E F1(flags)33.336 156 Q F2
(is a bitwise \215ag which can contain, among others:)3.25 E 3.25<834d>
33.336 171 S 3.25(AP_SHARED: Write)-3.25 F(operations to mapped re)3.25
E(gion change the contents of the \214le.)-.195 E 6.03<834d>33.336 186 S
(AP_PRIV)-6.03 E -1.443(AT)-1.755 G 2.779(E: Mutually e)1.443 F(xclusi)
-.195 E 3.169 -.195(ve w)-.325 H 2.779
(ith MAP_SHARED: Write operations to the).195 F(mapped re)33.336 201 Q
(gion do not change the contents of the \214le.)-.195 E 3.915<834d>
33.336 216 S .665(AP_DENYWRITE: Setting it will pre)-3.915 F -.195(ve)
-.325 G .665(nt write access to the mapped \214led using the).195 F 2.33
(traditional write system call.)33.336 231 R 2.33
(See discussion at end of this unit.)8.83 F(Ho)8.83 E(we)-.325 E -.195
(ve)-.325 G 3.37 -.52(r, t).195 H 2.33(he Linux).52 F -.13(ke)33.336 246
S 2.435(rnel currently pre).13 F -.195(ve)-.325 G 2.435
(nts programs from setting this \215ag with the mmap system call,).195 F
(although the \215ag is used internally by the k)33.336 261 Q
(ernel to protect e)-.13 E -.195(xe)-.195 G(cutable \214les.).195 E
6.692<834d>33.336 276 S(AP_GR)-6.692 E -.455(OW)-.52 G(SDO).455 E 3.441
(WN: The re)-.455 F 3.441(gion should ha)-.195 F 3.831 -.195(ve t)-.26 H
3.441(he property that it automagically).195 F(gro)33.336 291 Q(ws to)
-.325 E -.13(wa)-.325 G(rds lo).13 E 3.25(wm)-.325 G(emory)-3.25 E 3.25
(,i)-.845 G(.e. it is intended to be a stack re)-3.25 E(gion.)-.195 E
11.188<834d>33.336 306 S 7.938(AP_ANONYMOUS: A ne)-11.188 F 9.629 -.845
(w, a)-.325 H(non).845 E 7.939(ymous re)-.195 F 7.939
(gion is being requested.)-.195 F(The)14.439 E(\214le_descriptor and of)
33.336 321 Q(fset parameters are ignored.)-.325 E/F3 13/Times-Bold@0 SF
(mmap within the k)200.873 351 Q(er)-.13 E(nel)-.195 E F2 5.532(The ef)
33.336 387 R 5.532(fect of \(a successful\) mmap call inside the k)-.325
F 5.531(ernel is to allocate a ne)-.13 F(w)-.325 E F1(vm_area_struct)
33.336 402 Q F2 1.52(and to insert it into the singly-link)4.769 F 1.52
(ed list of such memory re)-.13 F(gions)-.195 E 1.799
(that is hanging of)33.336 417 R 5.049(ft)-.325 G(he)-5.049 E F1
(mm_struct)5.049 E F2 8.299(.T)C(he)-8.299 E F1(vm_flags)5.049 E F2
1.799(\214eld is initialized based on the)5.049 F F1(flags)33.336 432 Q
F2(and)3.255 E F1(prot)3.255 E F2(ar)3.255 E .005
(guments to the system call.)-.234 F .006(E.g. PR)6.506 F -.52(OT)-.52 G
.006(_READ maps to VM_READ,).52 F(MAP_GR)33.336 447 Q -.455(OW)-.52 G
(SDO).455 E 3.757(WN maps to VM_GR)-.455 F -.455(OW)-.52 G(SDO).455 E
7.007(WN. If)-.455 F 3.757(MAP_ANONYMOUS w)7.007 F(as)-.13 E 1.347
(speci\214ed, the)33.336 462 R F1(vm_file)4.597 E F2 1.347
(is set to NULL, otherwise it points to the)4.597 F F1 1.348
(struct file)4.598 F F2(\(in)4.598 E -.13(ke)33.336 477 S 2.367
(rnel memory\) that the \214le descriptor w).13 F 2.367(as referencing.)
-.13 F 2.367(Because the reference count)8.867 F(\()33.336 492 Q F1
(f_count)A F2 3.529(\)i)C 3.529(si)-3.529 G .279(ncremented, the proces\
s may close the \214le descriptor after mmap, and the)-3.529 F -.13(ke)
33.336 507 S 1.88(rnel "hangs on" to the open \214le instance.).13 F F1
(vm_pgoff)8.379 E F2 1.879(is set to the of)5.129 F 1.879(fset ar)-.325
F(gument,)-.234 E -.195(ex)33.336 522 S 1.772
(cept the latter is speci\214ed in bytes, and is di).195 F 1.773
(vided by 4096 \(on X86 architecture\) to)-.325 F(arri)33.336 537 Q .403
-.195(ve a)-.325 H 3.263(tv).195 G(m_pgof)-3.263 E 3.263(fi)-.325 G
3.263(np)-3.263 G 3.262(ages. It)-3.263 F .012
(is therefore an error to specify an of)3.262 F .012
(fset which is not page-)-.325 F(aligned.)33.336 552 Q F3(Shar)189.037
582 Q(ed vs Pri)-.234 E -.13(va)-.13 G(te Mappings).13 E F2 1.778
(When MAP_SHARED is speci\214ed \(equi)33.336 618 R -.325(va)-.325 G
1.778(lent to VM_SHARED in k).325 F 1.779(ernel\), writing to)-.13 F
1.117(the memory re)33.336 633 R 1.117
(gion is immediately and transparently visible to this or an)-.195 F
4.367(yo)-.195 G 1.117(ther process)-4.367 F .349
(through the traditional system calls such as)33.336 648 R F1(read)3.599
E F2 6.849(.L)C(ik)-6.849 E -.325(ew)-.13 G .349(ise, an).325 F 3.599
(yc)-.195 G .349(hanges to the \214le, e.g.)-3.599 F(through)33.336 663
Q F1(write)3.25 E F2 3.25(,a)C
(re immediately visible through the mapped re)-3.25 E(gion.)-.195 E
1.423(When the mapping is MAP_PRIV)33.336 684 R -1.443(AT)-1.755 G 1.423
(E, Cop)1.443 F 4.672(yo)-.13 G 4.672(nW)-4.672 G 1.422(rite \(see belo)
-4.672 F 1.422(w\) happens.)-.325 F 1.422(Upon the)7.922 F .489
(\214rst memory write access to a page in a MAP_PRIV)33.336 699 R -1.443
(AT)-1.755 G 3.739(Er)1.443 G -.195(eg)-3.739 G .489
(ion, the association between).195 F .441
(that virtual page and the \214le is brok)33.336 714 R 3.691(en. Thus)
-.13 F .441(writes to a MAP_PRIV)3.691 F -1.443(AT)-1.755 G 3.691(Er)
1.443 G -.195(eg)-3.691 G .441(ion do NO).195 F(T)-.52 E .576
(cause the associated \214le to be modi\214ed.)33.336 729 R .577
(It is unspeci\214ed if writes to the \214le \(e.g. via the)7.076 F
2.688(write system call\) are visible in the memory re)33.336 744 R
2.688(gion, before the association has been)-.195 F 0 Cg EP
%%Page: 15 15
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 15)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(brok)33.336 120 Q 3.677
(en by a write to the memory re)-.13 F 6.927(gion. On)-.195 F 3.677
(the Linux k)6.927 F 3.678(ernel, the)-.13 F 6.928(ya)-.195 G 3.678
(re \(b)-6.928 F 3.678(ut see)-.26 F(discussion of MAP_DENYWRITE\).)
33.336 135 Q -.195(Pa)33.336 156 S 2.166(ges in a MAP_PRIV).195 F -1.443
(AT)-1.755 G 5.416(Ea)1.443 G 2.166(rea, once the)-5.416 F 5.416(yh)
-.195 G -2.925 -.26(av e)-5.416 H 2.165(been written to, become anon)
5.675 F(ymous)-.195 E 1.12(pages, because the association of that parti\
cular virtual page with that particular area of)33.336 171 R .13
(the mapped \214le has been brok)33.336 186 R 3.38(en. Therefore,)-.13 F
.13(if the)3.38 F 3.38(yn)-.195 G .13(eed to be paged-out, the)-3.38 F
3.38(ya)-.195 G .13(re sent to)-3.38 F(sw)33.336 201 Q(ap; the)-.13 E
3.25(yc)-.195 G(an not be paged-out to the original \214le.)-3.25 E/F2
13/Times-Bold@0 SF
(File size not multiple of page size, \214le truncation)133.91 231 Q F1
1.595(The mapped re)33.336 261 R 1.595(gion may e)-.195 F 1.595
(xtend be)-.195 F 1.595(yond the current end of the \214le.)-.195 F
1.596(This could happen)8.096 F 1.837(either because the)33.336 276 R/F3
13/Courier@0 SF(len)5.087 E F1 1.837(parameter speci\214ed is lar)5.087
F 1.836(ger than the \214le, or because after the)-.234 F 3.02(mapping \
has been established, the \214le size is reduced \(e.g. through the)
33.336 291 R F3(truncate)6.271 E F1 .326(system call\).)33.336 306 R
.326
(If the process attempts to access memory which corresponds to just be)
6.826 F(yond)-.195 E .335(the current end of \214le, b)33.336 321 R .335
(ut not be)-.26 F .335(yond a page size boundary)-.195 F 3.585(,i)-.845
G 3.585(tw)-3.585 G .335(ill see bytes with a v)-3.585 F(alue)-.325 E
.54(of 0.)33.336 336 R(Ho)7.039 E(we)-.325 E -.195(ve)-.325 G 1.579 -.52
(r, w).195 H .539(hen the process tries to go further out, be).52 F .539
(yond the page boundary)-.195 F 3.789(,e)-.845 G -.195(ve)-4.114 G(n)
.195 E .314
(though the memory address is within the bounds of the mapped re)33.336
351 R .314(gion, the k)-.195 F .314(ernel will be)-.13 F .194
(unable to satisfy the page f)33.336 366 R .194
(ault, because the backing store does not e)-.13 F .194
(xist in the \214lesystem.)-.195 F(Under this condition, the k)33.336
381 Q(ernel must deli)-.13 E -.195(ve)-.325 G 3.25(ra).195 G F2(SIGB)A
(US)-.13 E F1(to the process.)3.25 E .571
(Read and write access via a \214le-mapped re)33.336 402 R .571
(gion will set the inode atime and mtime \214elds)-.195 F(appropriately)
33.336 417 Q 3.599(,b)-.845 G .349(ut not necessarily instantaneously)
-3.859 F 3.598(,f)-.845 G .348(or reasons which should become clear)
-3.598 F(later in this unit when we look at the PFRA.)33.336 432 Q
(mmap')33.336 453 Q 6.693(ds)-.65 G -.195(eg)-6.693 G 3.444
(ments are inherited by child processes in fork, using the cop).195 F
(y-on-write)-.13 E 1.396(mechanism for an)33.336 468 R 4.646(yw)-.195 G
1.396(ritable re)-4.646 F 1.395(gions, as described later)-.195 F 7.895
(.M)-.715 G 1.395(ultiple processes can share a)-7.895 F 3.468
(mapped se)33.336 483 R 6.718(gment. In)-.195 F -.13(fa)6.718 G 3.468
(ct, a MAP_ANONYMOUS|MAP_SHARED re).13 F 3.468(gion can be a)-.195 F
1.549(useful inter)33.336 498 R 1.548(-process communications tool.)-.26
F 1.548(Note that when a re)8.048 F 1.548(gion of memory has the)-.195 F
5.176(MAP_SHARED property)33.336 513 R 8.426(,c)-.845 G(op)-8.426 E
5.177(y-on-write does not apply to that re)-.13 F 5.177(gion, and both)
-.195 F(processes after a fork continue to share the same ph)33.336 528
Q(ysical memory for that re)-.065 E(gion.)-.195 E F2
(Remapping, Unmapping)199.073 558 Q F1(The)33.336 588 Q F3(munmap)3.483
E F1 .232(system call destro)3.483 F .232(ys a memory re)-.13 F .232
(gion and an)-.195 F 3.482(ya)-.195 G .232
(ssociated mapping to a \214le.)-3.482 F(The)33.336 603 Q F3(mremap)
3.541 E F1 .291(system call is used to mak)3.541 F 3.541(ea)-.13 G 3.541
(ne)-3.541 G .291(xisting memory re)-3.736 F .291(gion lar)-.195 F .292
(ger or smaller)-.234 F 3.542(,o)-.52 G(r)-3.542 E 1.459(to mo)33.336
618 R 1.849 -.195(ve i)-.195 H 4.708(tt).195 G 4.708(oa)-4.708 G 1.458
(nother virtual address.)-4.708 F F3(mprotect)7.958 E F1 1.458
(can change the protections \(R/W/X\))4.708 F .907(associated with a re)
33.336 633 R .907(gion \(b)-.195 F .907(ut those ne)-.26 F 4.157(wp)
-.325 G .907(rotections must be consistent with ho)-4.157 F 4.158(wt)
-.325 G .908(he \214le)-4.158 F .085(descriptor w)33.336 648 R .085
(as open in the case of \214le-mapped re)-.13 F 3.334(gions\). The)-.195
F .084(reader is encouraged to read)3.334 F 1.457
(the man pages for these system calls carefully)33.336 663 R 7.957(.H)
-.845 G 2.107 -.325(ow t)-7.957 H 1.457
(hese system calls manipulate the).325 F F3(vm_area_struct)33.336 678 Q
F1 3.25(ss)C(hould be ob)-3.25 E(vious.)-.195 E F2
(Exec and virtual memory)196.746 708 Q F1 1.284(During the e)33.336 744
R -.195(xe)-.195 G 4.534(cs).195 G 1.283(ystem call, a ne)-4.534 F 4.533
(wa)-.325 G 1.283(ddress space is initialized and the e)-4.533 F 1.283
(xisting address)-.195 F 0 Cg EP
%%Page: 16 16
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 16)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF .497(space of a process is freed.)33.336
120 R .497(The page tables themselv)6.997 F .498(es are freed and an)
-.195 F 3.748(yp)-.195 G -.065(hy)-3.748 G .498(sical pages).065 F .769
(that the process had mapped are placed on the free list.)33.336 135 R
.768(It is as if the process had called)7.268 F/F2 13/Courier@0 SF
(munmap)33.336 150 Q F1(for each of its re)3.25 E(gions.)-.195 E .501
(The basis of the initialization of the ne)33.336 171 R 3.751(wa)-.325 G
.502(ddress space is the \214lename passed to the e)-3.751 F -.195(xe)
-.195 G(c).195 E 2.178(system call.)33.336 186 R 2.178
(This refers to an e)8.678 F -.195(xe)-.195 G 2.177
(cutable \214le in one of the binary e).195 F -.195(xe)-.195 G 2.177
(cutable formats).195 F 1.244
(which that operating system and processor type can e)33.336 201 R -.195
(xe)-.195 G 4.494(cute. The).195 F 1.245(\214rst fe)4.494 F 4.495(wb)
-.325 G 1.245(ytes of the)-4.495 F 1.678(\214le determines the e)33.336
216 R -.195(xe)-.195 G 1.678(cutable format, and are kno).195 F 1.678
(wn as the)-.325 F/F3 13/Times-Bold@0 SF 1.678(magic number)4.928 F F1
8.178(.W)C 4.928(eh)-9.218 G -2.925 -.26(av e)-4.928 H 3.037
(seen that the a.out \214le contains the te)33.336 231 R 3.037(xt re)
-.195 F 3.038(gion image, the data re)-.195 F 3.038(gion initial image)
-.195 F(\(v)33.336 246 Q
(ariable initializers\), and the initial requested size of the bss re)
-.325 E(gion.)-.195 E .437(In Unit 3, a highly conceptual model w)33.336
267 R .437(as presented of ho)-.13 F 3.687(wan)-.325 G 1.087 -.325(ew p)
-3.687 H .437(rogram is loaded into).325 F 3.649(memory during e)33.336
282 R -.195(xe)-.195 G 6.899(c. No).195 F 6.899(wt)-.325 G 3.65
(hat we understand mappings between \214les and virtual)-6.899 F(memory)
33.336 297 Q 4.134(,w)-.845 G 4.134(ec)-4.134 G .883(an tak)-4.134 F
4.133(eam)-.13 G .883(ore re\214ned look and see that e)-4.133 F -.195
(xe)-.195 G .883(cutable "loading" is really the).195 F
(establishment of a number of mmap re)33.336 312 Q(gions.)-.195 E 4.308
<8354>33.336 342 S 1.058(he te)-4.308 F 1.058(xt re)-.195 F 1.058(gion \
is created as if the process had used mmap to create a mapping to the)
-.195 F 2.885(area in the a.out \214le holding the te)33.336 357 R 2.884
(xt image.)-.195 F 2.884(The protections of the te)9.384 F 2.884(xt re)
-.195 F 2.884(gion are)-.195 F(PR)33.336 372 Q -.52(OT)-.52 G(_READ|PR)
.52 E -.52(OT)-.52 G 3.777(_EXEC. The).52 F .528(\215ags are MAP_PRIV)
3.778 F -1.443(AT)-1.755 G 3.778(E|MAP_DENYWRITE. Note)1.443 F .563
(that since page frames are ne)33.336 387 R -.195(ve)-.325 G 3.813(ra)
.195 G .563(llocated to virtual address spaces until an actual access)
-3.813 F 2.104(occurs, the v)33.336 402 R 2.104
(ery \214rst thing which the ne)-.195 F 5.354(wp)-.325 G 2.104
(rogram does, upon attempting to fetch its)-5.354 F 2.135
(initial opcode from memory and e)33.336 417 R -.195(xe)-.195 G 2.135
(cute it, is to cause a page f).195 F 5.384(ault! The)-.13 F 2.134
(program is)5.384 F(demand-paged in from the a.out \214le as needed.)
33.336 432 Q 4.62<8354>33.336 462 S 1.371(he data re)-4.62 F 1.371
(gion is created as if by mmap with MAP_PRIV)-.195 F -1.443(AT)-1.755 G
(E|MAP_DENYWRITE.)1.443 E 1.584(The mapping is to the area of the a.out\
 \214le which contains the .data section \(image of)33.336 477 R 5.088
(initializer v)33.336 492 R 8.338(alues\). The)-.325 F 5.089
(protections are PR)8.338 F -.52(OT)-.52 G(_READ|PR).52 E -.52(OT)-.52 G
8.339(_WRITE. Because).52 F(the)8.339 E 2.109(mapping is MAP_PRIV)33.336
507 R -1.443(AT)-1.755 G 2.108
(E, the program "sees" the correct initializers when the)1.443 F 5.358
(ya)-.195 G(re)-5.358 E 1.912(\214rst accessed, b)33.336 522 R 1.912
(ut writes to those v)-.26 F 1.912(ariables don')-.325 F 5.162(tc)-.234
G 1.912(ause the unpleasant consequence of)-5.162 F
(modifying the a.out \214le.)33.336 537 Q 8.634<8354>33.336 567 S 5.384
(he bss re)-8.634 F 5.384
(gion is created, with the size requested in the a.out header)-.195 F
8.633(,a)-.52 G 8.633(sa)-8.633 G(MAP_ANONYMOUS|MAP_PRIV)33.336 582 Q
-1.443(AT)-1.755 G 10.499(Em)1.443 G 7.25(apping, with PR)-10.499 F -.52
(OT)-.52 G(_READ|PR).52 E -.52(OT)-.52 G(_WRITE).52 E 3.488
(protections. As)33.336 597 R .238(it is accessed, the k)3.488 F .238
(ernel will allocate page frames, zero-\214lling them \214rst.)-.13 F
(As a MAP_ANONYMOUS re)33.336 612 Q(gion, the bss will be back)-.195 E
(ed by sw)-.13 E(ap space.)-.13 E 13.224<8354>33.336 642 S 9.974
(he stack re)-13.224 F 9.974
(gion is created with a small initial size and with the)-.195 F
(MAP_ANONYMOUS|MAP_GR)33.336 657 Q -.455(OW)-.52 G(SDO).455 E 15.071
(WN properties.)-.455 F 15.07(The protections are)21.57 F(PR)33.336 672
Q -.52(OT)-.52 G(_READ|PR).52 E -.52(OT)-.52 G 6.669(_WRITE. The).52 F
3.419(stack re)6.669 F 3.419(gion will be gro)-.195 F 3.419
(wn as it is accessed, as)-.325 F 1.318(described pre)33.336 687 R
(viously)-.325 E 4.568(,w)-.845 G 1.318(ith ne)-4.568 F 4.568(wp)-.325 G
1.317(age frames being zero-\214lled.)-4.568 F 1.317
(The stack is also back)7.817 F(ed)-.13 E(by sw)33.336 702 Q(ap space.)
-.13 E 1.647(In the e)33.336 732 R 1.647(xample belo)-.195 F 3.337 -.845
(w, a n)-.325 H 2.297 -.325(ew p).845 H 1.647
(rogram has been set up by e).325 F -.195(xe)-.195 G 4.898(cw).195 G
1.648(ith a te)-4.898 F 1.648(xt re)-.195 F 1.648(gion of 2)-.195 F 0 Cg
EP
%%Page: 17 17
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 17)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(pages, data re)33.336 120 Q
(gion 1 page long, and an initial bss re)-.195 E(gion of 3 pages.)-.195
E 0 0 468 619 -402.979 533 33.336 543.979 PBEGIN
%%BeginDocument: exec.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: exec.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Wed Oct 21 22:19:02 2015
%%For: hak@lex ()
%%BoundingBox: 0 0 619 533
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 533 moveto 0 0 lineto 619 0 lineto 619 533 lineto closepath clip newpath
-0.0 576.7 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
7.500 slw
n 1200 1200 m 2400 1200 l 2400 7200 l 1200 7200 l
 cp gs col0 s gr 
% Polyline
n 1200 2700 m
 2400 2700 l gs col0 s gr 
% Polyline
n 1200 3600 m 2400 3600 l 2400 4800 l 1200 4800 l
 cp gs col0 s gr 
% Polyline
n 1200 6000 m 2400 6000 l 2400 6600 l 1200 6600 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 1200 4200 m
 2400 4200 l gs col0 s gr  [] 0 sd
% Polyline
gs  clippath
1231 3610 m 1189 3568 l 1081 3675 l 1188 3612 l 1124 3718 l cp
eoclip
n 600 4200 m
 1200 3600 l gs col0 s gr gr

% arrowhead
n 1124 3718 m 1188 3612 l 1081 3675 l  col0 s
% Polyline
gs  clippath
1179 6026 m 1233 6000 l 1166 5864 l 1193 5985 l 1112 5891 l cp
eoclip
n 600 4800 m
 1200 6000 l gs col0 s gr gr

% arrowhead
n 1112 5891 m 1193 5985 l 1166 5864 l  col0 s
% Polyline
n 4800 1200 m 6000 1200 l 6000 9600 l 4800 9600 l
 cp gs col0 s gr 
% Polyline
n 4800 2400 m 6000 2400 l 6000 3600 l 4800 3600 l
 cp gs col0 s gr 
% Polyline
n 4800 4200 m 6000 4200 l 6000 4800 l 4800 4800 l
 cp gs col0 s gr 
% Polyline
n 4800 5400 m 6000 5400 l 6000 7200 l 4800 7200 l
 cp gs col0 s gr 
% Polyline
n 4800 8400 m 6000 8400 l 6000 9000 l 4800 9000 l
 cp gs col0 s gr 
% Polyline
n 4800 2400 m
 2550 3750 l gs col0 s gr 
% Polyline
n 2700 3450 m
 2400 4050 l gs col0 s gr 
% Polyline
n 2400 4350 m
 3000 4650 l gs col0 s gr 
% Polyline
n 2700 4500 m
 4800 3300 l gs col0 s gr 
% Polyline
n 4800 4200 m
 2503 5955 l gs col0 s gr 
% Polyline
n 4800 4650 m
 2638 6405 l gs col0 s gr 
% Polyline
n 2700 5550 m 2400 6150 l
 2850 6600 l gs col0 s gr 
% Polyline
gs  clippath
5430 7935 m 5370 7935 l 5370 8087 l 5400 7967 l 5430 8087 l cp
eoclip
n 5400 8400 m
 5400 7950 l gs col0 s gr gr

% arrowhead
n 5430 8087 m 5400 7967 l 5370 8087 l  col0 s
% Polyline
 [60] 0 sd
n 4800 3000 m
 6000 3000 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 4800 6000 m
 6000 6000 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 4800 6600 m
 6000 6600 l gs col0 s gr  [] 0 sd
/Times-Roman ff 200.00 scf sf
1350 975 m
gs 1 -1 sc (a.out file) col0 sh gr
/Times-Roman ff 200.00 scf sf
1200 1500 m
gs 1 -1 sc (text start/sz) col0 sh gr
/Times-Roman ff 200.00 scf sf
1200 1755 m
gs 1 -1 sc (data start/sz) col0 sh gr
/Times-Roman ff 200.00 scf sf
1200 2010 m
gs 1 -1 sc (bss start/sz) col0 sh gr
/Times-Roman ff 200.00 scf sf
1200 2265 m
gs 1 -1 sc (exec_addr) col0 sh gr
/Times-Roman ff 200.00 scf sf
1500 3900 m
gs 1 -1 sc (.text) col0 sh gr
/Times-Roman ff 200.00 scf sf
1500 6300 m
gs 1 -1 sc (.data) col0 sh gr
/Times-Roman ff 200.00 scf sf
0 4500 m
gs 1 -1 sc (aligned on) col0 sh gr
/Times-Roman ff 200.00 scf sf
0 4755 m
gs 1 -1 sc (4K boundary) col0 sh gr
/Times-Roman ff 200.00 scf sf
300 1800 m
gs 1 -1 sc (HEADER) col0 sh gr
/Times-Roman ff 200.00 scf sf
300 2055 m
gs 1 -1 sc (AREA) col0 sh gr
/Times-Roman ff 200.00 scf sf
5100 8700 m
gs 1 -1 sc (stack) col0 sh gr
/Times-Roman ff 200.00 scf sf
5100 6000 m
gs 1 -1 sc (bss) col0 sh gr
/Times-Roman ff 200.00 scf sf
6300 7200 m
gs 1 -1 sc (brk address) col0 sh gr
/Times-Roman ff 200.00 scf sf
6300 7455 m
gs 1 -1 sc (\(end of heap\)) col0 sh gr
/Times-Roman ff 200.00 scf sf
5100 4500 m
gs 1 -1 sc (data) col0 sh gr
/Times-Roman ff 200.00 scf sf
5100 3000 m
gs 1 -1 sc (text) col0 sh gr
/Times-Roman ff 200.00 scf sf
6163 2580 m
gs 1 -1 sc (PROT_READ|PROT_EXEC) col0 sh gr
/Times-Roman ff 200.00 scf sf
6163 2835 m
gs 1 -1 sc (MAP_PRIVATE|MAP_DENYWRITE) col0 sh gr
/Times-Roman ff 200.00 scf sf
6163 4275 m
gs 1 -1 sc (PROT_READ|PROT_WRITE) col0 sh gr
/Times-Roman ff 200.00 scf sf
6163 4530 m
gs 1 -1 sc (MAP_PRIVATE|MAP_DENYWRITE) col0 sh gr
/Times-Roman ff 200.00 scf sf
6178 5580 m
gs 1 -1 sc (PROT_READ|PROT_WRITE) col0 sh gr
/Times-Roman ff 200.00 scf sf
6178 5835 m
gs 1 -1 sc (MAP_ANONYMOUS) col0 sh gr
/Times-Roman ff 200.00 scf sf
6178 8475 m
gs 1 -1 sc (PROT_READ|PROT_WRITE) col0 sh gr
/Times-Roman ff 200.00 scf sf
6178 8730 m
gs 1 -1 sc (MAP_ANONYMOUS|MAP_GROWSDOWN) col0 sh gr
/Times-Roman ff 200.00 scf sf
4800 900 m
gs 1 -1 sc (Process VA Space) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F2 13/Times-Bold@0 SF(Wh)168.308 564.979 Q 3.25(yt)-.195 G
(he MAP_DENYWRITE \215ag?)-3.25 E F1 .008(Both te)33.336 600.979 R .008
(xt and data re)-.195 F .008
(gions are mapped with the MAP_DENYWRITE \215ag set.)-.195 F .008
(The reason)6.508 F .674(for this is the follo)33.336 615.979 R .674
(wing situation:)-.325 F(Let')7.174 E 3.924(ss)-.715 G .674
(ay a program is running from a particular a.out)-3.924 F 3.758
(\214le, and then someone comes along and re-writes that e)33.336
630.979 R -.195(xe)-.195 G 3.758(cutable \(e.g. it is being).195 F 1.137
(recompiled or reinstalled\).)33.336 645.979 R(Ho)7.637 E(we)-.325 E
-.195(ve)-.325 G 2.177 -.52(r, t).195 H 1.137
(he running program is still mapped to the \214le, so).52 F .846
(what gets paged-in w)33.336 660.979 R .846
(ould be a mixture of the original contents of the \214le and the ne)
-.13 F(wer)-.325 E 6.334(contents. Clearly)33.336 675.979 R 3.084
(this w)6.334 F(on')-.13 E 6.334(tw)-.234 G 3.084
(ork...it amounts to a corruption of the program.)-6.464 F(The)9.585 E
.591(DENYWRITE \215ag will pre)33.336 690.979 R -.195(ve)-.325 G .591
(nt an).195 F 3.841(yk)-.195 G .591(ind of write access to the e)-3.841
F -.195(xe)-.195 G .591(cutable \214le, including).195 F 3.264
(truncation. It)33.336 705.979 R .015(will f)3.264 F .015
(ail with the error)-.13 F/F3 13/Courier@0 SF(ETXTBUSY)3.265 E F1 6.515
(.H)C -.325(ow)-6.515 G -2.795 -.325(ev e).325 H 1.055 -.52(r, o).325 H
.015(ne can unlink or rename the).52 F -.195(exe)33.336 720.979 S .57
(cuting a.out \214le, and install a ne).195 F 3.819(wv)-.325 G .569
(ersion with the same name.)-4.014 F .569(Since the mapping is)7.069 F
1.073(based on inode number)33.336 735.979 R 4.323(,n)-.52 G 1.074
(ot pathname, the currently running process \(or processes\) will)-4.323
F 0 Cg EP
%%Page: 18 18
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 18)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 3.366(continue to use the old e)33.336
120 R -.195(xe)-.195 G 3.366(cutable, while an).195 F 6.616(yn)-.195 G
4.016 -.325(ew e)-6.616 H -.195(xe).13 G(c').195 E 6.616(sw)-.715 G
3.366(ould reference the ne)-6.746 F(w)-.325 E -.195(exe)33.336 135 S
(cutable \(since the).195 E 3.25(ye)-.195 G -.325(va)-3.575 G
(luate a pathname, as if by).325 E/F2 13/Times-Bold@0 SF(open)3.25 E F1
(\).)A 12.761(Those responsible for the de)33.336 156 R -.195(ve)-.325 G
12.762(lopment of the Linux k).195 F 12.762(ernel remo)-.13 F -.195(ve)
-.195 G(d).195 E .416(MAP_DENYWRITE from the list of \215ags that can b\
e speci\214ed by the mmap system call)33.336 171 R 1.425
(\(the \215ag is accepted b)33.336 186 R 1.425(ut silently ignored\).)
-.26 F 1.425(The reasoning went lik)7.925 F 4.676(et)-.13 G 1.426
(his: User A which)-4.676 F 4.199(has read-only access to a \214le F co\
uld establish a read-only mmap mapping with)33.336 201 R 1.324
(DENYWRITE, e)33.336 216 R -.195(ve)-.325 G 4.574(nt).195 G 1.324
(hough the)-4.574 F 4.574(yd)-.195 G 4.574(on)-4.574 G 1.324(ot ha)
-4.574 F 1.714 -.195(ve w)-.26 H 1.324(rite permission on F).195 F 7.824
(.T)-1.04 G 1.325(his can create a)-7.824 F 1.23
(denial-of-service attack, in that another user B, who does ha)33.336
231 R 1.619 -.195(ve w)-.26 H 1.229(rite permission, w).195 F(ould)-.13
E(no)33.336 246 Q 4.014(wb)-.325 G 4.014(ep)-4.014 G(re)-4.014 E -.195
(ve)-.325 G .764(nted from writing to the \214le.).195 F .765
(When the k)7.265 F .765(ernel sets up a ne)-.13 F 4.015(wa)-.325 G .765
(ddress space)-4.015 F .715(during e)33.336 261 R -.195(xe)-.195 G .715
(c, it is using internal v).195 F .715
(ersions of mmap, and is thus not actually using the \215ag)-.195 F
(MAP_DENYWRITE, b)33.336 276 Q(ut is specifying VM_DENYWRITE directly)
-.26 E(.)-.845 E F2(The P)207.776 321 Q(age Frame P)-.13 E(ool)-.26 E F1
(No)33.336 357 Q 5.576(wt)-.325 G 2.326(hat we ha)-5.576 F 2.716 -.195
(ve m)-.26 H 2.326(ade an initial e).195 F 2.326(xploration of ho)-.195
F 5.576(wt)-.325 G 2.326(he k)-5.576 F 2.326(ernel manages the virtual)
-.13 F 2.058(address space of processes, let')33.336 372 R 5.308(st)
-.715 G(ak)-5.308 E 5.308(eal)-.13 G 2.058
(ook from the standpoint of ph)-5.308 F 2.058(ysical memory)-.065 F(.)
-.845 E -1.04(We)33.336 387 S -.13('l)1.04 G 3.25(lt).13 G(hen put it t\
ogether and discuss the mechanisms for paging-in and paging-out.)-3.25 E
5.071(Ac)33.336 408 S 1.822(omputer system has a certain amount of ph)
-5.071 F 1.822(ysical RAM.)-.065 F 1.822(Some of that is tak)8.322 F
1.822(en up)-.13 F 1.301(statically by the k)33.336 423 R 1.301
(ernel, i.e. k)-.13 F 1.301(ernel te)-.13 F 1.301
(xt, data and bss, and system control structures that)-.195 F .333
(must e)33.336 438 R .333(xist at a certain ph)-.195 F .333
(ysical address, such as the Interrupt Descriptor T)-.065 F 3.584
(able. There)-1.04 F(are)3.584 E(additional demands for ph)33.336 453 Q
(ysical memory:)-.065 E 4.673<8344>33.336 468 S 1.423
(ynamically allocated k)-4.673 F 1.422
(ernel data structures, e.g. the task_struct, k)-.13 F 1.422
(ernel-mode stacks,)-.13 F .02
(in-core inodes and directory entries, pending signals, loadable k)
33.336 483 R .02(ernel modules, and shared)-.13 F -.13(ke)33.336 498 S
(rnel/hardw).13 E(are data structures such as page tables.)-.13 E 4.043
<8355>33.336 513 S .792(ser process address space.)-4.043 F -1.04(We)
7.292 G -2.145 -.65('v e)1.04 H .792(seen that this can be brok)4.692 F
.792(en do)-.13 F .792(wn into anon)-.325 F(ymous)-.195 E(re)33.336 528
Q 5.537(gions, which are not persistent, and \214le-mapped re)-.195 F
5.537(gions where resident pages)-.195 F
(correspond to speci\214c portions of speci\214c, persistent \214les.)
33.336 543 Q 3.744<8349>33.336 558 S .494(/O b)-3.744 F(uf)-.26 E 3.744
(fers. In)-.325 F .494(some cases the I/O b)3.744 F(uf)-.26 E .494
(fer corresponds to a portion of a \214le, b)-.325 F .494(ut in other)
-.26 F(cases \(e.g. netw)33.336 573 Q(ork pack)-.13 E(et b)-.13 E(uf)
-.26 E(fers\) it does not.)-.325 E 4.349<8346>33.336 588 S 1.099
(ilesystem block caches:)-4.349 F 1.1
(Filesystems sometimes need to cache disk blocks which are)7.599 F
(not the actual contents of a gi)33.336 603 Q -.195(ve)-.325 G 3.25
<6e8c>.195 G(le, e.g. directory entries.)-3.25 E .292
(The demand for page frames ebbs and \215o)33.336 624 R .292
(ws throughout the life of the system.)-.325 F .292(At certain)6.792 F
3.338(times, there may be ab)33.336 639 R 3.339
(undant page frames which are empty and uncommitted, and)-.26 F .386
(therefore a)33.336 654 R -.325(va)-.26 G .386
(ilable for immediate allocation.).325 F .386
(At other times, the page frame pool may be)6.886 F 1.553(depleted, cau\
sing pressure for page frames to be freed up to satisfy ne)33.336 669 R
4.804(wd)-.325 G 4.804(emand. The)-4.804 F -.13(ke)33.336 684 S 1.329
(rnel, through the P).13 F 1.328
(age Frame Reclamation Algorithm \(PFRA\), al)-.195 F -.13(wa)-.13 G
1.328(ys tries to k).13 F 1.328(eep a)-.13 F 2.313(reasonable number of\
 free page frames, so that an allocation request does not f)33.336 699 R
2.314(ail or)-.13 F(encounter e)33.336 714 Q(xcessi)-.195 E .39 -.195
(ve d)-.325 H(elay).195 E(.)-.845 E 3.196 -1.04(We w)33.336 735 T 1.116
(ill no)1.04 F 4.366(wc)-.325 G 1.115(onsider ho)-4.366 F 4.365(wp)-.325
G 1.115(age frames are allocated by k)-4.365 F 1.115
(ernel routines, and ho)-.13 F 4.365(wt)-.325 G(hose)-4.365 E 0 Cg EP
%%Page: 19 19
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 19)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(page frames may be subdi)33.336 120 Q
(vided for ef)-.325 E(\214cient allocation of smaller objects.)-.325 E
/F2 13/Times-Bold@0 SF(Addr)196.486 150 Q(essing Issues on X86)-.234 E
F1 .841(Recall that the k)33.336 186 R .841(ernel, in a 32-bit X86 en)
-.13 F .842(vironment, uses the last 1GB of virtual address)-.52 F 1.935
(space for itself, lea)33.336 201 R 1.934(ving the \214rst 3GB to user)
-.26 F 5.184(-mode. Also)-.26 F 1.934(recall that all k)5.184 F 1.934
(ernel virtual)-.13 F 2.213
(addresses are shared, i.e. there is not a separate k)33.336 216 R 2.213
(ernel virtual address space for each)-.13 F 1.34
(process or component of the k)33.336 231 R 4.59(ernel. Therefore,)-.13
F 1.34(it w)4.59 F 1.34(ould seem to be impossible for the)-.13 F -.13
(ke)33.336 246 S(rnel to ha).13 E .39 -.195(ve m)-.26 H
(ore than 1GB of internal data structures.).195 E .626
(This is addressed through an interesting strate)33.336 267 R(gy)-.195 E
7.126(.L)-.845 G .627(inux further subdi)-7.126 F .627(vides both ph)
-.325 F(ysical)-.065 E .636(and k)33.336 282 R .635
(ernel virtual space so that the \214rst 896MB of ph)-.13 F .635
(ysical page frames map)-.065 F F2(dir)3.885 E(ectly)-.234 E F1(to)3.885
E 1.611(the \214rst 896MB of the last GB of virtual address space.)
33.336 297 R 1.611(This greatly simpli\214es k)8.111 F(ernel)-.13 E .95
(code as a ph)33.336 312 R .95(ysical page number can be used directly \
to compute the virtual address and)-.065 F 2.246(vice v)33.336 327 R
5.496(ersa. The)-.195 F 2.246(last 128MB of the k)5.496 F(ernel')-.13 E
5.496(sv)-.715 G 2.246(irtual address space is used to establish)-5.496
F F2 .416(temporary mappings)33.336 342 R F1 .416(to ph)3.666 F .416
(ysical pages which are abo)-.065 F .806 -.195(ve 8)-.195 H 3.666
(96MB. The).195 F -.13(ke)3.666 G .416(rnel calls these).13 F(tw)33.336
357 Q 3.76(oa)-.13 G .51(reas of ph)-3.76 F .51(ysical memory)-.065 F F2
(zones)3.761 E F1 3.761(,t)C .511
(he former being the NORMAL zone and the latter)-3.761 F 1.896
(the HIGHMEM zone.)33.336 372 R 1.896
(This klugery is not required for 64 bit architectures, where the)8.396
F -.13(ke)33.336 387 S(rnel has ample virtual address space to mak).13 E
3.25(ead)-.13 G(irect mapping to all ph)-3.25 E(ysical pages.)-.065 E
.454(When allocating memory for internal data structures, the k)33.336
408 R .454(ernel uses the pool of pages in)-.13 F 2.034
(the NORMAL zone.)33.336 423 R 2.034
(Since user processes are not con\214ned to the shared 1GB virtual)8.534
F 1.527(address space, their pages al)33.336 438 R -.13(wa)-.13 G 1.527
(ys get pulled from the HIGHMEM zone \214rst, and then,).13 F 2.587
(with reluctance, from the NORMAL zone if there is insuf)33.336 453 R
2.587(\214cient free memory in the)-.325 F(HIGHMEM zone.)33.336 468 Q F2
-.13(Pa)205.898 498 S(ge Descriptor T).13 E(able)-1.196 E F1 1.643
(The k)33.336 534 R 1.643(ernel maintains a single, contiguous array of)
-.13 F F2 1.644(page descriptor)4.894 F F1 1.644(structures, each of)
4.894 F(which represents one page frame:)33.336 549 Q/F3 10/Courier@0 SF
(struct page {)33.336 561 Q(unsigned long flags;)90.936 573 Q
(/* bitwise flags */)168 E(atomic_t _count;)90.936 585 Q
(/* usage counter */)134.4 E(atomic_t _mapcount;)90.936 597 Q
(/* how many PTE mappings to this page */)116.4 E
(/* This is a GCC compiler extension known as a blind union */)90.936
609 Q(union {)90.936 621 Q(unsigned long private;)148.536 633 Q
(// buddy order, et al)98.4 E(struct address_space *mapping;)148.536 645
Q(// reverse mapping)50.4 E(};)90.936 657 Q(pgoff_t index;)90.936 669 Q
(/* offset of page within mapping*/)146.4 E(struct list_head lru;)90.936
681 Q(/* free/active lists */)104.4 E(void *virtual;)90.936 693 Q
(/* kernel virt address */)146.4 E(};)33.336 705 Q F1 1.699
(The page descriptor table, called)33.336 726 R/F4 13/Courier@0 SF
(mem_map)4.949 E F1 1.698(\(another term often used in UNIX k)4.949 F
(ernels)-.13 E 4.3
(other than Linux is "core map"\) consumes a small amount of memory o)
33.336 741 R -.195(ve)-.195 G(rhead.).195 E 0 Cg EP
%%Page: 20 20
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 20)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(Speci\214cally)33.336 120 Q 3.321(,o)
-.845 G 3.321(na3)-3.321 G .07(2-bit system, each)-3.321 F/F2 13
/Courier@0 SF .07(struct page)3.32 F F1 .07(is 32 bytes long, so the o)
3.32 F -.195(ve)-.195 G .07(rhead is).195 F .499(32/4096 or 0.7%.)33.336
135 R .499(The page frame number is implicit by the inde)6.999 F 3.749
(xo)-.195 G 3.75(ft)-3.749 G .5(he page descriptor)-3.75 F 3.362
(within the)33.336 150 R F2(mem_map)6.612 E F1(array)6.612 E 9.862(.F)
-.845 G 3.362(or an)-10.057 F 6.612(yg)-.195 G -2.795 -.325(iv e)-6.612
H 6.612(np).325 G 3.362(age, if it f)-6.612 F 3.362(alls within the lo)
-.13 F(w-memory)-.325 E 1.649(\("NORMAL"\) zone, the k)33.336 165 R 1.65
(ernel can easily \214gure out the direct-mapped virtual address.)-.13 F
.177(Otherwise, if the page is currently mapped into k)33.336 180 R .177
(ernel memory space, the)-.13 F F2(virtual)3.427 E F1(\214eld)3.427 E
(says where.)33.336 195 Q 5.046(Ag)33.336 216 S -2.795 -.325(iv e)-5.046
H 5.046(np).325 G 1.797
(age frame is either mapped \(there is at least one PTE in somebody')
-5.046 F 5.047(sv)-.715 G(irtual)-5.047 E 1.031
(memory area, including the k)33.336 231 R(ernel')-.13 E 1.031
(s, that points to it\) or it is free.)-.715 F 3.111 -1.04(To s)7.531 H
-2.925 -.26(av e)1.04 H 1.031(space, some)4.541 F 4.235(\214elds of the)
33.336 246 R F2 4.235(struct page)7.485 F F1 4.236(are o)7.486 F -.195
(ve)-.195 G 4.236(rloaded with mutually e).195 F(xclusi)-.195 E 4.626
-.195(ve v)-.325 H 7.486(alues. F)-.13 F(or)-.195 E -.195(ex)33.336 261
S .704(ample, the blind union).195 F F2 .703(private / mapping)3.953 F
F1 .703(contains either information about the)3.953 F 1.507
(free page or information about the re)33.336 276 R -.195(ve)-.325 G
1.507(rse mapping if it is mapped.).195 F(The)8.007 E F2(_mapcount)4.757
E F1 3.353(\214eld will be 0 if the page is free and >0 if the page is \
mapped some)33.336 291 R 6.602(where. The)-.325 F .499
(confusingly named)33.336 306 R F2(_count)3.749 E F1 .5
(\214eld is a temporary usage counter that is incremented when)3.749 F
.505(certain memory management routines are doing something with that p\
age, and is used as)33.336 321 R 4.333(af)33.336 336 S 1.083
(orm of locking to pre)-4.333 F -.195(ve)-.325 G 1.084
(nt pages from disappearing while k).195 F 1.084
(ernel code is playing with)-.13 F 6.047(them. The)33.336 351 R F2
(flags)6.046 E F1 2.796(\214eld contains bitwise \215ags of the form)
6.046 F F2(PG_xxxx)6.046 E F1 2.796(which encode)6.046 F -.325(va)33.336
366 S .454(rious status v).325 F 3.704(alues. F)-.325 F .454(or e)-.195
F .454(xample, the)-.195 F F2(PG_locked)3.704 E F1 .454
(\215ag is set when an I/O operation is)3.704 F 1.615
(in progress on that page.)33.336 381 R 1.614
(The usage of the other \214elds in the)8.115 F F2 1.614(struct page)
4.864 F F1 1.614(will be)4.864 F
(discussed during the rest of this unit.)33.336 396 Q/F3 13/Times-Bold@0
SF -.13(Pa)178.936 426 S(ge Allocator -- Buddy System).13 E F1 2.08
(The basic k)33.336 462 R 2.08(ernel page frame allocator is based on a\
sking for one or more contiguous)-.13 F 3.393(pages. Although)33.336 477
R .142(most of the time k)3.392 F .142
(ernel routines are asking for just one page, sometimes)-.13 F 1.721
(the k)33.336 492 R 1.721(ernel needs a rather lar)-.13 F 1.721(ge b)
-.234 F(uf)-.26 E 1.721(fer which spans man)-.325 F 4.971(yp)-.195 G
1.722(ages, e.g. when setting up a)-4.971 F
(Direct Memory Access transfer to/from an I/O de)33.336 507 Q(vice.)
-.325 E 1.051(In general, memory allocation routines \(e.g.)33.336 528 R
F2(malloc\(\))4.301 E F1 1.051(in user mode\) are f)4.301 F 1.051
(aced with a)-.13 F(tradeof)33.336 543 Q 5.739(fb)-.325 G 2.489
(etween space ef)-5.739 F(\214cienc)-.325 E 5.739(ya)-.195 G 2.489
(nd time ef)-5.739 F(\214cienc)-.325 E 7.429 -.845(y. I)-.195 H 5.74(ft)
.845 G 2.49(here is a request for say 7)-5.74 F 1.226
(contiguous "units" of memory)33.336 558 R 4.476(,i)-.845 G 4.476(ti)
-4.476 G 4.476(sd)-4.476 G 1.226(esirable in terms of space ef)-4.476 F
(\214cienc)-.325 E 4.475(yt)-.195 G 4.475(os)-4.475 G 1.225(atisfy that)
-4.475 F .438(request with e)33.336 573 R .438(xactly 7 units.)-.195 F
(Ho)6.939 E(we)-.325 E -.195(ve)-.325 G 1.479 -.52(r, a).195 H 3.689(sm)
.52 G .439(emory is allocated and freed,)-3.689 F F3(fragmentation)3.689
E F1 4.893(arises. There)33.336 588 R 1.643
(may be 3 units free, then 1 occupied unit, then 4 more free units.)
4.893 F(Ev)8.142 E(en)-.195 E(though there are 7 free units, the)33.336
603 Q 3.25(ya)-.195 G
(re not contiguous and thus do not satisfy the request.)-3.25 E 2.469(I\
n some allocation settings, e.g. on-disk \214lesystems, it is possible \
to de-fragment the)33.336 624 R .786(system by sw)33.336 639 R .786
(apping storage locations so as to group clumps of free units together)
-.13 F 7.285(.T)-.715 G(his)-7.285 E 3.297
(is not possible in the C programming en)33.336 654 R 3.298
(vironment because once memory has been)-.52 F .791(allocated, its ra)
33.336 669 R 4.041(wa)-.195 G .791
(ddress has been passed back as a pointer and there is no w)-4.041 F .79
(ay to track)-.13 F(do)33.336 684 Q .473
(wn all references \(including of)-.325 F .473
(fset references\) to that memory re)-.325 F .473(gion, and thus no w)
-.195 F(ay)-.13 E(to change the address of the re)33.336 699 Q(gion.)
-.195 E(Gi)33.336 720 Q -.195(ve)-.325 G 4.168(nt).195 G .918
(hat fragmentation is una)-4.168 F -.26(vo)-.26 G .918(idable, the ne)
.26 F .918(xt best thing in terms of space ef)-.195 F(\214cienc)-.325 E
(y)-.195 E .183(is, gi)33.336 735 R -.195(ve)-.325 G -6.682 3.433(na r)
.195 H .184
(equest for N contiguous units, satisfy it with the smallest a)-3.433 F
-.325(va)-.26 G .184(ilable contiguous).325 F 0 Cg EP
%%Page: 21 21
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 21)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(re)33.336 120 Q .239
(gion of size M units, M>=N.)-.195 F(No)6.739 E 3.489(wt)-.325 G .239
(his leads to a time ef)-3.489 F(\214cienc)-.325 E 3.488(yi)-.195 G .238
(ssue: ho)-3.488 F 3.488(wl)-.325 G .238(ong will it)-3.488 F(tak)33.336
135 Q 3.986(et)-.13 G 3.986(os)-3.986 G .736(earch the list of a)-3.986
F -.325(va)-.26 G .737(ilable memory units to \214nd this "best \214t".)
.325 F .737(In the case of the)7.237 F -.13(ke)33.336 150 S .545(rnel, \
because memory allocation is a frequent and critical operation, it is d\
esirable that).13 F .814(this time be a constant one, not one which gro)
33.336 165 R .814(ws as the number of distinct free memory)-.325 F 5.852
(units increases because of fragmentation.)33.336 180 R 5.851
(Therefore, the Linux k)12.351 F 5.851(ernel mak)-.13 F 5.851(es a)-.13
F .99(compromise, and adopts the well-kno)33.336 195 R .99(wn "b)-.325 F
.99(uddy system" algorithm to gi)-.26 F 1.381 -.195(ve f)-.325 H .991
(airly decent).065 F 1.071(space ef)33.336 210 R(\214cienc)-.325 E 4.321
(ya)-.195 G 1.07
(nd lookup time which, although not strictly constant-time, has a small)
-4.321 F(and \214x)33.336 225 Q(ed upper bound.)-.195 E 1.038(The "b)
33.336 246 R 1.039(uddy system" algorithm maintains, for each of the me\
mory allocation zones \(e.g.)-.26 F .265
(NORMAL and HIGHMEM\) an array of 11 pointers.)33.336 261 R .264
(The [0] element of this array points)6.765 F .442
(to a circular doubly-link)33.336 276 R .443
(ed list of page descriptors for page frames which are free b)-.13 F
.443(ut not)-.26 F 1.313(contiguous with other free pages.)33.336 291 R
1.313(The [1] element points to such a list for groups of 2)7.813 F .702
(contiguous pages.)33.336 306 R .702
(The [2] element does the same for groups of 4 contiguous pages, and)
7.202 F .894(so on up to the [10] element which collects groups of 1024\
 contiguous pages, i.e. 4MB.)33.336 321 R .155
(These lists are chained through the)33.336 336 R/F2 13/Courier@0 SF
(lru)3.405 E F1 .155
(\214eld of the page descriptor \(which has other uses)3.405 F 1.639
(when the page frame is not free\) and furthermore the)33.336 351 R F2
(private)4.889 E F1 1.639(\214eld of the \214rst page)4.889 F 3.977
(descriptor in a contiguous chunk holds the order of that chunk.)33.336
366 R 3.977(Subsequent page)10.477 F 1.929
(descriptors in the chunk are not part of the list b)33.336 381 R 1.929
(ut their e)-.26 F 1.929(xistence is inferred by their)-.195 F
(position in the)33.336 396 Q F2(mem_map)3.25 E F1(.)A 1.332
(When a routine in the k)33.336 417 R 1.332(ernel w)-.13 F 1.333
(ants say one page frame, the b)-.13 F 1.333(uddy system tries to tak)
-.26 F(e)-.13 E .394(that from the [0] order list of free page frames.)
33.336 432 R .394(If there are none, it grabs a chunk of tw)6.894 F(o)
-.13 E .567(page frames from the [1] list and splits it, handing one ba\
ck to the caller and mo)33.336 447 R .568(ving the)-.195 F .71
(other to the [0] list.)33.336 462 R .71(If the [1] list is empty)7.21 F
3.96(,t)-.845 G .709(his process continues mo)-3.96 F .709
(ving up the ladder)-.195 F(,)-.52 E 4.876(e.g. taking)33.336 477 R
4.876(ac)4.876 G 1.627
(lump of 4 contiguous frames, returning 1 to the caller)-4.876 F 4.877
(,a)-.52 G 1.627(nd splitting the)-4.877 F
(remainder into a single free frame and a pair of frames.)33.336 492 Q
1.822(When a page frame or contiguous group of frames is de-allocated b\
y the k)33.336 513 R 1.821(ernel to be)-.13 F .121
(placed back in the free pool, the "b)33.336 528 R .121
(uddy system" checks to see if the freed page\(s\) is/are a)-.26 F 1.099
(contiguous "b)33.336 543 R 1.099(uddy" of another free page.)-.26 F
1.099(If so, the)7.599 F 4.348(ya)-.195 G 1.098(re mer)-4.348 F 1.098
(ged to form a higher)-.234 F(-order)-.26 E .173(contiguous re)33.336
558 R 3.423(gion. This)-.195 F .174
(process can continue up to order 10, i.e.)3.423 F .174
(coalescing into a chunk)6.674 F(of 1,024 free pages.)33.336 573 Q 1.238
(Note that the b)33.336 594 R 1.237(uddy system trades CPU time ef)-.26
F(\214cienc)-.325 E 4.487(yf)-.195 G 1.237(or absolute memory ef)-4.487
F(\214cienc)-.325 E -.845(y,)-.195 G .139
(by introducing an additional restriction.)33.336 609 R 3.389(Ag)6.639 G
.139(roup of pages on the, e.g. [2] list, i.e. a group)-3.389 F 1.011
(of 4 contiguous pages, will al)33.336 624 R -.13(wa)-.13 G 1.011
(ys start with a page number di).13 F 1.011(visible by 4.)-.325 F 1.01
(If say page)7.51 F .813(frame numbers 1024-1027 inclusi)33.336 639 R
1.203 -.195(ve a)-.325 H .813
(re free, these can be used to satisfy a request for 4).195 F 2.27
(contiguous pages.)33.336 654 R(Ho)8.77 E(we)-.325 E -.195(ve)-.325 G
3.31 -.52(r, i).195 H 5.52(f1).52 G 2.27(025-1028 inclusi)-5.52 F 2.66
-.195(ve a)-.325 H 2.269(re free, this does not satisfy the).195 F .255
(request, because the start of the free area, 1025, is not a multiple o\
f 4.)33.336 669 R .255(Instead, the b)6.755 F(uddy)-.26 E 1.456
(system vie)33.336 684 R 1.456
(ws this as a page of order 0 \(#1025\), tw)-.325 F 4.706(op)-.13 G
1.456(ages of order 1 \(1026-1027\) and)-4.706 F
(another page \(1028\) of order 0.)33.336 699 Q(Gi)33.336 720 Q -.195
(ve)-.325 G 4.937(nap).195 G 1.687(age frame number)-4.937 F F2(a)4.937
E F1 4.937(,i)C 1.687(ts order)-4.937 F(-)-.26 E F2(N)A F1 -.26(bu)4.937
G 1.687(ddy with page frame number).26 F F2(b)4.938 E F1(therefore)4.938
E(satis\214es the e)33.336 735 Q(xpression:)-.195 E 0 Cg EP
%%Page: 22 22
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 22)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF(b==a ^ \(1<<N\))33.336 117 Q/F2 13
/Times-Roman@0 SF(An)33.336 132 Q 3.25(yp)-.195 G(age frame number)-3.25
E/F3 13/Courier@0 SF(a)3.25 E F2(of order)3.25 E(-)-.26 E F3(N)A F2
(has a parent of order)3.25 E F3(N+1)3.25 E F2(which li)3.25 E -.195(ve)
-.325 G 3.25(sa).195 G(t:)-3.25 E F1(p=a & ~ \(1<<N\))33.336 144 Q F2
3.839(These simple bit-arithmetic relationships allo)33.336 165 R 7.088
(wt)-.325 G 3.838(he deallocation and conglomeration)-7.088 F 1.517
(algorithm to be performed v)33.336 180 R 1.517(ery quickly)-.195 F
4.767(,w)-.845 G 1.517(ithout e)-4.767 F(xtensi)-.195 E 1.907 -.195
(ve d)-.325 H 1.517(ata structures manipulation).195 F
(and resulting memory accesses.)33.336 195 Q
(The penalty is increased fragmentation.)6.5 E/F4 13/Times-Bold@0 SF
(Slab Allocator)227.432 225 Q F2 1.623(The k)33.336 261 R 1.623
(ernel subdi)-.13 F 1.623(vides page frames using a system called the)
-.325 F F4 1.623(Slab Allocator)4.873 F F2 1.623(for small)4.873 F 1.733
(objects \(e.g. allocating a ne)33.336 276 R(w)-.325 E F3(task_struct)
4.984 E F2 4.984(\). This)B 1.734(system is f)4.984 F 1.734
(airly complicated and)-.13 F 1.267(will not be fully described here.)
33.336 291 R 1.267(The k)7.767 F 1.267
(ernel grabs page frames and uses them as slabs,)-.13 F .715
(storing an internal descriptor at the be)33.336 306 R .715
(ginning of the slab to track ho)-.195 F 3.965(wt)-.325 G .715
(he page frame or)-3.965 F .847(frames is being subdi)33.336 321 R 4.097
(vided. Because)-.325 F .847(the k)4.097 F .847
(ernel is a tightly-controlled piece of code and)-.13 F 2.277(the type \
of data structures which will need to be allocated and released frequen\
tly is)33.336 336 R .623(understood in adv)33.336 351 R .622(ance, the \
slab allocator can be optimized so that it can quickly allocate)-.325 F
(and free objects of a gi)33.336 366 Q -.195(ve)-.325 G 3.25(nt).195 G
(ype.)-3.25 E 1.728(When the k)33.336 387 R 1.728
(ernel requires space for a ne)-.13 F 4.978(wo)-.325 G 1.728
(bject of a certain type, it consults the slab)-4.978 F .264
(associated with that type.)33.336 402 R .264
(The slab descriptor bitmap quickly determines if there is a free)6.764
F 1.009(slot open, and if so where.)33.336 417 R 1.009
(If there are no free slots, the slab allocator goes back to the)7.509 F
.972(page frame allocator and asks for an additional page \(not necessa\
rily contiguous\) which)33.336 432 R(is subdi)33.336 447 Q
(vided into slots.)-.325 E(Lik)33.336 468 Q -.325(ew)-.13 G 1.886(ise, \
de-allocation of an object allocated through the slab allocator means s\
imply).325 F 1.51(noting in the descriptor that the slot is free.)33.336
483 R 1.509(If all slots in the page frame are free, the)8.009 F
(page frame itself is released to the free pool.)33.336 498 Q 2.034
(The slab allocator is both space ef)33.336 519 R 2.034
(\214cient \(the o)-.325 F -.195(ve)-.195 G 2.035
(rhead is just 1 bit in the bitmap per).195 F .225(object, plus a fe)
33.336 534 R 3.475(wb)-.325 G .225(ytes for the o)-3.475 F -.195(ve)
-.195 G .224(rall slab header\) and time ef).195 F .224
(\214cient \(no con)-.325 F -.26(vo)-.52 G .224(luted data).26 F 3.419
(structures\). This)33.336 549 R .169
(is important because small data structures \(such as)3.419 F F3 .169
(struct file)3.419 F F2 3.419(\)a)C(re)-3.419 E
(frequently being allocated and released by the k)33.336 564 Q(ernel.)
-.13 E F4(Addr)176.401 624 Q(ess space r)-.234 E(elease \(munmap\))-.234
E F2 1.092(When a)33.336 654 R F3(vm_area)4.342 E F2 1.092(is destro)
4.342 F 1.092
(yed via the munmap operation, either via the system call or)-.13 F
1.124(the internal v)33.336 669 R 1.125(ersion which is called during e)
-.195 F -.195(xe)-.195 G 4.375(co).195 G 4.375(re)-4.375 G 1.125
(xit, the k)-4.57 F 1.125(ernel visits the page tables)-.13 F .468
(which are spanned by that re)33.336 684 R 3.717(gion. F)-.195 F .467
(or an)-.195 F 3.717(yP)-.195 G .467
(RESENT PTE, the PFN gets us to the struct)-3.717 F 4.038(page. The)
33.336 699 R F3(mapcount)4.038 E F2 .788(is decremented.)4.038 F .789
(If this w)7.288 F .789(as the last mapping to the page and the)-.13 F
.695(count is no)33.336 714 R 3.945(w0)-.325 G 3.945(,t)-3.945 G .695
(he page is mo)-3.945 F -.195(ve)-.195 G 3.945(dt).195 G 3.945(ot)-3.945
G .695(he free list.)-3.945 F .695(This process is recursi)7.195 F -.195
(ve)-.325 G 7.194(.I).195 G 3.944(fa)-7.194 G 3.944(ne)-3.944 G(ntire)
-3.944 E .636(page table w)33.336 729 R .636(orth of PTEs ha)-.13 F
1.026 -.195(ve b)-.26 H .636
(een freed up, the page table itself can be returned to the).195 F .321
(page frame pool.)33.336 744 R .321(Finally when the entire process add\
ress space is free, the PGD is freed.)6.821 F 0 Cg EP
%%Page: 23 23
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 23)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.588(If an)33.336 120 R 4.838(yP)-.195 G
1.588(TEs indicate that this w)-4.838 F 1.589(as an anon)-.13 F 1.589
(ymous page that had been sw)-.195 F 1.589(apped out, the)-.13 F -.13
(ke)33.336 135 S .749(rnel updates its).13 F/F2 13/Times-Italic@0 SF
.749(swap map)3.999 F F1 3.999(,d)C .749
(ecrementing the reference count on that sw)-3.999 F .749(ap slot.)-.13
F(When)7.249 E(the reference count is 0, the sw)33.336 150 Q
(ap slot is free to be re-used.)-.13 E 3.374
(Upon process termination, the k)33.336 171 R 3.375
(ernel calls an internal v)-.13 F 3.375(ersion of munmap for each)-.195
F 1.199(vm_area_struct in that process')33.336 186 R 4.448(sa)-.715 G
1.198(ddress space.)-4.448 F 1.198(Therefore it is ne)7.698 F -.195(ve)
-.325 G 4.448(rn).195 G 1.198(ecessary for user)-4.448 F(code to e)
33.336 201 Q(xplicitly free memory prior to program e)-.195 E(xit!)-.195
E/F3 13/Times-Bold@0 SF(Copy-On-Write and F)195.998 231 Q(ork)-.325 E F1
.099(When the virtual address space is copied during fork, the k)33.336
267 R .099(ernel mak)-.13 F .099(es a deep cop)-.13 F 3.35(yo)-.13 G
3.35(ft)-3.35 G(he)-3.35 E/F4 13/Courier@0 SF .71(struct mm_struct)
33.336 282 R F1 .709(in the parent to form the memory map of the child.)
3.96 F .709(This means)7.209 F 1.442(that each)33.336 297 R F4
(vm_area_struct)4.692 E F1 1.442(is copied, forming a ne)4.692 F 4.692
(wl)-.325 G(ink)-4.692 E 1.442(ed list attached to the ne)-.13 F(w)-.325
E F4(mm_struct)33.336 312 Q F1 1.207(of the child.)4.457 F 1.206
(The page tables are also deep-copied.)7.706 F 1.206
(The child gets a ne)7.706 F(w)-.325 E 1.231(PGD which is a cop)33.336
327 R 4.481(yo)-.13 G 4.481(ft)-4.481 G 1.231(he parent')-4.481 F 1.231
(s, and an)-.715 F 4.481(yP)-.195 G 1.231
(UD, PMD and PTs are also recursi)-4.481 F -.195(ve)-.325 G(ly).195 E
4.586(deep-copied. Each)33.336 342 R 1.336
(PTE in the parent is thus duplicated to the child, and if the page in)
4.586 F 4.792(question is Present, the reference count of the correspon\
ding struct page is also)33.336 357 R(incremented.)33.336 372 Q(Re)
33.336 393 Q .845(gions that are writable and MAP_PRIV)-.195 F -1.443
(AT)-1.755 G .845(E, including the data, bss and stack re)1.443 F(gions)
-.195 E .799(of an)33.336 408 R 4.049(yp)-.195 G .8
(rocess, are set up for)-4.049 F F3(copy-on-write)4.05 E F1 4.05(:t)C .8
(he W bit is turned of)-4.05 F 4.05(fi)-.325 G 4.05(nb)-4.05 G .8
(oth the original)-4.05 F .328(parent PTE and the ne)33.336 423 R 3.577
(wc)-.325 G .327(hild PTE.)-3.577 F .327(The Linux k)6.827 F .327
(ernel also turns of)-.13 F 3.577(ft)-.325 G .327(he A bit in the child)
-3.577 F 3.509(PTE. The)33.336 438 R F4(vm_page_prot)3.509 E F1 .259
(\214eld of the vm_area_struct is modi\214ed so that an)3.509 F 3.509
(yn)-.195 G .909 -.325(ew P)-3.509 H(TE).325 E .963
(mappings in the shared memory re)33.336 453 R .963(gions \(which w)
-.195 F .963(ould otherwise ha)-.13 F 1.353 -.195(ve t)-.26 H .963
(he PTE_WRITE).195 F 1.197(bit turned on because the)33.336 468 R 4.448
(yh)-.195 G -2.925 -.26(av e)-4.448 H 1.198
(VM_WRITE\) caused by a page f)4.708 F 1.198(ault are installed with)
-.13 F .51(the W bit of)33.336 483 R .51(f, which will allo)-.325 F
3.759(wt)-.325 G .509
(he page frame to be shared until somebody tries to write)-3.759 F
(to it.)33.336 498 Q(Re)33.336 519 Q 2.444(gions that ha)-.195 F 2.834
-.195(ve t)-.26 H 2.444
(he VM_SHARED property \(i.e. MAP_SHARED memory mapped).195 F(re)33.336
534 Q .355(gions\) are)-.195 F F3(not)3.605 E F1(cop)3.605 E .355
(y-on-write since by de\214nition the)-.13 F 3.605(ya)-.195 G .355
(re shared after a fork.)-3.605 F .354(The PTEs)6.854 F .952(are not mo\
di\214ed and the parent and child will continue to map to the same page\
 frames)33.336 549 R(for all pages in this shared re)33.336 564 Q(gion.)
-.195 E .247(By w)33.336 585 R .247(ay of contrast, during a)-.13 F F4
(clone)3.497 E F1 .247(system call, the)3.497 F F4(task_struct)3.497 E
F1 .247(is not deep-copied.)3.497 F 1.196(The ne)33.336 600 R(w)-.325 E
F4(task_struct)4.446 E F1 1.197(of the child is a shallo)4.447 F 4.447
(wc)-.325 G(op)-4.447 E 4.447(yo)-.13 G 4.447(ft)-4.447 G 1.197
(he parent.)-4.447 F 1.197(This means that)7.697 F(the)33.336 615 Q F4
(mm_struct)5.214 E F1 1.964
(and all subsidiary structures will simply be shared.)5.214 F 1.964
(All threads in a)8.464 F .883(multi-threaded program, which are create\
d with clone, thus share the same page frames.)33.336 630 R .674
(Furthermore, system calls such as mmap or munmap made by one thread af)
33.336 645 R .674(fect all other)-.325 F(threads in that process.)33.336
660 Q 0 Cg EP
%%Page: 24 24
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 24)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Bold@0 SF(The T)157.973 120 Q
(rinity of Memory and Addr)-.962 E(essing)-.234 E/F2 13/Times-Roman@0 SF
2.08 -1.04(We c)33.336 156 T
(an look at randomly-addressable things from three standpoints:)1.04 E
4.821<8356>33.336 171 S 1.571
(irtual pages: The set of all virtual memory re)-5.601 F 1.572
(gions in all address spaces along with)-.195 F
(their associated properties)33.336 186 Q 3.25<8350>33.336 201 S -.065
(hy)-3.25 G(sical pages \(page frames\)).065 E 3.697<8354>33.336 216 S
.447(he \214le and disk I/O system.)-3.697 F .446
(Each \214le is randomly-addressable and portions of the \214le)6.946 F
.026(may be cached in ph)33.336 231 R .027(ysical memory)-.065 F 6.527
(.I)-.845 G 3.277(na)-6.527 G .027(ddition, a \214le or a ra)-3.277 F
3.277(wd)-.195 G .027(isk partition may be used)-3.277 F(as)33.336 246 Q
F1(swap space)3.25 E F2(to hold anon)3.25 E
(ymous virtual pages when the)-.195 E 3.25(yh)-.195 G -2.925 -.26(av e)
-3.25 H(to be paged-out.)3.51 E 1.312(There are relationships in both d\
irections between each of these three vie)33.336 267 R 1.312
(ws, which are)-.325 F .835(managed by v)33.336 282 R .835(arious k)
-.325 F .835(ernel data structures.)-.13 F .836
(The diagram near the end of this unit sho)7.336 F(ws)-.325 E .211
(all of these together and can be quite intimidating.)33.336 297 R .21
(The relationships, or mappings, are as)6.711 F(follo)33.336 312 Q(ws:)
-.325 E<83>33.336 342 Q F1 -.325(Fo)3.736 G .486(rward Mapping).325 F F2
3.736(:G)C -2.795 -.325(iv e)-3.736 H 3.736(nav).325 G .487
(irtual page \(i.e. a speci\214c virtual memory area and of)-3.736 F
(fset)-.325 E .754(within that area\), what page frame holds it or)
33.336 357 R 4.003(,i)-.52 G 4.003(fn)-4.003 G 4.003(op)-4.003 G .753
(age frame holds it, ho)-4.003 F 4.003(wd)-.325 G 4.003(ow)-4.003 G
4.003<658c>-4.003 G(nd)-4.003 E 4.463
(the canonical contents of that page frame?)33.336 372 R 4.464
(The page table data structure, which)10.963 F 1.562(ultimately deli)
33.336 387 R -.195(ve)-.325 G 1.562
(rs us to the PTE, determines the page frame.).195 F 1.562
(This is an N:1 mapping)8.062 F 1.091(because a gi)33.336 402 R -.195
(ve)-.325 G 4.341(np).195 G 1.091
(age frame can be shared among multiple virtual memory re)-4.341 F 1.091
(gions \(e.g.)-.195 F 1.869(MAP_SHARED mmap\).)33.336 417 R 1.869
(If the PTE is empty)8.369 F 5.119(,t)-.845 G 1.869
(he vm_\214le and vm_pgof)-5.119 F 5.119<668c>-.325 G 1.869(elds of the)
-5.119 F .754(vm_area_struct point us in the right direction for \214nd\
ing the corresponding chunk of the)33.336 432 R
(\214le which backs up this virtual memory re)33.336 447 Q(gion.)-.195 E
<83>33.336 462 Q F1(Re)3.71 E -.13(ve)-.195 G .459(rse Mapping).13 F F2
3.709(:F)C .459(or a gi)-3.904 F -.195(ve)-.325 G 3.709(np).195 G .459
(age frame, \214nd all PTEs that map to it.)-3.709 F(Dif)6.959 E .459
(ferent data)-.325 F 4.007(structures are used for re)33.336 477 R -.195
(ve)-.325 G 4.007(rsed mapping depending on whether the gi).195 F -.195
(ve)-.325 G 7.258(np).195 G 4.008(age is)-7.258 F(anon)33.336 492 Q
(ymous or \214le-mapped.)-.195 E<83>33.336 507 Q F1 1.326(I/O Mapping)
4.576 F F2 4.576(:W)C 1.326(hen a gi)-4.576 F -.195(ve)-.325 G 4.576(np)
.195 G 1.326(age-sized chunk of a \214le is w)-4.576 F 1.326
(anted for a read or write)-.13 F .547(system call, determine if that c\
hunk is already cached in memory and if so, in what page)33.336 522 R
(frame?)33.336 537 Q 0 Cg EP
%%Page: 25 25
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 25)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E 0 0 288 506 -280.032 492 123.336 400.032 PBEGIN
%%BeginDocument: trinity.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: trinity.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Fri Nov 11 00:29:09 2016
%%For: hak@lex ()
%%BoundingBox: 0 0 506 492
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 492 moveto 0 0 lineto 506 0 lineto 506 492 lineto closepath clip newpath
-40.0 581.2 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 1950 3150 1275 1650 0 360 DrawEllipse gs col0 s gr

% Ellipse
n 4200 7875 1803 1803 0 360 DrawEllipse gs col0 s gr

% Polyline
n 2925 2850 m
 6675 2850 l gs col0 s gr 
% Polyline
n 7080 1725 m 6975 1725 6975 4920 105 arcto 4 {pop} repeat
  6975 5025 8970 5025 105 arcto 4 {pop} repeat
  9075 5025 9075 1830 105 arcto 4 {pop} repeat
  9075 1725 7080 1725 105 arcto 4 {pop} repeat
 cp gs col0 s gr 
% Polyline
n 6975 2625 m
 6525 3075 l gs col0 s gr 
% Polyline
n 6975 2625 m
 6600 2250 l gs col0 s gr 
% Polyline
n 2925 2400 m
 6750 2400 l gs col0 s gr 
% Polyline
n 2175 4200 m
 3225 6000 l gs col0 s gr 
% Polyline
n 2560 3970 m
 3675 5925 l gs col0 s gr 
% Polyline
n 3525 6150 m
 3900 5475 l gs col0 s gr 
% Polyline
n 3525 6150 m
 2850 5925 l gs col0 s gr 
% Polyline
n 2850 6750 m
 2025 5025 l gs col0 s gr 
% Polyline
n 1875 4950 m
 2325 5175 l gs col0 s gr 
% Polyline
n 1725 5175 m
 2625 7050 l gs col0 s gr 
% Polyline
n 1875 4950 m
 1650 5325 l gs col0 s gr 
% Polyline
n 3525 4125 m
 3150 3750 l gs col0 s gr 
% Polyline
n 3600 3300 m
 3150 3750 l gs col0 s gr 
% Polyline
n 3450 3525 m
 6975 3525 l gs col0 s gr 
% Polyline
n 3450 3900 m
 6975 3900 l gs col0 s gr 
% Polyline
n 6525 4575 m
 6975 4800 l gs col0 s gr 
% Polyline
n 6975 4800 m
 6825 5250 l gs col0 s gr 
% Polyline
n 6825 5025 m
 5100 6375 l gs col0 s gr 
% Polyline
n 6000 6600 m
 5925 7200 l gs col0 s gr 
% Polyline
n 5925 7200 m
 6375 7275 l gs col0 s gr 
% Polyline
n 6000 6900 m
 7650 5025 l gs col0 s gr 
% Polyline
n 6150 7200 m
 8175 5025 l gs col0 s gr 
% Polyline
n 4875 6225 m
 6675 4725 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
1275 2100 m
gs 1 -1 sc (Virtual Pages) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
975 2850 m
gs 1 -1 sc (Set of vm_area_struct) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7425 2025 m
gs 1 -1 sc (Physical Pages) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7425 2535 m
gs 1 -1 sc (array of) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7425 2790 m
gs 1 -1 sc ( struct page) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7425 3300 m
gs 1 -1 sc (\(mem_map\)) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3600 6600 m
gs 1 -1 sc (Files) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3600 7110 m
gs 1 -1 sc (Set of struct file,) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3600 7365 m
gs 1 -1 sc (and corresponding) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3600 7620 m
gs 1 -1 sc (struct inode) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3525 2700 m
gs 1 -1 sc (N:1 mapping by PTEs) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2475 4425 m
gs 1 -1 sc  300.0 rot (vm_file, vm_pgoff) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3825 3825 m
gs 1 -1 sc (anon_vma) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2250 6000 m
gs 1 -1 sc  300.0 rot (PST) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5325 6150 m
gs 1 -1 sc  40.0 rot (radix-64 tree) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6375 6750 m
gs 1 -1 sc  45.0 rot (page->mapping) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3600 2175 m
gs 1 -1 sc (Forward Mapping) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4500 3450 m
gs 1 -1 sc (Reverse  Mapping) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6750 6975 m
gs 1 -1 sc (Reverse Mapping) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3225 4800 m
gs 1 -1 sc (Forward Mapping) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
975 6375 m
gs 1 -1 sc (Reverse) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
975 6630 m
gs 1 -1 sc (Mapping) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4650 5475 m
gs 1 -1 sc (I/O Mapping) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F1 13/Times-Roman@0 SF 1.277
(These mappings form a circle, and thus it is dif)33.336 427.032 R 1.276
(\214cult to present this material which has)-.325 F .749
(circularities in our comprehension prerequisites.)33.336 442.032 R
2.829 -1.04(We m)7.249 H .749(ust jump into it at some point, so)1.04 F
(we will start with F)33.336 457.032 Q(orw)-.195 E(ard Mapping!)-.13 E
/F2 13/Times-Bold@0 SF -.13(Pa)149.634 487.032 S(ge F).13 E
(ault Handling)-.325 E(-- F)6.5 E(orward Mapping)-.325 E F1 1.454
(The page f)33.336 523.032 R 1.454(ault e)-.13 F 1.454
(xception is used by the CPU to indicate an access to an in)-.195 F
-.325(va)-.52 G 1.453(lid or un-).325 F .242
(translated virtual address.)33.336 538.032 R(Ho)6.742 E(we)-.325 E
-.195(ve)-.325 G 1.282 -.52(r, t).195 H .242
(his is usually not a real problem.).52 F .242(The k)6.742 F .242
(ernel enjo)-.13 F(ys)-.13 E 2.14(handling page f)33.336 553.032 R 2.14
(aults, and uses page f)-.13 F 2.139
(aults to implement a number of features, one of)-.13 F .794(which is)
33.336 568.032 R F2 .794(Demand P)4.044 F(aging)-.13 E F1 4.044(:p)C
.794(age frames are not actually allocated, and I/O operations \(if)
-4.044 F 2.3(applicable\) are not actually initiated, until a process e\
stablishes the need to do so by)33.336 583.032 R 2.893
(attempting to access the corresponding virtual page.)33.336 598.032 R
2.894(This is a signi\214cant speed and)9.394 F .636(memory usage impro)
33.336 613.032 R -.195(ve)-.195 G 3.886(ment. W).195 F .636
(ithout demand paging, programs w)-.52 F .636(ould tak)-.13 F 3.886(ea)
-.13 G .635(long time)-.001 F .652(to load and start, because the entir\
e program code \(including all those libraries\) and data)33.336 628.032
R -.13(wo)33.336 643.032 S .425(uld ha).13 F .815 -.195(ve t)-.26 H
3.674(ob).195 G 3.674(er)-3.674 G .424(ead in from disk.)-3.674 F -.52
(Wi)6.924 G .424(th Demand P).52 F .424
(aging, only the code and data which)-.195 F
(is actually used consumes reserouces.)33.336 658.032 Q(The k)33.336
679.032 Q(ernel')-.13 E 3.25(sp)-.715 G(age f)-3.25 E(ault handler kno)
-.13 E(ws:)-.325 E 3.25<8354>33.336 694.032 S(he identity of the f)-3.25
E(aulting process \()-.13 E/F3 13/Courier@0 SF(current)A F1(global v)
3.25 E(ariable\))-.325 E 3.25<8354>33.336 709.032 S
(he attempted virtual address.)-3.25 E 3.25<8354>33.336 724.032 S
(he type of access \(read/write\).)-3.25 E 3.25<8357>33.336 739.032 S
(hether the virtual page in question had a v)-3.25 E(alid PTE)-.325 E 0
Cg EP
%%Page: 26 26
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 26)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 3.25<8354>33.336 120 S(he re)-3.25 E
(gisters at the time of f)-.195 E
(ault \(including user/supervisor \215ag\).)-.13 E 1.628(The page f)
33.336 141 R 1.628(ault handler can ha)-.13 F 2.018 -.195(ve o)-.26 H
1.628(ne of tw).195 F 4.879(og)-.13 G 1.629
(eneral outcomes: Either the page f)-4.879 F 1.629(ault is)-.13 F
(resolv)33.336 156 Q .322(ed, resulting in the establishment of a v)
-.195 F .322(alid PTE \(which has the appropriate R/W/X)-.325 F 2.78
(permissions for the access being attempted\) pointing to a v)33.336 171
R 2.78(alid page frame with the)-.325 F 2.073
(correct data in it, or the page f)33.336 186 R 2.073
(ault can not be resolv)-.13 F 2.073(ed, resulting in the deli)-.195 F
-.195(ve)-.325 G 2.073(ry of a).195 F(SIGSEGV)33.336 201 Q 5.903(,S)
-1.677 G(IGB)-5.903 E 2.654(US or SIGKILL to the process.)-.13 F(Let')
9.154 E 5.904(st)-.715 G(ak)-5.904 E 5.904(eal)-.13 G 2.654
(ook at the page f)-5.904 F(ault)-.13 E(handler code:)33.336 216 Q/F2 10
/Courier@0 SF(/* Please note: All of this code is fictional, but based \
on a true story.)33.336 228 Q 6(*I)39.336 240 S 6(ti)-6 G 6(sah)-6 G
(eavily simplified and cleansed condensation of actual Linux)-6 E 6(*k)
39.336 252 S(ernel source code for page fault handling.)-6 E
(Many of the variable and)12 E 6(*f)39.336 264 S
(unction names have been changed to protect the innocent.)-6 E
(The interested)12 E 6(*r)39.336 276 S
(eader is invited to begin at /usr/src/linux/mm/memory.c)-6 E(*/)66 E(/\
* handle_pagefault_usermode\(\) is the fictitious name of the fault han\
dler)33.336 300 Q 6(*w)39.336 312 S(hich is invoked when the MMU gives \
a page fault and the kernel determines)-6 E 6(*t)39.336 324 S
(hat the fault happened while in user mode.)-6 E
(Because this is a synchronous)12 E 6(*e)39.336 336 S(ntry into the ker\
nel, the current variable is that of the process which)-6 E 6(*c)39.336
348 S(aused the page fault.)-6 E
(Upon return from this function, we will return to)12 E 6(*u)39.336 360
S(ser mode and either the faulted instruction will be re-started or a)-6
E 6(*s)39.336 372 S(ignal handler will be invoked)-6 E(*/)228 E
(handle_pagefault_usermode\(void *addr, int access_type\))33.336 384 Q
({)33.336 396 Q(struct vm_area_struct *vma,*growsdown;)39.336 408 Q
(void *new_addr;)39.336 420 Q(if \(addr >= KERNEL_MEMORY_START\))90.936
456 Q(// Attempt to access kmem from user)38.4 E
(force_sig\(current,SIGSEGV\);)148.536 468 Q
(/* Note: the force_sig function posts the requested signal to the)
90.936 480 Q 6(*s)96.936 492 S(pecified task.)-6 E
(If that signal is currently being ignored or)12 E 6(*b)96.936 504 S
(locked, the setting is changed to SIG_DFL which usually terminates.)-6
E 6(*W)96.936 516 S 6(ec)-6 G
(an't ignore or defer the signal because the current instruction)-6 E 6
(*h)96.936 528 S
(as faulted and therefore continued execution makes no sense */)-6 E
(growsdown=NULL;)90.936 552 Q
(/* Is the fault address inside of a defined region? */)90.936 564 Q
(for\(vma=current->mm->mmap;vma;vma=vma->vm_next\))90.936 576 Q({)90.936
588 Q(if \(addr>=vm->vm_start && addr<vm->vm_end\) break;)148.536 600 Q
(if \(vm->vm_flags & VM_GROWSDOWN &&)148.536 612 Q
(vm->vm_start-addr < STACK_FUZZINESS &&)206.136 624 Q
(regs->esp <= addr + STACK_FUZZINESS\))206.136 636 Q(growsdown=vma;)
263.736 648 Q(})90.936 660 Q(if \(!vma && growsdown\))90.936 672 Q({)
90.936 684 Q(new_addr= addr&~\(PAGE_SIZE-1\);)148.536 696 Q
(// round down to page boundary)50.4 E(vma=growsdown;)148.536 708 Q
(/* There are additional checks, e.g. will the newly grown)148.536 720 Q
6(*s)154.536 732 S
(tack exceed resource limits, or collide with another area */)-6 E 0 Cg
EP
%%Page: 27 27
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 27)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF(vma->vm_start=new_addr;)148.536 117 Q(})
90.936 129 Q(if \(!vma\))90.936 141 Q(// No valid region found)61.2 E
(return force_sig\(current,SIGSEGV\);)148.536 153 Q
(/* Inside of a region, may have been a protections fault */)90.936 177
Q(if \(!protections_ok\(vm->vm_flags,access_type\)\))90.936 189 Q
(return force_sig\(current,SIGSEGV\);)148.536 201 Q
(/* We have now proved that the user's access is valid,)90.936 213 Q
45.6(*l)96.936 225 S(et's resolve the page fault */)-45.6 E(try_again:)
39.336 237 Q(vp_addr = addr & ~\(PAGE_SIZE-1\);)90.936 249 Q
(// Start of virtual page w/ fault)18 E
(switch \(handle_mm_fault\(current->mm,vma,vp_addr,access_type\)\))
90.936 261 Q({)90.936 273 Q(case VM_FAULT_OOM:)102.936 285 Q
(if \(current->pid == 1\) {)148.536 297 Q(// Oh no, can't kill init!)
28.8 E 61.2(yield\(\); //)206.136 309 R(Let PFRA work)6 E
(goto try_again;)206.136 321 Q(})148.536 333 Q
(printk\("VM: Killing process %d0,current->pid\);)148.536 345 Q
(do_exit\(SIGKILL\);)148.536 357 Q(/*NOTREACHED*/)148.536 369 Q
(case VM_FAULT_SIGBUS:)102.936 381 Q(force_sig\(current,SIGBUS\);)
148.536 393 Q(break;)148.536 405 Q(case VM_FAULT_MAJOR:)102.936 417 Q
(current->maj_flt++;)148.536 429 Q(break;)148.536 441 Q
(case VM_FAULT_MINOR:)102.936 453 Q(current->min_flt++;)148.536 465 Q
(break;)148.536 477 Q(})90.936 489 Q(})33.336 501 Q
(handle_mm_fault\(struct mm_struct *mm,struct vm_area_struct *vma,)
33.336 525 Q(void *addr,int access_type\))263.736 537 Q({)33.336 549 Q
(pte_t **pgd,**pud,**pmd,**pt;)39.336 561 Q(pte_t *ptep,pte;)39.336 573
Q(pgd=mm->pgd;)90.936 585 Q(/* PGD is always allocated.)90.936 597 Q
(Make sure PUD/PMD/PT are allocated */)12 E
(/* corresponding to the faulted address.)90.936 609 Q
(The xxx_alloc functions */)12 E
(/* return a pointer to the next table, possibly allocating a new */)
90.936 621 Q
(/* page frame for the table and installing a pointer to it in the */)
90.936 633 Q(/* enclosing table.)90.936 645 Q
(Physical addresses are mapped by the kernel */)12 E
(/* to virtual addresses for this temporary purpose; this mechanism */)
90.936 657 Q
(/* is very arch-specific and beyond the scope of this class */)90.936
669 Q(if \(!\(pud=pud_alloc\(mm,pgd,addr\)\)\) return VM_FAULT_OOM;)
90.936 693 Q
(if \(!\(pmd=pmd_alloc\(mm,pud,addr\)\)\) return VM_FAULT_OOM;)90.936
705 Q(if \(!\(pt=pt_alloc\(mm,pmd,addr\)\)\) return VM_FAULT_OOM;)90.936
717 Q(/* Compute offset of PTE within Page Table */)90.936 729 Q
(/* On X86-32, PAGE_SHIFT is 12 bits and PAGE_MASK is 0x000003FF */)
90.936 741 Q 0 Cg EP
%%Page: 28 28
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 28)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF
(/* On X86-64, PAGE_MASK becomes 0x000001FF */)90.936 117 Q
(ptep= &pt[\(\(unsigned long\)addr >> PAGE_SHIFT\) & PAGE_MASK];)90.936
129 Q(pte= *ptep;)90.936 141 Q(if \(!pte_present\(pte\)\))90.936 165 Q
(// PRESENT bit is 0)98.4 E({)90.936 177 Q(if \(pte == 0\))148.536 189 Q
(// First time access or file-backed)94.8 E({)148.536 201 Q
(if \(vma->vm_file\))206.136 213 Q(// File-mapped)13.2 E
(return pagein_from_file\(mm,vma,addr,ptep,access_type\);)263.736 225 Q
142.8(else //)206.136 237 R(Anonymous)6 E
(return pagein_anon\(mm,vma,addr,ptep,access_type\);)263.736 249 Q(})
148.536 261 Q(/* PTE encodes swap loc for paged-out anon page */)148.536
273 Q(return pagein_from_swap\(mm,vma,addr,pte,ptep,access_type\);)
148.536 285 Q(})90.936 297 Q
(/* PTE is present, must be a COW protection fault */)90.936 309 Q
(if \(write_attempt\(access_type\)\))90.936 321 Q({)90.936 333 Q
(pfn_t pfn;)148.536 345 Q
(pfn=\(\(unsigned long\)pte >> PFN_SHIFT\) & PFN_MASK;)148.536 357 Q
(/* This next condition is common after fork-exec */)148.536 369 Q
(if \(mem_map[pfn]._mapcount==1\))148.536 381 Q({)148.536 393 Q
(/* Some code elided to check if MAP_PRIVATE page)206.136 405 Q 45.6(*t)
212.136 417 S(hat had been marked down for COW but had)-45.6 E 45.6(*o)
212.136 429 S(nly a single mapping, needs to adjust)-45.6 E 45.6(*t)
212.136 441 S(he radix-64 tree to invalidate)-45.6 E(*/)66 E
(*ptep|=PTE_WRITE;)206.136 465 Q(return VM_FAULT_MINOR;)206.136 477 Q(})
148.536 489 Q(void *new_pf;)148.536 501 Q
(/* Allocate a new page frame and provide a valid temporary */)148.536
513 Q(/* virtual address so we can access it */)148.536 525 Q
(if \(!\(new_pf=pageframe_alloc\(1\)\)\) return VM_FAULT_OOM;)148.536
537 Q(memcpy\(map_pf_to_va\(new_pf\),addr,PAGE_SIZE\);)148.536 549 Q
(*ptep|=PTE_WRITE;)148.536 561 Q(return VM_FAULT_MINOR;)148.536 573 Q(})
90.936 585 Q(})33.336 597 Q(/* This function is only called for first-t\
ime access to an anon virt page */)33.336 621 Q(pagein_anon\(struct mm_\
struct *mm,struct vm_area_struct *vma,void *addr,)33.336 633 Q
(pte_t *pte_p,int access_type\))148.536 645 Q({)33.336 657 Q
(void *new_pf;)45.336 669 Q(pfn_t pfn;)45.336 681 Q(// 32 bit or 64 bit)
100.8 E(unsigned pte_bits;)45.336 693 Q
(pte_bits=vma->vm_page_prot | PTE_PRESENT;)90.936 705 Q
(if \(read_attempt\(access_type\)\))90.936 717 Q({)90.936 729 Q
(/* For first-time read, we can grab a shared COW 0 page */)148.536 741
Q 0 Cg EP
%%Page: 29 29
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 29)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF(new_pf=global_shared_zeropage_paddr;)148.536
117 Q(if \(!new_pf\) return VM_FAULT_OOM;)148.536 129 Q
(pte_bits &= ~PTE_WRITE;)148.536 141 Q(// Not writable -- COW)34.8 E(})
90.936 153 Q(else)90.936 165 Q({)90.936 177 Q
(new_pf=pageframe_alloc\(1\);)148.536 189 Q
(/* map_pf_to_va provides a \(temporary\) virt addr */)148.536 201 Q
(bzero\(map_pf_to_va\(new_pf\),PAGE_SIZE\);)148.536 213 Q(})90.936 225 Q
(pfn=\(unsigned long\)new_pf>>PAGE_SHIFT;)90.936 237 Q 16.8
(mem_map[pfn]._mapcount++; //)90.936 249 R(Update core map)6 E
(/* Fill in the PTE.)90.936 261 Q
(PFN_SHIFT is the bit pos of the PFN in the PTE */)12 E
(*ptep= \(pfn<<PFN_SHIFT\) | pte_bits;)90.936 273 Q 7.2
(update_rss\(ANON\); //)90.936 285 R(Update rss, highwater, etc. stats.)
6 E(return VM_FAULT_MINOR;)90.936 297 Q(})33.336 309 Q(pagein_from_file\
\(struct mm_struct *mm,struct vm_area_struct *vma,void *addr,)33.336 333
Q(pte_t *pte_p,int access_type\))148.536 345 Q({)33.336 357 Q
(void *new_pf;)39.336 369 Q(struct page *new_pf;)39.336 381 Q
(pfn_t pfn;)39.336 393 Q(unsigned long pte_bits;)39.336 405 Q(int rc;)
39.336 417 Q(/* Determine offset within file, in units of pages */)
90.936 429 Q
(va_offset=\(unsigned long\)\(addr-vma->vm_start\) >> PAGE_SHIFT;)90.936
441 Q(file_offset=va_offset+vma->vm_pgoff;)90.936 453 Q
(/* See if that page is already resident in memory */)90.936 465 Q
(rc=VM_FAULT_MINOR;)90.936 477 Q(if \(!\(new_pf=file_address_space_sear\
ch\(vma->vm_file,file_offset\)\)\))90.936 489 Q({)90.936 501 Q
(/* No, need to allocate a fresh page frame */)148.536 513 Q
(if \(!\(new_pf=pageframe_alloc\(1\)\)\) return VM_FAULT_OOM;)148.536
525 Q(pfn=\(unsigned long\)new_pf >> PAGE_SHIFT;)148.536 537 Q
(new_pf= &mem_map[pfn];)148.536 549 Q
(/* Ask the filesystem module to initiate a disk read)148.536 561 Q 6
(*o)154.536 573 S
(peration, depositing the result in physical page new_pf.)-6 E 6(*T)
154.536 585 S(his puts the task into a non-interruptible SLEEPING state)
-6 E 6(*u)154.536 597 S(ntil the I/O operation completes \(or fails)-6 E
(*/)66 E(if \(!do_file_readpage\(vma->vm_file,file_offset,new_pf\)\))
148.536 609 Q({)148.536 621 Q(pageframe_free\(new_pf\);)206.136 633 Q
(return VM_FAULT_SIGBUS;)206.136 645 Q(})148.536 657 Q
(rc=VM_FAULT_MAJOR;)148.536 669 Q(})90.936 681 Q(pfn= new_pf-mem_map;)
90.936 693 Q(// PFN is implicit by index within array)52.8 E 46.8
(new_pf->_mapcount++; //)90.936 705 R(Here comes new PTE)6 E
(pte_bits=vma->vm_page_prot|PTE_PRESENT;)90.936 717 Q
(*ptep=pfn<<PFN_SHIFT|pte_bits;)90.936 729 Q(update_rss\(FILE\);)90.936
741 Q 0 Cg EP
%%Page: 30 30
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 30)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF(return rc;)90.936 117 Q(})33.336 129 Q(pagei\
n_from_swap\(struct mm_struct *mm,struct vm_area_struct *vma,void *addr\
,)33.336 165 Q(pte_t pte,pte_t *pte_p,int access_type\))148.536 177 Q({)
33.336 189 Q(void *new_pf;)39.336 201 Q(pfn_t pfn;)39.336 213 Q
(int pte_bits;)39.336 225 Q(unsigned long swap_area,swap_slot;)39.336
237 Q(swap_area=\(pte&SWAP_AREA_MASK\)>>SWAP_AREA_SHIFT;)90.936 249 Q
(swap_slot=\(pte&SWAP_SLOT_MASK\)>>SWAP_SLOT_SHIFT;)90.936 261 Q
(if \(!\(new_pf=pageframe_alloc\(1\)\)\) return VM_FAULT_OOM;)90.936 273
Q(/* This operation results in a non-interruptible SLEEP */)90.936 285 Q
(if \(!read_from_swap\(swap_area,swap_slot,new_pf\)\))90.936 297 Q({)
90.936 309 Q(pageframe_free\(new_pf\);)148.536 321 Q
(return VM_FAULT_SIGBUS;)148.536 333 Q(})90.936 345 Q
(/* Some more complexity elided to deal with a SHARED, ANON)90.936 357 Q
6(*p)96.936 369 S
(age that had more than one mapping and had been swapped out */)-6 E
(mark_swap_slot_free\(swap_area,swap_slot\);)90.936 381 Q
(pfn=\(unsigned long\)new_pf >> PFN_SHIFT;)90.936 393 Q
(pte_bits=vma->vm_page_prot|PTE_PRESENT;)90.936 405 Q
(*ptep=pfn<<PFN_SHIFT|pte_bits;)90.936 417 Q(mem_map[pfn]._mapcount++;)
90.936 429 Q(update_rss\(ANON\);)90.936 441 Q(return VM_FAULT_MAJOR;)
90.936 453 Q(})33.336 465 Q/F2 13/Times-Roman@0 SF 5.016
(Prior to the code seen abo)33.336 480 R -.195(ve)-.195 G 8.266(,t).195
G 5.016(he k)-8.266 F 5.016(ernel e)-.13 F 5.016(xamines the f)-.195 F
5.016(aulting address and the)-.13 F 1.849(user/supervisor mode bit.)
33.336 495 R 1.849(If the f)8.349 F 1.849
(aulting address is inside the k)-.13 F(ernel')-.13 E 5.1(sr)-.715 G
(eserv)-5.1 E 1.85(ed virtual)-.195 F 1.36(address range AND we were in\
 user mode, then a SIGSEGV is sent to the process, no)33.336 510 R 2.138
(questions ask)33.336 525 R 5.388(ed. If)-.13 F 2.138
(we were in supervisor mode, then the page f)5.388 F 2.138
(ault happened inside)-.13 F -.13(ke)33.336 540 S .746(rnel code.).13 F
.746(The k)7.246 F .746(ernel tries to a)-.13 F -.26(vo)-.26 G .745
(id an).26 F 3.995(ys)-.195 G .745
(ituations where this happens, as the code for)-3.995 F 1.447
(handling this is messy)33.336 555 R 7.947(.W)-.845 G 4.697(ew)-8.987 G
(on')-4.827 E 4.697(tb)-.234 G 4.697(ec)-4.697 G 1.447(onsidering k)
-4.697 F 1.447(ernel-mode page f)-.13 F 1.447(aults in the Linux)-.13 F
-.13(ke)33.336 570 S(rnel an).13 E 3.25(yf)-.195 G(urther)-3.25 E(.)
-.715 E(No)33.336 591 Q 4.141(wt)-.325 G .891(hat we ha)-4.141 F 1.281
-.195(ve d)-.26 H .891(etermined that it w).195 F .891(as a user)-.13 F
.89(-mode program that got us into the page)-.26 F -.13(fa)33.336 606 S
.241(ult handler).13 F 3.491(,a)-.52 G .241(nd that the access w)-3.491
F .241(as not to the k)-.13 F .241(ernel reserv)-.13 F .242
(ed address space, we ha)-.195 F .632 -.195(ve t)-.26 H(o).195 E .448
(see if this w)33.336 621 R .447(as a le)-.13 F .447
(gitimate virtual memory access.)-.195 F .447(This is done by e)6.947 F
.447(xamining the virtual)-.195 F 2.941
(address space description contained in the list of)33.336 636 R/F3 13
/Courier@0 SF(vm_area_struct)6.191 E F2 6.191(st)C 6.192(os)-6.191 G
2.942(ee if the)-6.192 F -.13(fa)33.336 651 S .034
(ulting address is inside of an e).13 F .033(xisting v)-.195 F .033
(alid virtual memory re)-.325 F 3.283(gion. If)-.195 F .033
(it is, we then need)3.283 F .608(to determine if there has been a prot\
ection violation \(access attempt mode doesn')33.336 666 R 3.858(tm)
-.234 G(atch)-3.858 E(PTE mode\).)33.336 681 Q(There are tw)6.5 E 3.25
(oe)-.13 G(xceptions to this: stacks and cop)-3.445 E(y-on-write.)-.13 E
/F4 13/Times-Bold@0 SF(Stacks)249.279 711 Q 0 Cg EP
%%Page: 31 31
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 31)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.364(When the stack gro)33.336 120 R
1.364
(ws e.g. through a push instruction, the stack pointer is decremented)
-.325 F .157(\214rst and then the write tak)33.336 135 R .157(es place.)
-.13 F .158(If the stack pointer is no)6.657 F 3.408(wl)-.325 G -.325
(ow)-3.408 G .158(er than the current start).325 F .768(of the stack re)
33.336 150 R .768(gion, a f)-.195 F .768(ault will be incurred.)-.13 F
.768(If the f)7.268 F .767(aulted address is "close" to the stack)-.13 F
.959(pointer \(an allo)33.336 165 R -.13(wa)-.325 G .959
(nce is made for certain X86 instructions which access memory on the).13
F .774
(stack \214rst, then adjust the stack pointer\) and if the memory re)
33.336 180 R .774(gion just abo)-.195 F 1.164 -.195(ve t)-.195 H .773
(he f).195 F(aulted)-.13 E .657(address has the GR)33.336 195 R -.455
(OW)-.52 G(SDO).455 E .657(WN property)-.455 F 3.907(,t)-.845 G .657
(hen the stack re)-3.907 F .657(gion is e)-.195 F .657
(xpanded by one page)-.195 F(to)33.336 210 Q -.13(wa)-.325 G 2.148
(rd lo).13 F 5.398(wm)-.325 G 2.148(emory addresses \("do)-5.398 F 2.148
(wn"\) as if by the)-.325 F/F2 13/Courier@0 SF(mremap)5.398 E F1 2.148
(system call.)5.398 F 2.148(There are)8.648 F .278
(checks performed to mak)33.336 225 R 3.528(es)-.13 G .278
(ure this doesn')-3.528 F 3.529(te)-.234 G .279
(xceed the stack size ulimit resource limit, or)-3.724 F 1.739
(cause the stack to collide with another re)33.336 240 R 4.989
(gion. This)-.195 F 1.739(automagical stack gro)4.989 F 1.739
(wth is quite)-.325 F(essential to transparent program e)33.336 255 Q
-.195(xe)-.195 G(cution.).195 E .47(This adjustment of the)33.336 276 R
F2(vm_start)3.721 E F1 .471(address does not by itself resolv)3.721 F
3.721(et)-.195 G .471(he page f)-3.721 F 3.721(ault. The)-.13 F
(logic \215o)33.336 291 Q 3.25(wn)-.325 G .65 -.325(ow c)-3.25 H
(ontinues, the same as a page f).325 E(ault in an)-.13 E 3.25(yo)-.195 G
(ther v)-3.25 E(alid memory re)-.325 E(gion.)-.195 E/F3 13/Times-Bold@0
SF(Copy-On-Write \(CO)201.406 321 Q(W\))-.65 E F1 2.021(There are se)
33.336 357 R -.195(ve)-.325 G 2.02(ral cases where the k).195 F 2.02
(ernel must logically mak)-.13 F 5.27(eac)-.13 G(op)-5.27 E 5.27(yo)-.13
G 5.27(fap)-5.27 G 5.27(age. One)-5.27 F .206(common e)33.336 372 R .207
(xample is during)-.195 F F2(fork\(\))3.457 E F1 6.707(.A)C .207
(nother is when a \214le is mapped MAP_PRIV)-6.707 F -1.443(AT)-1.755 G
(E.)1.443 E 1.519(Actually allocating)33.336 387 R(ne)8.019 E 4.769(wp)
-.325 G 1.519(age frames and cop)-4.769 F 1.519(ying, byte-for)-.13 F
1.518(-byte, the entire contents of)-.26 F 2.017
(each page frame of the re)33.336 402 R 2.017(gion being copied, w)-.195
F 2.017(ould be a terrible performance penalty)-.13 F(.)-.845 E .858
(Instead, the k)33.336 417 R .857(ernel continues to point both virtual\
 mappings to the same page frame, b)-.13 F(ut)-.26 E(marks do)33.336 432
Q(wn the PTE entries in question to disallo)-.325 E 3.25(ww)-.325 G
(rite access.)-3.25 E .089(As long as none of the processes sharing the\
 mapping attempt to write, there is no need to)33.336 453 R 1.223(do an)
33.336 468 R 1.223(ything further)-.195 F 7.723(.T)-.715 G(he)-7.723 E
4.473(yw)-.195 G 1.223
(ill each see the correct data which are unchanged from the)-4.473 F
.566(point of forking, in the \214rst e)33.336 483 R .567
(xample case, or from the original contents of the \214le, in the)-.195
F 1.111(second case.)33.336 498 R 1.11(As soon as an)7.611 F 4.36(yp)
-.195 G 1.11(rocess tries to write, it will incur a page/protection f)
-4.36 F(ault.)-.13 E .03(The k)33.336 513 R .03
(ernel recognizes this CO)-.13 F 3.28(Ws)-.455 G .03
(ituation because the f)-3.28 F .03(aulting address is v)-.13 F .03
(alid, the virtual)-.325 F .542
(memory area \215ags say we should be allo)33.336 528 R .542
(wed to write to this area, AND there w)-.325 F .542(as a PTE)-.13 F
(PRESENT for that address.)33.336 543 Q 2.907 -1.04(To r)33.336 564 T
(esolv)1.04 E 4.077(et)-.195 G .827(he CO)-4.077 F 4.077(Wf)-.455 G .827
(ault, the k)-4.207 F .827(ernel grabs a ne)-.13 F 4.077(wf)-.325 G .827
(ree page frame, copies to contents of)-4.077 F 2.497(the e)33.336 579 R
2.497(xisting \(shared\) page frame to the ne)-.195 F 5.747(wf)-.325 G
2.497(rame, and then updates the PTE of the)-5.747 F -.13(fa)33.336 594
S 1.543(ulting process to point to the ne).13 F 4.794(wf)-.325 G 1.544
(rame, turning on the PTE Write Enable bit at the)-4.794 F(same time.)
33.336 609 Q(The other process\(es\) sharing that mapping continue to s\
ee it read-only)6.5 E(.)-.845 E 1.175
(One important optimization on the abo)33.336 630 R 1.565 -.195(ve h)
-.195 H 1.175(appens when a process forks and then either).195 F .847
(the parent or the child \(b)33.336 645 R .847
(ut usually the child in the common UNIX programming idiom\))-.26 F
-.195(exe)33.336 660 S 4.331(cs. Then).195 F 1.081(the shared memory re)
4.331 F 1.081(gion is unmapped from one of the processes.)-.195 F 1.08
(As we)7.58 F(ha)33.336 675 Q 1.758 -.195(ve s)-.26 H 1.368(een, the k)
.195 F 1.368(ernel maintains a core map data structure gi)-.13 F 1.369
(ving the state of each page)-.325 F 1.923(frame, and can track ho)
33.336 690 R 5.172(wm)-.325 G(an)-5.172 E 5.172(yr)-.195 G 1.922
(eferences there are to an)-5.172 F 5.172(yg)-.195 G -2.795 -.325(iv e)
-5.172 H 5.172(np).325 G 1.922(age frame.)-5.172 F 1.922(So the)8.422 F
1.432(unmapping results in the reference count going back do)33.336 705
R 1.432(wn to 1.)-.325 F 1.432(When the k)7.932 F 1.432(ernel sees)-.13
F 2.048(this condition, it does not ha)33.336 720 R 2.438 -.195(ve t)
-.26 H 5.298(oa).195 G 2.048(llocate a ne)-5.298 F 5.298(wp)-.325 G
2.048(age frame and memcp)-5.298 F 6.988 -.845(y. I)-.13 H 5.297(tm).845
G(erely)-5.297 E(changes the PTE to turn the write enable bit back on)
33.336 735 Q 0 Cg EP
%%Page: 32 32
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 32)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF -.195(Fo)33.336 120 S 3.614(rM).195 G
(AP_PRIV)-3.614 E -1.443(AT)-1.755 G 3.614(Er)1.443 G -.195(eg)-3.614 G
.364(ions we ha).195 F .754 -.195(ve a h)-.26 H 3.614(ybrid. Consider)
.13 F 3.614(,f)-.52 G .364(or e)-3.614 F .364(xample, the data re)-.195
F .364(gion of)-.195 F 4.581(ar)33.336 135 S 1.331
(unning program, which is mapped MAP_PRIV)-4.581 F -1.443(AT)-1.755 G
1.331(E, PR)1.443 F -.52(OT)-.52 G(_READ|PR).52 E -.52(OT)-.52 G 1.33
(_WRITE to).52 F .067(an of)33.336 150 R .067(fset within the e)-.325 F
-.195(xe)-.195 G .067(cutable \214le).195 F .068
(where the data initializers are to be found.)6.567 F .068(The re)6.568
F(gion)-.195 E .99(is write-enabled b)33.336 165 R .99
(ut the PTEs are mark)-.26 F .99(ed do)-.13 F .99(wn to force Cop)-.325
F 4.24(y-On-Write. If)-.13 F .99(the process)4.24 F 2.82
(only reads a particular page in the data re)33.336 180 R 2.82
(gion, then that page is Demand-P)-.195 F 2.821(aged in.)-.195 F 1.67
(Multiple processes running the same e)33.336 195 R -.195(xe)-.195 G
1.669(cutable can share the mapping to the ph).195 F(ysical)-.065 E .927
(page frame containing the data.)33.336 210 R(Ho)7.427 E(we)-.325 E
-.195(ve)-.325 G 1.967 -.52(r, a).195 H 4.177(ss).52 G .927
(oon as the process tries to write to a data)-4.177 F(re)33.336 225 Q
(gion page, Cop)-.195 E(y-On-Write kicks in.)-.13 E 3.25(Ap)6.5 G(ri)
-3.25 E -.325(va)-.325 G(te cop).325 E 3.25(yi)-.13 G 3.25(sm)-3.25 G
(ade for the writing process.)-3.25 E 1.688(While the original page fra\
me still corresponds to the contents of the \214le, and thus its)33.336
246 R(re)33.336 261 Q -.195(ve)-.325 G .799
(rse mapping remains \214le-back).195 F .799(ed, the pri)-.13 F -.325
(va)-.325 G .799(te cop).325 F 4.05(yh)-.13 G .8(as brok)-4.05 F .8
(en the mapping, and thus)-.13 F 1.981(is no)33.336 276 R 5.231(wc)-.325
G 1.981(onsidered anon)-5.231 F 5.231(ymous. If)-.195 F 1.981(this pri)
5.231 F -.325(va)-.325 G 1.981(te cop).325 F 5.231(yw)-.13 G 1.98
(ere later to be paged-out, it will)-5.231 F .187
(therefore wind up in sw)33.336 291 R .187(ap space.)-.13 F .187
(The data re)6.687 F .187(gion of the process, and indeed an)-.195 F
3.438(yw)-.195 G(ritable)-3.438 E(MAP_PRIV)33.336 306 Q -1.443(AT)-1.755
G 5.985(Er)1.443 G -.195(eg)-5.985 G 2.734
(ion, can therefore contain both \214le-mapped and anon).195 F 2.734
(ymous page)-.195 F .161(frames at the same time.)33.336 321 R -1.04(We)
6.661 G -.13('l)1.04 G 3.412(ls).13 G .162(ee ho)-3.412 F 3.412(wt)-.325
G(he)-3.412 E/F2 13/Courier@0 SF(mapping)3.412 E F1 .162
(\214eld of the page descriptor is used)3.412 F
(to distinguish, on a page frame by page frame basis, this status.)
33.336 336 Q .793(In the illustration belo)33.336 357 R 2.483 -.845
(w, b)-.325 H .793
(efore the fork, the parent process has demand-paged one page).845 F
1.276(of te)33.336 372 R 1.276
(xt, one page of bss, one page of stack, and tw)-.195 F 4.526(op)-.13 G
1.276(ages of data.)-4.526 F 1.276(It wrote to the \214rst)7.776 F 1.819
(data page b)33.336 387 R 1.819
(ut the second page has only be read, so its PTE is still r)-.26 F 5.068
(--. After)-.26 F 1.818(the fork)5.068 F .979
(\(second panel\), all PTE W bits are of)33.336 402 R 4.229(f. In)-.325
F .979(the third panel, the child attempts to write to)4.229 F
(the bss page.)33.336 417 Q(This causes cop)6.5 E 3.25(y-on-write. Note)
-.13 F(that the parent')3.25 E 3.25(sP)-.715 G(TE is not af)-3.25 E
(fected.)-.325 E 0 0 468 911 -265.08 516 33.336 718.08 PBEGIN
%%BeginDocument: cow.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: cow.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Fri Nov 11 01:06:08 2016
%%For: hak@lex ()
%%BoundingBox: 0 0 911 516
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 516 moveto 0 0 lineto 911 0 lineto 911 516 lineto closepath clip newpath
-54.0 541.3 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 2250 5400 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 2250 5925 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 2250 6450 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Polyline
 [60] 0 sd
n 1800 1500 m
 2700 1500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 2100 m
 2700 2100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 2700 m
 2700 2700 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 3000 m
 2700 3000 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 3300 m
 2700 3300 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 3600 m
 2700 3600 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 3900 m
 2700 3900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 4200 m
 2700 4200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 4500 m
 2700 4500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 4800 m
 2700 4800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 5100 m
 2700 5100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 6900 m
 2700 6900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 7200 m
 2700 7200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 7500 m
 2700 7500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 7800 m
 2700 7800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 8100 m
 2700 8100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 8400 m
 2700 8400 l gs col0 s gr  [] 0 sd
% Polyline
n 1800 1800 m 2700 1800 l 2700 2400 l 1800 2400 l
 cp gs col0 s gr 
% Polyline
n 1800 2700 m 2700 2700 l 2700 3300 l 1800 3300 l
 cp gs col0 s gr 
% Polyline
n 1800 8100 m 2700 8100 l 2700 8700 l 1800 8700 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 1800 1800 m
 2700 1800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 1800 2400 m
 2700 2400 l gs col0 s gr  [] 0 sd
% Polyline
n 1800 1200 m 2700 1200 l 2700 8700 l 1800 8700 l
 cp gs col0 s gr 
% Polyline
n 1575 1800 m 1500 1800 l 1500 2400 l
 1575 2400 l gs col0 s gr 
% Polyline
n 1575 2700 m 1500 2700 l 1500 3300 l
 1575 3300 l gs col0 s gr 
% Polyline
n 1575 3900 m 1500 3900 l 1500 4800 l
 1575 4800 l gs col0 s gr 
% Polyline
n 1800 3900 m 2700 3900 l 2700 4800 l 1800 4800 l
 cp gs col0 s gr 
% Polyline
n 1575 8100 m 1500 8100 l 1500 8700 l
 1575 8700 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
975 1950 m
gs 1 -1 sc (text) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
975 2850 m
gs 1 -1 sc (data) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
900 4050 m
gs 1 -1 sc (bss) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
900 8175 m
gs 1 -1 sc (stack) col0 sh gr
% Ellipse
n 6150 5400 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6150 5925 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 6150 6450 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Polyline
 [60] 0 sd
n 5700 1500 m
 6600 1500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 2100 m
 6600 2100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 2700 m
 6600 2700 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 3000 m
 6600 3000 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 3300 m
 6600 3300 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 3600 m
 6600 3600 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 3900 m
 6600 3900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 4200 m
 6600 4200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 4500 m
 6600 4500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 4800 m
 6600 4800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 5100 m
 6600 5100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 6900 m
 6600 6900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 7200 m
 6600 7200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 7500 m
 6600 7500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 7800 m
 6600 7800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 8100 m
 6600 8100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 8400 m
 6600 8400 l gs col0 s gr  [] 0 sd
% Polyline
n 5700 1800 m 6600 1800 l 6600 2400 l 5700 2400 l
 cp gs col0 s gr 
% Polyline
n 5700 2700 m 6600 2700 l 6600 3300 l 5700 3300 l
 cp gs col0 s gr 
% Polyline
n 5700 8100 m 6600 8100 l 6600 8700 l 5700 8700 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 5700 1800 m
 6600 1800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5700 2400 m
 6600 2400 l gs col0 s gr  [] 0 sd
% Polyline
n 5700 1200 m 6600 1200 l 6600 8700 l 5700 8700 l
 cp gs col0 s gr 
% Polyline
n 5475 1800 m 5400 1800 l 5400 2400 l
 5475 2400 l gs col0 s gr 
% Polyline
n 5475 2700 m 5400 2700 l 5400 3300 l
 5475 3300 l gs col0 s gr 
% Polyline
n 5475 3900 m 5400 3900 l 5400 4800 l
 5475 4800 l gs col0 s gr 
% Polyline
n 5700 3900 m 6600 3900 l 6600 4800 l 5700 4800 l
 cp gs col0 s gr 
% Polyline
n 5475 8100 m 5400 8100 l 5400 8700 l
 5475 8700 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
4875 1950 m
gs 1 -1 sc (text) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4875 2850 m
gs 1 -1 sc (data) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4800 4050 m
gs 1 -1 sc (bss) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4800 8175 m
gs 1 -1 sc (stack) col0 sh gr
% Ellipse
n 14700 5400 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 14700 5925 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 14700 6450 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Polyline
 [60] 0 sd
n 14250 1500 m
 15150 1500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 2100 m
 15150 2100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 2700 m
 15150 2700 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 3000 m
 15150 3000 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 3300 m
 15150 3300 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 3600 m
 15150 3600 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 3900 m
 15150 3900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 4200 m
 15150 4200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 4500 m
 15150 4500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 4800 m
 15150 4800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 5100 m
 15150 5100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 6900 m
 15150 6900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 7200 m
 15150 7200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 7500 m
 15150 7500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 7800 m
 15150 7800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 8100 m
 15150 8100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 8400 m
 15150 8400 l gs col0 s gr  [] 0 sd
% Polyline
n 14250 1800 m 15150 1800 l 15150 2400 l 14250 2400 l
 cp gs col0 s gr 
% Polyline
n 14250 2700 m 15150 2700 l 15150 3300 l 14250 3300 l
 cp gs col0 s gr 
% Polyline
n 14250 8100 m 15150 8100 l 15150 8700 l 14250 8700 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 14250 1800 m
 15150 1800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 14250 2400 m
 15150 2400 l gs col0 s gr  [] 0 sd
% Polyline
n 14250 1200 m 15150 1200 l 15150 8700 l 14250 8700 l
 cp gs col0 s gr 
% Polyline
n 14250 3900 m 15150 3900 l 15150 4800 l 14250 4800 l
 cp gs col0 s gr 
% Polyline
n 15300 8100 m 15375 8100 l 15375 8700 l
 15300 8700 l gs col0 s gr 
% Polyline
n 15375 3900 m 15450 3900 l 15450 4800 l
 15375 4800 l gs col0 s gr 
% Polyline
n 15300 2700 m 15375 2700 l 15375 3300 l
 15300 3300 l gs col0 s gr 
% Polyline
n 15300 1800 m 15375 1800 l 15375 2400 l
 15300 2400 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
15600 8175 m
gs 1 -1 sc (stack) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
15600 4050 m
gs 1 -1 sc (bss) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
15525 2850 m
gs 1 -1 sc (data) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
15525 1950 m
gs 1 -1 sc (text) col0 sh gr
% Ellipse
n 12075 5400 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 12075 5925 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 12075 6450 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Polyline
 [60] 0 sd
n 11625 1500 m
 12525 1500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 2100 m
 12525 2100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 2700 m
 12525 2700 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 3000 m
 12525 3000 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 3300 m
 12525 3300 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 3600 m
 12525 3600 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 3900 m
 12525 3900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 4200 m
 12525 4200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 4500 m
 12525 4500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 4800 m
 12525 4800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 5100 m
 12525 5100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 6900 m
 12525 6900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 7200 m
 12525 7200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 7500 m
 12525 7500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 7800 m
 12525 7800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 8100 m
 12525 8100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 8400 m
 12525 8400 l gs col0 s gr  [] 0 sd
% Polyline
n 11625 1800 m 12525 1800 l 12525 2400 l 11625 2400 l
 cp gs col0 s gr 
% Polyline
n 11625 2700 m 12525 2700 l 12525 3300 l 11625 3300 l
 cp gs col0 s gr 
% Polyline
n 11625 8100 m 12525 8100 l 12525 8700 l 11625 8700 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 11625 1800 m
 12525 1800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 11625 2400 m
 12525 2400 l gs col0 s gr  [] 0 sd
% Polyline
n 11625 1200 m 12525 1200 l 12525 8700 l 11625 8700 l
 cp gs col0 s gr 
% Polyline
n 11400 1800 m 11325 1800 l 11325 2400 l
 11400 2400 l gs col0 s gr 
% Polyline
n 11400 2700 m 11325 2700 l 11325 3300 l
 11400 3300 l gs col0 s gr 
% Polyline
n 11400 3900 m 11325 3900 l 11325 4800 l
 11400 4800 l gs col0 s gr 
% Polyline
n 11625 3900 m 12525 3900 l 12525 4800 l 11625 4800 l
 cp gs col0 s gr 
% Polyline
n 11400 8100 m 11325 8100 l 11325 8700 l
 11400 8700 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
10800 1950 m
gs 1 -1 sc (text) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10800 2850 m
gs 1 -1 sc (data) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10725 4050 m
gs 1 -1 sc (bss) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10725 8175 m
gs 1 -1 sc (stack) col0 sh gr
% Ellipse
n 8625 5400 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 8625 5925 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Ellipse
n 8625 6450 75 75 0 360 DrawEllipse gs 0.00 setgray ef gr gs col0 s gr

% Polyline
 [60] 0 sd
n 8175 1500 m
 9075 1500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 2100 m
 9075 2100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 2700 m
 9075 2700 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 3000 m
 9075 3000 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 3300 m
 9075 3300 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 3600 m
 9075 3600 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 3900 m
 9075 3900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 4200 m
 9075 4200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 4500 m
 9075 4500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 4800 m
 9075 4800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 5100 m
 9075 5100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 6900 m
 9075 6900 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 7200 m
 9075 7200 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 7500 m
 9075 7500 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 7800 m
 9075 7800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 8100 m
 9075 8100 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 8400 m
 9075 8400 l gs col0 s gr  [] 0 sd
% Polyline
n 8175 1800 m 9075 1800 l 9075 2400 l 8175 2400 l
 cp gs col0 s gr 
% Polyline
n 8175 2700 m 9075 2700 l 9075 3300 l 8175 3300 l
 cp gs col0 s gr 
% Polyline
n 8175 8100 m 9075 8100 l 9075 8700 l 8175 8700 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 8175 1800 m
 9075 1800 l gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 8175 2400 m
 9075 2400 l gs col0 s gr  [] 0 sd
% Polyline
n 8175 1200 m 9075 1200 l 9075 8700 l 8175 8700 l
 cp gs col0 s gr 
% Polyline
n 8175 3900 m 9075 3900 l 9075 4800 l 8175 4800 l
 cp gs col0 s gr 
% Polyline
n 9225 8100 m 9300 8100 l 9300 8700 l
 9225 8700 l gs col0 s gr 
% Polyline
n 9300 3900 m 9375 3900 l 9375 4800 l
 9300 4800 l gs col0 s gr 
% Polyline
n 9225 2700 m 9300 2700 l 9300 3300 l
 9225 3300 l gs col0 s gr 
% Polyline
n 9225 1800 m 9300 1800 l 9300 2400 l
 9225 2400 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
9525 8175 m
gs 1 -1 sc (stack) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9525 4050 m
gs 1 -1 sc (bss) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9450 2850 m
gs 1 -1 sc (data) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9450 1950 m
gs 1 -1 sc (text) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7050 930 m
gs 1 -1 sc (Frames) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7125 675 m
gs 1 -1 sc (Page) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5700 675 m
gs 1 -1 sc (parent) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5700 930 m
gs 1 -1 sc (VA space) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8325 930 m
gs 1 -1 sc (VA space) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8325 675 m
gs 1 -1 sc (child) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
12975 930 m
gs 1 -1 sc (Frames) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
13050 675 m
gs 1 -1 sc (Page) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11625 675 m
gs 1 -1 sc (parent) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11625 930 m
gs 1 -1 sc (VA space) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
14250 930 m
gs 1 -1 sc (VA space) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
14250 675 m
gs 1 -1 sc (child) col0 sh gr
% Arc
gs  clippath
13243 4639 m 13285 4681 l 13392 4573 l 13287 4638 l 13350 4531 l cp
eoclip
n 13068.8 4350.0 364.1 -55.5 55.5 arc
gs col0 s gr
 gr

% arrowhead
n 13350 4531 m 13287 4638 l 13392 4573 l  col0 s
% Arc
gs  clippath
13468 4639 m 13510 4681 l 13617 4573 l 13512 4638 l 13575 4531 l cp
eoclip
n 13293.8 4350.0 364.1 -55.5 55.5 arc
gs col0 s gr
 gr

% arrowhead
n 13575 4531 m 13512 4638 l 13617 4573 l  col0 s
% Polyline
n 3300 1800 m 4200 1800 l 4200 2100 l 3300 2100 l
 cp gs col0 s gr 
% Polyline
n 3300 2700 m 4200 2700 l 4200 3000 l 3300 3000 l
 cp gs col0 s gr 
% Polyline
n 3300 3225 m 4200 3225 l 4200 3525 l 3300 3525 l
 cp gs col0 s gr 
% Polyline
n 3300 3900 m 4200 3900 l 4200 4200 l 3300 4200 l
 cp gs col0 s gr 
% Polyline
n 3300 8100 m 4200 8100 l 4200 8400 l 3300 8400 l
 cp gs col0 s gr 
% Polyline
gs  clippath
3315 1980 m 3315 1920 l 3163 1920 l 3283 1950 l 3163 1980 l cp
eoclip
n 2700 1950 m
 3300 1950 l gs col0 s gr gr

% arrowhead
n 3163 1980 m 3283 1950 l 3163 1920 l  col0 s
% Polyline
gs  clippath
3315 2880 m 3315 2820 l 3163 2820 l 3283 2850 l 3163 2880 l cp
eoclip
n 2700 2850 m
 3300 2850 l gs col0 s gr gr

% arrowhead
n 3163 2880 m 3283 2850 l 3163 2820 l  col0 s
% Polyline
gs  clippath
3315 4080 m 3315 4020 l 3163 4020 l 3283 4050 l 3163 4080 l cp
eoclip
n 2700 4050 m
 3300 4050 l gs col0 s gr gr

% arrowhead
n 3163 4080 m 3283 4050 l 3163 4020 l  col0 s
% Polyline
gs  clippath
3315 8280 m 3315 8220 l 3163 8220 l 3283 8250 l 3163 8280 l cp
eoclip
n 2700 8250 m
 3300 8250 l gs col0 s gr gr

% arrowhead
n 3163 8280 m 3283 8250 l 3163 8220 l  col0 s
% Polyline
15.000 slw
 [90] 0 sd
n 4500 450 m
 4500 9000 l gs col0 s gr  [] 0 sd
% Polyline
 [90] 0 sd
n 10275 450 m
 10275 9000 l gs col0 s gr  [] 0 sd
% Polyline
7.500 slw
n 6975 1800 m 7875 1800 l 7875 2100 l 6975 2100 l
 cp gs col0 s gr 
% Polyline
n 6975 2700 m 7875 2700 l 7875 3000 l 6975 3000 l
 cp gs col0 s gr 
% Polyline
n 6975 3300 m 7875 3300 l 7875 3600 l 6975 3600 l
 cp gs col0 s gr 
% Polyline
n 6975 3900 m 7875 3900 l 7875 4200 l 6975 4200 l
 cp gs col0 s gr 
% Polyline
n 6975 8100 m 7875 8100 l 7875 8400 l 6975 8400 l
 cp gs col0 s gr 
% Polyline
gs  clippath
6990 1980 m 6990 1920 l 6838 1920 l 6958 1950 l 6838 1980 l cp
eoclip
n 6600 1950 m
 6975 1950 l gs col0 s gr gr

% arrowhead
n 6838 1980 m 6958 1950 l 6838 1920 l  col0 s
% Polyline
gs  clippath
6990 2880 m 6990 2820 l 6838 2820 l 6958 2850 l 6838 2880 l cp
eoclip
n 6600 2850 m
 6975 2850 l gs col0 s gr gr

% arrowhead
n 6838 2880 m 6958 2850 l 6838 2820 l  col0 s
% Polyline
gs  clippath
3304 3483 m 3323 3426 l 3179 3378 l 3284 3445 l 3160 3435 l cp
eoclip
n 2625 3225 m
 3300 3450 l gs col0 s gr gr

% arrowhead
n 3160 3435 m 3284 3445 l 3179 3378 l  col0 s
% Polyline
gs  clippath
6977 3408 m 7000 3352 l 6859 3296 l 6960 3369 l 6837 3352 l cp
eoclip
n 6600 3225 m
 6975 3375 l gs col0 s gr gr

% arrowhead
n 6837 3352 m 6960 3369 l 6859 3296 l  col0 s
% Polyline
gs  clippath
6990 4080 m 6990 4020 l 6838 4020 l 6958 4050 l 6838 4080 l cp
eoclip
n 6600 4050 m
 6975 4050 l gs col0 s gr gr

% arrowhead
n 6838 4080 m 6958 4050 l 6838 4020 l  col0 s
% Polyline
gs  clippath
6990 8280 m 6990 8220 l 6838 8220 l 6958 8250 l 6838 8280 l cp
eoclip
n 6600 8250 m
 6975 8250 l gs col0 s gr gr

% arrowhead
n 6838 8280 m 6958 8250 l 6838 8220 l  col0 s
% Polyline
gs  clippath
7860 2820 m 7860 2880 l 8012 2880 l 7892 2850 l 8012 2820 l cp
eoclip
n 8175 2850 m
 7875 2850 l gs col0 s gr gr

% arrowhead
n 8012 2820 m 7892 2850 l 8012 2880 l  col0 s
% Polyline
gs  clippath
7845 3359 m 7880 3408 l 8002 3317 l 7888 3365 l 7966 3269 l cp
eoclip
n 8175 3150 m
 7875 3375 l gs col0 s gr gr

% arrowhead
n 7966 3269 m 7888 3365 l 8002 3317 l  col0 s
% Polyline
gs  clippath
7860 4020 m 7860 4080 l 8012 4080 l 7892 4050 l 8012 4020 l cp
eoclip
n 8175 4050 m
 7875 4050 l gs col0 s gr gr

% arrowhead
n 8012 4020 m 7892 4050 l 8012 4080 l  col0 s
% Polyline
gs  clippath
7860 8145 m 7860 8205 l 8012 8205 l 7892 8175 l 8012 8145 l cp
eoclip
n 8175 8175 m
 7875 8175 l gs col0 s gr gr

% arrowhead
n 8012 8145 m 7892 8175 l 8012 8205 l  col0 s
% Polyline
gs  clippath
7860 1920 m 7860 1980 l 8012 1980 l 7892 1950 l 8012 1920 l cp
eoclip
n 8175 1950 m
 7875 1950 l gs col0 s gr gr

% arrowhead
n 8012 1920 m 7892 1950 l 8012 1980 l  col0 s
% Polyline
n 13050 1800 m 13950 1800 l 13950 2100 l 13050 2100 l
 cp gs col0 s gr 
% Polyline
n 13050 2700 m 13950 2700 l 13950 3000 l 13050 3000 l
 cp gs col0 s gr 
% Polyline
n 13050 3300 m 13950 3300 l 13950 3600 l 13050 3600 l
 cp gs col0 s gr 
% Polyline
n 13050 3900 m 13950 3900 l 13950 4200 l 13050 4200 l
 cp gs col0 s gr 
% Polyline
n 13050 4425 m 13950 4425 l 13950 4725 l 13050 4725 l
 cp gs col0 s gr 
% Polyline
n 13050 8100 m 13950 8100 l 13950 8400 l 13050 8400 l
 cp gs col0 s gr 
% Polyline
gs  clippath
13065 8280 m 13065 8220 l 12913 8220 l 13033 8250 l 12913 8280 l cp
eoclip
n 12525 8250 m
 13050 8250 l gs col0 s gr gr

% arrowhead
n 12913 8280 m 13033 8250 l 12913 8220 l  col0 s
% Polyline
gs  clippath
13065 4080 m 13065 4020 l 12913 4020 l 13033 4050 l 12913 4080 l cp
eoclip
n 12525 4050 m
 13050 4050 l gs col0 s gr gr

% arrowhead
n 12913 4080 m 13033 4050 l 12913 4020 l  col0 s
% Polyline
gs  clippath
13917 4417 m 13964 4455 l 14058 4337 l 13960 4412 l 14011 4299 l cp
eoclip
n 14250 4050 m
 13950 4425 l gs col0 s gr gr

% arrowhead
n 14011 4299 m 13960 4412 l 14058 4337 l  col0 s
% Polyline
gs  clippath
13065 1980 m 13065 1920 l 12913 1920 l 13033 1950 l 12913 1980 l cp
eoclip
n 12525 1950 m
 13050 1950 l gs col0 s gr gr

% arrowhead
n 12913 1980 m 13033 1950 l 12913 1920 l  col0 s
% Polyline
gs  clippath
13935 1920 m 13935 1980 l 14087 1980 l 13967 1950 l 14087 1920 l cp
eoclip
n 14250 1950 m
 13950 1950 l gs col0 s gr gr

% arrowhead
n 14087 1920 m 13967 1950 l 14087 1980 l  col0 s
% Polyline
gs  clippath
13065 2880 m 13065 2820 l 12913 2820 l 13033 2850 l 12913 2880 l cp
eoclip
n 12525 2850 m
 13050 2850 l gs col0 s gr gr

% arrowhead
n 12913 2880 m 13033 2850 l 12913 2820 l  col0 s
% Polyline
gs  clippath
13935 2820 m 13935 2880 l 14087 2880 l 13967 2850 l 14087 2820 l cp
eoclip
n 14250 2850 m 14175 2850 l 14100 2850 l 14025 2850 l
 13950 2850 l gs col0 s gr gr

% arrowhead
n 14087 2820 m 13967 2850 l 14087 2880 l  col0 s
% Polyline
gs  clippath
13051 3408 m 13075 3353 l 12936 3293 l 13035 3368 l 12912 3348 l cp
eoclip
n 12525 3150 m
 13050 3375 l gs col0 s gr gr

% arrowhead
n 12912 3348 m 13035 3368 l 12936 3293 l  col0 s
% Polyline
gs  clippath
13993 3364 m 14035 3406 l 14143 3299 l 14037 3363 l 14100 3256 l cp
eoclip
n 14250 3150 m
 14025 3375 l gs col0 s gr gr

% arrowhead
n 14100 3256 m 14037 3363 l 14143 3299 l  col0 s
% Polyline
gs  clippath
13860 8220 m 13860 8280 l 14012 8280 l 13892 8250 l 14012 8220 l cp
eoclip
n 14250 8250 m
 13875 8250 l gs col0 s gr gr

% arrowhead
n 14012 8220 m 13892 8250 l 14012 8280 l  col0 s
/Times-Roman-iso ff 200.00 scf sf
3000 1875 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2850 2775 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2850 3975 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2850 8175 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2100 675 m
gs 1 -1 sc (parent) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2100 930 m
gs 1 -1 sc (VA space) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3600 675 m
gs 1 -1 sc (Page) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3600 930 m
gs 1 -1 sc (Frames) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1050 2175 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1050 3075 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1050 4275 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1125 8400 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4950 8400 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4875 4275 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5025 3075 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5025 2175 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9525 2175 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10875 2175 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9525 3075 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10800 3075 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9600 4275 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10800 4275 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9600 8400 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10800 8400 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
15525 2175 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
15600 3075 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
15675 4275 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
15750 8400 m
gs 1 -1 sc (rw-) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6675 1875 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2925 3225 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6675 2775 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6750 3150 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6675 3975 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6675 8175 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7950 2700 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7950 3150 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7950 3900 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7950 8100 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7875 1875 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
12675 1875 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
13950 1800 m
gs 1 -1 sc (r-x) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
12750 2775 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
14025 2775 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
13950 3150 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
12750 3225 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
12750 3975 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
12675 8175 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
14025 8175 m
gs 1 -1 sc (r--) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
14025 4050 m
gs 1 -1 sc (rw-) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND 0 Cg EP
%%Page: 33 33
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 33)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Bold@0 SF(In)175.491 120 Q -.13(va)-.52 G(lid Addr)
.13 E(esses and SIGSEGV)-.234 E/F2 13/Times-Roman@0 SF .961(If, ho)
33.336 156 R(we)-.325 E -.195(ve)-.325 G 2.001 -.52(r, t).195 H .961
(he f).52 F .96(aulted address is outside of all re)-.13 F .96
(gions and is not associated with stack)-.195 F(gro)33.336 171 Q 2.878
(wth, or if the attempted access is a violation of the re)-.325 F 2.879
(gions protections, a signal)-.195 F/F3 13/Courier@0 SF(SIGSEGV)33.336
186 Q F2 .697(is forcibly posted to the current process.)3.947 F("F)
7.196 E .696(orcibly" means the k)-.195 F .696(ernel doesn')-.13 F(t)
-.234 E 4.1(care if the process has this signal number block)33.336 201
R 4.1(ed or ignored: The user program)-.13 F 1.128
(attempted to access an ille)33.336 216 R -.065(ga)-.195 G 4.378(lv).065
G 1.127(irtual memory address, and there is no point in letting it)
-4.378 F .587(continue on its current path.)33.336 231 R .587
(The address will not magically become v)7.087 F .587
(alid, and therefore)-.325 F 2.022(the f)33.336 246 R 2.022
(aulted instruction can ne)-.13 F -.195(ve)-.325 G 5.272(rb).195 G 5.272
(es)-5.272 G 2.022(atis\214ed and w)-5.272 F 2.022(ould loop fore)-.13 F
-.195(ve)-.325 G 6.702 -.715(r. T).195 H 2.022(he signal then).715 F
(terminates the process.)33.336 261 Q 3.41(If the signal has a handler)
33.336 282 R 6.66(,b)-.52 G 3.41(ut the signal is currently being block)
-6.92 F 3.411(ed, the signal is)-.13 F(unblock)33.336 297 Q .921
(ed, the handler is reset to SIG_DFL, and once ag)-.13 F .921
(ain the signal kills the process.)-.065 F .281
(The reasoning is that a handler should not be in)33.336 312 R -.26(vo)
-.52 G -.13(ke).26 G 3.531(di).13 G 3.531(ft)-3.531 G .281
(he corresponding signal is being)-3.531 F(block)33.336 327 Q(ed.)-.13 E
1.927(It is, ho)33.336 348 R(we)-.325 E -.195(ve)-.325 G 2.967 -.52
(r, p).195 H 1.927(ermissible for the signal to be).52 F/F4 13
/Times-Italic@0 SF(handled)5.177 E F2 1.926(as that will force e)5.176 F
-.195(xe)-.195 G 1.926(cution to).195 F 2.004(jump to another)33.336 363
R 5.254(,p)-.52 G 2.004(resumably less \215a)-5.254 F 2.004
(wed part of the program.)-.195 F 2.004(This technique is often)8.504 F
.655(used in comple)33.336 378 R .654
(x, modular applications \(such as the open-source image editor)-.195 F
F4 .654(The Gimp)3.904 F F2(\))A .984(to isolate a \215a)33.336 393 R
.984(wed module and pre)-.195 F -.195(ve)-.325 G .984
(nt it from crashing the entire program and possibly).195 F
(leading to a loss of data.)33.336 408 Q F1(Benign P)182.394 438 Q
(age F)-.13 E(aults / P)-.325 E(aging-in)-.13 E F2 -.195(Pa)33.336 474 S
.462(ge f).195 F .462(aults which are within an e)-.13 F .462
(xisting re)-.195 F .462
(gion and which are not the result of protection)-.195 F 1.32
(violations are therefore not the result of an)33.336 489 R 4.57(yp)
-.195 G 1.32(rogram error)-4.57 F 4.57(,a)-.52 G 1.32
(nd need to be resolv)-4.57 F 1.32(ed by)-.195 F .58(establishing a v)
33.336 504 R .58(alid forw)-.325 F .579
(ard mapping PTE that is pointing to a v)-.13 F .579(alid ph)-.325 F
.579(ysical page frame)-.065 F 1.823
(which contains the correct contents corresponding to the virtual page.)
33.336 519 R 1.824(This page f)8.324 F(ault)-.13 E
(resolution mechanism can ha)33.336 534 Q .39 -.195(ve o)-.26 H
(ne of four mutually e).195 E(xclusi)-.195 E .39 -.195(ve o)-.325 H
(utcomes:).195 E<83>33.336 549 Q F3 3.3(Minor fault)6.55 F F2 6.55(:T)C
3.3(he page f)-6.55 F 3.3(ault is resolv)-.13 F 3.3
(ed quickly without requiring a disk I/O)-.195 F 3.462
(operation or putting the process to sleep.)33.336 564 R 3.462
(E.g. demand-paging ne)9.962 F 6.713(wb)-.325 G 3.463(ss pages \(just)
-6.713 F .981(allocate a page, zero \214ll and return\), paging-in \214\
le-mapped pages which are still cached)33.336 579 R(in memory)33.336 594
Q 3.25(,o)-.845 G 3.25(rb)-3.25 G(reaking up a Cop)-3.25 E
(y-on-Write shared page frame.)-.13 E(Minor f)6.5 E(aults are good.)-.13
E<83>33.336 609 Q F3 .184(Major fault)3.434 F F2 3.434(:I)C 3.434(tw)
-3.434 G .185
(as necessary to sleep pending an I/O operation to satisfy this f)-3.564
F(ault.)-.13 E .086(Major f)33.336 624 R .086
(aults are not necessarily e)-.13 F .085(vil \(e.g. demand paging an e)
-.325 F -.195(xe)-.195 G .085(cutable \214le from disk\) b).195 F(ut)
-.26 E(we w)33.336 639 Q(ould lik)-.13 E 3.25(et)-.13 G 3.25(om)-3.25 G
(inimize their number)-3.25 E(.)-.715 E<83>33.336 654 Q F3 .339
(Bus Error)3.589 F F2 3.589(:T)C .339(he k)-3.589 F .339(ernel w)-.13 F
.34(as unable to page-in the page because of an error other than)-.13 F
1.493(being out of memory)33.336 669 R 7.993(.E)-.845 G 1.493
(.g. the page is mapped to a disk \214le b)-7.993 F 1.492
(ut an I/O error occurred)-.26 F 2.033
(trying to access the disk, or the mapping is no longer v)33.336 684 R
2.033(alid because the \214le has been)-.325 F 3.25(truncated. A)33.336
699 R(SIGB)3.25 E(US will be deli)-.13 E -.195(ve)-.325 G
(red to the process.).195 E<83>33.336 714 Q F3 .898(Out of Memory)4.148
F F2 4.148(:T)C .898(he k)-4.148 F .898
(ernel ran out of memory to allocate a free page frame or an)-.13 F .968
(internal data structure.)33.336 729 R .968(This is v)7.468 F .968
(ery bad.)-.195 F .969(Under ordinary circumstances, the k)7.469 F .969
(ernel tries)-.13 F 2.887(to pre)33.336 744 R -.195(ve)-.325 G 2.887
(nt this from happening by maintaining a pool of free memory).195 F
9.387(.I)-.845 G 6.137(ft)-9.387 G 2.886(his does)-6.137 F 0 Cg EP
%%Page: 34 34
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 34)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF .111(happen, the k)33.336 120 R .111
(ernel has no choice b)-.13 F .112(ut to terminate the current process.)
-.26 F .112(See also discussion)6.612 F(belo)33.336 135 Q 3.25(wo)-.325
G 3.25(n")-3.25 G -.195(ove)-3.25 G -.26(r-).195 G(commit".).26 E 3.031
(The Linux page f)33.336 156 R 3.03
(ault handling algorithm is summarized by the follo)-.13 F 3.03
(wing simpli\214ed)-.325 F<8d6f>33.336 171 Q(wchart:)-.325 E 0 0 216 437
-389.986 789 159.336 581.986 PBEGIN
%%BeginDocument: faultlogic.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: faultlogic.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Thu Dec  3 01:10:38 2015
%%For: hak@lex ()
%%BoundingBox: 0 0 437 789
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 789 moveto 0 0 lineto 437 0 lineto 437 789 lineto closepath clip newpath
-135.0 824.2 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 4500 8475 675 675 0 360 DrawEllipse gs col0 s gr

/Times-Roman-iso ff 166.67 scf sf
4200 8175 m
gs 1 -1 sc (expand) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4200 8370 m
gs 1 -1 sc (region) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4200 8565 m
gs 1 -1 sc (to cover) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4200 8760 m
gs 1 -1 sc (fault) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4200 8955 m
gs 1 -1 sc (addr) col0 sh gr
% Ellipse
n 8925 13125 600 600 0 360 DrawEllipse gs col0 s gr

/Times-Roman-iso ff 166.67 scf sf
8625 12975 m
gs 1 -1 sc (SEND) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
8625 13170 m
gs 1 -1 sc (SIGSEGV) col0 sh gr
% Ellipse
n 4500 13200 530 530 0 360 DrawEllipse gs col0 s gr

% Ellipse
n 6825 13200 530 530 0 360 DrawEllipse gs col0 s gr

% Polyline
n 4500 1500 m 3600 2100 l 4500 2700 l 5400 2100 l
 cp gs col0 s gr 
% Polyline
n 4500 3300 m 3600 3900 l 4500 4500 l 5400 3900 l
 cp gs col0 s gr 
% Polyline
gs  clippath
4470 3315 m 4530 3315 l 4530 3163 l 4500 3283 l 4470 3163 l cp
eoclip
n 4500 2700 m
 4500 3300 l gs col0 s gr gr

% arrowhead
n 4470 3163 m 4500 3283 l 4530 3163 l  col0 s
% Polyline
n 4500 4800 m 3600 5400 l 4500 6000 l 5400 5400 l
 cp gs col0 s gr 
% Polyline
gs  clippath
4470 4815 m 4530 4815 l 4530 4663 l 4500 4783 l 4470 4663 l cp
eoclip
n 4500 4500 m
 4500 4800 l gs col0 s gr gr

% arrowhead
n 4470 4663 m 4500 4783 l 4530 4663 l  col0 s
% Polyline
n 4500 6300 m 3600 6900 l 4500 7500 l 5400 6900 l
 cp gs col0 s gr 
% Polyline
gs  clippath
4470 6315 m 4530 6315 l 4530 6163 l 4500 6283 l 4470 6163 l cp
eoclip
n 4500 5925 m
 4500 6300 l gs col0 s gr gr

% arrowhead
n 4470 6163 m 4500 6283 l 4530 6163 l  col0 s
% Polyline
gs  clippath
4470 7815 m 4530 7815 l 4530 7663 l 4500 7783 l 4470 7663 l cp
eoclip
n 4500 7500 m
 4500 7800 l gs col0 s gr gr

% arrowhead
n 4470 7663 m 4500 7783 l 4530 7663 l  col0 s
% Polyline
gs  clippath
4470 9915 m 4530 9915 l 4530 9763 l 4500 9883 l 4470 9763 l cp
eoclip
n 3600 5400 m 3225 5400 l 3225 9600 l 4500 9600 l
 4500 9900 l gs col0 s gr gr

% arrowhead
n 4470 9763 m 4500 9883 l 4530 9763 l  col0 s
% Polyline
n 4500 9825 m 3600 10425 l 4500 11025 l 5400 10425 l
 cp gs col0 s gr 
% Polyline
n 3750 11400 m 5250 11400 l 5250 12300 l 3750 12300 l
 cp gs col0 s gr 
% Polyline
gs  clippath
3267 13192 m 3313 13230 l 3410 13114 l 3311 13187 l 3364 13075 l cp
eoclip
n 4050 12300 m
 3300 13200 l gs col0 s gr gr

% arrowhead
n 3364 13075 m 3311 13187 l 3410 13114 l  col0 s
% Polyline
gs  clippath
4470 12690 m 4530 12690 l 4530 12538 l 4500 12658 l 4470 12538 l cp
eoclip
n 4500 12300 m
 4500 12675 l gs col0 s gr gr

% arrowhead
n 4470 12538 m 4500 12658 l 4530 12538 l  col0 s
% Polyline
gs  clippath
6455 12783 m 6473 12725 l 6328 12680 l 6434 12745 l 6310 12737 l cp
eoclip
n 5025 12300 m
 6450 12750 l gs col0 s gr gr

% arrowhead
n 6310 12737 m 6434 12745 l 6328 12680 l  col0 s
% Polyline
gs  clippath
4470 11340 m 4530 11340 l 4530 11188 l 4500 11308 l 4470 11188 l cp
eoclip
n 4500 11025 m
 4500 11325 l gs col0 s gr gr

% arrowhead
n 4470 11188 m 4500 11308 l 4530 11188 l  col0 s
% Polyline
gs  clippath
4560 11145 m 4560 11205 l 4712 11205 l 4592 11175 l 4712 11145 l cp
eoclip
n 4500 9150 m 4500 9375 l 6150 9375 l 6150 11175 l
 4575 11175 l gs col0 s gr gr

% arrowhead
n 4712 11145 m 4592 11175 l 4712 11205 l  col0 s
% Polyline
n 6975 1500 m 6075 2100 l 6975 2700 l 7875 2100 l
 cp gs col0 s gr 
% Polyline
gs  clippath
6945 12690 m 7005 12690 l 7005 12538 l 6975 12658 l 6945 12538 l cp
eoclip
n 6975 2700 m
 6975 12675 l gs col0 s gr gr

% arrowhead
n 6945 12538 m 6975 12658 l 7005 12538 l  col0 s
% Polyline
gs  clippath
6090 2130 m 6090 2070 l 5938 2070 l 6058 2100 l 5938 2130 l cp
eoclip
n 5400 2100 m
 6075 2100 l gs col0 s gr gr

% arrowhead
n 5938 2130 m 6058 2100 l 5938 2070 l  col0 s
% Polyline
gs  clippath
8940 10455 m 8940 10395 l 8788 10395 l 8908 10425 l 8788 10455 l cp
eoclip
n 5400 10425 m
 8925 10425 l gs col0 s gr gr

% arrowhead
n 8788 10455 m 8908 10425 l 8788 10395 l  col0 s
% Polyline
gs  clippath
8895 12540 m 8955 12540 l 8955 12388 l 8925 12508 l 8895 12388 l cp
eoclip
n 5400 6900 m 8925 6900 l
 8925 12525 l gs col0 s gr gr

% arrowhead
n 8895 12388 m 8925 12508 l 8955 12388 l  col0 s
% Polyline
gs  clippath
8340 2130 m 8340 2070 l 8188 2070 l 8308 2100 l 8188 2130 l cp
eoclip
n 7875 2100 m
 8325 2100 l gs col0 s gr gr

% arrowhead
n 8188 2130 m 8308 2100 l 8188 2070 l  col0 s
% Polyline
gs  clippath
8895 6915 m 8955 6915 l 8955 6763 l 8925 6883 l 8895 6763 l cp
eoclip
n 5400 3900 m 8925 3900 l
 8925 6900 l gs col0 s gr gr

% arrowhead
n 8895 6763 m 8925 6883 l 8955 6763 l  col0 s
% Polyline
gs  clippath
4470 1590 m 4530 1590 l 4530 1438 l 4500 1558 l 4470 1438 l cp
eoclip
n 4500 825 m
 4500 1575 l gs col0 s gr gr

% arrowhead
n 4470 1438 m 4500 1558 l 4530 1438 l  col0 s
/Times-Roman-iso ff 166.67 scf sf
4725 2775 m
gs 1 -1 sc (N) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
5325 1800 m
gs 1 -1 sc (Y) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
7050 3150 m
gs 1 -1 sc (N) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 5175 m
gs 1 -1 sc (inside) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 5370 m
gs 1 -1 sc (memory) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 5565 m
gs 1 -1 sc (region?) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
3525 5100 m
gs 1 -1 sc (Y) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 6750 m
gs 1 -1 sc ("near") col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 7140 m
gs 1 -1 sc (region?) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4050 6975 m
gs 1 -1 sc (GROWSDOOWN) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4725 6150 m
gs 1 -1 sc (N) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
5325 6600 m
gs 1 -1 sc (N) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4725 7575 m
gs 1 -1 sc (Y) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 10200 m
gs 1 -1 sc (prot) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 10395 m
gs 1 -1 sc (violation?) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4875 11025 m
gs 1 -1 sc (N) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
3900 11625 m
gs 1 -1 sc (Page-in or) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
3900 11820 m
gs 1 -1 sc (COW) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
3150 13545 m
gs 1 -1 sc (Return) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 12975 m
gs 1 -1 sc (send) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4275 13170 m
gs 1 -1 sc (SIGBUS) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
5475 12375 m
gs 1 -1 sc (VM_FAULT_OOM) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
3150 13350 m
gs 1 -1 sc (Normal) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
2250 12525 m
gs 1 -1 sc (VM_FAULT_MAJOR) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
2775 12750 m
gs 1 -1 sc (or MINOR) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
6600 13350 m
gs 1 -1 sc (SIGKILL) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
6675 13125 m
gs 1 -1 sc (send) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4575 12675 m
gs 1 -1 sc (VM_FAULT_BUS) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
6675 1950 m
gs 1 -1 sc (add in kernel) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
6675 2175 m
gs 1 -1 sc (exception tbl?) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
5475 3675 m
gs 1 -1 sc (Y) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
5550 10275 m
gs 1 -1 sc (Y) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4350 1950 m
gs 1 -1 sc (kernel) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4350 2175 m
gs 1 -1 sc (mode?) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
8325 2100 m
gs 1 -1 sc (return) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
8025 1950 m
gs 1 -1 sc (Y) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4200 4125 m
gs 1 -1 sc (0xC000000) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4425 3825 m
gs 1 -1 sc (va  >) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4650 3150 m
gs 1 -1 sc (user) col0 sh gr
/Times-Roman-iso ff 166.67 scf sf
4650 4725 m
gs 1 -1 sc (N) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3975 750 m
gs 1 -1 sc (PAGE FAULT) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F2 13/Times-Bold@0 SF(On-demand cr)168.451 632.986 Q
(eation of P)-.234 E(age T)-.13 E(ables)-1.196 E F1 1.524
(Recall that the structure of the page table is multi-le)33.336 668.986
R -.195(ve)-.325 G 4.774(la).195 G 1.524(nd sparse.)-4.774 F 1.524
(Only the top-le)8.024 F -.195(ve)-.325 G(l).195 E -.195(Pa)33.336
683.986 S 1.359(ge Global Directory is pre-allocated.).195 F 1.359
(The k)7.859 F 1.358(ernel uses)-.13 F F2 1.358(lazy allocation)4.608 F
F1 1.358(in creating the)4.608 F 1.002
(page upper directories, page middle directories, and page tables.)
33.336 698.986 R 1.002(Therefore, at this time)7.502 F 3.663(of page f)
33.336 713.986 R 3.662(ault resolution, the k)-.13 F 3.662
(ernel must \(recursi)-.13 F -.195(ve)-.325 G 3.662
(ly\) allocate the directories/tables).195 F .169(mapping the f)33.336
728.986 R .169(aulted virtual memory address, if the)-.13 F 3.419(ya)
-.195 G .169(re not already allocated.)-3.419 F .169(When ne)6.669 F(w)
-.325 E .065(page tables or page directories are allocated, the)33.336
743.986 R 3.315(ya)-.195 G .065
(re set to 0, meaning none of the entries)-3.315 F 0 Cg EP
%%Page: 35 35
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 35)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 3.675(are vie)33.336 120 R 3.675
(wed by the hardw)-.325 F 3.675(are as PRESENT yet.)-.13 F 3.675(The k)
10.175 F 3.675(ernel then installs ne)-.13 F 6.925(wP)-.325 G(age)-7.12
E(Directory or P)33.336 135 Q(age T)-.195 E(able Entries as needed.)
-1.04 E/F2 13/Times-Bold@0 SF -.13(Pa)203.727 165 S(ging-in fr).13 E
(om wher)-.234 E(e?)-.234 E F1 3.092 -1.04(To c)33.336 201 T 1.012
(omplete page f)1.04 F 1.011(ault resolution, the k)-.13 F 1.011
(ernel must locate the canonical cop)-.13 F 4.261(yo)-.13 G 4.261(ft)
-4.261 G 1.011(he data)-4.261 F .991
(corresponding to the virtual page which is f)33.336 216 R 4.241
(aulted. In)-.13 F .991(brief, this can f)4.241 F .992
(all into one of the)-.13 F(follo)33.336 231 Q(wing cases:)-.325 E 3.25
<8354>33.336 246 S(he virtual page is \214le-mapped.)-3.25 E 3.25<8354>
33.336 261 S(he virtual page is anon)-3.25 E(ymous and not pre)-.195 E
(viously written to.)-.325 E 3.25<8354>33.336 276 S
(he virtual page is anon)-3.25 E(ymous and pre)-.195 E
(viously dirtied, and sw)-.325 E(apped out.)-.13 E 3.25<8354>33.336 291
S(he virtual page is already present in ph)-3.25 E(ysical memory)-.065 E
3.25(,a)-.845 G(nd this is a cop)-3.25 E(y-on-write.)-.13 E 4.451(The k)
33.336 312 R 4.451(ernel can determine which case applies by looking at\
 the bits of the PTE)-.13 F .091(corresponding to the f)33.336 327 R
.091(aulted address, and by looking at the attrib)-.13 F .091
(utes of the corresponding)-.26 F/F3 13/Courier@0 SF(vm_area_struct)
33.336 342 Q F1(.)A 3.568<8354>33.336 357 S .318
(he PFN \214eld is all zero and the Present bit is 0, and the)-3.568 F
F3(vm_area_struct)3.567 E F1(indicates)3.567 E .233(that this re)33.336
372 R .233(gion is mapped to a \214le.)-.195 F .233
(The corresponding page-sized chunk of the \214le might)6.733 F .762(al\
ready be cached in a page frame because of recent read/write sytsem cal\
l acti)33.336 387 R(vity)-.325 E 4.011(,o)-.845 G 4.011(ri)-4.011 G(t)
-4.011 E .455(may require the allocation of a ne)33.336 402 R 3.705(wp)
-.325 G .455(age frame and the initiation of a disk I/O operation.)
-3.705 F(See "File Mappings")33.336 417 Q 3.888<8354>33.336 432 S .638
(he PFN \214eld and Present bit are all 0 and the)-3.888 F F3
(vm_area_struct)3.888 E F1 .637(tells us that this is)3.888 F .37
(an anon)33.336 447 R .371(ymous re)-.195 F 3.621(gion. The)-.195 F .371
(PTE being entirely 0 tells us that this virtual page is "vir)3.621 F
(gin":)-.234 E .181(it has not pre)33.336 462 R .18
(viously been written to and sw)-.325 F .18(apped out.)-.13 F .18
(This situation is al)6.68 F -.13(wa)-.13 G .18(ys resolv).13 F(able)
-.325 E 1.604(as a minor f)33.336 477 R 4.854(ault: The)-.13 F -.13(ke)
4.854 G 1.604
(rnel \214nds a page frame from the free pool and maps it to the).13 F
-.13(fa)33.336 492 S 3.553(ulted virtual page.).13 F 3.553(If the f)
10.053 F 3.553(aulted access w)-.13 F 3.553(as a write, the k)-.13 F
3.552(ernel 0-\214lls the page.)-.13 F(Ho)33.336 507 Q(we)-.325 E -.195
(ve)-.325 G 1.649 -.52(r, f).195 H .609(or a read access, the k).52 F
.609(ernel optimizes by mapping to a single, shared ph)-.13 F(ysical)
-.065 E .513(page containing all 0, and setting up a CO)33.336 522 R
3.763(Ws)-.455 G .513(ituation by making the PTE protection bits)-3.763
F(read-only)33.336 537 Q 7.595(.A)-.845 G 4.345(tal)-7.595 G 1.096(ater\
 time, if the process writes to this page, things will be straightened)
-4.345 F 2.983(out by Cop)33.336 552 R 6.233(y-On-Write. This)-.13 F
(beha)6.233 E 2.983(vior of)-.26 F F2(zer)6.233 E(o-\214lling)-.234 E F1
(ne)6.233 E 6.233(wa)-.325 G(non)-6.233 E 2.983(ymous pages is v)-.195 F
(ery)-.195 E 1.552(important for security)33.336 567 R 8.052(.O)-.845 G
1.552(therwise, sensiti)-8.052 F 1.942 -.195(ve i)-.325 H 1.552
(nformation from another process could be).195 F(vie)33.336 582 Q
(wed when the page frame is rec)-.325 E(ycled.)-.195 E 3.958<8354>33.336
597 S .707(he PFN \214eld of the PTE is non-zero, b)-3.958 F .707
(ut the Present bit is 0 \(and the Dirty bit is also)-.26 F 5.64
(0\). The)33.336 612 R -.13(ke)5.64 G 2.39
(rnel deliberately sets up this odd situation to indicate an anon).13 F
2.39(ymous page)-.195 F .818(which has been)33.336 627 R F3 .817
(swapped out)4.067 F F1 7.317(.T)C .817
(he page frame number does not correspond to a real)-7.317 F .195
(address, b)33.336 642 R .196
(ut is used as an identi\214er to help the sw)-.26 F .196
(ap subsystem \214nd the image of the page)-.13 F .158(in the sw)33.336
657 R .158(ap area.)-.13 F 2.238 -1.04(We w)6.658 H .157
(ill need to initiate an I/O operation to sw)1.04 F .157
(ap-in the page image to a)-.13 F(ne)33.336 672 Q 3.25(wp)-.325 G
(age frame.)-3.25 E(This will be discussed further under "Sw)6.5 E
(ap Space".)-.13 E 5.013<8354>33.336 687 S 1.763(he Present bit is 1.)
-5.013 F 1.763(At this point in the code, we kno)8.263 F 5.013(wt)-.325
G 1.764(hat it must be a hardw)-5.013 F(are)-.13 E .031
(protection violation which tripped the page f)33.336 702 R .031
(ault, and we ha)-.13 F .421 -.195(ve p)-.26 H(re).195 E .031
(viously check)-.325 F .031(ed that the)-.13 F .435
(attempted access is v)33.336 717 R .435(alid for this re)-.325 F 3.685
(gion. Therefore)-.195 F .435(we need to resolv)3.685 F 3.685(et)-.195 G
.435(he cop)-3.685 F(y-on-write)-.13 E(as discussed abo)33.336 732 Q
-.195(ve)-.195 G(.).195 E 0 Cg EP
%%Page: 36 36
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 36)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E 0 0 360 637 -395.039 699 87.336 515.039 PBEGIN
%%BeginDocument: ptestates.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: ptestates.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Thu Dec  3 01:24:15 2015
%%For: hak@lex ()
%%BoundingBox: 0 0 637 699
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 699 moveto 0 0 lineto 637 0 lineto 637 699 lineto closepath clip newpath
-71.3 878.2 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
7.500 slw
n 1200 7200 m 9600 7200 l 9600 8100 l 1200 8100 l
 cp gs col0 s gr 
% Polyline
n 1500 7200 m
 1500 8100 l gs col0 s gr 
% Polyline
n 1200 9000 m 9600 9000 l 9600 9900 l 1200 9900 l
 cp gs col0 s gr 
% Polyline
n 1500 9000 m
 1500 9900 l gs col0 s gr 
% Polyline
 [60 30 15 30] 0 sd
n 3000 9000 m
 3000 9900 l gs col0 s gr  [] 0 sd
% Polyline
gs  clippath
4140 11130 m 4140 11070 l 3988 11070 l 4108 11100 l 3988 11130 l cp
eoclip
n 2175 9900 m 2175 11100 l
 4125 11100 l gs col0 s gr gr

% arrowhead
n 3988 11130 m 4108 11100 l 3988 11070 l  col0 s
% Polyline
n 4275 11100 m 6675 11100 l 6675 14625 l 4275 14625 l
 cp gs col0 s gr 
% Polyline
gs  clippath
6435 12420 m 6435 12480 l 6587 12480 l 6467 12450 l 6587 12420 l cp
eoclip
n 7800 9600 m 7800 12450 l
 6450 12450 l gs col0 s gr gr

% arrowhead
n 6587 12420 m 6467 12450 l 6587 12480 l  col0 s
% Polyline
n 4275 11400 m
 6675 11400 l gs col0 s gr 
% Polyline
n 4275 11700 m
 6675 11700 l gs col0 s gr 
% Polyline
n 4275 12000 m
 6675 12000 l gs col0 s gr 
% Polyline
n 4275 12300 m
 6675 12300 l gs col0 s gr 
% Polyline
n 4275 12600 m
 6675 12600 l gs col0 s gr 
% Polyline
n 4275 14100 m
 6675 14100 l gs col0 s gr 
% Polyline
n 4275 14400 m
 6675 14400 l gs col0 s gr 
% Polyline
n 1200 5325 m 9600 5325 l 9600 6225 l 1200 6225 l
 cp gs col0 s gr 
% Polyline
n 1500 5325 m
 1500 6225 l gs col0 s gr 
% Polyline
 [60 30 15 30] 0 sd
n 3900 5325 m
 3900 6225 l gs col0 s gr  [] 0 sd
% Polyline
n 1200 3300 m 9600 3300 l 9600 4200 l 1200 4200 l
 cp gs col0 s gr 
% Polyline
n 1500 3300 m
 1500 4200 l gs col0 s gr 
% Polyline
 [60 30 15 30] 0 sd
n 3900 3300 m
 3900 4200 l gs col0 s gr  [] 0 sd
/Times-Roman-iso ff 200.00 scf sf
1350 7725 m
gs 1 -1 sc (0) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6675 7725 m
gs 1 -1 sc (0) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10125 7350 m
gs 1 -1 sc (PTE all-0) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10125 7605 m
gs 1 -1 sc ("Virgin" anon page) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10125 7860 m
gs 1 -1 sc (or file-backed page) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1350 9525 m
gs 1 -1 sc (0) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1950 9525 m
gs 1 -1 sc (swap) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1950 9780 m
gs 1 -1 sc (area #) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4500 9525 m
gs 1 -1 sc (swap slot # within area) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6450 8850 m
gs 1 -1 sc (24) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2175 8775 m
gs 1 -1 sc (7) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10125 9225 m
gs 1 -1 sc (Previously) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10125 9480 m
gs 1 -1 sc (dirty anon page) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10125 9735 m
gs 1 -1 sc (paged out to) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10125 9990 m
gs 1 -1 sc (swap space) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4725 10950 m
gs 1 -1 sc (swap area #1 \(/dev/sda2\)) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5025 13350 m
gs 1 -1 sc (. . .) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1350 5775 m
gs 1 -1 sc (P) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6825 5850 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7125 5175 m
gs 1 -1 sc (20) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1650 5775 m
gs 1 -1 sc (R0XSAD) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10050 5880 m
gs 1 -1 sc (but W bit is off) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10050 6135 m
gs 1 -1 sc (to trigger C-O-W) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1350 3750 m
gs 1 -1 sc (P) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6825 3825 m
gs 1 -1 sc (PFN) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7125 3150 m
gs 1 -1 sc (20) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1650 3750 m
gs 1 -1 sc (RWXSAD) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10050 3600 m
gs 1 -1 sc (Page is mapped) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10050 3855 m
gs 1 -1 sc (RWXSAD bits) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10050 4110 m
gs 1 -1 sc (checked by hw) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10050 5625 m
gs 1 -1 sc (Page is mapped) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F1 13/Times-Italic@0 SF .5(Note that in the abo)33.336 542.039
R .5(ve dia)-.13 F(gr)-.13 E .5(am, the or)-.195 F .499
(der of the bits within the PFN has been abstr)-.481 F(acted)-.195 E
.505(to mak)33.336 557.039 R 3.755(eac)-.13 G(lear)-3.755 E .505(er pr)
-.481 F 3.755(esention. If)-.481 F .505(you dar)3.755 F 3.755(et)-.481 G
3.755(ol)-3.755 G .506(ook at the X86 documentation, you')-3.755 F 3.756
<648c>-.325 G .506(nd it)-3.756 F(dif)33.336 572.039 Q(fer)-.234 E(s.)
-.13 E/F2 13/Times-Bold@0 SF -.13(Pa)160.229 617.039 S
(ge Frame Reclamation / P).13 E(aging-Out)-.13 E/F3 13/Times-Roman@0 SF
4.218 -1.04(We c)33.336 653.039 T 2.138
(an think of the pool of page frames as a cache for acti)1.04 F -.195
(ve)-.325 G 2.137(ly-used data which are).195 F .114
(otherwise stored on disk \(in a \214le or in sw)33.336 668.039 R .115
(ap space\).)-.13 F .115(Linux uses a strate)6.615 F .115
(gy of maintaining)-.195 F 3.534(ap)33.336 683.039 S .283
(ool of free page frames proacti)-3.534 F -.195(ve)-.325 G(ly).195 E
6.783(.C)-.845 G .283(onsider what w)-6.783 F .283
(ould happen if this strate)-.13 F .283(gy were)-.195 F .793
(not in place: W)33.336 698.039 R 4.043(ec)-1.04 G .793
(all the total number of page frames mapped to a process the)-4.043 F F2
(Resident)4.043 E 2.206(Set Size \(RSS\))33.336 713.039 R F3 8.706(.A)C
5.456(sp)-8.706 G 2.206
(rocesses request virtual memory and are allocated page frames,)-5.456 F
.644(their RSS w)33.336 728.039 R .644(ould gro)-.13 F 2.334 -.845(w, a)
-.325 H .644(nd the pool of free frames w).845 F .645
(ould shrink and shrink.)-.13 F(Ev)7.145 E(entually)-.195 E(,)-.845 E
2.125(there will not be an)33.336 743.039 R 5.375(yf)-.195 G 2.125
(rames a)-5.375 F -.325(va)-.26 G 2.125(ilable to satisfy a ne).325 F
5.375(wr)-.325 G 5.375(equest. This)-5.375 F 2.125(could block the)5.375
F 0 Cg EP
%%Page: 37 37
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 37)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.328(process for a long time while a "v\
ictim" page is selected to be written back to backing)33.336 120 R
(store and re-assigned.)33.336 135 Q .13(Instead, the Linux k)33.336 156
R .13(ernel uses a k)-.13 F .13(ernel task \()-.13 F/F2 13
/Times-Italic@0 SF 3.38(ak)C .13(ernel task aka k)-3.51 F .13(ernel thr)
-.13 F .13(ead is lik)-.481 F 3.38(eau)-.13 G(ser)-3.38 E(-)-.26 E .513
(mode pr)33.336 171 R .514(ocess, b)-.585 F .514(ut it ne)-.26 F .514
(ver leaves k)-.195 F .514(ernel mode)-.13 F 7.014(.I)-.195 G 3.764(tc)
-7.014 G .514(an mak)-3.764 F 3.764(es)-.13 G .514
(ystem calls, using a slightly)-3.764 F 2.282
(modi\214ed, internalized syntax.)33.336 186 R -.455(Ke)8.782 G 2.282
(rnel tasks ar).455 F 5.532(es)-.481 G -.195(ch)-5.532 G 2.281
(eduled by the sc).195 F(heduler)-.195 E 5.531(,c)-1.443 G 2.281
(an go to)-5.531 F .944(sleep and wak)33.336 201 R .944(eup, etc.)-.13 F
(The)7.444 E 4.194(yd)-.39 G 4.195(on)-4.194 G .945
(ot have their own mm_struct b)-4.195 F .945(ut "borr)-.26 F .945
(ow" one fr)-.585 F .945(om a)-.585 F .865(user pr)33.336 216 R .865
(ocess, whic)-.585 F 4.115(hi)-.195 G 4.115(sO)-4.115 G 4.115(Ks)-4.115
G .865(ince the)-4.115 F 4.115(yo)-.39 G .864(nly access the shar)-4.115
F .864(ed k)-.481 F .864(ernel memory ar)-.13 F(ea)-.481 E F1 4.114(\)c)
C(alled)-4.114 E/F3 13/Courier@0 SF(kswapd)33.336 231 Q F1 .85
(to periodically scan the)4.1 F F3(mem_map)4.1 E F1 4.1(,l)C .851
(ooking for possible victims from which to)-4.1 F .859
(steal back pages and thus reduce the total RSS.)33.336 246 R .859
(There are tw)7.359 F 4.109(op)-.13 G .858(arameters which can be)-4.109
F 1.144(tuned by the system administrator establishing lo)33.336 261 R
(w-w)-.325 E 1.144(ater and high-w)-.13 F 1.144(ater marks for free)-.13
F(pages.)33.336 276 Q F3(kswapd)8.105 E F1 -.13(wo)4.855 G 1.605
(rks hard to k).13 F 1.605(eep the free page count abo)-.13 F 1.994
-.195(ve l)-.195 H -.325(ow).195 G(-w).325 E(ater)-.13 E 4.854(,a)-.52 G
1.604(nd goes to)-4.854 F .635(sleep when it reaches the high-w)33.336
291 R .635(ater mark.)-.13 F 2.715 -1.04(To b)7.135 H 3.885(em)1.04 G
.635(ore precise, each memory zone \(e.g.)-3.885 F 1.058
(NORMAL, HIGHMEM\) has its o)33.336 306 R 1.058(wn high and lo)-.325 F
4.308(ww)-.325 G 1.058(ater marks, b)-4.438 F 1.057
(ut we will ignore this)-.26 F(detail.)33.336 321 Q 2.036(The P)33.336
342 R 2.036(age Frame Reclamation Algorithm \(PFRA\) maintains tw)-.195
F 5.286(ol)-.13 G 2.037(ists of non-free page)-5.286 F 3.517
(frames: acti)33.336 357 R 3.907 -.195(ve a)-.325 H 3.517(nd inacti).195
F -.195(ve)-.325 G 10.017(.T).195 G 3.517
(hese lists are chained via the)-10.017 F F3(lru)6.766 E F1 3.516
(\214eld of the page)6.766 F(descriptor)33.336 372 Q 7.608(.P)-.715 G
(eriodically)-7.608 E 4.358(,t)-.845 G 1.108
(he PFRA scans the page descriptors on the acti)-4.358 F 1.498 -.195
(ve l)-.325 H 1.108(ist with the).195 F 1.752(desire to \214nd h)33.336
387 R(ypoacti)-.065 E 2.142 -.195(ve p)-.325 H 1.752(ages and mo).195 F
2.142 -.195(ve t)-.195 H 1.751(hem to the inacti).195 F 2.141 -.195
(ve l)-.325 H 5.001(ist. It).195 F 1.751(uses the re)5.001 F -.195(ve)
-.325 G(rse).195 E 1.835(mapping \(see belo)33.336 402 R 1.836
(w\) in the page descriptor to \214nd the PTEs mapping to this ph)-.325
F(ysical)-.065 E .995(page \(when the page is shared there will be mult\
iple PTE pointing to the same ph)33.336 417 R(ysical)-.065 E 4.248
(page\). Each)33.336 432 R .998(PTE is e)4.248 F .998
(xamined to see if the A)-.195 F .999(CCESSED bit is set, then the A)
-.52 F(CCESSED)-.52 E 1.796(bit is cleared.)33.336 447 R 1.796
(The PFRA also k)8.296 F 1.796(eeps a second bitwise \215ag,)-.13 F F3
(PG_referenced)5.046 E F1 5.046(,i)C 5.046(nt)-5.046 G(he)-5.046 E F3
(flags)33.336 462 Q F1 1.134(\214eld of the page descriptor)4.384 F
4.384(,w)-.52 G 1.134(hich stores the pre)-4.384 F 1.134(vious v)-.325 F
1.134(alue of the A)-.325 F(CCESSED)-.52 E .951(PTE \215ag.)33.336 477 R
.951(\(when there are multiple PTEs mapping the same page, PG_reference\
d is the)7.451 F(OR of the A)33.336 492 Q(CCESSED PTE bits\).)-.52 E
5.292(When an page which had)33.336 513 R F3(PG_referenced)8.542 E F1
5.292(set to 0 is visited ag)8.542 F 5.292(ain and the)-.065 F -.52(AC)
33.336 528 S .242(CESSED PTE \215ag\(s\) is \(are all\) still clear).52
F 3.492(,i)-.52 G 3.492(tm)-3.492 G .241
(eans the page has not been used in tw)-3.492 F(o)-.13 E(successi)33.336
543 Q .697 -.195(ve s)-.325 H .308(can passes.).195 F .308
(The PFRA will then mo)6.808 F .698 -.195(ve t)-.195 H .308
(he page to the tail of the).195 F F2 .308(inactive list)3.558 F F1(.)A
1.975(After the PFRA \214nishes hunting for acti)33.336 564 R 2.364
-.195(ve p)-.325 H 1.974(ages to mo).195 F 2.364 -.195(ve t)-.195 H
5.224(ot).195 G 1.974(he inacti)-5.224 F 2.364 -.195(ve l)-.325 H 1.974
(ist, it starts).195 F .388(trying to pull victims of)33.336 579 R 3.638
(ft)-.325 G .388(he inacti)-3.638 F .778 -.195(ve l)-.325 H .389
(ist, starting at the head of the list.).195 F .389(I.e. it starts with)
6.889 F 1.167(the pages which ha)33.336 594 R 1.557 -.195(ve b)-.26 H
1.167(een sitting on the inacti).195 F 1.557 -.195(ve l)-.325 H 1.167
(ist the longest.).195 F 1.166(This is kno)7.667 F 1.166(wn as the)-.325
F/F4 13/Times-Bold@0 SF 1.763(Least Recently Used \(LR)33.336 609 R(U\))
-.39 E F1 5.014(ordering. The)5.013 F 1.764
(theory is that pages which ha)5.014 F 2.154 -.195(ve r)-.26 H(emained)
.195 E(inacti)33.336 624 Q .39 -.195(ve f)-.325 H
(or a long time will probably continue to be inacti).195 E -.195(ve)
-.325 G(.).195 E -.195(Fo)33.336 645 S 3.979(re).195 G .729(ach inacti)
-3.979 F 1.119 -.195(ve p)-.325 H .729(age scanned, the A).195 F .729
(CCESSED bit\(s\) is \(are\) check)-.52 F .729(ed ag)-.13 F 3.979
(ain. Note)-.065 F(that)3.979 E .432
(this bit is only cleared when the PFRA has visited the page from the)
33.336 660 R F2(active)3.683 E F1 .433(list, therefore)3.683 F 1.703
(if there has been an)33.336 675 R 4.953(ya)-.195 G 1.703(ccess whatsoe)
-4.953 F -.195(ve)-.325 G 4.953(rb).195 G 1.703
(etween the time that the page w)-4.953 F 1.703(as mo)-.13 F -.195(ve)
-.195 G 4.953(dt).195 G(o)-4.953 E(inacti)33.336 690 Q 1.498 -.195(ve a)
-.325 H 1.108(nd the time it w).195 F 1.108(as visited on the inacti)
-.13 F 1.499 -.195(ve l)-.325 H 1.109
(ist, this PTE bit will be set, and the).195 F .852(page is just mo)
33.336 705 R -.195(ve)-.195 G 4.102(db).195 G .852(ack to the acti)
-4.102 F 1.242 -.195(ve l)-.325 H 4.101(ist. Otherwise,).195 F .851
(the page will be reclaimed.)4.101 F .851(If the)7.351 F 3.56
(PTE indicates that the page is dirty)33.336 720 R 6.81(,aw)-.845 G 3.56
(rite-back to backing store is be)-6.81 F 6.811(gun. This)-.195 F 1.132
(operation might tak)33.336 735 R 4.382(eaw)-.13 G 1.132(hile, so)-4.382
F F3(kswapd)4.382 E F1 1.132
(continues to look at additional pages that are)4.382 F 0 Cg EP
%%Page: 38 38
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 38)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.132(not dirty)33.336 120 R 4.382(,u)
-.845 G 1.133(ntil it has reclaimed the desired number of pages.)-4.382
F -.195(Pa)7.633 G 1.133(ges which are not dirty).195 F 1.586
(can be reclaimed by simply immediately unmapping the PTE\(s\).)33.336
135 R -.195(Pa)8.086 G 1.586(ges which were in).195 F 5.295(the process\
 of being written back are unmapped when that writeback operation)33.336
150 R(concludes.)33.336 165 Q -.195(Pa)33.336 186 S .302
(ges that the PFRA has reclaimed are then placed on the free list.).195
F .301(Since the)6.801 F 3.551(ya)-.195 G .301(re placed)-3.551 F .891
(at the tail of the free list \(for a gi)33.336 201 R -.195(ve)-.325 G
4.141(nb).195 G .891(uddy order\) and the page allocator pulls from the)
-4.401 F 1.284
(front, this further enhances the notion of Least Recently Used.)33.336
216 R -.195(Pa)7.784 G 1.284(ges which are on the).195 F .602
(free list and ha)33.336 231 R -.195(ve)-.26 G(n').195 E 3.852(tb)-.234
G .602(een re-used b)-3.852 F .602(ut still contain v)-.26 F .602
(alid images can be pulled back of)-.325 F 3.853(fs)-.325 G(o)-3.853 E
(that a page f)33.336 246 Q(ault can be resolv)-.13 E(ed as a minor f)
-.195 E(ault.)-.13 E .784(The PFRA is adapti)33.336 267 R 1.174 -.195
(ve a)-.325 H .784(nd if it feels that it isn').195 F 4.033(tr)-.234 G
.783(eclaiming enough memory)-4.033 F 4.033(,i)-.845 G 4.033(ti)-4.033 G
(ncreases)-4.033 E 1.042(the rate at which it scans acti)33.336 282 R
1.432 -.195(ve p)-.325 H 1.042(ages, thus making the acti).195 F 1.042
(vity timeout windo)-.325 F 4.292(ws)-.325 G(horter)-4.292 E 2.907
(and increasing the pool of potential inacti)33.336 297 R 3.297 -.195
(ve p)-.325 H 6.157(ages. This).195 F 2.907(is a delicate balancing act)
6.157 F 3.167(because the PFRA/)33.336 312 R/F2 13/Courier@0 SF(kswapd)A
F1 3.167(consumes CPU resources in doing all of this scanning.)6.417 F
(Excessi)33.336 327 Q 2.94 -.195(ve s)-.325 H 2.55(canning w).195 F
2.549(astes CPU time, b)-.13 F 2.549(ut insuf)-.26 F 2.549
(\214cient reclamation can cause memory)-.325 F(starv)33.336 342 Q
(ation and se)-.325 E -.195(ve)-.325 G(re performance penalties.).195 E
(Lik)33.336 363 Q 7.494(es)-.13 G 4.245(cheduling, memory allocation an\
d reclamation algorithms are the subject of)-7.494 F -.195(ex)33.336 378
S(tensi).195 E .39 -.195(ve r)-.325 H(esearch and de).195 E -.195(ve)
-.325 G(lopment.).195 E/F3 13/Times-Bold@0 SF(Re)218.573 408 Q -.13(ve)
-.195 G(rse Mapping).13 E F1 -.195(Fo)33.336 444 S 3.959(ra).195 G 1.099
-.195(ny g)-3.959 H -2.795 -.325(iv e).195 H 3.959(np).325 G .709
(age frame, there may be multiple mappings for it.)-3.959 F .709(The k)
7.209 F .709(ernel must k)-.13 F(eep)-.13 E 2.426
(track of all of them and pre)33.336 459 R -.195(ve)-.325 G 2.426
(nt inconsistent vie).195 F 5.676(ws. F)-.325 F 2.427(or e)-.195 F 2.427
(xample, a gi)-.195 F -.195(ve)-.325 G 5.677(np).195 G 2.427(age may)
-5.677 F 2.079(appear as part of the virtual address space of one or mo\
re processes, correspond to a)33.336 474 R 2.206(particular of)33.336
489 R 2.206(fset in a particular memory-mapped \214le, and furthermore \
correspond to a)-.325 F 2.027(particular of)33.336 504 R 2.027
(fset within the hard disk storing that \214le.)-.325 F 2.027
(The PFRA, when visiting page)8.527 F .056
(frames, must be able to \214nd all e)33.336 519 R .057
(xisting mappings \(PTEs\) of that page so that it can locate)-.195 F
3.912(and possibly modify the PTEs.)33.336 534 R 5.992 -1.04(To v)10.412
H 3.912(isit the PTEs, the PFRA must determine the)1.04 F F2
(vm_area_struct)33.336 549 Q F1(and of)3.25 E(fset within that re)-.325
E(gion \(there could be multiple re)-.195 E(gions\).)-.195 E .542
(Either a page is mapped to a \214le, or it is anon)33.336 570 R 3.792
(ymous. These)-.195 F(tw)3.792 E 3.792(oc)-.13 G .542
(onditions are mutually)-3.792 F -.195(ex)33.336 585 S(clusi).195 E
-.195(ve)-.325 G 8.031(.T).195 G(he)-8.031 E F2(mapping)4.781 E F1 1.53
(\214eld of the page descriptor contains a pointer to one of tw)4.781 F
(o)-.13 E .103(objects which will help with the re)33.336 600 R -.195
(ve)-.325 G .103(rse mapping.).195 F .103
(If the least signi\214cant bit is 1, the page)6.603 F 1.351(is anon)
33.336 615 R 1.351(ymous and)-.195 F F2 1.35(mapping &~01)4.6 F F1 1.35
(points to a)4.6 F F2 1.35(struct anon_vma)4.6 F F1 7.85(.I)C 4.6(ft)
-7.85 G 1.35(he lsb is 0,)-4.6 F .1(the page maps to a \214le and)33.336
630 R F2(mapping)3.35 E F1 .1(points to a)3.35 F F2 .101
(struct address_space)3.351 F F1 .101(object for)3.351 F 2.747
(the \214le.)33.336 645 R 2.747(This use of the least signi\214cant bit\
 is a programming trick: because k)9.247 F(ernel)-.13 E 1.036
(pointers are al)33.336 660 R -.13(wa)-.13 G 1.036
(ys aligned on 4-byte boundaries, the least signi\214cant bit can be w)
.13 F(asted)-.13 E(for this purpose.)33.336 675 Q F3(Anonymous Mappings)
204.669 705 Q F1(The)33.336 741 Q F2(anon_vma)5.284 E F1 2.034
(is simply the head of a doubly-link)5.284 F 2.034
(ed circular list of memory re)-.13 F(gion)-.195 E 0 Cg EP
%%Page: 39 39
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 39)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.799(descriptors \()33.336 120 R/F2 13
/Courier@0 SF(vm_area_struct)A F1 1.799(\), chaining through the)B F2
(anon_vma_node)5.05 E F1 1.8(pointers in)5.05 F .215(the latter)33.336
135 R 6.715(.F)-.715 G .215(urthermore, the)-6.715 F F2(vm_area_struct)
3.465 E F1 .214(contains a pointer \()3.465 F F2(anon_vma)A F1 3.464
(\)b)C .214(ack to)-3.464 F(the)33.336 150 Q F2(anon_vma)4.044 E F1 .795
(list head.)4.044 F .795
(More often than not, the list contains just one memory re)7.295 F(gion)
-.195 E(descriptor)33.336 165 Q 7.684(.H)-.715 G -.325(ow)-7.684 G
-2.795 -.325(ev e).325 H 2.224 -.52(r, w).325 H 1.184(hen a re).52 F
1.184(gion becomes shared \(e.g. after a fork\) this list contains)-.195
F 4.954(each re)33.336 180 R 4.955
(gion in each process which refers to it.)-.195 F 4.955
(This will also be the case for)11.455 F 4.253(MAP_SHARED re)33.336 195
R 4.253(gions that were inherited via fork.)-.195 F 4.252
(Therefore, each)10.752 F F2(anon_vma)7.502 E F1 3.585
(structure represents one anon)33.336 210 R 3.585
(ymous virtual memory re)-.195 F 3.586(gion \(which might be shared)
-.195 F(among multiple processes\).)33.336 225 Q 5.263(Ap)33.336 246 S
2.013(rocess data re)-5.263 F 2.013(gion or other MAP_PRIV)-.195 F
-1.443(AT)-1.755 G 5.263<458c>1.443 G 2.013
(le mappings might \214nd itself on the)-5.263 F F2(anon_vma)33.336 261
Q F1 1.489
(list and also part of a \214le mapping, because some pages in the re)
4.738 F 1.489(gion still)-.195 F 1.224(correspond to the \214le, b)
33.336 276 R 1.224(ut some ha)-.26 F 1.614 -.195(ve b)-.26 H 1.224
(een written to making them anon).195 F 4.474(ymous. W)-.195 F(ithin)
-.52 E .154(this re)33.336 291 R .154
(gion, mapped-in pages are either "vir)-.195 F .154
(gin" and still correspond to the original \214le, or)-.234 F(the)33.336
306 Q 4.532(yh)-.195 G -2.925 -.26(av e)-4.532 H 1.282
(been dirtied and are no)4.792 F 4.531(wb)-.325 G(ack)-4.531 E 1.281
(ed by sw)-.13 F 1.281(ap space.)-.13 F 1.281
(This distinction is captured)7.781 F 2.191
(via the least signi\214cant bit of the)33.336 321 R F2(mapping)5.441 E
F1 2.192(\214eld of the page descriptor as described)5.441 F(abo)33.336
336 Q -.195(ve)-.195 G(.).195 E .753(The PFRA, after getting the)33.336
357 R F2(anon_vma)4.002 E F1 .752(list start from the page descriptor)
4.002 F 4.002(,c)-.52 G .752(an w)-4.002 F .752(alk the)-.13 F(link)
33.336 372 Q 4.76(ed list anchored by the)-.13 F F2 4.76
(struct anon_vma)8.01 F F1 4.761(and visit each memory re)8.01 F(gion)
-.195 E(\()33.336 387 Q F2(vm_area_struct)A F1 4.209(\)w)C .959
(hich maps that page, which gi)-4.209 F -.195(ve)-.325 G 4.208(st).195 G
.958(he starting virtual address of)-4.208 F .43(the that re)33.336 402
R 3.68(gion. The)-.195 F F2(index)3.68 E F1 .431
(\214eld of the page descriptor gi)3.68 F -.195(ve)-.325 G 3.681(st).195
G .431(he of)-3.681 F .431(fset, in pages, of that)-.325 F .202
(particular page within the re)33.336 417 R 3.452(gion. The)-.195 F F2
(pgd)3.452 E F1 .202(\214eld of the)3.452 F F2 .202(struct mm_struct)
3.452 F F1 3.452(,w)C .202(hich in)-3.452 F .492
(turn is accessible from the vm_area_struct, gi)33.336 432 R -.195(ve)
-.325 G 3.742(st).195 G .492(he address of the page global directory)
-3.742 F .114(for the process.)33.336 447 R .114(It is no)6.614 F 3.364
(wat)-.325 G(ri)-3.364 E .114(vial matter to w)-.325 F .114
(alk through the page table structure and \214nd)-.13 F(the PTE.)33.336
462 Q/F3 13/Times-Bold@0 SF(Swap Space and anonymous page-outs)160.43
492 Q F1 3.5(When an anon)33.336 528 R 3.501
(ymous page is selected for reclamation, the Dirty bit of the PTE is)
-.195 F -.195(ex)33.336 543 S 3.906(amined. If).195 F .656
(set, then the page has been written to and therefore must be sa)3.906 F
-.195(ve)-.26 G 3.905(dt).195 G(o)-3.905 E F3(swap)3.905 E(space)33.336
558 Q F1 10.71(.T)C 4.21(he k)-10.71 F 4.21
(ernel maintains one or more sw)-.13 F 4.21
(ap areas, which are either ra)-.13 F 7.46(wd)-.195 G(isk)-7.46 E .292(\
partitions, or \214les, in either case prepared with the system utility\
 command)33.336 573 R F2(mkswap)3.542 E F1 3.542(,a)C(nd)-3.542 E
(then made a)33.336 588 Q -.325(va)-.26 G(ilable as part of sw).325 E
(ap space with the)-.13 E F2(swapon)3.25 E F1(command.)3.25 E(Anon)
33.336 609 Q .693(ymous pages aren')-.195 F 3.943(tm)-.234 G .693
(eant to be persistent, and so sw)-3.943 F .693
(ap space is just a pool of disk)-.13 F 1.348
(space where we can stash them.)33.336 624 R 1.348
(There is nothing within a sw)7.848 F 1.347(ap area which w)-.13 F 1.347
(ould tell)-.13 F .2(one the identities of the page images.)33.336 639 R
.2(That information is k)6.7 F .2(ept by the k)-.13 F .2
(ernel in RAM and)-.13 F 2.166(simply discarded when the system halts.)
33.336 654 R 2.166(The k)8.666 F 2.166(ernel maintains an array of sw)
-.13 F 2.166(ap area)-.13 F 3.172
(descriptors, each of which includes a free map.)33.336 669 R 3.172
(Each slot of a free map gi)9.672 F -.195(ve)-.325 G 6.422(st).195 G(he)
-6.422 E(reference count of the corresponding page-sized slot of the co\
rresponding sw)33.336 684 Q(ap area.)-.13 E 5.861(Ap)33.336 705 S 2.611
(articular page frame containing an anon)-5.861 F 2.611
(ymous page may be mapped by multiple)-.195 F .088
(PTEs in one or more processes.)33.336 720 R .088
(Therefore, when that page frame is sw)6.588 F .089(apped out, ALL of)
-.13 F 1.571(the PTE must be mark)33.336 735 R 1.571(ed as not present.)
-.13 F 4.821(Af)8.071 G 1.571(ree slot in some sw)-4.821 F 1.57
(ap area is chosen \(the)-.13 F 0 Cg EP
%%Page: 40 40
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 40)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.528(algorithm to do so k)33.336 120 R
1.529(eeps things such as disk I/O performance in mind\).)-.13 F 1.529
(Free slots are)8.029 F .827(indicated by a sw)33.336 135 R .827
(ap map entry of 0.)-.13 F .827(Once the slot is allocated, the sw)7.327
F .826(ap map entry will)-.13 F(re\215ect the number of mappings that h\
ad been pointing at that shared page frame.)33.336 150 Q(No)33.336 171 Q
3.909(wt)-.325 G .659(he Linux k)-3.909 F .659
(ernel uses a slightly dirty trick.)-.13 F .66(The sw)7.16 F .66
(ap area number \(a 7-bit inte)-.13 F(ger\))-.195 E .734(combined with \
the slot number within the area form a unique identi\214er of the sw)
33.336 186 R .734(ap slot.)-.13 F .945(24 bits are allo)33.336 201 R
.946(wed for the slot number)-.325 F 4.196(,m)-.52 G .946
(eaning the maximum size of one sw)-4.196 F .946(ap area is)-.13 F 1.087
(2^24*2^12=2^36 or 64 GB.)33.336 216 R 1.087(The total amount of sw)
7.587 F 1.087(ap space on the system is limited to)-.13 F
(2^\(36+7\) = 8 TB.)33.336 231 Q(Gi)33.336 252 Q -.195(ve)-.325 G 7.617
(nt).195 G 4.367(his information, the page f)-7.617 F 4.367
(ault handler can, when the page is once ag)-.13 F(ain)-.065 E .022
(referenced, \214nd the corresponding sw)33.336 267 R .022
(ap slot on disk and read it in.)-.13 F .021(This sw)6.521 F .021
(ap identi\214er is)-.13 F 1.435
(stored in each PTE which had mapped the sw)33.336 282 R 1.435
(apped-out page.)-.13 F 1.436(There are 31 bits in the)7.935 F 1.173
(identi\214er and a PTE is 32 bits.)33.336 297 R 1.172(The Linux k)7.672
F 1.172(ernel packs the bits into the PTE in such a)-.13 F -.13(wa)
33.336 312 S 3.663(yt).13 G .413(hat the Present \215ag is al)-3.663 F
-.13(wa)-.13 G .414
(ys 0, and the remaining 31 bits are scattered between the).13 F 2.616
(PFN and the Flags \214elds.)33.336 327 R 2.615(It isn')9.116 F 5.865
(tav)-.234 G 2.615(alid PTE b)-6.19 F 2.615
(ut since the Present bit is OFF)-.26 F 5.865(,t)-1.04 G(he)-5.865 E
(hardw)33.336 342 Q 1.263(are will ne)-.13 F -.195(ve)-.325 G 4.514(rl)
.195 G 1.264(ook at it or touch it.)-4.514 F 1.264
(\(On X86-64, there are 63 bits of the PTE to)7.764 F
(play with for encoding a sw)33.336 357 Q(ap area and sw)-.13 E
(ap slot....that')-.13 E 3.25(saL)-.715 G 1.04 -.52(OT o)-3.25 H 3.25
(fs).52 G -.13(wa)-3.25 G 3.25(ps).13 G(pace!\))-3.25 E/F2 13
/Times-Bold@0 SF(File Mappings)227.426 402 Q F1 -.195(Fo)33.336 438 S
4.198<728c>.195 G .948(les which are mapped into memory)-4.198 F 4.197
(,i)-.845 G 4.197(ti)-4.197 G 4.197(si)-4.197 G .947
(mportant to be able to locate quickly the)-4.197 F 1.03
(page frame which currently contains a particular \(page-aligned\) of)
33.336 453 R 1.031(fset in the \214le, and/or)-.325 F .587
(to determine that no such page is currently resident.)33.336 468 R .587
(Consider the)7.087 F/F3 13/Courier@0 SF(read)3.837 E F1 .586
(system call, the)3.837 F 2.006(semantics of which must w)33.336 483 R
2.006(ork correctly and transparently with memory-mapped \214les.)-.13 F
F3(read)33.336 498 Q F1 .993(amounts to \214nding the page frame which \
holds that part of the \214le \(if there is no)4.243 F .815(such frame,\
 ask the \214lesystem to bring it in from disk and sleep until that hap\
pens\), and)33.336 513 R(then cop)33.336 528 Q
(ying the requested portion of that page into the user b)-.13 E(uf)-.26
E(fer)-.325 E(.)-.715 E(Lik)33.336 549 Q -.325(ew)-.13 G 3.125
(ise, when f).325 F 3.124
(aulting-in a memory-mapped \214le, it could be that the same \(page-)
-.13 F 1.684(aligned\) area of the \214le has recently been accessed fr\
om the same or dif)33.336 564 R 1.685(ferent process)-.325 F .712
(using the read or write system call, in which case the f)33.336 579 R
.712(ault can be resolv)-.13 F .712(ed a minor f)-.195 F(ault)-.13 E
(by pointing the PTE at the e)33.336 594 Q
(xisting page frame which contains that image.)-.195 E(An)33.336 615 Q
F3(address_space)4.995 E F1 1.745(structure is used to pro)4.995 F 1.745
(vide this quick lookup.)-.195 F 1.745(One of these is)8.245 F .03
(allocated for e)33.336 630 R -.195(ve)-.325 G .03(ry open inode.).195 F
.029(It has man)6.529 F 3.279<798c>-.195 G .029(elds, b)-3.279 F .029
(ut among them are tw)-.26 F 3.279(ot)-.13 G .029(ypes of trees.)-3.279
F 1.35(One is a \215e)33.336 645 R 1.35(xible radix-64 tree which, gi)
-.195 F -.195(ve)-.325 G 4.6(na).195 G 4.6(no)-4.6 G -.325(ff)-4.6 G
1.351(set \(in page-sized units\) into the \214le,).325 F .408(\214nds \
the struct page corresponding to that part of the \214le, or NULL if th\
ere is none such.)33.336 660 R .536
(Each node of the radix-64 tree has 64 pointers.)33.336 675 R .536
(If the \214le size is 256K or less \(64*4096\))7.036 F 1.051
(then the entire \214le')33.336 690 R 4.3(sa)-.715 G 1.05
(ddress space is handled by a single-le)-4.3 F -.195(ve)-.325 G 4.3(lt)
.195 G 4.3(ree. Otherwise,)-4.3 F 1.05(the tree)4.3 F(gro)33.336 705 Q
3.66(ws. A)-.325 F(tw)3.66 E(o-le)-.13 E -.195(ve)-.325 G 3.66(lt).195 G
.41(ree can handle \(64*64*4096\) or 16MB of \214le addressing, etc.)
-3.66 F .411(up to)6.911 F 3.25(6l)33.336 720 S -2.795 -.325(ev e)-3.25
H(ls.).325 E/F4 10/Courier@0 SF(struct address_space {)33.336 732 Q
(/* /usr/src/linux/include/linux/fs.h */)98.4 E 0 Cg EP
%%Page: 41 41
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 41)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF(struct inode)81.336 117 Q 54(*host; /*)72 F
(owner: inode, block_device */)6 E(struct radix_tree_root)81.336 129 Q
30(page_tree; /*)12 F(radix tree of all pages */)6 E 78
(spinlock_t tree_lock;)81.336 141 R(/* and lock protecting it */)36 E
(unsigned int)81.336 153 Q
(i_mmap_writable;/* count VM_SHARED mappings */)72 E
(struct prio_tree_root)81.336 165 Q 48(i_mmap; /*)18 F
(tree of private and shared mappings */)6 E 78(spinlock_t i_mmap_lock;)
81.336 177 R(/* protect tree, count, list */)24 E(unsigned long)81.336
189 Q 42(nrpages; /*)66 F(number of total pages */)6 E
(/* some other fields elided for simplicity */)90.936 201 Q(};)33.336
213 Q/F2 13/Times-Roman@0 SF .171
(While the radix tree is great for going from a kno)33.336 234 R .17
(wn of)-.325 F .17(fset in the \214le to a page descriptor)-.325 F(,)
-.52 E 1.859(the PFRA is trying to go a dif)33.336 249 R 1.859(ferent w)
-.325 F 5.109(ay: \214nd)-.13 F 1.859
(all PTEs which refer to this particular)5.109 F(of)33.336 264 Q 1.397
(fset within the \214le.)-.325 F(The)7.897 E/F3 13/Courier@0 SF
(address_space)4.647 E F2 1.397(pointer of the)4.647 F F3 1.397
(struct page)4.647 F F2(identi\214es)4.646 E .484(the \214le, and the)
33.336 279 R F3(index)3.734 E F2 .484(\214eld gi)3.734 F -.195(ve)-.325
G 3.734(st).195 G .484(he of)-3.734 F .484
(fset in pages within the \214le.)-.325 F 3.735(As)6.985 G .485
(imple approach)-3.735 F -.13(wo)33.336 294 S 2.333
(uld be to link all re).13 F 2.333
(gions mapping to the \214le into a link)-.195 F 2.332
(ed list, as is done for the)-.13 F F3(anon_vma)33.336 309 Q F2 3.453
(structure. Ho)3.453 F(we)-.325 E -.195(ve)-.325 G 1.243 -.52(r, w).195
H .203(hile sharing of an anon).52 F .203(ymous re)-.195 F .204
(gion is usually limited)-.195 F 2.796(to a small number of processes, \
memory-mapped \214les, especially those containing a)33.336 324 R 3.936
(common e)33.336 339 R -.195(xe)-.195 G 3.936
(cutable, are shared by man).195 F 7.187(yp)-.195 G 7.187
(rocesses. There)-7.187 F 3.937(can also potentially be)7.187 F .497
(multiple mappings to dif)33.336 354 R .497
(ferent parts of one \214le \(consider an a.out \214le where the .te)
-.325 F .496(xt and)-.195 F(.data section are mapped separately\).)
33.336 369 Q .548(Linux uses a Priority Search T)33.336 390 R .548
(ree for)-.455 F/F4 13/Times-Italic@0 SF(eac)3.798 E 3.798<688c>-.195 G
(le)-3.798 E F2 7.048(.I)C 3.798(ti)-7.048 G 3.798(sa)-3.798 G .548
(ccessed via the)-3.798 F F3(address_space)3.798 E F2(structure')33.336
405 Q(s)-.715 E F3(i_mmap)5.602 E F2(pointer)5.602 E 5.602(,a)-.52 G
2.352(nd can quickly answer the follo)-5.602 F 2.352(wing question: "gi)
-.325 F -.195(ve)-.325 G 5.601(na).195 G .02(particular of)33.336 420 R
.021(fset within the \214le, tell me all memory re)-.325 F .021
(gions which contain it.")-.195 F .021(I.e. the PST)6.521 F 2.951
(sorts the mapping re)33.336 435 R 2.951(gions by their starting of)
-.195 F 6.201(fset. The)-.325 F 2.951(PFRA e)6.201 F 2.951
(xamines all memory)-.195 F(re)33.336 450 Q 1.467
(gion descriptors which map to the page.)-.195 F 1.467
(Each descriptor contains the starting virtual)7.967 F 4.194
(address of the re)33.336 465 R 4.194(gion, and the corresponding of)
-.195 F 4.193(fset within the \214le \(this is in the)-.325 F F3
(vm_pgoff)33.336 480 Q F2 3.27(\214eld\). No)3.27 F 3.27(wt)-.325 G .02
(he of)-3.27 F .02(fset of the page within the re)-.325 F .021
(gion can be readily calculated,)-.195 F
(and from there the PTE can be found.)33.336 495 Q 4.848<418c>33.336 516
S 1.597(le-mapped page which needs to be paged out and which is dirty m\
ust be part of a)-4.848 F .127(MAP_SHARED \214le-mapped re)33.336 531 R
.127(gion \(if it were MAP_PRIV)-.195 F -1.443(AT)-1.755 G .128
(E, the dirty pages w)1.443 F .128(ould be)-.13 F .452(paged-out to sw)
33.336 546 R 3.702(ap\). W)-.13 F 3.702(ek)-1.04 G(no)-3.702 E 3.701(wf)
-.325 G .451(rom the)-3.701 F F3(mapping)3.701 E F2 .451(and the)3.701 F
F3(index)3.701 E F2 .451(\214elds of the)3.701 F F3(struct)3.701 E(page)
33.336 561 Q F2 .502(the \214le and the of)3.752 F .502
(fset within that \214le where the page needs to go.)-.325 F .503
(So paging-out a)7.003 F 2.488(\214le-mapped dirty page in)33.336 576 R
-.26(vo)-.52 G(lv).26 E 2.488
(es asking the underlying \214lesystem module to write the)-.195 F
(page to that of)33.336 591 Q(fset within the \214le on the disk.)-.325
E 0 Cg EP
%%Page: 42 42
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 42)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E 0 0 468 824 -571.369 1006 33.336 691.369 PBEGIN
%%BeginDocument: procaddr.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: procaddr.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Fri Nov 11 01:57:12 2016
%%For: hak@lex ()
%%BoundingBox: 0 0 824 1006
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 1006 moveto 0 0 lineto 824 0 lineto 824 1006 lineto closepath clip newpath
-38.9 1050.2 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
/Times-BoldItalic /Times-BoldItalic-iso isovec ReEncode
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
7.500 slw
n 2280 5280 m
 3600 5280 l gs col0 s gr 
% Polyline
n 2280 5520 m
 3600 5520 l gs col0 s gr 
% Polyline
n 2280 5760 m
 3600 5760 l gs col0 s gr 
% Polyline
n 2280 6420 m
 3600 6420 l gs col0 s gr 
% Polyline
n 2280 6600 m
 3600 6600 l gs col0 s gr 
% Polyline
n 2280 6840 m
 3600 6840 l gs col0 s gr 
% Polyline
n 2280 7080 m
 3600 7080 l gs col0 s gr 
% Polyline
n 2280 7320 m
 3600 7320 l gs col0 s gr 
% Polyline
n 2280 4740 m 3600 4740 l 3600 8340 l 2280 8340 l
 cp gs col0 s gr 
% Polyline
n 2280 5040 m
 3600 5040 l gs col0 s gr 
% Polyline
n 2280 7920 m
 3600 7920 l gs col0 s gr 
% Polyline
n 2280 7680 m
 3600 7680 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
2880 5220 m
gs 1 -1 sc (vm_start) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 5445 m
gs 1 -1 sc (vm_end) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 5670 m
gs 1 -1 sc (vm_prot) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 6570 m
gs 1 -1 sc (vm_fille) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 6795 m
gs 1 -1 sc (vm_pgoff) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 7245 m
gs 1 -1 sc (anon_vma) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2940 4620 m
gs 1 -1 sc (vm_area_struct) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 4980 m
gs 1 -1 sc (vm_mm) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 7860 m
gs 1 -1 sc (vm_next) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2940 7500 m
gs 1 -1 sc (anon_vma_node) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 5580 5340 m
 6900 5340 l gs col0 s gr 
% Polyline
n 5580 5580 m
 6900 5580 l gs col0 s gr 
% Polyline
n 5580 5820 m
 6900 5820 l gs col0 s gr 
% Polyline
n 5580 6480 m
 6900 6480 l gs col0 s gr 
% Polyline
n 5580 6660 m
 6900 6660 l gs col0 s gr 
% Polyline
n 5580 6900 m
 6900 6900 l gs col0 s gr 
% Polyline
n 5580 7140 m
 6900 7140 l gs col0 s gr 
% Polyline
n 5580 7380 m
 6900 7380 l gs col0 s gr 
% Polyline
n 5580 4800 m 6900 4800 l 6900 8400 l 5580 8400 l
 cp gs col0 s gr 
% Polyline
n 5580 5100 m
 6900 5100 l gs col0 s gr 
% Polyline
n 5580 7980 m
 6900 7980 l gs col0 s gr 
% Polyline
n 5580 7740 m
 6900 7740 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
6180 5280 m
gs 1 -1 sc (vm_start) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6180 5505 m
gs 1 -1 sc (vm_end) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6180 5730 m
gs 1 -1 sc (vm_prot) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6180 6630 m
gs 1 -1 sc (vm_fille) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6180 6855 m
gs 1 -1 sc (vm_pgoff) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6180 7305 m
gs 1 -1 sc (anon_vma) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6240 4680 m
gs 1 -1 sc (vm_area_struct) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6180 5040 m
gs 1 -1 sc (vm_mm) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6180 7920 m
gs 1 -1 sc (vm_next) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6240 7560 m
gs 1 -1 sc (anon_vma_node) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 8520 5340 m
 9840 5340 l gs col0 s gr 
% Polyline
n 8520 5580 m
 9840 5580 l gs col0 s gr 
% Polyline
n 8520 5820 m
 9840 5820 l gs col0 s gr 
% Polyline
n 8520 6480 m
 9840 6480 l gs col0 s gr 
% Polyline
n 8520 6660 m
 9840 6660 l gs col0 s gr 
% Polyline
n 8520 6900 m
 9840 6900 l gs col0 s gr 
% Polyline
n 8520 7140 m
 9840 7140 l gs col0 s gr 
% Polyline
n 8520 7380 m
 9840 7380 l gs col0 s gr 
% Polyline
n 8520 4800 m 9840 4800 l 9840 8400 l 8520 8400 l
 cp gs col0 s gr 
% Polyline
n 8520 5100 m
 9840 5100 l gs col0 s gr 
% Polyline
n 8520 7980 m
 9840 7980 l gs col0 s gr 
% Polyline
n 8520 7740 m
 9840 7740 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
9120 5280 m
gs 1 -1 sc (vm_start) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9120 5505 m
gs 1 -1 sc (vm_end) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9120 5730 m
gs 1 -1 sc (vm_prot) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9120 6630 m
gs 1 -1 sc (vm_fille) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9120 6855 m
gs 1 -1 sc (vm_pgoff) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9120 7305 m
gs 1 -1 sc (anon_vma) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9180 4680 m
gs 1 -1 sc (vm_area_struct) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9120 5040 m
gs 1 -1 sc (vm_mm) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9120 7920 m
gs 1 -1 sc (vm_next) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9180 7560 m
gs 1 -1 sc (anon_vma_node) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 10980 5340 m
 12300 5340 l gs col0 s gr 
% Polyline
n 10980 5580 m
 12300 5580 l gs col0 s gr 
% Polyline
n 10980 5820 m
 12300 5820 l gs col0 s gr 
% Polyline
n 10980 6480 m
 12300 6480 l gs col0 s gr 
% Polyline
n 10980 6660 m
 12300 6660 l gs col0 s gr 
% Polyline
n 10980 6900 m
 12300 6900 l gs col0 s gr 
% Polyline
n 10980 7140 m
 12300 7140 l gs col0 s gr 
% Polyline
n 10980 7380 m
 12300 7380 l gs col0 s gr 
% Polyline
n 10980 4800 m 12300 4800 l 12300 8400 l 10980 8400 l
 cp gs col0 s gr 
% Polyline
n 10980 5100 m
 12300 5100 l gs col0 s gr 
% Polyline
n 10980 7980 m
 12300 7980 l gs col0 s gr 
% Polyline
n 10980 7740 m
 12300 7740 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
11580 5280 m
gs 1 -1 sc (vm_start) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11580 5505 m
gs 1 -1 sc (vm_end) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11580 5730 m
gs 1 -1 sc (vm_prot) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11580 6630 m
gs 1 -1 sc (vm_fille) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11580 6855 m
gs 1 -1 sc (vm_pgoff) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11580 7305 m
gs 1 -1 sc (anon_vma) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11640 4680 m
gs 1 -1 sc (vm_area_struct) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11580 5040 m
gs 1 -1 sc (vm_mm) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11580 7920 m
gs 1 -1 sc (vm_next) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11640 7560 m
gs 1 -1 sc (anon_vma_node) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 10920 10800 m 12900 10800 l 12900 11160 l 10920 11160 l
 cp gs col0 s gr 
% Polyline
n 10920 11160 m 12900 11160 l 12900 11400 l 10920 11400 l
 cp gs col0 s gr 
% Polyline
n 10920 11400 m 12900 11400 l 12900 11640 l 10920 11640 l
 cp gs col0 s gr 
% Polyline
n 10920 10500 m 12900 10500 l 12900 12000 l 10920 12000 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
11760 11100 m
gs 1 -1 sc (mapping) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 11325 m
gs 1 -1 sc (index) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 11550 m
gs 1 -1 sc (LRU) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 10920 12360 m 12900 12360 l 12900 12720 l 10920 12720 l
 cp gs col0 s gr 
% Polyline
n 10920 12720 m 12900 12720 l 12900 12960 l 10920 12960 l
 cp gs col0 s gr 
% Polyline
n 10920 12960 m 12900 12960 l 12900 13200 l 10920 13200 l
 cp gs col0 s gr 
% Polyline
n 10920 12060 m 12900 12060 l 12900 13560 l 10920 13560 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
11760 12660 m
gs 1 -1 sc (mapping) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 12885 m
gs 1 -1 sc (index) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 13110 m
gs 1 -1 sc (LRU) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 10920 13980 m 12900 13980 l 12900 14340 l 10920 14340 l
 cp gs col0 s gr 
% Polyline
n 10920 14340 m 12900 14340 l 12900 14580 l 10920 14580 l
 cp gs col0 s gr 
% Polyline
n 10920 14580 m 12900 14580 l 12900 14820 l 10920 14820 l
 cp gs col0 s gr 
% Polyline
n 10920 13680 m 12900 13680 l 12900 15180 l 10920 15180 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
11760 14280 m
gs 1 -1 sc (mapping) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 14505 m
gs 1 -1 sc (index) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 14730 m
gs 1 -1 sc (LRU) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 10920 15600 m 12900 15600 l 12900 15960 l 10920 15960 l
 cp gs col0 s gr 
% Polyline
n 10920 15960 m 12900 15960 l 12900 16200 l 10920 16200 l
 cp gs col0 s gr 
% Polyline
n 10920 16200 m 12900 16200 l 12900 16440 l 10920 16440 l
 cp gs col0 s gr 
% Polyline
n 10920 15300 m 12900 15300 l 12900 16800 l 10920 16800 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
11760 15900 m
gs 1 -1 sc (mapping) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 16125 m
gs 1 -1 sc (index) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 16350 m
gs 1 -1 sc (LRU) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 10920 9180 m 12900 9180 l 12900 9540 l 10920 9540 l
 cp gs col0 s gr 
% Polyline
n 10920 9540 m 12900 9540 l 12900 9780 l 10920 9780 l
 cp gs col0 s gr 
% Polyline
n 10920 9780 m 12900 9780 l 12900 10020 l 10920 10020 l
 cp gs col0 s gr 
% Polyline
n 10920 8880 m 12900 8880 l 12900 10380 l 10920 10380 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
11760 9480 m
gs 1 -1 sc (mapping) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 9705 m
gs 1 -1 sc (index) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 9930 m
gs 1 -1 sc (LRU) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 5520 9120 m 6780 9120 l 6780 9540 l 5520 9540 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
6000 9060 m
gs 1 -1 sc (anon_vma) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 7740 9180 m 9000 9180 l 9000 9600 l 7740 9600 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
8220 9120 m
gs 1 -1 sc (anon_vma) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 9240 8940 m 10500 8940 l 10500 9360 l 9240 9360 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
9720 8880 m
gs 1 -1 sc (anon_vma) dup sw pop 2 div neg 0 rm  col0 sh gr
% Polyline
n 10050 2040 m 10950 2040 l 10950 2340 l 10050 2340 l
 cp gs col0 s gr 
% Polyline
n 10050 1500 m 10950 1500 l 10950 3960 l 10050 3960 l
 cp gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
10470 900 m
gs 1 -1 sc (Page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10470 1125 m
gs 1 -1 sc (Table) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10410 2280 m
gs 1 -1 sc (PTE) dup sw pop 2 div neg 0 rm  col0 sh gr
% Arc
gs  clippath
2133 4798 m 2078 4774 l 2016 4912 l 2093 4815 l 2071 4936 l cp
eoclip
 [60] 0 sd
n 13938.1 10135.5 12984.9 166.3 -155.7 arc
gs col0 s gr
 gr
 [] 0 sd
% arrowhead
n 2071 4936 m 2093 4815 l 2016 4912 l  col0 s
% Arc
gs  clippath
5612 7433 m 5555 7417 l 5513 7563 l 5575 7456 l 5571 7579 l cp
5432 9439 m 5491 9430 l 5467 9280 l 5457 9404 l 5408 9290 l cp
eoclip
n 9760.2 8687.0 4362.2 170.3 -163.4 arc
gs col0 s gr
 gr

% arrowhead
n 5571 7579 m 5575 7456 l 5513 7563 l  col0 s
% arrowhead
n 5408 9290 m 5457 9404 l 5467 9280 l  col0 s
% Arc
gs  clippath
6901 7526 m 6872 7579 l 7005 7652 l 6915 7568 l 7034 7599 l cp
6755 9277 m 6776 9333 l 6917 9278 l 6795 9294 l 6895 9222 l cp
eoclip
n 6508.1 8407.1 933.4 73.1 -65.2 arcn
gs col0 s gr
 gr

% arrowhead
n 7034 7599 m 6915 7568 l 7005 7652 l  col0 s
% arrowhead
n 6895 9222 m 6795 9294 l 6917 9278 l  col0 s
% Polyline
n 3600 2400 m
 4920 2400 l gs col0 s gr 
% Polyline
n 3600 2760 m
 4920 2760 l gs col0 s gr 
% Polyline
n 6000 1380 m 7380 1380 l 7380 4200 l 6000 4200 l
 cp gs col0 s gr 
% Polyline
n 6000 3360 m 7380 3360 l 7380 3720 l 6000 3720 l
 cp gs col0 s gr 
% Polyline
n 6000 2220 m 7380 2220 l 7380 2580 l 6000 2580 l
 cp gs col0 s gr 
% Polyline
gs  clippath
8426 1760 m 8400 1706 l 8264 1773 l 8385 1747 l 8291 1827 l cp
eoclip
n 7080 2400 m
 8400 1740 l gs col0 s gr gr

% arrowhead
n 8291 1827 m 8385 1747 l 8264 1773 l  col0 s
% Polyline
n 8460 1680 m 9360 1680 l 9360 3840 l 8460 3840 l
 cp gs col0 s gr 
% Polyline
n 8460 2460 m 9360 2460 l 9360 2760 l 8460 2760 l
 cp gs col0 s gr 
% Polyline
gs  clippath
10081 1510 m 10038 1468 l 9932 1577 l 10038 1512 l 9975 1618 l cp
eoclip
n 8940 2640 m
 10050 1500 l gs col0 s gr gr

% arrowhead
n 9975 1618 m 10038 1512 l 9932 1577 l  col0 s
% Polyline
gs  clippath
5970 1453 m 5932 1407 l 5815 1504 l 5927 1451 l 5853 1550 l cp
eoclip
n 4560 2580 m
 5940 1440 l gs col0 s gr gr

% arrowhead
n 5853 1550 m 5927 1451 l 5815 1504 l  col0 s
% Polyline
gs  clippath
5912 1612 m 5854 1598 l 5820 1746 l 5876 1636 l 5878 1759 l cp
eoclip
n 3540 4920 m 5280 4260 l
 5880 1620 l gs col0 s gr gr

% arrowhead
n 5878 1759 m 5876 1636 l 5820 1746 l  col0 s
% Polyline
n 3600 1200 m 4920 1200 l 4920 3360 l 3600 3360 l
 cp gs col0 s gr 
% Polyline
gs  clippath
2355 7830 m 2355 7770 l 2203 7770 l 2323 7800 l 2203 7830 l cp
eoclip
n 6000 3600 m 1740 3600 l 1800 7800 l
 2340 7800 l gs col0 s gr gr

% arrowhead
n 2203 7830 m 2323 7800 l 2203 7770 l  col0 s
% Polyline
n 2340 9120 m 3600 9120 l 3600 10740 l 2340 10740 l
 cp gs col0 s gr 
% Polyline
n 2340 9120 m 3600 9120 l 3600 9480 l 2340 9480 l
 cp gs col0 s gr 
% Polyline
gs  clippath
3641 9091 m 3648 9151 l 3798 9134 l 3676 9118 l 3791 9074 l cp
eoclip
n 3540 6480 m 4200 6480 l 4200 9060 l
 3660 9120 l gs col0 s gr gr

% arrowhead
n 3791 9074 m 3676 9118 l 3798 9134 l  col0 s
% Polyline
gs  clippath
10995 7890 m 10995 7830 l 10843 7830 l 10963 7860 l 10843 7890 l cp
eoclip
n 9780 7860 m
 10980 7860 l gs col0 s gr gr

% arrowhead
n 10843 7890 m 10963 7860 l 10843 7830 l  col0 s
% Polyline
gs  clippath
4233 8979 m 4260 9033 l 4395 8966 l 4275 8993 l 4368 8912 l cp
eoclip
n 5580 6600 m 4860 6600 l 4860 8700 l
 4260 9000 l gs col0 s gr gr

% arrowhead
n 4368 8912 m 4275 8993 l 4395 8966 l  col0 s
% Polyline
gs  clippath
4950 10083 m 4976 10029 l 4839 9964 l 4935 10043 l 4813 10019 l cp
eoclip
n 3480 9360 m
 4950 10050 l gs col0 s gr gr

% arrowhead
n 4813 10019 m 4935 10043 l 4839 9964 l  col0 s
% Polyline
n 4980 11220 m 7560 11220 l 7560 12180 l 4980 12180 l
 cp gs col0 s gr 
% Polyline
n 2340 9480 m 3600 9480 l 3600 9840 l 2340 9840 l
 cp gs col0 s gr 
% Polyline
n 1380 11340 m 2700 11340 l 2700 11940 l 1380 11940 l
 cp gs col0 s gr 
% Polyline
n 1380 11340 m 2700 11340 l 2700 11640 l 1380 11640 l
 cp gs col0 s gr 
% Polyline
gs  clippath
1590 11295 m 1650 11295 l 1650 11143 l 1620 11263 l 1590 11143 l cp
eoclip
n 2340 9720 m 1620 10140 l
 1620 11280 l gs col0 s gr gr

% arrowhead
n 1590 11143 m 1620 11263 l 1650 11143 l  col0 s
% Polyline
n 3360 12060 m 4560 12060 l 4560 13500 l 3360 13500 l
 cp gs col0 s gr 
% Polyline
n 1125 13080 m 1020 13080 1020 13575 105 arcto 4 {pop} repeat
  1020 13680 2775 13680 105 arcto 4 {pop} repeat
  2880 13680 2880 13185 105 arcto 4 {pop} repeat
  2880 13080 1125 13080 105 arcto 4 {pop} repeat
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
gs  clippath
5461 4773 m 5485 4718 l 5346 4658 l 5445 4733 l 5322 4713 l cp
eoclip
n 1200 13140 m 660 10260 l 660 8340 l 1140 4740 l 2100 4200 l 4200 4200 l

 5460 4740 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 5322 4713 m 5445 4733 l 5346 4658 l  col0 s
% Polyline
n 10800 8760 m 13080 8760 l 13080 17040 l 10800 17040 l
 cp gs col0 s gr 
% Polyline
gs  clippath
7292 11380 m 7321 11433 l 7454 11361 l 7335 11392 l 7426 11308 l cp
11127 9379 m 11098 9326 l 10965 9398 l 11085 9368 l 10993 9451 l cp
eoclip
n 11100 9360 m
 7320 11400 l gs col0 s gr gr

% arrowhead
n 10993 9451 m 11085 9368 l 10965 9398 l  col0 s
% arrowhead
n 7426 11308 m 7335 11392 l 7454 11361 l  col0 s
% Polyline
gs  clippath
5475 9270 m 5475 9210 l 5323 9210 l 5443 9240 l 5323 9270 l cp
eoclip
n 5580 7260 m 5220 7260 l 5220 9240 l
 5460 9240 l gs col0 s gr gr

% arrowhead
n 5323 9270 m 5443 9240 l 5323 9210 l  col0 s
% Polyline
gs  clippath
8010 8955 m 8070 8955 l 8070 8803 l 8040 8923 l 8010 8803 l cp
eoclip
n 8520 7260 m 8040 7260 l
 8040 8940 l gs col0 s gr gr

% arrowhead
n 8010 8803 m 8040 8923 l 8070 8803 l  col0 s
% Polyline
gs  clippath
10287 8946 m 10344 8962 l 10386 8816 l 10325 8924 l 10329 8800 l cp
eoclip
n 11040 7260 m 10440 7260 l 10440 8520 l
 10320 8940 l gs col0 s gr gr

% arrowhead
n 10329 8800 m 10325 8924 l 10386 8816 l  col0 s
% Polyline
gs  clippath
7755 9390 m 7755 9330 l 7603 9330 l 7723 9360 l 7603 9390 l cp
8595 7530 m 8595 7470 l 8443 7470 l 8563 7500 l 8443 7530 l cp
eoclip
n 8580 7500 m 7560 7500 l 7560 9360 l
 7740 9360 l gs col0 s gr gr

% arrowhead
n 8443 7530 m 8563 7500 l 8443 7470 l  col0 s
% arrowhead
n 7603 9390 m 7723 9360 l 7603 9330 l  col0 s
% Polyline
gs  clippath
8985 9330 m 8985 9390 l 9137 9390 l 9017 9360 l 9137 9330 l cp
9825 7470 m 9825 7530 l 9977 7530 l 9857 7500 l 9977 7470 l cp
eoclip
n 9840 7500 m 10200 7500 l 10200 8520 l 8940 8520 l 9120 9360 l
 9000 9360 l gs col0 s gr gr

% arrowhead
n 9977 7470 m 9857 7500 l 9977 7530 l  col0 s
% arrowhead
n 9137 9330 m 9017 9360 l 9137 9390 l  col0 s
% Polyline
gs  clippath
12285 7590 m 12285 7650 l 12437 7650 l 12317 7620 l 12437 7590 l cp
10466 9180 m 10520 9206 l 10587 9071 l 10507 9165 l 10533 9044 l cp
eoclip
n 10500 9180 m 10740 8700 l 12840 8340 l 12840 7620 l
 12300 7620 l gs col0 s gr gr

% arrowhead
n 10533 9044 m 10507 9165 l 10587 9071 l  col0 s
% arrowhead
n 12437 7590 m 12317 7620 l 12437 7650 l  col0 s
% Polyline
gs  clippath
9219 9086 m 9273 9060 l 9206 8924 l 9233 9045 l 9152 8951 l cp
10995 7590 m 10995 7530 l 10843 7530 l 10963 7560 l 10843 7590 l cp
eoclip
n 10980 7560 m 10320 7560 l 10320 8640 l 9240 8640 l 9180 8940 l
 9240 9060 l gs col0 s gr gr

% arrowhead
n 10843 7590 m 10963 7560 l 10843 7530 l  col0 s
% arrowhead
n 9152 8951 m 9233 9045 l 9206 8924 l  col0 s
% Polyline
gs  clippath
8463 9326 m 8431 9377 l 8560 9457 l 8474 9369 l 8591 9406 l cp
eoclip
n 11160 11040 m
 8460 9360 l gs col0 s gr gr

% arrowhead
n 8591 9406 m 8474 9369 l 8560 9457 l  col0 s
% Polyline
gs  clippath
10228 9102 m 10168 9107 l 10180 9258 l 10201 9137 l 10240 9254 l cp
eoclip
n 11040 12600 m 10380 11400 l
 10200 9120 l gs col0 s gr gr

% arrowhead
n 10240 9254 m 10201 9137 l 10180 9258 l  col0 s
% Polyline
gs  clippath
10875 13050 m 10875 12990 l 10723 12990 l 10843 13020 l 10723 13050 l cp
9525 12990 m 9525 13050 l 9677 13050 l 9557 13020 l 9677 12990 l cp
eoclip
n 9540 13020 m
 10860 13020 l gs col0 s gr gr

% arrowhead
n 9677 12990 m 9557 13020 l 9677 13050 l  col0 s
% arrowhead
n 10723 13050 m 10843 13020 l 10723 12990 l  col0 s
% Polyline
 [15 45] 45 sd
gs  clippath
13890 13935 m 13950 13935 l 13950 13783 l 13920 13903 l 13890 13783 l cp
eoclip
n 12720 13080 m 13920 13080 l
 13920 13920 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 13890 13783 m 13920 13903 l 13950 13783 l  col0 s
% Polyline
n 7800 12840 m 9540 12840 l 9540 13200 l 7800 13200 l
 cp gs col0 s gr 
% Polyline
n 7800 12360 m 9540 12360 l 9540 12720 l 7800 12720 l
 cp gs col0 s gr 
% Polyline
 [15 45] 45 sd
gs  clippath
7815 13050 m 7815 12990 l 7663 12990 l 7783 13020 l 7663 13050 l cp
eoclip
n 6960 13020 m
 7800 13020 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 7663 13050 m 7783 13020 l 7663 12990 l  col0 s
% Polyline
 [15 45] 45 sd
gs  clippath
7815 12570 m 7815 12510 l 7663 12510 l 7783 12540 l 7663 12570 l cp
eoclip
n 7020 12540 m
 7800 12540 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 7663 12570 m 7783 12540 l 7663 12510 l  col0 s
% Polyline
gs  clippath
10992 11490 m 10997 11431 l 10845 11420 l 10963 11459 l 10841 11480 l cp
9525 12510 m 9525 12570 l 9677 12570 l 9557 12540 l 9677 12510 l cp
eoclip
n 9540 12540 m 10140 12540 l 10140 11400 l
 10980 11460 l gs col0 s gr gr

% arrowhead
n 9677 12510 m 9557 12540 l 9677 12570 l  col0 s
% arrowhead
n 10841 11480 m 10963 11459 l 10845 11420 l  col0 s
% Polyline
gs  clippath
12885 9810 m 12885 9870 l 13037 9870 l 12917 9840 l 13037 9810 l cp
12885 11430 m 12885 11490 l 13037 11490 l 12917 11460 l 13037 11430 l cp
eoclip
n 12900 11460 m 13680 11460 l 13680 9840 l
 12900 9840 l gs col0 s gr gr

% arrowhead
n 13037 11430 m 12917 11460 l 13037 11490 l  col0 s
% arrowhead
n 13037 9810 m 12917 9840 l 13037 9870 l  col0 s
% Polyline
 [15 45] 45 sd
gs  clippath
9643 10714 m 9685 10756 l 9793 10649 l 9687 10713 l 9750 10606 l cp
10995 9930 m 10995 9870 l 10843 9870 l 10963 9900 l 10843 9930 l cp
eoclip
n 10980 9900 m 10500 9900 l
 9675 10725 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 10843 9930 m 10963 9900 l 10843 9870 l  col0 s
% arrowhead
n 9750 10606 m 9687 10713 l 9793 10649 l  col0 s
% Polyline
n 7740 13560 m 8460 13560 l 8460 16860 l 7740 16860 l
 cp gs col0 s gr 
% Polyline
gs  clippath
10995 14730 m 10995 14670 l 10843 14670 l 10963 14700 l 10843 14730 l cp
8085 14670 m 8085 14730 l 8237 14730 l 8117 14700 l 8237 14670 l cp
eoclip
n 8100 14700 m
 10980 14700 l gs col0 s gr gr

% arrowhead
n 8237 14670 m 8117 14700 l 8237 14730 l  col0 s
% arrowhead
n 10843 14730 m 10963 14700 l 10843 14670 l  col0 s
% Polyline
gs  clippath
12885 16290 m 12885 16350 l 13037 16350 l 12917 16320 l 13037 16290 l cp
12885 14670 m 12885 14730 l 13037 14730 l 12917 14700 l 13037 14670 l cp
eoclip
n 12900 14700 m 13800 14700 l 13800 16320 l
 12900 16320 l gs col0 s gr gr

% arrowhead
n 13037 14670 m 12917 14700 l 13037 14730 l  col0 s
% arrowhead
n 13037 16290 m 12917 16320 l 13037 16350 l  col0 s
% Polyline
 [15 45] 45 sd
gs  clippath
10365 16290 m 10365 16350 l 10517 16350 l 10397 16320 l 10517 16290 l cp
10995 16350 m 10995 16290 l 10843 16290 l 10963 16320 l 10843 16350 l cp
eoclip
n 10980 16320 m
 10380 16320 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 10843 16350 m 10963 16320 l 10843 16290 l  col0 s
% arrowhead
n 10517 16290 m 10397 16320 l 10517 16350 l  col0 s
% Polyline
gs  clippath
3300 12093 m 3326 12039 l 3189 11974 l 3285 12053 l 3163 12029 l cp
eoclip
n 2280 11580 m
 3300 12060 l gs col0 s gr gr

% arrowhead
n 3163 12029 m 3285 12053 l 3189 11974 l  col0 s
% Polyline
n 5055 9975 m 7635 9975 l 7635 10935 l 5055 10935 l
 cp gs col0 s gr 
% Polyline
gs  clippath
6194 11161 m 6232 11207 l 6349 11110 l 6238 11164 l 6310 11064 l cp
eoclip
n 6697 10781 m
 6225 11175 l gs col0 s gr gr

% arrowhead
n 6310 11064 m 6238 11164 l 6349 11110 l  col0 s
% Polyline
gs  clippath
2516 13130 m 2574 13147 l 2618 13002 l 2555 13109 l 2560 12985 l cp
eoclip
n 5025 10275 m 3000 11625 l
 2550 13125 l gs col0 s gr gr

% arrowhead
n 2560 12985 m 2555 13109 l 2618 13002 l  col0 s
% Polyline
gs  clippath
5654 7890 m 5655 7830 l 5503 7826 l 5623 7860 l 5502 7886 l cp
eoclip
n 3600 7800 m
 5640 7860 l gs col0 s gr gr

% arrowhead
n 5502 7886 m 5623 7860 l 5503 7826 l  col0 s
% Polyline
gs  clippath
8533 7890 m 8536 7830 l 8384 7824 l 8503 7859 l 8381 7884 l cp
eoclip
n 6900 7800 m
 8520 7860 l gs col0 s gr gr

% arrowhead
n 8381 7884 m 8503 7859 l 8384 7824 l  col0 s
% Polyline
n 3360 12750 m 4560 12750 l 4560 13050 l 3360 13050 l
 cp gs col0 s gr 
% Polyline
gs  clippath
4983 10569 m 4925 10552 l 4881 10697 l 4945 10591 l 4939 10714 l cp
eoclip
n 4275 12825 m
 4950 10575 l gs col0 s gr gr

% arrowhead
n 4939 10714 m 4945 10591 l 4881 10697 l  col0 s
% Polyline
gs  clippath
4541 12072 m 4593 12103 l 4669 11972 l 4583 12061 l 4617 11942 l cp
eoclip
n 5400 10650 m
 4575 12075 l gs col0 s gr gr

% arrowhead
n 4617 11942 m 4583 12061 l 4669 11972 l  col0 s
% Polyline
n 7725 13875 m
 8475 13875 l gs col0 s gr 
% Polyline
n 7725 14175 m
 8475 14175 l gs col0 s gr 
% Polyline
n 7725 14475 m
 8475 14475 l gs col0 s gr 
% Polyline
n 7725 14850 m
 8475 14850 l gs col0 s gr 
% Polyline
n 7725 15150 m
 8475 15150 l gs col0 s gr 
% Polyline
n 7725 15450 m
 8475 15450 l gs col0 s gr 
% Polyline
n 7725 15750 m
 8475 15750 l gs col0 s gr 
% Polyline
n 7725 16050 m
 8475 16050 l gs col0 s gr 
% Polyline
n 7725 16425 m
 8475 16425 l gs col0 s gr 
/Times-Roman-iso ff 200.00 scf sf
3600 1080 m
gs 1 -1 sc (task_struct) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2400 1320 m
gs 1 -1 sc (current  ->) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4200 2640 m
gs 1 -1 sc (mm) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6540 1140 m
gs 1 -1 sc (mm_struct) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6600 3600 m
gs 1 -1 sc (mmap) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6600 2460 m
gs 1 -1 sc (pgd) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8820 1140 m
gs 1 -1 sc (Page) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8820 1365 m
gs 1 -1 sc (Global) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8820 1590 m
gs 1 -1 sc (Directory) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 9000 m
gs 1 -1 sc (struct file) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2820 9420 m
gs 1 -1 sc (f_mapping) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
2880 9720 m
gs 1 -1 sc (f_dentry) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1860 11220 m
gs 1 -1 sc (dentry) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1920 11580 m
gs 1 -1 sc (d_inode) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3900 11940 m
gs 1 -1 sc (inode) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1740 13320 m
gs 1 -1 sc (Priority) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
1740 13545 m
gs 1 -1 sc (Search Tree) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6060 11580 m
gs 1 -1 sc (radix-64 tree) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 17220 m
gs 1 -1 sc (mem_map) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
11760 17445 m
gs 1 -1 sc (\(array of srtruct page\)) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
13920 14040 m
gs 1 -1 sc (to other) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
13920 14265 m
gs 1 -1 sc (active pgs) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8640 13080 m
gs 1 -1 sc (active list) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8700 12600 m
gs 1 -1 sc (inactive list) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9720 16380 m
gs 1 -1 sc (to other free) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9720 16605 m
gs 1 -1 sc (pgs of order 3) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-BoldItalic-iso ff 200.00 scf sf
3900 5100 m
gs 1 -1 sc (text) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-BoldItalic-iso ff 200.00 scf sf
7200 5100 m
gs 1 -1 sc (data) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-BoldItalic-iso ff 200.00 scf sf
10080 5160 m
gs 1 -1 sc (bss) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-BoldItalic-iso ff 200.00 scf sf
12720 5160 m
gs 1 -1 sc (stack) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-BoldItalic-iso ff 200.00 scf sf
3480 11760 m
gs 1 -1 sc (a.out file) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9450 10950 m
gs 1 -1 sc (to other inactive pgs) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6750 10725 m
gs 1 -1 sc (page_tree) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5400 10650 m
gs 1 -1 sc (host) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
6375 9900 m
gs 1 -1 sc (address_space) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3900 12975 m
gs 1 -1 sc (i_mapping) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
5550 10350 m
gs 1 -1 sc (i_mmap) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7575 13725 m
gs 1 -1 sc (order 0) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7575 14025 m
gs 1 -1 sc (order 1) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7500 14325 m
gs 1 -1 sc (order 2) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7575 14700 m
gs 1 -1 sc (order 3) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
7500 15225 m
gs 1 -1 sc (etc.) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
9450 13650 m
gs 1 -1 sc (buddy system free list) dup sw pop 2 div neg 0 rm  col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND 0 Cg EP
%%Page: 43 43
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 43)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Bold@0 SF(Resour)208.771 120 Q(ce Exhaustion)-.234 E
/F2 13/Times-Roman@0 SF 2.383(In an ideal w)33.336 156 R 2.383
(orld, systems w)-.13 F 2.383(ould al)-.13 F -.13(wa)-.13 G 2.383(ys ha)
.13 F 2.773 -.195(ve s)-.26 H(uf).195 E 2.383
(\214cient resources to handle the jobs)-.325 F 1.792(which are thro)
33.336 171 R 1.792(wn at them.)-.325 F 1.792(But that w)8.292 F 1.791
(orld is not a terribly interesting one in terms of)-.13 F .029
(operating systems design.)33.336 186 R .029(In reality)6.529 F 3.279
(,m)-.845 G .029(emory resource e)-3.279 F .029
(xhaustion is often a problem.)-.195 F -1.04(We)6.53 G 1.728
(can consider tw)33.336 201 R 4.978(od)-.13 G 1.728
(istinct problem areas: Insuf)-4.978 F 1.728(\214cient ph)-.325 F 1.727
(ysical memory)-.065 F 4.977(,a)-.845 G 1.727(nd insuf)-4.977 F
(\214cient)-.325 E(sw)33.336 216 Q(ap space.)-.13 E F1
(Thrashing / Swap T)199.547 246 Q(ok)-1.196 E(en)-.13 E F2 1.336
(When memory becomes v)33.336 282 R 1.336
(ery scarce, the system can spend much of its time freeing up)-.195 F
.273(pages by sw)33.336 297 R .273(apping-out, follo)-.13 F .273
(wed by sw)-.325 F .273
(apping-in when a process which has had its pages)-.13 F 1.031
(stolen gets scheduled and tries to run.)33.336 312 R 1.032
(This is an age-old problem kno)7.532 F 1.032(wn as)-.325 F F1
(thrashing)4.282 E F2(.)A .927
(Linux tries to ameliorate it by using what Linux calls a "sw)33.336 327
R .926(ap tok)-.13 F 4.176(en". A)-.13 F .926(process which)4.176 F
1.961(holds the sw)33.336 342 R 1.961(ap tok)-.13 F 1.961(en is gi)-.13
F -.195(ve)-.325 G 5.211(nat).195 G 1.961(emporary reprie)-5.211 F 2.351
-.195(ve b)-.325 H 5.211(yt).195 G 1.961(he PFRA.)-5.211 F 1.962(The sw)
8.462 F 1.962(ap tok)-.13 F 1.962(en is)-.13 F(gi)33.336 357 Q -.195(ve)
-.325 G 4.298(nt).195 G 4.298(oap)-4.298 G 1.048(rocess based on heuris\
tic rules...basically a process which has recently been)-4.298 F 1.115
(victimized by the PFRA, has good priority and looks lik)33.336 372 R
4.366(ei)-.13 G 4.366(tw)-4.366 G 1.116(ill do something useful if)
-4.366 F(allo)33.336 387 Q(wed to run.)-.325 E .983(This isn')33.336 408
R 4.233(tn)-.234 G .983(ecessarily a perfect solution.)-4.233 F 3.063
-1.04(To c)7.483 H .983(ontrast, the Solaris k)1.04 F .983(ernel tak)
-.13 F .983(es a dif)-.13 F(ferent)-.325 E 5.594(approach. When)33.336
423 R 2.344(memory runs lo)5.594 F 4.034 -.845(w, a k)-.325 H 2.344
(ernel thread called the "sw).715 F 2.345(apper" picks entire)-.13 F .17
(processes to victimize and steals all of the process' pages.)33.336 438
R 3.42(Ap)6.67 G .17(rocess thus sw)-3.42 F .169(apped-out is)-.13 F
1.176(basically put to sleep and therefore doesn')33.336 453 R 4.426(tg)
-.234 G 1.176(et scheduled.)-4.426 F 1.176(When things get calmer)7.676
F 4.426(,t)-.52 G(he)-4.426 E 1.851(process is released from the sw)
33.336 468 R(apper')-.13 E 5.1(sg)-.715 G 1.85(rasp and is allo)-5.1 F
1.85(wed to run and f)-.325 F 1.85(ault its pages)-.13 F(back in.)33.336
483 Q F1(Memory o)124.563 513 Q -.13(ve)-.13 G -.481(r-).13 G
(commit and the out-of-memory killer).481 E F2 .759(Just lik)33.336 549
R 4.009(ea)-.13 G 4.009(na)-4.009 G .759(irline which o)-4.009 F -.195
(ve)-.195 G -.26(r-).195 G .76(books seats, it is possible for the k).26
F .76(ernel to hand out more)-.13 F .853(virtual memory than it has ph)
33.336 564 R .852(ysical memory and sw)-.065 F .852(ap to co)-.13 F
-.195(ve)-.195 G 5.532 -.715(r. I).195 H 4.102(fi).715 G 4.102(th)-4.102
G .852(appens that all of)-4.102 F .373
(the memory is demanded at once and there are insuf)33.336 579 R .374
(\214cient free sw)-.325 F .374(ap slots to page-out to,)-.13 F .94
(the k)33.336 594 R .94(ernel will ha)-.13 F 1.33 -.195(ve n)-.26 H
4.189(oc).195 G .939(hoice b)-4.189 F .939
(ut to kill processes in order to re)-.26 F -.065(ga)-.195 G .939
(in memory).065 F 7.439(.T)-.845 G .939(here is)-7.439 F .035(an Out-Of\
-Memory killer which is triggered when the system becomes desperately l\
o)33.336 609 R 3.285(wo)-.325 G(f)-3.285 E(memory)33.336 624 Q 6.5(.I)
-.845 G 3.25(tp)-6.5 G(icks lar)-3.25 E(ge processes which ha)-.234 E
-.195(ve)-.26 G(n').195 E 3.25(tb)-.234 G(een running too long.)-3.25 E
2.3(This might seem lik)33.336 645 R 5.55(ead)-.13 G 2.3(esign \215a)
-5.55 F 7.24 -.845(w. A)-.195 H 2.3
(fter all, the programmer successfully allocated).845 F 1.576
(memory using malloc \(which in turn used)33.336 660 R/F3 13/Courier@0
SF(brk)4.826 E F2(or)4.826 E F3(mmap)4.827 E F2 1.577(\), so wh)B 4.827
(yh)-.065 G 1.577(as the k)-4.827 F 1.577(ernel gone)-.13 F .32
(back on its promise and wh)33.336 675 R 3.57(ys)-.065 G .319
(hould a process be terminated because of something which)-3.57 F
(is not its f)33.336 690 Q(ault?)-.13 E .585
(On the other hand, the most conserv)33.336 711 R(ati)-.325 E .975 -.195
(ve a)-.325 H .585(pproach, which guarantees that one will ne).195 F
-.195(ve)-.325 G(r).195 E 2.36(run out of memory)33.336 726 R 5.61(,i)
-.845 G 5.61(st)-5.61 G 5.61(or)-5.61 G(eserv)-5.61 E 5.61(eas)-.195 G
-.13(wa)-5.61 G 5.61(ps).13 G 2.36(pace slot for each virtual anon)-5.61
F 2.359(ymous page)-.195 F 4.564(allocated. Then)33.336 741 R 1.314
(there will al)4.564 F -.13(wa)-.13 G 1.315
(ys be a place to page-out an).13 F 4.565(yr)-.195 G 1.315
(esident page and we can)-4.565 F 0 Cg EP
%%Page: 44 44
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 44)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(ne)33.336 120 Q -.195(ve)-.325 G 4.838
(rg).195 G 1.588(et into this trouble.)-4.838 F 1.588
(The problem with this approach is that processes will start)8.088 F
.618(getting memory allocation f)33.336 135 R .619
(ailures long before the system has reached a high probability)-.13 F
.225(of running out of memory)33.336 150 R 3.475(,u)-.845 G .225
(nless the administrator has con\214gured a v)-3.475 F .224(ery lar)
-.195 F .224(ge amount of)-.234 F(sw)33.336 165 Q 1.825(ap space.)-.13 F
1.826(The reason:)8.326 F 1.826(most virtual anon)8.326 F 1.826
(ymous pages are ne)-.195 F -.195(ve)-.325 G 5.076(ra).195 G 1.826
(ctually paged-out.)-5.076 F .073(Consider a lar)33.336 180 R .073
(ge process which forks and then e)-.234 F -.195(xe)-.195 G 3.323
(cs. Most).195 F .072(of the virtual address space of)3.323 F
(the child will be discarded.)33.336 195 Q 3.675(Older Linux k)33.336
216 R 3.676(ernels took the \214rst approach.)-.13 F 3.676(Solaris k)
10.176 F 3.676(ernels tend to)-.13 F -.13(wa)-.325 G 3.676(rds to more)
.13 F(conserv)33.336 231 Q(ati)-.325 E 1.228 -.195(ve a)-.325 H 4.088
(pproach. Modern).195 F .838(\(2.6+\) Linux k)4.088 F .838(ernels allo)
-.13 F 4.088(wt)-.325 G .838(he administrator to tune the)-4.088 F
(memory o)33.336 246 Q -.195(ve)-.195 G -.26(r-).195 G(commit polic).26
E -.845(y.)-.195 G/F2 10/Courier@0 SF(The following is verbatim from \\\
fCDocumentation/vm/overcommit-accounting\\fP:)33.336 258 Q
(The Linux kernel supports the following overcommit handling modes)
33.336 282 Q 42(0-H)33.336 306 S
(euristic overcommit handling. Obvious overcommits of)-42 E
(address space are refused. Used for a typical system. It)129.336 318 Q
(ensures a seriously wild allocation fails while allowing)129.336 330 Q
(overcommit to reduce swap usage.)129.336 342 Q(root is allowed to)12 E
(allocate slighly more memory in this mode. This is the)129.336 354 Q
(default.)129.336 366 Q 42(1-A)33.336 390 S
(lways overcommit. Appropriate for some scientific)-42 E(applications.)
129.336 402 Q 42(2-D)33.336 426 S
(on't overcommit. The total address space commit)-42 E
(for the system is not permitted to exceed swap + a)129.336 438 Q
(configurable percentage \(default is 50\) of physical RAM.)129.336 450
Q(Depending on the percentage you use, in most situations)129.336 462 Q
(this means a process will not be killed while accessing)129.336 474 Q
(pages but will receive errors on memory allocation as)129.336 486 Q
(appropriate.)129.336 498 Q
(The overcommit policy is set via the sysctl `vm.overcommit_memory'.)
33.336 522 Q
(The overcommit percentage is set via `vm.overcommit_ratio'.)33.336 546
Q(The current overcommit limit and amount committed are viewable in)
33.336 570 Q
(/proc/meminfo as CommitLimit and Committed_AS respectively.)33.336 582
Q(Gotchas)33.336 606 Q(-------)33.336 618 Q(The C language stack growth\
 does an implicit mremap. If you want absolute)33.336 642 Q
(guarantees and run close to the edge you MUST mmap your stack for the)
33.336 654 Q(largest size you think you will need. For typical stack us\
age this does)33.336 666 Q
(not matter much but it's a corner case if you really really care)33.336
678 Q(In mode 2 the MAP_NORESERVE flag is ignored.)33.336 702 Q
(How It Works)33.336 738 Q 0 Cg EP
%%Page: 45 45
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 45)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF(------------)33.336 117 Q
(The overcommit is based on the following rules)33.336 141 Q
(For a file backed map)33.336 165 Q(SHARED or READ-only)81.336 177 Q 42
(-0)30 G(cost \(the file is the map not swap\))-36 E(PRIVATE WRITABLE)
81.336 189 Q 42(-s)48 G(ize of mapping per instance)-42 E
(For an anonymous or /dev/zero map)33.336 213 Q 102(SHARED -)81.336 225
R(size of mapping)42 E(PRIVATE READ-only)81.336 237 Q 42(-0)42 G
(cost \(but of little use\))-36 E(PRIVATE WRITABLE)81.336 249 Q 42(-s)48
G(ize of mapping per instance)-42 E(Additional accounting)33.336 273 Q
(Pages made writable copies by mmap)81.336 285 Q
(shmfs memory drawn from the same pool)81.336 297 Q 0 Cg EP
%%Page: 46 46
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 46)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Bold@0 SF -.325(Ap)146.351 120 S(pendix: Ho).325 E
3.25(wa)-.13 G 3.25(ne)-3.25 G(xecutable \214le is cr)-3.25 E(eated)
-.234 E/F2 13/Times-Roman@0 SF 1.175(In the original UNIX k)33.336 156 R
1.175(ernel, each program w)-.13 F 1.175(as entirely)-.13 F F1
(statically-link)4.425 E(ed)-.13 E F2 4.425(,i)C 1.175(.e. all of the)
-4.425 F 2.383(code required to e)33.336 171 R -.195(xe)-.195 G 2.383
(cute the program, and in particular all of the libraries which the).195
F 1.181(program requires, are put together at compile-time into one lar)
33.336 186 R 1.181(ge monolithic e)-.234 F -.195(xe)-.195 G(cutable).195
E 4.589(\214le. This)33.336 201 R 1.338(practice be)4.588 F -.065(ga)
-.195 G 4.588(nt).065 G 4.588(oc)-4.588 G 1.338
(hange during the 1990s, and today almost all programs in)-4.588 F .581
(almost all UNIX-deri)33.336 216 R -.195(ve)-.325 G 3.831(ds).195 G .581
(ystems are)-3.831 F/F3 13/Times-Italic@0 SF .581(dynamically link)3.831
F(ed)-.13 E F2 7.081(.I)C 3.831(ti)-7.081 G 3.831(ss)-3.831 G .581
(till possible to compile a)-3.831 F 2.429
(program which is statically link)33.336 231 R 2.429(ed, b)-.13 F 2.429
(ut this is e)-.26 F 5.679(xceptional. W)-.195 F 5.679(ew)-1.04 G 2.429
(ill \214rst discuss ho)-5.679 F(w)-.325 E(statically link)33.336 246 Q
(ed programs are link)-.13 E(ed together)-.13 E 3.25(,a)-.52 G
(nd then delv)-3.25 E 3.25(ei)-.195 G(nto dynamic linking.)-3.25 E .772
(Compiling a C program into an e)33.336 267 R -.195(xe)-.195 G .772
(cutable \214le is a multi-stage process in).195 F -.26(vo)-.52 G .772
(lving se).26 F -.195(ve)-.325 G(ral).195 E 3.25(tools. When)33.336 282
R(one simply runs:)3.25 E/F4 10/Courier@0 SF(cc test.c)33.336 294 Q F2
(The)33.336 309 Q/F5 13/Courier@0 SF(cc)7.396 E F2 4.146
(command transparently e)7.396 F -.195(xe)-.195 G 4.146
(cutes the tools, detailed belo).195 F 5.836 -.845(w, r)-.325 H 4.145
(esulting in an).845 F -.195(exe)33.336 324 S 2.175
(cutable \214le called).195 F F5(a.out)5.425 E F2 2.176
(\(if there are no f)5.425 F 2.176(atal errors in compilation\).)-.13 F
2.176(The "a" in)8.676 F 1.224
("a.out" stands for "Absolute", meaning that all symbolic references ha)
33.336 339 R 1.614 -.195(ve b)-.26 H 1.224(een resolv).195 F(ed.)-.195 E
.912(An a.out \214le contains pure machine code that can be directly e)
33.336 354 R -.195(xe)-.195 G .912(cuted by the processor).195 F(.)-.715
E .193(The e)33.336 369 R -.195(xe)-.195 G .193
(cutable \214le \("a.out"\) contains e).195 F -.195(ve)-.325 G .193
(rything that the operating system needs to create).195 F 4.598(ap)
33.336 384 S(rogram')-4.598 E 4.598(si)-.715 G 1.349
(nitial memory con\214guration and be)-4.598 F 1.349(gin e)-.195 F -.195
(xe)-.195 G 4.599(cution. The).195 F 1.349(header of the a.out)4.599 F
2.729(identi\214es it to the operating system as an e)33.336 399 R -.195
(xe)-.195 G 2.729(cutable \214le and speci\214es the processor).195 F
.09(architecture on which the machine code instructions will run.)33.336
414 R 3.34(Ap)6.59 G .09(rogram compiled for an)-3.34 F 1.34
(x86 architecture can not be e)33.336 429 R -.195(xe)-.195 G 1.34
(cuted, for e).195 F 1.34(xample, on a SP)-.195 F 1.34(ARC processor)
-1.196 F 7.84(.T)-.715 G 1.34(he header)-7.84 F(also gi)33.336 444 Q
-.195(ve)-.325 G 3.25(st).195 G(he size of the te)-3.25 E
(xt, data and bss memory requirements, as e)-.195 E(xplained belo)-.195
E -.845(w.)-.325 G(The)33.336 465 Q F5(a.out)3.304 E F2 .054
(\214le includes the literal bytes of e)3.304 F -.195(xe)-.195 G .055
(cutable code which will be loaded into the).195 F(process')33.336 480 Q
(s)-.715 E F5(text)4.705 E F2(re)4.705 E 4.704(gion. These)-.195 F 1.454
(are in a contiguous part of the)4.704 F F5(a.out)4.704 E F2 4.704
(\214le. The)4.704 F(header)4.704 E(gi)33.336 495 Q -.195(ve)-.325 G
4.152(st).195 G .902(he of)-4.152 F .902(fset of the be)-.325 F .903
(ginning of the)-.195 F F5(.text)4.153 E F2 .903(section of the)4.153 F
F5(a.out)4.153 E F2 4.153(,a)C .903(nd also the)-4.153 F F1(load)4.153 E
(addr)33.336 510 Q(ess)-.234 E F2 4.51(,i)C 1.259
(.e. the virtual address at which the compilation system e)-4.51 F 1.259
(xpects this te)-.195 F 1.259(xt to be)-.195 F(loaded.)33.336 525 Q(Lik)
33.336 546 Q -.325(ew)-.13 G 1.093(ise, there is a).325 F F5(.data)4.343
E F2 1.094(section in the)4.344 F F5(a.out)4.344 E F2 1.094
(which contains an image of what the)4.344 F F5(data)33.336 561 Q F2(re)
3.25 E(gion of the process will look lik)-.195 E 3.25(ea)-.13 G 3.25(tp)
-3.25 G(rogram startup.)-3.25 E 0 Cg EP
%%Page: 47 47
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 47)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E 0 0 468 647 -390.603 540 33.336 510.603 PBEGIN
%%BeginDocument: maps.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: maps.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Mon Feb  6 22:31:41 2012
%%For: hak@lex ()
%%BoundingBox: 0 0 647 540
%%Magnification: 1.0000
%%EndComments
/MyAppDict 100 dict dup begin def
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 540 moveto 0 0 lineto 647 0 lineto 647 540 lineto closepath clip newpath
-70.0 577.3 translate
1 -1 scale

% This junk string is used by the show operators
/PATsstr 1 string def
/PATawidthshow { 	% cx cy cchar rx ry string
  % Loop over each character in the string
  {  % cx cy cchar rx ry char
    % Show the character
    dup				% cx cy cchar rx ry char char
    PATsstr dup 0 4 -1 roll put	% cx cy cchar rx ry char (char)
    false charpath		% cx cy cchar rx ry char
    /clip load PATdraw
    % Move past the character (charpath modified the
    % current point)
    currentpoint			% cx cy cchar rx ry char x y
    newpath
    moveto			% cx cy cchar rx ry char
    % Reposition by cx,cy if the character in the string is cchar
    3 index eq {			% cx cy cchar rx ry
      4 index 4 index rmoveto
    } if
    % Reposition all characters by rx ry
    2 copy rmoveto		% cx cy cchar rx ry
  } forall
  pop pop pop pop pop		% -
  currentpoint
  newpath
  moveto
} bind def
/PATcg {
  7 dict dup begin
    /lw currentlinewidth def
    /lc currentlinecap def
    /lj currentlinejoin def
    /ml currentmiterlimit def
    /ds [ currentdash ] def
    /cc [ currentrgbcolor ] def
    /cm matrix currentmatrix def
  end
} bind def
% PATdraw - calculates the boundaries of the object and
% fills it with the current pattern
/PATdraw {			% proc
  save exch
    PATpcalc			% proc nw nh px py
    5 -1 roll exec		% nw nh px py
    newpath
    PATfill			% -
  restore
} bind def
% PATfill - performs the tiling for the shape
/PATfill { % nw nh px py PATfill -
  PATDict /CurrentPattern get dup begin
    setfont
    % Set the coordinate system to Pattern Space
    PatternGState PATsg
    % Set the color for uncolored pattezns
    PaintType 2 eq { PATDict /PColor get PATsc } if
    % Create the string for showing
    3 index string		% nw nh px py str
    % Loop for each of the pattern sources
    0 1 Multi 1 sub {		% nw nh px py str source
	% Move to the starting location
	3 index 3 index		% nw nh px py str source px py
	moveto			% nw nh px py str source
	% For multiple sources, set the appropriate color
	Multi 1 ne { dup PC exch get PATsc } if
	% Set the appropriate string for the source
	0 1 7 index 1 sub { 2 index exch 2 index put } for pop
	% Loop over the number of vertical cells
	3 index 		% nw nh px py str nh
	{			% nw nh px py str
	  currentpoint		% nw nh px py str cx cy
	  2 index oldshow	% nw nh px py str cx cy
	  YStep add moveto	% nw nh px py str
	} repeat		% nw nh px py str
    } for
    5 { pop } repeat
  end
} bind def

% PATkshow - kshow with the current pattezn
/PATkshow {			% proc string
  exch bind			% string proc
  1 index 0 get			% string proc char
  % Loop over all but the last character in the string
  0 1 4 index length 2 sub {
				% string proc char idx
    % Find the n+1th character in the string
    3 index exch 1 add get	% string proc char char+1
    exch 2 copy			% strinq proc char+1 char char+1 char
    % Now show the nth character
    PATsstr dup 0 4 -1 roll put	% string proc chr+1 chr chr+1 (chr)
    false charpath		% string proc char+1 char char+1
    /clip load PATdraw
    % Move past the character (charpath modified the current point)
    currentpoint newpath moveto
    % Execute the user proc (should consume char and char+1)
    mark 3 1 roll		% string proc char+1 mark char char+1
    4 index exec		% string proc char+1 mark...
    cleartomark			% string proc char+1
  } for
  % Now display the last character
  PATsstr dup 0 4 -1 roll put	% string proc (char+1)
  false charpath		% string proc
  /clip load PATdraw
  neewath
  pop pop			% -
} bind def
% PATmp - the makepattern equivalent
/PATmp {			% patdict patmtx PATmp patinstance
  exch dup length 7 add		% We will add 6 new entries plus 1 FID
  dict copy			% Create a new dictionary
  begin
    % Matrix to install when painting the pattern
    TilingType PATtcalc
    /PatternGState PATcg def
    PatternGState /cm 3 -1 roll put
    % Check for multi pattern sources (Level 1 fast color patterns)
    currentdict /Multi known not { /Multi 1 def } if
    % Font dictionary definitions
    /FontType 3 def
    % Create a dummy encoding vector
    /Encoding 256 array def
    3 string 0 1 255 {
      Encoding exch dup 3 index cvs cvn put } for pop
    /FontMatrix matrix def
    /FontBBox BBox def
    /BuildChar {
	mark 3 1 roll		% mark dict char
	exch begin
	Multi 1 ne {PaintData exch get}{pop} ifelse  % mark [paintdata]
	  PaintType 2 eq Multi 1 ne or
	  { XStep 0 FontBBox aload pop setcachedevice }
	  { XStep 0 setcharwidth } ifelse
	  currentdict		% mark [paintdata] dict
	  /PaintProc load	% mark [paintdata] dict paintproc
	end
	gsave
	  false PATredef exec true PATredef
	grestore
	cleartomark		% -
    } bind def
    currentdict
  end				% newdict
  /foo exch			% /foo newlict
  definefont			% newfont
} bind def
% PATpcalc - calculates the starting point and width/height
% of the tile fill for the shape
/PATpcalc {	% - PATpcalc nw nh px py
  PATDict /CurrentPattern get begin
    gsave
	% Set up the coordinate system to Pattern Space
	% and lock down pattern
	PatternGState /cm get setmatrix
	BBox aload pop pop pop translate
	% Determine the bounding box of the shape
	pathbbox			% llx lly urx ury
    grestore
    % Determine (nw, nh) the # of cells to paint width and height
    PatHeight div ceiling		% llx lly urx qh
    4 1 roll				% qh llx lly urx
    PatWidth div ceiling		% qh llx lly qw
    4 1 roll				% qw qh llx lly
    PatHeight div floor			% qw qh llx ph
    4 1 roll				% ph qw qh llx
    PatWidth div floor			% ph qw qh pw
    4 1 roll				% pw ph qw qh
    2 index sub cvi abs			% pw ph qs qh-ph
    exch 3 index sub cvi abs exch	% pw ph nw=qw-pw nh=qh-ph
    % Determine the starting point of the pattern fill
    %(px, py)
    4 2 roll				% nw nh pw ph
    PatHeight mul			% nw nh pw py
    exch				% nw nh py pw
    PatWidth mul exch			% nw nh px py
  end
} bind def

% Save the original routines so that we can use them later on
/oldfill	/fill load def
/oldeofill	/eofill load def
/oldstroke	/stroke load def
/oldshow	/show load def
/oldashow	/ashow load def
/oldwidthshow	/widthshow load def
/oldawidthshow	/awidthshow load def
/oldkshow	/kshow load def

% These defs are necessary so that subsequent procs don't bind in
% the originals
/fill	   { oldfill } bind def
/eofill	   { oldeofill } bind def
/stroke	   { oldstroke } bind def
/show	   { oldshow } bind def
/ashow	   { oldashow } bind def
/widthshow { oldwidthshow } bind def
/awidthshow { oldawidthshow } bind def
/kshow 	   { oldkshow } bind def
/PATredef {
  MyAppDict begin
    {
    /fill { /clip load PATdraw newpath } bind def
    /eofill { /eoclip load PATdraw newpath } bind def
    /stroke { PATstroke } bind def
    /show { 0 0 null 0 0 6 -1 roll PATawidthshow } bind def
    /ashow { 0 0 null 6 3 roll PATawidthshow }
    bind def
    /widthshow { 0 0 3 -1 roll PATawidthshow }
    bind def
    /awidthshow { PATawidthshow } bind def
    /kshow { PATkshow } bind def
  } {
    /fill   { oldfill } bind def
    /eofill { oldeofill } bind def
    /stroke { oldstroke } bind def
    /show   { oldshow } bind def
    /ashow  { oldashow } bind def
    /widthshow { oldwidthshow } bind def
    /awidthshow { oldawidthshow } bind def
    /kshow  { oldkshow } bind def
    } ifelse
  end
} bind def
false PATredef
% Conditionally define setcmykcolor if not available
/setcmykcolor where { pop } {
  /setcmykcolor {
    1 sub 4 1 roll
    3 {
	3 index add neg dup 0 lt { pop 0 } if 3 1 roll
    } repeat
    setrgbcolor - pop
  } bind def
} ifelse
/PATsc {		% colorarray
  aload length		% c1 ... cn length
    dup 1 eq { pop setgray } { 3 eq { setrgbcolor } { setcmykcolor
  } ifelse } ifelse
} bind def
/PATsg {		% dict
  begin
    lw setlinewidth
    lc setlinecap
    lj setlinejoin
    ml setmiterlimit
    ds aload pop setdash
    cc aload pop setrgbcolor
    cm setmatrix
  end
} bind def

/PATDict 3 dict def
/PATsp {
  true PATredef
  PATDict begin
    /CurrentPattern exch def
    % If it's an uncolored pattern, save the color
    CurrentPattern /PaintType get 2 eq {
      /PColor exch def
    } if
    /CColor [ currentrgbcolor ] def
  end
} bind def
% PATstroke - stroke with the current pattern
/PATstroke {
  countdictstack
  save
  mark
  {
    currentpoint strokepath moveto
    PATpcalc				% proc nw nh px py
    clip newpath PATfill
    } stopped {
	(*** PATstroke Warning: Path is too complex, stroking
	  with gray) =
    cleartomark
    restore
    countdictstack exch sub dup 0 gt
	{ { end } repeat } { pop } ifelse
    gsave 0.5 setgray oldstroke grestore
  } { pop restore pop } ifelse
  newpath
} bind def
/PATtcalc {		% modmtx tilingtype PATtcalc tilematrix
  % Note: tiling types 2 and 3 are not supported
  gsave
    exch concat					% tilingtype
    matrix currentmatrix exch			% cmtx tilingtype
    % Tiling type 1 and 3: constant spacing
    2 ne {
	% Distort the pattern so that it occupies
	% an integral number of device pixels
	dup 4 get exch dup 5 get exch		% tx ty cmtx
	XStep 0 dtransform
	round exch round exch			% tx ty cmtx dx.x dx.y
	XStep div exch XStep div exch		% tx ty cmtx a b
	0 YStep dtransform
	round exch round exch			% tx ty cmtx a b dy.x dy.y
	YStep div exch YStep div exch		% tx ty cmtx a b c d
	7 -3 roll astore			% { a b c d tx ty }
    } if
  grestore
} bind def
/PATusp {
  false PATredef
  PATDict begin
    CColor PATsc
  end
} bind def

% this is the pattern fill program from the Second edition Reference Manual
% with changes to call the above pattern fill
% left30
11 dict begin
/PaintType 1 def
/PatternType 1 def
/TilingType 1 def
/BBox [0 0 1 1] def
/XStep 1 def
/YStep 1 def
/PatWidth 1 def
/PatHeight 1 def
/Multi 2 def
/PaintData [
  { clippath } bind
  { 32 16 true [ 32 0 0 -16 0 16 ]
	{<c000c000300030000c000c000300030000c000c000300030
	000c000c00030003c000c000300030000c000c0003000300
	00c000c000300030000c000c00030003>}
     imagemask } bind
] def
/PaintProc {
	pop
	exec fill
} def
currentdict
end
/P1 exch def

% right30
11 dict begin
/PaintType 1 def
/PatternType 1 def
/TilingType 1 def
/BBox [0 0 1 1] def
/XStep 1 def
/YStep 1 def
/PatWidth 1 def
/PatHeight 1 def
/Multi 2 def
/PaintData [
  { clippath } bind
  { 32 16 true [ 32 0 0 -16 0 16 ]
	{<00030003000c000c0030003000c000c0030003000c000c00
	30003000c000c00000030003000c000c0030003000c000c0
	030003000c000c0030003000c000c000>}
     imagemask } bind
] def
/PaintProc {
	pop
	exec fill
} def
currentdict
end
/P2 exch def

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
15.000 slw
n 5760 1200 m 9360 1200 l 9360 9600 l 5760 9600 l
 cp gs /PC [[1.00 1.00 1.00] [0.00 0.00 0.00]] def
15.00 15.00 sc P2 [16 0 0 -8 384.00 80.00] PATmp PATsp ef gr PATusp gs col0 s gr 
% Polyline
n 5760 1920 m 9360 1920 l 9360 2880 l 5760 2880 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 5760 3840 m 9360 3840 l 9360 4680 l 5760 4680 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 5760 4680 m 9360 4680 l 9360 5400 l 5760 5400 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 5760 5400 m 9360 5400 l 9360 6600 l 5760 6600 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 5760 7800 m 9360 7800 l 9360 9120 l 5760 9120 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
30.000 slw
gs  clippath
7530 6945 m 7350 6945 l 7350 7277 l 7440 7007 l 7530 7277 l cp
eoclip
n 7440 7800 m
 7440 6960 l gs col7 1.00 shd ef gr gs col0 s gr gr

% arrowhead
n 7530 7277 m 7440 7007 l 7350 7277 l 7440 7367 l 7530 7277 l 
 cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
7830 7215 m 8010 7215 l 8010 6883 l 7920 7153 l 7830 6883 l cp
eoclip
n 7920 6600 m
 7920 7200 l gs col7 1.00 shd ef gr gs col0 s gr gr

% arrowhead
n 7830 6883 m 7920 7153 l 8010 6883 l 7920 6793 l 7830 6883 l 
 cp gs 0.00 setgray ef gr  col0 s
% Polyline
n 1200 1200 m 3600 1200 l 3600 5760 l 1200 5760 l
 cp gs /PC [[1.00 1.00 1.00] [0.00 0.00 0.00]] def
15.00 15.00 sc P1 [16 0 0 -8 80.00 80.00] PATmp PATsp ef gr PATusp gs col0 s gr 
% Polyline
n 1200 4440 m 3600 4440 l 3600 5520 l 1200 5520 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 1200 3000 m 3600 3000 l 3600 4200 l 1200 4200 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 1200 1200 m 3600 1200 l 3600 2520 l 1200 2520 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
gs  clippath
6166 2478 m 6101 2310 l 5691 2471 l 6060 2424 l 5757 2638 l cp
eoclip
n 3360 3480 m
 6120 2400 l gs col7 1.00 shd ef gr gs col0 s gr gr

% arrowhead
n 5757 2638 m 6060 2424 l 5691 2471 l 5757 2638 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
gs  clippath
6156 4283 m 6112 4109 l 5685 4216 l 6057 4216 l 5729 4390 l cp
eoclip
n 3240 4920 m
 6120 4200 l gs col7 1.00 shd ef gr gs col0 s gr gr

% arrowhead
n 5729 4390 m 6057 4216 l 5685 4216 l 5729 4390 l  cp gs 0.00 setgray ef gr  col0 s
% Polyline
7.500 slw
gs  clippath
8415 2295 m 8366 2330 l 8457 2452 l 8410 2338 l 8505 2416 l cp
eoclip
n 10650 5325 m
 8400 2325 l gs col0 s gr gr

% arrowhead
n 8505 2416 m 8410 2338 l 8457 2452 l  col0 s
% Polyline
gs  clippath
8593 8089 m 8635 8131 l 8743 8024 l 8637 8088 l 8700 7981 l cp
eoclip
n 10575 6150 m
 8625 8100 l gs col0 s gr gr

% arrowhead
n 8700 7981 m 8637 8088 l 8743 8024 l  col0 s
% Polyline
15.000 slw
n 10500 3825 m 11925 3825 l 11925 6375 l 10500 6375 l
 cp gs col0 s gr 
% Polyline
7.500 slw
n 10500 4275 m
 11925 4275 l gs col0 s gr 
% Polyline
n 10500 4725 m
 11925 4725 l gs col0 s gr 
% Polyline
n 10500 5550 m
 11925 5550 l gs col0 s gr 
% Polyline
n 10500 5925 m
 11925 5925 l gs col0 s gr 
% Polyline
n 10500 5175 m
 11925 5175 l gs col0 s gr 
% Polyline
gs  clippath
8593 7789 m 8635 7831 l 8743 7724 l 8637 7788 l 8700 7681 l cp
eoclip
n 10650 5775 m
 8625 7800 l gs col0 s gr gr

% arrowhead
n 8700 7681 m 8637 7788 l 8743 7724 l  col0 s
/Times-Roman-iso ff 266.67 scf sf
7320 2520 m
gs 1 -1 sc (text) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
7320 4320 m
gs 1 -1 sc (data) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
7320 5160 m
gs 1 -1 sc (bss) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
7320 6120 m
gs 1 -1 sc (heap) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
7320 8520 m
gs 1 -1 sc (stack) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 233.33 scf sf
5640 1200 m
gs 1 -1 sc (00000000) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 233.33 scf sf
5640 9600 m
gs 1 -1 sc (FFFFFFFF) dup sw pop neg 0 rm  col0 sh gr
/Times-Roman-iso ff 300.00 scf sf
7320 840 m
gs 1 -1 sc (Run-Time Memory Image) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
2280 3600 m
gs 1 -1 sc (.text) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
2280 5040 m
gs 1 -1 sc (.data) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
1440 2370 m
gs 1 -1 sc (bss_sz) col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
2280 1560 m
gs 1 -1 sc (header:) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 300.00 scf sf
2640 840 m
gs 1 -1 sc (a.out file) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10950 4125 m
gs 1 -1 sc (%eax) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10950 4575 m
gs 1 -1 sc (%ebx) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10875 6225 m
gs 1 -1 sc (%ebp) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10950 4950 m
gs 1 -1 sc (. . .) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10875 5400 m
gs 1 -1 sc (%eip) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
10875 5850 m
gs 1 -1 sc (%esp) col0 sh gr
/Times-Roman-iso ff 300.00 scf sf
11175 3600 m
gs 1 -1 sc (Processor) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 300.00 scf sf
11175 3225 m
gs 1 -1 sc (Virtual) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
1275 1800 m
gs 1 -1 sc (load_addr,exec_addr,) col0 sh gr
/Times-Roman-iso ff 266.67 scf sf
1350 2100 m
gs 1 -1 sc (text_sz,data_sz,) col0 sh gr
% here ends figure;
$F2psEnd
rs
end
showpage
%%EndDocument
end PEND 0 Cg EP
%%Page: 48 48
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 48)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(The)33.336 120 Q/F2 13/Times-Bold@0 SF
(bss)3.711 E F1 .461(section contains all un-initialized global v)3.711
F 3.711(ariables. The)-.325 F 3.711(Cl)3.711 G .46
(anguage speci\214cation)-3.711 F 2.333(states that all such v)33.336
135 R 2.333(ariables, lacking an e)-.325 F 2.333(xplicit initializer)
-.195 F 5.583(,m)-.52 G 2.333(ust be initialized by the)-5.583 F
(operating system or C run-time en)33.336 150 Q(vironment to 0.)-.52 E
/F3 10/Courier@0 SF(int j=2;)33.336 162 Q(int k;)33.336 174 Q(main\(\))
33.336 186 Q({)33.336 198 Q(int l;)39.336 210 Q(/*...*/)90.936 222 Q(})
33.336 234 Q F1 .875(In the e)33.336 249 R .875(xample abo)-.195 F -.195
(ve)-.195 G(,).195 E/F4 13/Courier@0 SF(j)4.125 E F1 .874(has an e)4.124
F .874(xplicit initializer)-.195 F 4.124(,a)-.52 G .874
(nd will be in the data se)-4.124 F 4.124(gment. The)-.195 F -.325(va)
33.336 264 S 1.093(lue of the initializer will be found in the .data se\
ction of the a.out.).325 F F4(k)7.593 E F1 1.093(is uninitialized.)4.343
F .529(Therefore it will reside in the bss se)33.336 279 R .528
(gment of memory and will ha)-.195 F .918 -.195(ve a)-.26 H 3.778(ni)
.195 G .528(nitial v)-3.778 F .528(alue of 0.)-.325 F 3.67(The ISO C st\
andard says that "If an object that has static storage duration is not)
33.336 294 R 2.027(initialized e)33.336 309 R(xplicitly)-.195 E 5.277
(,i)-.845 G 5.277(ti)-5.277 G 5.277(si)-5.277 G 2.027
(nitialized impliclitly as if e)-5.277 F -.195(ve)-.325 G 2.027
(ry member that has arithmetic).195 F 1.953(type were assigned 0 and e)
33.336 324 R -.195(ve)-.325 G 1.954
(ry member that has pointer type were assigned a NULL).195 F 1.136
(pointer constant".)33.336 339 R 1.136
(This is satis\214ed by \214lling e)7.636 F -.195(ve)-.325 G 1.136
(ry byte of the bss re).195 F 1.136(gion with 0, and is)-.195 F 2.243
(performed by the operating system.)33.336 354 R 2.244(The v)8.743 F
(ariable)-.325 E F4(l)5.494 E F1 2.244(has automatic storage scope, and)
5.494 F .009(therefore will be found on the stack \(or)33.336 369 R
3.258(,i)-.52 G 3.258(ft)-3.258 G .008(he compiler is set for hea)-3.258
F .008(vy optimization and a)-.26 F 3.208(pointer to)33.336 384 R F4(l)
6.458 E F1 3.208(is ne)6.458 F -.195(ve)-.325 G 6.458(rt).195 G(ak)
-6.458 E 3.208(en, it may li)-.13 F 3.598 -.195(ve i)-.325 H 6.459(nar)
.195 G -.195(eg)-6.459 G 6.459(ister\). Automatic).195 F -.325(va)6.459
G 3.209(riables are not).325 F(0-initialized.)33.336 399 Q F2
(Behind cc-losed doors)206.665 414 Q F1(The)33.336 444 Q F4(cc)3.877 E
F1 .627(command is often and erroneously called "the compiler)3.877 F
3.876(." In)-.715 F -.13(fa)3.876 G .626(ct, it is a wrapper).13 F .088
(program which in)33.336 459 R -.26(vo)-.52 G -.13(ke).26 G 3.338(sas)
.13 G .088(eries of tools.)-3.338 F .089
(Each tool transforms a speci\214c kind of input \214le)6.588 F .109
(to a speci\214c kind of output \214le.)33.336 474 R .108
(It is possible to instruct)6.608 F F4(cc)3.358 E F1 .108
(to interrupt the process at an)3.358 F(y)-.195 E(stage, and to access \
and manipulate these intermediate \214les as needed.)33.336 489 Q 0 Cg
EP
%%Page: 49 49
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 49)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E 0 0 468 713 -382.014 582 33.336 502.014 PBEGIN
%%BeginDocument: compile.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: compile.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Wed Sep 20 21:36:37 2006
%%For: hak@lex ()
%%BoundingBox: 0 0 713 582
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 582 moveto 0 0 lineto 713 0 lineto 713 582 lineto closepath clip newpath
-53.3 567.7 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 8925 2475 1135 1135 0 360 DrawEllipse gs col0 s gr

% Polyline
gs  clippath
3315 1755 m 3315 1695 l 3163 1695 l 3283 1725 l 3163 1755 l cp
eoclip
n 2325 1725 m
 3300 1725 l gs col0 s gr gr

% arrowhead
n 3163 1755 m 3283 1725 l 3163 1695 l  col0 s
% Polyline
gs  clippath
3315 2130 m 3315 2070 l 3163 2070 l 3283 2100 l 3163 2130 l cp
eoclip
n 2325 2100 m
 3300 2100 l gs col0 s gr gr

% arrowhead
n 3163 2130 m 3283 2100 l 3163 2070 l  col0 s
% Polyline
gs  clippath
3315 2580 m 3315 2520 l 3163 2520 l 3283 2550 l 3163 2580 l cp
eoclip
n 2325 2550 m
 3300 2550 l gs col0 s gr gr

% arrowhead
n 3163 2580 m 3283 2550 l 3163 2520 l  col0 s
% Polyline
gs  clippath
5265 2130 m 5265 2070 l 5113 2070 l 5233 2100 l 5113 2130 l cp
eoclip
n 4275 2100 m
 5250 2100 l gs col0 s gr gr

% arrowhead
n 5113 2130 m 5233 2100 l 5113 2070 l  col0 s
% Polyline
gs  clippath
5265 1755 m 5265 1695 l 5113 1695 l 5233 1725 l 5113 1755 l cp
eoclip
n 4275 1725 m
 5250 1725 l gs col0 s gr gr

% arrowhead
n 5113 1755 m 5233 1725 l 5113 1695 l  col0 s
% Polyline
gs  clippath
5265 2580 m 5265 2520 l 5113 2520 l 5233 2550 l 5113 2580 l cp
eoclip
n 4275 2550 m
 5250 2550 l gs col0 s gr gr

% arrowhead
n 5113 2580 m 5233 2550 l 5113 2520 l  col0 s
% Polyline
n 2580 3825 m 2475 3825 2475 5070 105 arcto 4 {pop} repeat
  2475 5175 3720 5175 105 arcto 4 {pop} repeat
  3825 5175 3825 3930 105 arcto 4 {pop} repeat
  3825 3825 2580 3825 105 arcto 4 {pop} repeat
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
gs  clippath
3266 3754 m 3323 3773 l 3371 3629 l 3305 3734 l 3314 3610 l cp
eoclip
n 3675 2625 m
 3300 3750 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 3314 3610 m 3305 3734 l 3371 3629 l  col0 s
% Polyline
n 5205 3900 m 5100 3900 5100 5070 105 arcto 4 {pop} repeat
  5100 5175 7470 5175 105 arcto 4 {pop} repeat
  7575 5175 7575 4005 105 arcto 4 {pop} repeat
  7575 3900 5205 3900 105 arcto 4 {pop} repeat
 cp gs col0 s gr 
% Polyline
n 1005 3750 m 900 3750 900 5145 105 arcto 4 {pop} repeat
  900 5250 1995 5250 105 arcto 4 {pop} repeat
  2100 5250 2100 3855 105 arcto 4 {pop} repeat
  2100 3750 1005 3750 105 arcto 4 {pop} repeat
 cp gs col0 s gr 
% Polyline
n 5430 5175 m 5325 5175 5325 5895 105 arcto 4 {pop} repeat
  5325 6000 7245 6000 105 arcto 4 {pop} repeat
  7350 6000 7350 5280 105 arcto 4 {pop} repeat
  7350 5175 5430 5175 105 arcto 4 {pop} repeat
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
gs  clippath
5973 3845 m 6032 3834 l 6004 3685 l 5997 3809 l 5945 3696 l cp
eoclip
n 5775 2625 m
 6000 3825 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 5945 3696 m 5997 3809 l 6004 3685 l  col0 s
% Polyline
 [60] 0 sd
gs  clippath
1617 3683 m 1676 3695 l 1707 3547 l 1653 3659 l 1648 3535 l cp
eoclip
n 1875 2625 m
 1650 3675 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 1648 3535 m 1653 3659 l 1707 3547 l  col0 s
% Polyline
gs  clippath
7965 1830 m 7965 1770 l 7813 1770 l 7933 1800 l 7813 1830 l cp
eoclip
n 6075 1800 m
 7950 1800 l gs col0 s gr gr

% arrowhead
n 7813 1830 m 7933 1800 l 7813 1770 l  col0 s
% Polyline
gs  clippath
7740 2205 m 7740 2145 l 7588 2145 l 7708 2175 l 7588 2205 l cp
eoclip
n 6150 2175 m
 7725 2175 l gs col0 s gr gr

% arrowhead
n 7588 2205 m 7708 2175 l 7588 2145 l  col0 s
% Polyline
gs  clippath
7665 2505 m 7665 2445 l 7513 2445 l 7633 2475 l 7513 2505 l cp
eoclip
n 6150 2475 m
 7650 2475 l gs col0 s gr gr

% arrowhead
n 7513 2505 m 7633 2475 l 7513 2445 l  col0 s
% Polyline
gs  clippath
10665 2505 m 10665 2445 l 10513 2445 l 10633 2475 l 10513 2505 l cp
eoclip
n 10050 2475 m
 10650 2475 l gs col0 s gr gr

% arrowhead
n 10513 2505 m 10633 2475 l 10513 2445 l  col0 s
% Polyline
n 10725 1725 m 12750 1725 l 12750 9450 l 10725 9450 l
 cp gs col0 s gr 
% Polyline
n 10725 2100 m
 12750 2100 l gs col0 s gr 
% Polyline
n 10725 2325 m
 12750 2325 l gs col0 s gr 
% Polyline
n 10725 2550 m
 12750 2550 l gs col0 s gr 
% Polyline
n 10725 2775 m
 12750 2775 l gs col0 s gr 
% Polyline
n 10725 3000 m
 12750 3000 l gs col0 s gr 
% Polyline
n 10725 3225 m
 12750 3225 l gs col0 s gr 
% Polyline
n 10725 3975 m
 12750 3975 l gs col0 s gr 
% Polyline
n 10725 6975 m
 12750 6975 l gs col0 s gr 
% Polyline
n 5100 -225 m 7950 -225 l 7950 900 l 5100 900 l
 cp gs col0 s gr 
% Polyline
n 1650 -75 m 4500 -75 l 4500 1050 l 1650 1050 l
 cp gs col0 s gr 
% Polyline
gs  clippath
8245 1458 m 8279 1409 l 8154 1322 l 8236 1416 l 8120 1371 l cp
eoclip
n 7500 900 m
 8250 1425 l gs col0 s gr gr

% arrowhead
n 8120 1371 m 8236 1416 l 8154 1322 l  col0 s
% Polyline
n 6405 7050 m 6300 7050 6300 8220 105 arcto 4 {pop} repeat
  6300 8325 8670 8325 105 arcto 4 {pop} repeat
  8775 8325 8775 7155 105 arcto 4 {pop} repeat
  8775 7050 6405 7050 105 arcto 4 {pop} repeat
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
gs  clippath
8894 7036 m 8932 7082 l 9049 6985 l 8938 7039 l 9011 6939 l cp
eoclip
n 11100 5250 m
 8925 7050 l gs col0 s gr gr
 [] 0 sd
% arrowhead
n 9011 6939 m 8938 7039 l 9049 6985 l  col0 s
% Polyline
gs  clippath
8175 1608 m 8201 1554 l 8066 1487 l 8160 1568 l 8039 1541 l cp
eoclip
n 4425 975 m 7425 1200 l
 8175 1575 l gs col0 s gr gr

% arrowhead
n 8039 1541 m 8160 1568 l 8066 1487 l  col0 s
% Polyline
n 4500 1200 m 4950 1200 l 4950 3300 l 4500 3300 l
 cp gs col0 s gr 
% Polyline
n 2550 1200 m 3000 1200 l 3000 3150 l 2550 3150 l
 cp gs col0 s gr 
% Polyline
n 10725 6525 m
 12750 6525 l gs col0 s gr 
/Times-Roman ff 180.00 scf sf
1680 1746 m
gs 1 -1 sc (main.c) col0 sh gr
/Times-Roman ff 180.00 scf sf
1665 2166 m
gs 1 -1 sc (func1.c) col0 sh gr
/Times-Roman ff 180.00 scf sf
1650 2601 m
gs 1 -1 sc (func2.c) col0 sh gr
/Times-Roman ff 180.00 scf sf
3450 1800 m
gs 1 -1 sc (main.s) col0 sh gr
/Times-Roman ff 180.00 scf sf
3450 2175 m
gs 1 -1 sc (func1.s) col0 sh gr
/Times-Roman ff 180.00 scf sf
3450 2550 m
gs 1 -1 sc (func2.s) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 4125 m
gs 1 -1 sc (....) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 4350 m
gs 1 -1 sc (.....) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 4575 m
gs 1 -1 sc (INCL  i) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 4800 m
gs 1 -1 sc (.....) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 5025 m
gs 1 -1 sc (.....) col0 sh gr
/Times-Roman ff 180.00 scf sf
5475 1800 m
gs 1 -1 sc (main.o) col0 sh gr
/Times-Roman ff 180.00 scf sf
5475 2175 m
gs 1 -1 sc (func1.o) col0 sh gr
/Times-Roman ff 180.00 scf sf
5475 2550 m
gs 1 -1 sc (func2.o) col0 sh gr
/Times-Roman ff 180.00 scf sf
5325 4125 m
gs 1 -1 sc (0020      ....) col0 sh gr
/Times-Roman ff 180.00 scf sf
5325 4350 m
gs 1 -1 sc (0024      ....) col0 sh gr
/Times-Roman ff 180.00 scf sf
5325 4575 m
gs 1 -1 sc (0028     FF05 00000000) col0 sh gr
/Times-Roman ff 180.00 scf sf
975 3975 m
gs 1 -1 sc (extern int i;) col0 sh gr
/Times-Roman ff 180.00 scf sf
975 4425 m
gs 1 -1 sc (f1\(\)) col0 sh gr
/Times-Roman ff 180.00 scf sf
975 4650 m
gs 1 -1 sc ({) col0 sh gr
/Times-Roman ff 180.00 scf sf
975 4875 m
gs 1 -1 sc (   ...) col0 sh gr
/Times-Roman ff 180.00 scf sf
975 5100 m
gs 1 -1 sc (   i++;) col0 sh gr
/Times-Roman ff 180.00 scf sf
1500 5475 m
gs 1 -1 sc (C) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
5550 5400 m
gs 1 -1 sc (RELOCATIONS:) col0 sh gr
/Times-Roman ff 180.00 scf sf
5550 5625 m
gs 1 -1 sc (i    @002A  4 bytes) col0 sh gr
/Times-Roman ff 180.00 scf sf
8475 2325 m
gs 1 -1 sc (LINKER) col0 sh gr
/Times-Roman ff 180.00 scf sf
11625 2250 m
gs 1 -1 sc (load_addr) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11625 2475 m
gs 1 -1 sc (exec_addr) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11625 2700 m
gs 1 -1 sc (text size) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11625 2925 m
gs 1 -1 sc (data size) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11625 3150 m
gs 1 -1 sc (bss size) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11625 8100 m
gs 1 -1 sc (.data initial values) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11775 5475 m
gs 1 -1 sc (.text image) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11700 1275 m
gs 1 -1 sc (a.out ) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
11700 1500 m
gs 1 -1 sc (absolute executable file) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
5625 375 m
gs 1 -1 sc (standard C library libc) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 675 m
gs 1 -1 sc (math library libm) col0 sh gr
/Times-Roman ff 180.00 scf sf
6450 7275 m
gs 1 -1 sc (08048112    ....) col0 sh gr
/Times-Roman ff 180.00 scf sf
6450 7500 m
gs 1 -1 sc (08048116   ....) col0 sh gr
/Times-Roman ff 180.00 scf sf
6450 7725 m
gs 1 -1 sc (0804811A  FF05 0804D004) col0 sh gr
/Times-Roman ff 180.00 scf sf
3150 5475 m
gs 1 -1 sc (Assembly language) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
4950 6150 m
gs 1 -1 sc (Object file) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 180.00 scf sf
4950 7275 m
gs 1 -1 sc (Absolute) col0 sh gr
/Times-Roman ff 180.00 scf sf
4950 7500 m
gs 1 -1 sc (Executable) col0 sh gr
/Times-Roman ff 180.00 scf sf
4950 7725 m
gs 1 -1 sc (Machine Code) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 1425 m
gs 1 -1 sc (C) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 1650 m
gs 1 -1 sc (O) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 1875 m
gs 1 -1 sc (M) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 2100 m
gs 1 -1 sc (P) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 2325 m
gs 1 -1 sc (I) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 2550 m
gs 1 -1 sc (L) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 2775 m
gs 1 -1 sc (E) col0 sh gr
/Times-Roman ff 180.00 scf sf
2775 3000 m
gs 1 -1 sc (R) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 1425 m
gs 1 -1 sc (A) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 1650 m
gs 1 -1 sc (S) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 1875 m
gs 1 -1 sc (S) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 2100 m
gs 1 -1 sc (E) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 2325 m
gs 1 -1 sc (M) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 2550 m
gs 1 -1 sc (B) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 2775 m
gs 1 -1 sc (L) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 3000 m
gs 1 -1 sc (E) col0 sh gr
/Times-Roman ff 180.00 scf sf
4725 3225 m
gs 1 -1 sc (R) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F1 13/Times-Roman@0 SF 3.191(The compiler proper tak)33.336
529.014 R 3.192(es C code, passing it through the macro pre-processor)
-.13 F 6.442(,a)-.52 G(nd)-6.442 E .593
(compiles it into symbolic assembly language. By using the)33.336
544.014 R/F2 13/Courier@0 SF(-S)3.843 E F1 .593(option to)3.843 F F2(cc)
3.843 E F1 3.842(,w)C 3.842(ec)-3.842 G .592(an halt)-3.842 F 3.282
(the process before the assembler and link)33.336 559.014 R 3.283
(er are in)-.13 F -.26(vo)-.52 G -.13(ke).26 G 3.283(d, and vie).13 F
6.533(wt)-.325 G 3.283(he intermediate)-6.533 F
(assembly language \214le, which will ha)33.336 574.014 Q .39 -.195
(ve a)-.26 H F2(.s)3.445 E F1 -.195(ex)3.25 G(tension.).195 E 3.293
(The assembler tak)33.336 595.014 R 3.293
(es symbolic assembly language \214les \()-.13 F F2(.s)A F1 6.542(\)a)C
3.292(nd con)-6.542 F -.195(ve)-.52 G 3.292(rts them into).195 F 2.754
(relocatable object \214les \(which ha)33.336 610.014 R 3.144 -.195
(ve a)-.26 H F2(.o)6.199 E F1 -.195(ex)6.004 G 6.004(tension\). An).195
F 2.754(object \214le is similar to an)6.004 F -.195(exe)33.336 625.014
S .257(cutable \("a.out"\) \214le in that it contains machine code, ho)
.195 F(we)-.325 E -.195(ve)-.325 G 3.507(rs).195 G .257
(ymbols which can not)-3.507 F 1.244(be resolv)33.336 640.014 R 1.244
(ed \(as detailed belo)-.195 F 1.244(w\) are left dangling.)-.325 F
1.245(Therefore, it is not ready to run until)7.745 F 2.919(these dangl\
ing links are settled, possibly by linking with additional object \214l\
es.)33.336 655.014 R(By)9.418 E(gi)33.336 670.014 Q(ving)-.325 E F2(cc)
5.671 E F1(the)5.671 E F2(-c)5.671 E F1 2.421(option, the link)5.671 F
2.422(er will not be run and the)-.13 F F2(.o)5.672 E F1 2.422
(\214les will be left for)5.672 F 1.72(subsequent e)33.336 685.014 R
1.72(xamination or linking.)-.195 F 1.719(It is also possible to in)
8.219 F -.26(vo)-.52 G 1.979 -.13(ke t).26 H 1.719
(he assembler directly).13 F(with the)33.336 700.014 Q F2(as)3.25 E F1
(command.)3.25 E .269
(Although some compilers do not separate the assembler)33.336 730.014 R
3.52(,i)-.52 G 3.52(ti)-3.52 G 3.52(su)-3.52 G .27(seful to di)-3.52 F
-.26(vo)-.325 G .27(rce it from the).26 F .184(compiler and mak)33.336
745.014 R 3.434(ei)-.13 G 3.434(tas)-3.434 G .184(eparate utility)-3.434
F 6.684(.I)-.845 G 3.434(nt)-6.684 G .184(his w)-3.434 F(ay)-.13 E 3.434
(,ac)-.845 G .183(ommon assembler program can be)-3.434 F 0 Cg EP
%%Page: 50 50
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 50)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 3.104(written and emplo)33.336 120 R
3.104(yed by compilers for dif)-.13 F 3.105(ferent languages.)-.325 F
-.195(Fo)9.605 G 6.355(re).195 G 3.105(xample, the GNU)-6.55 F .968
(compilers for C, C++ and FOR)33.336 135 R .967(TRAN are all dif)-.78 F
.967(ferent programs, yet the)-.325 F 4.217(ya)-.195 G .967
(ll call on the)-4.217 F/F2 13/Courier@0 SF(as)33.336 150 Q F1 .348
(program for assembly)3.597 F 6.848(.I)-.845 G 3.598(ti)-6.848 G 3.598
(sa)-3.598 G .348(lso useful to be able to introduce)-3.598 F F2(.s)
3.598 E F1 .348(\214les that ha)3.598 F .738 -.195(ve b)-.26 H(een).195
E(written by hand for certain performance optimizations or platform-spe\
ci\214c features.)33.336 165 Q .181(The link)33.336 195 R .181(er tak)
-.13 F .18(es multiple object \()-.13 F F2(.o)A F1 3.43<298c>C .18
(les \(or libraries of object \214les, with)-3.43 F F2(.a)3.43 E F1
-.195(ex)3.43 G(tensions,).195 E .881(as discussed belo)33.336 210 R
.881(w\), resolv)-.325 F .882
(es symbol references, and creates an absolute e)-.195 F -.195(xe)-.195
G .882(cutable \214le.).195 F 3.059(If unresolv)33.336 225 R 3.059
(ed symbols remain at this point, the link)-.195 F 3.058
(er will not be able to create an)-.13 F(absolute e)33.336 240 Q -.195
(xe)-.195 G(cutable and an error will result.).195 E(Lik)33.336 270 Q
4.022(et)-.13 G .772(he assembler)-4.022 F 4.022(,t)-.52 G .772(he link)
-4.022 F .773(er is a separate tool which can be called directly as)-.13
F F2(ld)4.023 E F1 7.273(.T)C(he)-7.273 E .257
(reason for this rather un-mnemonic tw)33.336 285 R .257
(o-letter name is that historically)-.13 F 3.507(,t)-.845 G .257
(he link)-3.507 F .257(er has also)-.13 F .282
(been called the "loader", because it w)33.336 300 R .282
(as responsible for creating the "load deck" of punch)-.13 F .153
(cards that could then be directly run by the computer)33.336 315 R
6.653(.B)-.715 G(esides,)-6.653 E F2(ln)3.403 E F1 -.13(wa)3.403 G 3.402
(sa).13 G .152(lready tak)-3.402 F .152(en as a)-.13 F(command name.)
33.336 330 Q .545(When compiling C programs, it is best to allo)33.336
360 R 3.795(wt)-.325 G(he)-3.795 E F2(cc)3.795 E F1 .545(wrapper to in)
3.795 F -.26(vo)-.52 G -.13(ke).26 G F2(ld)3.926 E F1 .546(rather than)
3.796 F 2.714(trying to do it manually as there are a number of comple)
33.336 375 R 5.964(xp)-.195 G 2.714(latform-speci\214c options)-5.964 F
(needed to actually create a run-able program.)33.336 390 Q(The)33.336
420 Q F2(.o)4.173 E F1 .924(\214les need not ha)4.173 F 1.314 -.195
(ve c)-.26 H .924(ome from C source code.).195 F .924
(It is possible to distrib)7.424 F .924(ute binary)-.26 F .244
(object \214les or libraries which can be link)33.336 435 R .243(ed ag)
-.13 F .243(ainst user)-.065 F .243(-supplied code.)-.26 F .243
(It is also possible)6.743 F 1.62(to create cross-language e)33.336 450
R -.195(xe)-.195 G 1.62
(cutables, where part of the code is written directly in lo).195 F(w-)
-.325 E(le)33.336 465 Q -.195(ve)-.325 G 4.938(la).195 G 1.688
(ssembly language, or in another high-le)-4.938 F -.195(ve)-.325 G 4.938
(ll).195 G 1.688(anguage \(with all due caution about)-4.938 F(mix)
33.336 480 Q(ed run-time en)-.195 E(vironment e)-.52 E(xpectations\).)
-.195 E/F3 13/Times-Bold@0 SF(Separate Compilation)206.489 510 Q F1
-1.443(Ve)33.336 540 S .934
(ry simple C programs can be contained in a single)1.443 F F2(.c)4.185 E
F1 4.185(\214le. As)4.185 F .935(the size of the project)4.185 F 3.567
(increases, it becomes e)33.336 555 R 3.567(xtremely inef)-.195 F 3.567
(\214cient to do this.)-.325 F 3.566(The tasks of pre-processing,)10.067
F 1.13(compiling and assembling are CPU-intensi)33.336 570 R -.195(ve)
-.325 G 7.63(.W).195 G 1.13(ith a single \214le, an)-8.15 F 4.38(yc)
-.195 G 1.13(hange, no matter)-4.38 F(ho)33.336 585 Q 3.25(ws)-.325 G
(mall, requires that the entire \214le be recompiled.)-3.25 E 3.008
(The program can be split up into a number of smaller)33.336 615 R F2
(.c)6.257 E F1 6.257(\214les. There)6.257 F 3.007(are v)6.257 F(arying)
-.325 E .719(opinions on ho)33.336 630 R 3.97<778c>-.325 G .72
(nely to di)-3.97 F .72
(vide the program and on what basis to select which parts go)-.325 F
(into which \214le.)33.336 645 Q(Some guidelines:)6.5 E 3.92(1\) Groups\
 of functions which form a coherent subsystem are good candidates for)
33.336 675 R .264(including in their o)33.336 690 R .264(wn \214le.)
-.325 F .264(In C++ terms, this w)6.764 F .264(ould be a class.)-.13 F
.264(Some subsystems are so)6.764 F(comple)33.336 705 Q 3.25(xt)-.195 G
(hat the)-3.25 E 3.25(yn)-.195 G(eed to be further subdi)-3.25 E(vided.)
-.325 E .751(2\) Whene)33.336 735 R -.195(ve)-.325 G 4.001(ras).195 G
(ingle)-4.001 E F2(.c)4.001 E F1 .75
(\214le is on the order of 1000 lines of code, it is probably getting)
4.001 F 0 Cg EP
%%Page: 51 51
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 51)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 2.773(too big.)33.336 120 R 2.773
(On the other hand, ha)9.273 F 2.773
(ving lots of \214les each containing one or tw)-.26 F 6.024(o1)-.13 G
(0-line)-6.024 E(functions is also w)33.336 135 Q(asteful.)-.13 E 1.134
(3\) Code which is being incorporated from another source, or which is \
being w)33.336 165 R(ork)-.13 E 1.133(ed on)-.13 F .46(by a dif)33.336
180 R .46(ferent programmer)-.325 F 3.71(,s)-.52 G .46(hould ha)-3.71 F
.85 -.195(ve i)-.26 H .46(ts o).195 F .46
(wn \214le, or perhaps be structured as a library)-.325 F(,)-.845 E
(to mak)33.336 195 Q 3.25(ei)-.13 G 3.25(te)-3.25 G
(asier to deal with changes.)-3.25 E .25(As an e)33.336 225 R .25
(xample, let')-.195 F 3.5(ss)-.715 G .25(ay our program has been di)-3.5
F .249(vided into \214les)-.325 F/F2 13/Courier@0 SF(f1.c)3.499 E F1(,)A
F2(f2.c)3.499 E F1(and)3.499 E F2(f3.c)3.499 E F1(.)A 2.264 -1.04(To c)
33.336 240 T .184(ompile this, we could run:)1.04 F F2 .185
(cc f1.c f2.c f3.c)3.435 F F1 3.435(,w)C .185(hich w)-3.435 F .185
(ould perform the entire)-.13 F .744(pre-processing, compiling and asse\
mbling process on each of the three \214les, then in)33.336 255 R -.26
(vo)-.52 G -.13(ke).26 G 2.132(the link)33.336 270 R 2.133
(er to create the)-.13 F F2(a.out)5.383 E F1 8.633(.H)C -.325(ow)-8.633
G -2.795 -.325(ev e).325 H 3.173 -.52(r, s).325 H 2.133(uppose we mak)
.52 F 5.383(eac)-.13 G 2.133(hange to)-5.383 F F2(f1.c)5.383 E F1(only)
5.383 E(.)-.845 E(Wh)33.336 285 Q 3.25(yd)-.065 G 3.25(oa)-3.25 G
(ll that w)-3.25 E(ork ag)-.13 E(ain for the other tw)-.065 E 3.25<6f8c>
-.13 G(les, which ha)-3.25 E .39 -.195(ve n)-.26 H(ot changed?).195 E
.56(Instead, we can \214rst run:)33.336 315 R F2 .56
(cc -c f1.c f2.c f3.c)3.81 F F1 3.81(,w)C .56
(hich will pre-process, compile)-3.81 F 2.729
(and assemble each of the \214les, creating)33.336 330 R F2(f1.o)5.979 E
F1(,)A F2(f2.o)5.979 E F1(and)5.979 E F2(f3.o)5.979 E F1 9.229(.T)C
2.729(hen we run:)-9.229 F F2(cc)5.98 E .052(f1.o f2.o f3.o)33.336 345 R
F1 6.552(.T)C(he)-6.552 E F2(cc)3.301 E F1 .051
(wrapper sees that we are gi)3.301 F .051(ving it)-.325 F F2(.o)3.301 E
F1 .051(\214les and passes them)3.301 F .933(directly to the link)33.336
360 R(er)-.13 E 7.433(.N)-.715 G -.325(ow)-7.433 G 4.183(,i)-.52 G 4.183
(fw)-4.183 G 4.183(ec)-4.183 G(hange)-4.183 E F2(f1.c)4.184 E F1 4.184
(,w)C 4.184(er)-4.184 G(un)-4.184 E F2 .934(cc -c f1.c)4.184 F F1 .934
(to re-compile it)4.184 F .725(alone, and then run)33.336 375 R F2 .725
(cc f1.o f2.o f3.o)3.975 F F1(ag)3.975 E .724(ain to link the program.)
-.065 F .724(This process is)7.224 F .562(automated by the tool)33.336
390 R F2(make)3.812 E F1 3.812(,w)C .562(hich uses dependenc)-3.812 F
3.812(yr)-.195 G .562(ules and \214le modi\214cation times to)-3.812 F
(determine which compilation phases to in)33.336 405 Q -.26(vo)-.52 G
.26 -.13(ke a).26 H(nd on which \214les.).13 E/F3 13/Times-Bold@0 SF
(The link)194.458 450 Q(er vs the compiler)-.13 E F1 2.635
(The job of the link)33.336 480 R 2.635(er is to tak)-.13 F 5.885(eo)
-.13 G 2.634(ne or more relocatable object \214les, resolv)-5.885 F
5.884(es)-.195 G(ymbol)-5.884 E 1.518
(references, and create an absolute e)33.336 495 R -.195(xe)-.195 G
1.518(cutable \214le.).195 F 1.518(The link)8.018 F 1.518
(er does not kno)-.13 F 4.768(wa)-.325 G 1.518(bout C')-4.768 F(s)-.715
E 1.765(type algebra, nor should it, since the link)33.336 510 R 1.765
(er is independent of an)-.13 F 5.015(yp)-.195 G 1.765
(articular high-le)-5.015 F -.195(ve)-.325 G(l).195 E(language.)33.336
525 Q 2.002(Unfortunately for the student, the C language also deals in\
 symbols, e.g. v)33.336 555 R 2.002(ariable and)-.325 F 4.031
(function names, and this issue is sometimes dif)33.336 570 R 4.031
(\214cult to separate from the symbol)-.325 F 2.004
(processing which happens at link time.)33.336 585 R 2.004
(Here are some things that ne)8.504 F -.195(ve)-.325 G 5.254(ra).195 G
2.004(ppear in an)-5.254 F(object \214le and do not concern the link)
33.336 600 Q(er:)-.13 E 3.388(\203Cl)33.336 615 S .138(anguage type spe\
ci\214ers \(such as "p is a pointer to a pointer to a function returnin\
g int)-3.388 F(and taking tw)33.336 630 Q 3.25(oi)-.13 G(nt ar)-3.25 E
(guments"\))-.234 E 3.25(\203Cl)33.336 645 S
(anguage structure, union and enum de\214nitions and typedef names.)
-3.25 E<83>33.336 660 Q F2(goto)3.25 E F1(labels)3.25 E 4.735<8349>
33.336 675 S 1.486(nternal labels that may be generated by the compiler\
 for loops, switch statements, if)-4.735 F(statements, etc.)33.336 690 Q
4.222<8361>33.336 705 S .972(utomatic \(local\) v)-4.222 F 4.222
(ariables. An)-.325 F .972(important e)4.222 F .972
(xception is a local v)-.195 F .972(ariable that is declared)-.325 F
.515(with the)33.336 720 R F2(static)3.765 E F1 .515(storage class.)
3.765 F .516(This v)7.015 F .516
(ariable has local scope, i.e. its name is not visible)-.325 F 3.667
(outside of the curly-braced block in which it is declared, b)33.336 735
R 3.667(ut it li)-.26 F -.195(ve)-.325 G 6.917(si).195 G 6.916(nt)-6.917
G 3.666(he same)-6.916 F 0 Cg EP
%%Page: 52 52
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 52)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(neighborhood as global v)33.336 120 Q
(ariables.)-.325 E 0 0 148 148 -310 310 193.336 466 PBEGIN
%%BeginDocument: obj.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: obj.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Wed Sep 20 02:01:42 2006
%%For: hak@lex ()
%%BoundingBox: 0 0 148 310
%%Magnification: 1.0000
%%EndComments
/MyAppDict 100 dict dup begin def
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 310 moveto 0 0 lineto 148 0 lineto 148 310 lineto closepath clip newpath
-70.0 347.6 translate
1 -1 scale

% This junk string is used by the show operators
/PATsstr 1 string def
/PATawidthshow { 	% cx cy cchar rx ry string
  % Loop over each character in the string
  {  % cx cy cchar rx ry char
    % Show the character
    dup				% cx cy cchar rx ry char char
    PATsstr dup 0 4 -1 roll put	% cx cy cchar rx ry char (char)
    false charpath		% cx cy cchar rx ry char
    /clip load PATdraw
    % Move past the character (charpath modified the
    % current point)
    currentpoint			% cx cy cchar rx ry char x y
    newpath
    moveto			% cx cy cchar rx ry char
    % Reposition by cx,cy if the character in the string is cchar
    3 index eq {			% cx cy cchar rx ry
      4 index 4 index rmoveto
    } if
    % Reposition all characters by rx ry
    2 copy rmoveto		% cx cy cchar rx ry
  } forall
  pop pop pop pop pop		% -
  currentpoint
  newpath
  moveto
} bind def
/PATcg {
  7 dict dup begin
    /lw currentlinewidth def
    /lc currentlinecap def
    /lj currentlinejoin def
    /ml currentmiterlimit def
    /ds [ currentdash ] def
    /cc [ currentrgbcolor ] def
    /cm matrix currentmatrix def
  end
} bind def
% PATdraw - calculates the boundaries of the object and
% fills it with the current pattern
/PATdraw {			% proc
  save exch
    PATpcalc			% proc nw nh px py
    5 -1 roll exec		% nw nh px py
    newpath
    PATfill			% -
  restore
} bind def
% PATfill - performs the tiling for the shape
/PATfill { % nw nh px py PATfill -
  PATDict /CurrentPattern get dup begin
    setfont
    % Set the coordinate system to Pattern Space
    PatternGState PATsg
    % Set the color for uncolored pattezns
    PaintType 2 eq { PATDict /PColor get PATsc } if
    % Create the string for showing
    3 index string		% nw nh px py str
    % Loop for each of the pattern sources
    0 1 Multi 1 sub {		% nw nh px py str source
	% Move to the starting location
	3 index 3 index		% nw nh px py str source px py
	moveto			% nw nh px py str source
	% For multiple sources, set the appropriate color
	Multi 1 ne { dup PC exch get PATsc } if
	% Set the appropriate string for the source
	0 1 7 index 1 sub { 2 index exch 2 index put } for pop
	% Loop over the number of vertical cells
	3 index 		% nw nh px py str nh
	{			% nw nh px py str
	  currentpoint		% nw nh px py str cx cy
	  2 index oldshow	% nw nh px py str cx cy
	  YStep add moveto	% nw nh px py str
	} repeat		% nw nh px py str
    } for
    5 { pop } repeat
  end
} bind def

% PATkshow - kshow with the current pattezn
/PATkshow {			% proc string
  exch bind			% string proc
  1 index 0 get			% string proc char
  % Loop over all but the last character in the string
  0 1 4 index length 2 sub {
				% string proc char idx
    % Find the n+1th character in the string
    3 index exch 1 add get	% string proc char char+1
    exch 2 copy			% strinq proc char+1 char char+1 char
    % Now show the nth character
    PATsstr dup 0 4 -1 roll put	% string proc chr+1 chr chr+1 (chr)
    false charpath		% string proc char+1 char char+1
    /clip load PATdraw
    % Move past the character (charpath modified the current point)
    currentpoint newpath moveto
    % Execute the user proc (should consume char and char+1)
    mark 3 1 roll		% string proc char+1 mark char char+1
    4 index exec		% string proc char+1 mark...
    cleartomark			% string proc char+1
  } for
  % Now display the last character
  PATsstr dup 0 4 -1 roll put	% string proc (char+1)
  false charpath		% string proc
  /clip load PATdraw
  neewath
  pop pop			% -
} bind def
% PATmp - the makepattern equivalent
/PATmp {			% patdict patmtx PATmp patinstance
  exch dup length 7 add		% We will add 6 new entries plus 1 FID
  dict copy			% Create a new dictionary
  begin
    % Matrix to install when painting the pattern
    TilingType PATtcalc
    /PatternGState PATcg def
    PatternGState /cm 3 -1 roll put
    % Check for multi pattern sources (Level 1 fast color patterns)
    currentdict /Multi known not { /Multi 1 def } if
    % Font dictionary definitions
    /FontType 3 def
    % Create a dummy encoding vector
    /Encoding 256 array def
    3 string 0 1 255 {
      Encoding exch dup 3 index cvs cvn put } for pop
    /FontMatrix matrix def
    /FontBBox BBox def
    /BuildChar {
	mark 3 1 roll		% mark dict char
	exch begin
	Multi 1 ne {PaintData exch get}{pop} ifelse  % mark [paintdata]
	  PaintType 2 eq Multi 1 ne or
	  { XStep 0 FontBBox aload pop setcachedevice }
	  { XStep 0 setcharwidth } ifelse
	  currentdict		% mark [paintdata] dict
	  /PaintProc load	% mark [paintdata] dict paintproc
	end
	gsave
	  false PATredef exec true PATredef
	grestore
	cleartomark		% -
    } bind def
    currentdict
  end				% newdict
  /foo exch			% /foo newlict
  definefont			% newfont
} bind def
% PATpcalc - calculates the starting point and width/height
% of the tile fill for the shape
/PATpcalc {	% - PATpcalc nw nh px py
  PATDict /CurrentPattern get begin
    gsave
	% Set up the coordinate system to Pattern Space
	% and lock down pattern
	PatternGState /cm get setmatrix
	BBox aload pop pop pop translate
	% Determine the bounding box of the shape
	pathbbox			% llx lly urx ury
    grestore
    % Determine (nw, nh) the # of cells to paint width and height
    PatHeight div ceiling		% llx lly urx qh
    4 1 roll				% qh llx lly urx
    PatWidth div ceiling		% qh llx lly qw
    4 1 roll				% qw qh llx lly
    PatHeight div floor			% qw qh llx ph
    4 1 roll				% ph qw qh llx
    PatWidth div floor			% ph qw qh pw
    4 1 roll				% pw ph qw qh
    2 index sub cvi abs			% pw ph qs qh-ph
    exch 3 index sub cvi abs exch	% pw ph nw=qw-pw nh=qh-ph
    % Determine the starting point of the pattern fill
    %(px, py)
    4 2 roll				% nw nh pw ph
    PatHeight mul			% nw nh pw py
    exch				% nw nh py pw
    PatWidth mul exch			% nw nh px py
  end
} bind def

% Save the original routines so that we can use them later on
/oldfill	/fill load def
/oldeofill	/eofill load def
/oldstroke	/stroke load def
/oldshow	/show load def
/oldashow	/ashow load def
/oldwidthshow	/widthshow load def
/oldawidthshow	/awidthshow load def
/oldkshow	/kshow load def

% These defs are necessary so that subsequent procs don't bind in
% the originals
/fill	   { oldfill } bind def
/eofill	   { oldeofill } bind def
/stroke	   { oldstroke } bind def
/show	   { oldshow } bind def
/ashow	   { oldashow } bind def
/widthshow { oldwidthshow } bind def
/awidthshow { oldawidthshow } bind def
/kshow 	   { oldkshow } bind def
/PATredef {
  MyAppDict begin
    {
    /fill { /clip load PATdraw newpath } bind def
    /eofill { /eoclip load PATdraw newpath } bind def
    /stroke { PATstroke } bind def
    /show { 0 0 null 0 0 6 -1 roll PATawidthshow } bind def
    /ashow { 0 0 null 6 3 roll PATawidthshow }
    bind def
    /widthshow { 0 0 3 -1 roll PATawidthshow }
    bind def
    /awidthshow { PATawidthshow } bind def
    /kshow { PATkshow } bind def
  } {
    /fill   { oldfill } bind def
    /eofill { oldeofill } bind def
    /stroke { oldstroke } bind def
    /show   { oldshow } bind def
    /ashow  { oldashow } bind def
    /widthshow { oldwidthshow } bind def
    /awidthshow { oldawidthshow } bind def
    /kshow  { oldkshow } bind def
    } ifelse
  end
} bind def
false PATredef
% Conditionally define setcmykcolor if not available
/setcmykcolor where { pop } {
  /setcmykcolor {
    1 sub 4 1 roll
    3 {
	3 index add neg dup 0 lt { pop 0 } if 3 1 roll
    } repeat
    setrgbcolor - pop
  } bind def
} ifelse
/PATsc {		% colorarray
  aload length		% c1 ... cn length
    dup 1 eq { pop setgray } { 3 eq { setrgbcolor } { setcmykcolor
  } ifelse } ifelse
} bind def
/PATsg {		% dict
  begin
    lw setlinewidth
    lc setlinecap
    lj setlinejoin
    ml setmiterlimit
    ds aload pop setdash
    cc aload pop setrgbcolor
    cm setmatrix
  end
} bind def

/PATDict 3 dict def
/PATsp {
  true PATredef
  PATDict begin
    /CurrentPattern exch def
    % If it's an uncolored pattern, save the color
    CurrentPattern /PaintType get 2 eq {
      /PColor exch def
    } if
    /CColor [ currentrgbcolor ] def
  end
} bind def
% PATstroke - stroke with the current pattern
/PATstroke {
  countdictstack
  save
  mark
  {
    currentpoint strokepath moveto
    PATpcalc				% proc nw nh px py
    clip newpath PATfill
    } stopped {
	(*** PATstroke Warning: Path is too complex, stroking
	  with gray) =
    cleartomark
    restore
    countdictstack exch sub dup 0 gt
	{ { end } repeat } { pop } ifelse
    gsave 0.5 setgray oldstroke grestore
  } { pop restore pop } ifelse
  newpath
} bind def
/PATtcalc {		% modmtx tilingtype PATtcalc tilematrix
  % Note: tiling types 2 and 3 are not supported
  gsave
    exch concat					% tilingtype
    matrix currentmatrix exch			% cmtx tilingtype
    % Tiling type 1 and 3: constant spacing
    2 ne {
	% Distort the pattern so that it occupies
	% an integral number of device pixels
	dup 4 get exch dup 5 get exch		% tx ty cmtx
	XStep 0 dtransform
	round exch round exch			% tx ty cmtx dx.x dx.y
	XStep div exch XStep div exch		% tx ty cmtx a b
	0 YStep dtransform
	round exch round exch			% tx ty cmtx a b dy.x dy.y
	YStep div exch YStep div exch		% tx ty cmtx a b c d
	7 -3 roll astore			% { a b c d tx ty }
    } if
  grestore
} bind def
/PATusp {
  false PATredef
  PATDict begin
    CColor PATsc
  end
} bind def

% this is the pattern fill program from the Second edition Reference Manual
% with changes to call the above pattern fill
% left30
11 dict begin
/PaintType 1 def
/PatternType 1 def
/TilingType 1 def
/BBox [0 0 1 1] def
/XStep 1 def
/YStep 1 def
/PatWidth 1 def
/PatHeight 1 def
/Multi 2 def
/PaintData [
  { clippath } bind
  { 32 16 true [ 32 0 0 -16 0 16 ]
	{<c000c000300030000c000c000300030000c000c000300030
	000c000c00030003c000c000300030000c000c0003000300
	00c000c000300030000c000c00030003>}
     imagemask } bind
] def
/PaintProc {
	pop
	exec fill
} def
currentdict
end
/P1 exch def

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Polyline
30.000 slw
n 1200 1200 m 3600 1200 l 3600 5760 l 1200 5760 l
 cp gs /PC [[1.00 1.00 1.00] [0.00 0.00 0.00]] def
15.00 15.00 sc P1 [16 0 0 -8 80.00 80.00] PATmp PATsp ef gr PATusp gs col0 s gr 
% Polyline
n 1200 1200 m 3600 1200 l 3600 1920 l 1200 1920 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 1200 1920 m 3600 1920 l 3600 3120 l 1200 3120 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 1200 3120 m 3600 3120 l 3600 4200 l 1200 4200 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 1200 4200 m 3600 4200 l 3600 5040 l 1200 5040 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
% Polyline
n 1200 5040 m 3600 5040 l 3600 5760 l 1200 5760 l
 cp gs col7 1.00 shd ef gr gs col0 s gr 
/Times-Roman ff 240.00 scf sf
2280 1560 m
gs 1 -1 sc (header) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 240.00 scf sf
2280 2520 m
gs 1 -1 sc (.text) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 240.00 scf sf
2280 3600 m
gs 1 -1 sc (.data) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 240.00 scf sf
2280 4680 m
gs 1 -1 sc (relocations table) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 240.00 scf sf
2280 5400 m
gs 1 -1 sc (symbol table) dup sw pop 2 div neg 0 rm  col0 sh gr
/Times-Roman ff 270.00 scf sf
2520 840 m
gs 1 -1 sc (Object File) dup sw pop 2 div neg 0 rm  col0 sh gr
% here ends figure;
$F2psEnd
rs
end
showpage
%%EndDocument
end PEND/F2 13/Times-Bold@0 SF(What')225.684 487 Q 3.25(si)-.481 G 3.25
(na.)-3.25 G(o?)-3.25 E F1(Let')33.336 517 Q 3.25(ss)-.715 G
(ee what is actually in an object \214le and ho)-3.25 E 3.25(wi)-.325 G
3.25(tg)-3.25 G(ets there:)-3.25 E/F3 10/Courier@0 SF(/* f1.c */)33.336
529 Q(extern int i;)33.336 541 Q(f\(\))33.336 565 Q({)33.336 577 Q(i=2;)
90.936 589 Q(})33.336 601 Q(/* f2.c */)33.336 625 Q(int i;)33.336 637 Q
(main\(\))33.336 649 Q({)33.336 661 Q(i=1;)90.936 673 Q(f\(\);)90.936
685 Q(})33.336 697 Q F1(In)33.336 712 Q/F4 13/Courier@0 SF(f1.c)4.308 E
F1 4.308(,t)C(he)-4.308 E F4(extern)4.308 E F1 1.058
(storage class for v)4.308 F(ariable)-.325 E/F5 13/Times-Italic@0 SF(i)
4.308 E F1 1.058(tells the compiler that this v)4.308 F 1.059
(ariable is)-.325 F -.195(ex)33.336 727 S .148(ternal to that).195 F F4
(.c)3.398 E F1 3.398(\214le. Therefore,)3.398 F .148
(the compiler does not complain when it does not see a)3.398 F 2.199
(declaration that v)33.336 742 R 5.449(ariable. Instead,)-.325 F 2.2
(it kno)5.45 F 2.2(ws that)-.325 F F4(i)5.45 E F1 2.2(is a global v)5.45
F 2.2(ariable, and should be)-.325 F 0 Cg EP
%%Page: 53 53
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 53)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF .79
(accessed by using an absolute addressing mode.)33.336 120 R .789
(Neither the compiler nor the assembler)7.29 F(kno)33.336 135 Q 1.159
(ws what that actual address will be.)-.325 F 1.16
(That is not decided until the link)7.659 F 1.16(er puts all the)-.13 F
2.041(object \214les together and assigns addresses to symbols.)33.336
150 R 2.041(Therefore, the assembler must)8.541 F(lea)33.336 165 Q .626
-.195(ve a ")-.26 H .236(place-holder" in the object \214le.).195 F(Lik)
6.736 E -.325(ew)-.13 G .237
(ise, in f2.o, there will be a reference to the).325 F(symbol)33.336 180
Q/F2 13/Courier@0 SF(f)3.25 E F1(.)A .381(Let us e)33.336 210 R .381(xa\
mine the assembly language \214les produced \(using an older gcc under \
Linux on)-.195 F(an x86 system\):)33.336 225 Q/F3 10/Courier@0 SF
(**** f1.s)39.336 237 Q(.text)90.936 249 Q(.globl f)90.936 261 Q 18
(.type f,@function)87.336 273 R(f:)39.336 285 Q(pushl %ebp)87.336 297 Q
(*These instructions set up)58.8 E(movl %esp,%ebp)87.336 309 Q
(*the stack frame pointer)92.4 E(movl $2,i)87.336 321 Q 140.4
(leave *Restore)87.336 333 R(frame pointer)6 E(ret)87.336 345 Q(.Lfe1:)
39.336 357 Q 18(.size f,.Lfe1-f)87.336 369 R(**** f2.s)39.336 393 Q
(.text)90.936 405 Q(.globl main)90.936 417 Q 18(.type main,@function)
87.336 429 R(main:)39.336 441 Q(pushl %ebp)87.336 453 Q
(*These instructions set up)58.8 E(movl %esp,%ebp)87.336 465 Q
(*the stack frame pointer)92.4 E(movl $1,i)90.936 477 Q(call f)87.336
489 Q 140.4(leave *Restore)87.336 501 R(frame pointer)6 E(ret)87.336 513
Q(.Lfe1:)39.336 525 Q 18(.size main,.Lfe1-main)87.336 537 R 12
(.comm i,4,4)87.336 549 R F1 .504(The assembler directi)33.336 594 R
-.195(ve)-.325 G F2(.text)3.949 E F1 .504
(tells the assembler that it is assembling opcodes to go in)3.754 F
1.898(the .te)33.336 609 R 1.897(xt section of the object \214le.)-.195
F(The)8.397 E F2(.globl)5.147 E F1(directi)5.147 E 2.287 -.195(ve w)
-.325 H 1.897(ill cause the assembler to).195 F -.195(ex)33.336 624 S
3.379(port the associated symbol as a de\214ning instance.).195 F F2
(.type)9.879 E F1 3.379(is used to pass along)6.629 F 2.484
(information into the object \214le as to the type of the symbol.)33.336
639 R 2.483(Please note that it has)8.984 F .554
(nothing to do with the C language notion of type.)33.336 654 R .555
(Symbol types may either be functions)7.055 F 2.485(or v)33.336 669 R
5.735(ariables. The)-.325 F(link)5.735 E 2.485
(er is able to catch gross errors such as if)-.13 F F2(f)5.734 E F1
2.484(were de\214ned as a)5.734 F -.325(va)33.336 684 S 1.526(riable in)
.325 F F2(f1.c)4.776 E F1 1.526(instead of a function. The)4.776 F F2
(.size)4.777 E F1(directi)4.777 E 1.917 -.195(ve c)-.325 H 1.527
(alculates the size of the).195 F 1.556(function by subtracting the v)
33.336 699 R 1.556
(alue of the symbol representing the \214rst instruction of the)-.325 F
.159(function \(e.g.)33.336 714 R F2(main)3.409 E F1 3.409(\)f)C .16
(rom a placeholder assembler symbol \(e.g.)-3.409 F F2(.Lfe1)3.41 E F1
3.41(\)r)C .16(epresenting the)-3.41 F 1.621(end of the function.)33.336
729 R 1.621(Note that the CALL to function)8.121 F F2(f)4.871 E F1 1.621
(is done symbolically)4.871 F 4.871(,a)-.845 G 4.871(si)-4.871 G 4.87
(st)-4.871 G(he)-4.87 E(assignment into global v)33.336 744 Q(ariable)
-.325 E F2(i)3.25 E F1(.)A 0 Cg EP
%%Page: 54 54
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 54)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF .938
(The resulting object \214le is similar to an a.out \214le, ho)33.336
120 R(we)-.325 E -.195(ve)-.325 G 4.189(ra).195 G .939
(ll addresses are relati)-4.189 F -.195(ve)-.325 G 7.439(.I).195 G(n)
-7.439 E 2.096(addition, the object \214le will ha)33.336 135 R 2.486
-.195(ve a s)-.26 H 2.096(ection kno).195 F 2.096(wn as the)-.325 F/F2
13/Times-Bold@0 SF 2.095(symbol table)5.346 F F1 2.095(containing an)
5.345 F .571(entry for e)33.336 150 R -.195(ve)-.325 G .571(ry symbol t\
hat is either de\214ned or referenced in the \214le, and another sectio\
n).195 F(called the)33.336 165 Q F2 -.234(re)3.25 G(locations table).234
E F1 3.25(,d)C(escribed belo)-3.25 E -.845(w.)-.325 G(No)33.336 195 Q
2.671 -.845(w, l)-.325 H .981(et us vie).845 F 4.23(wt)-.325 G .98
(he .te)-4.23 F .98(xt section of)-.195 F/F3 13/Courier@0 SF(f1.o)4.23 E
F1 .98(\(the listing belo)4.23 F 4.23(ww)-.325 G .98
(as re-formatted from the)-4.36 F(output of objdump -d\):)33.336 210 Q
/F4 10/Courier@0 SF(Offset Opcodes)33.336 222 Q(Disassembly)142.8 E 12
(0000 55)33.336 234 R(pushl %ebp)144 E 12(0001 89E5)33.336 246 R
(movl %esp,%ebp)132 E 12(0003 C7050000000002000000)33.336 258 R
(movl $2,0)36 E 12(000D C9)33.336 270 R(leave)144 E 12(000E C3)33.336
282 R(ret)144 E F1 1.225(First, note that the of)33.336 312 R 1.226
(fset of the \214rst instruction is 0.)-.325 F(Ob)7.726 E(viously)-.195
E 4.476(,t)-.845 G 1.226(his can not be a v)-4.476 F(alid)-.325 E .432
(memory address.)33.336 327 R .432(All of)6.932 F .432
(fsets in object \214les are relati)-.325 F .821 -.195(ve t)-.325 H
3.681(ot).195 G .431(he object \214le.)-3.681 F .431(It isn')6.931 F
3.681(tu)-.234 G .431(ntil the)-3.681 F(link)33.336 342 Q
(er kicks in that symbols g)-.13 E(ain absolute, usable addresses.)-.065
E(Ne)33.336 372 Q 2.097(xt note that in the instruction be)-.195 F 2.097
(ginning at of)-.195 F 2.098(fset 0003, the constant 2 is mo)-.325 F
-.195(ve)-.195 G 5.348(dt).195 G(o)-5.348 E 2.909(memory address 0.)
33.336 387 R 4.988 -1.04(We k)9.408 H(no)1.04 E 6.158(wf)-.325 G 2.908
(rom e)-6.158 F 2.908(xamining the corresponding assembly language)-.195
F .158(input \214le that this is the instruction that mo)33.336 402 R
-.195(ve)-.195 G 3.408(s2i).195 G .158(nto v)-3.408 F(ariable)-.325 E F3
(i)3.408 E F1 6.659(.T)C .159(he assembler has left a)-6.659 F .627
(place-holder of 00000000 in the object \214le where the link)33.336 417
R .627(er will ha)-.13 F 1.017 -.195(ve t)-.26 H 3.877<6f8c>.195 G .627
(ll in the actual)-3.877 F 2.718(32-bit address of symbol)33.336 432 R
F3(i)5.969 E F1 2.719(once that is kno)5.969 F 5.969(wn. C705)-.325 F
2.719(is the x86 machine language)5.969 F 1.506(opcode for the MO)33.336
447 R 1.506
(VL instruction where the source addressing mode is Immediate and)-.65 F
1.41(the destination mode is Absolute.)33.336 462 R 1.41(The ne)7.91 F
1.411(xt 4 bytes are the destination address and the)-.195 F 1.143(\214\
nal 4 bytes of the instruction are the source operand \(which is in Int\
el-style, or "little-)33.336 477 R(endian" byte order\).)33.336 492 Q
(Here is the dump of f2.o:)33.336 522 Q F4(Offset Opcodes)33.336 534 Q
(Disassembly)146.4 E 12(0000 55)33.336 546 R(pushl %ebp)138 E 12
(0001 89E5)33.336 558 R(movl %esp,%ebp)126 E 12
(0003 C7050000000001000000)33.336 570 R(movl $1,0)30 E 12
(000D E8FCFFFFFF)33.336 582 R(call 000E)90 E 12(0012 C9)33.336 594 R
(leave)138 E 12(0013 C3)33.336 606 R(ret)138 E F1 1.796
(Note that the placeholder in the CALL instruction is FFFFFFFC, b)33.336
636 R 1.797(ut the disassembler)-.26 F 2.032(decodes that as 000E.)
33.336 651 R 2.032
(This is because the CALL instruction uses a Program Counter)8.532 F
(Relati)33.336 666 Q 1.659 -.195(ve a)-.325 H 1.269(ddressing mode.).195
F 1.269(The address to which e)7.769 F -.195(xe)-.195 G 1.269
(cution jumps is the operand in the).195 F .776
(instruction added to the v)33.336 681 R .776
(alue of the Program Counter re)-.325 F(gister)-.195 E/F5 13
/Times-Italic@0 SF(corr)4.026 E .776(esponding to the byte)-.481 F(be)
33.336 696 Q 1.842(yond the last byte of the CALL instruction)-.39 F F1
8.342(.I)C 5.092(nt)-8.342 G -.13(wo)-5.092 G 3.272 -.715('s c).13 H
1.842(omplement, FFFFFFFC is -4,).715 F .59
(therefore the CALL appears to be to the instruction at of)33.336 711 R
.59(fset 000E.)-.325 F .59(Of course, all of this)7.09 F 3.47
(is meaningless since it is just a placeholder that will be o)33.336 726
R -.195(ve)-.195 G 3.47(rwritten by the link).195 F(er)-.13 E(.)-.715 E
1.768(Nonetheless, it reminds us that there are dif)33.336 741 R(ferent)
-.325 E F2 1.768(Relocation T)5.018 F(ypes)-.962 E F1 1.768
(depending on the)5.018 F 0 Cg EP
%%Page: 55 55
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 55)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(addressing mode being used.)33.336 120 Q
(The symbol and relocation tables for the tw)33.336 150 Q 3.25(oo)-.13 G
(bject \214les will look something lik)-3.25 E 3.25(et)-.13 G(his:)-3.25
E/F2 10/Courier@0 SF(f1.o:)33.336 162 Q(SYMBOL TABLE)148.536 174 Q 18
(NAME TYPE)33.336 186 R(VALUE)54 E 42(ff)33.336 198 S 48(unc 0)-42 F
(in .text)6 E 42(iv)33.336 210 S 24(ariable [reference])-42 F
(RELOCATIONS TABLE)148.536 222 Q 12(SYMBOL=i OFFSET=0005)33.336 234 R 6
(LENGTH=4 RELTYPE=ABSOLUTE)12 F(f2.o:)33.336 282 Q(SYMBOL TABLE)148.536
294 Q 18(NAME TYPE)33.336 306 R(VALUE)54 E 42(ff)33.336 318 S 24
(unction [reference])-42 F 42(iv)33.336 330 S 24(ariable 8)-42 F
(in .bss)6 E 18(main function)33.336 342 R 6(0i)30 G 6(n.)-6 G(text)-6 E
(RELOCATIONS TABLE)148.536 354 Q 12(SYMBOL=i OFFSET=0005)33.336 366 R
(RELTYPE=ABSOLUTE)12 E 12(SYMBOL=f OFFSET=000E)33.336 378 R
(RELTYPE=PCRELATIVE)12 E/F3 13/Times-Bold@0 SF(What ld does)230.858 408
Q F1(The \214rst task of)33.336 438 Q/F4 13/Courier@0 SF(ld)3.25 E F1
(is to tak)3.25 E 3.251(ei)-.13 G -2.405 -.52(nv e)-3.251 H .001
(ntory of all of the).52 F F4(.o)3.251 E F1 .001
(\214les being presented to it.)3.251 F .001(It loads)6.501 F 1.298(in \
the symbol tables from all of the object \214les to create a uni\214ed \
symbol table for the)33.336 453 R 1.042(entire program.)33.336 468 R
1.042(There is only one global namespace for all link)7.542 F 1.042
(er symbols.)-.13 F 1.042(This might)7.542 F 1.248
(be considered a de\214cienc)33.336 483 R 6.188 -.845(y. L)-.195 H(et')
.845 E 4.498(ss)-.715 G 1.248(ay we ha)-4.498 F 1.638 -.195(ve a m)-.26
H(odule).195 E F4(foo.c)4.498 E F1 1.248(that de\214nes a function)4.498
F(called)33.336 498 Q F4(calculate)3.827 E F1 7.077(.I)C 3.827(fw)-7.077
G 3.827(ea)-3.827 G .577
(ttempt to incorporate that module into a program written by)-3.827 F
.618(someone else, the)33.336 513 R 3.867(ym)-.195 G .617(ay ha)-3.867 F
1.007 -.195(ve a)-.26 H .617(lso made a function called).195 F F4
(calculate)3.867 E F1 7.117(.I)C 3.867(ti)-7.117 G .617(s, after all, a)
-3.867 F(common name.)33.336 528 Q 2.372(If there is more than one de\
\214ning instance of a symbol, i.e. if a symbol is)33.336 558 R/F5 13
/Times-Italic@0 SF(multiply-)5.623 E(de\214ned)33.336 573 Q F1 5.499(,t)
C 2.249(his is generally a f)-5.499 F 2.249(atal error)-.13 F 8.749(.C)
-.715 G 2.249(onsider what w)-8.749 F 2.249(ould happen if a programmer)
-.13 F .233(accidentally included tw)33.336 588 R 3.483(ov)-.13 G .233
(ersions of function)-3.678 F F4(f)3.483 E F1(abo)3.483 E .623 -.195
(ve i)-.195 H 3.483(nt).195 G .493 -.13(wo d)-3.483 H(if).13 E(ferent)
-.325 E F4(.c)3.483 E F1 3.483(\214les. When)3.483 F F4(f)3.484 E F1
(is called some)33.336 603 Q(where in the program, which v)-.325 E
(ersion should be called?)-.195 E 3.189 -1.04(To a)33.336 633 T 1.109
(meliorate this problem of \215at global link)1.04 F 1.109
(er namespace, a con)-.13 F -.195(ve)-.52 G 1.109(ntion e).195 F 1.109
(xists that one)-.195 F 1.206(should prepend to one')33.336 648 R 4.457
(sg)-.715 G 1.207(lobal v)-4.457 F 1.207
(ariable and function names a reasonably unique pre\214x.)-.325 F .983
(Therefore, we might call our function)33.336 663 R F4(foo_calculate)
4.233 E F1 7.483(.T)C .982(his is less lik)-7.483 F .982
(ely to con\215ict)-.13 F(with another name.)33.336 678 Q(It isn')6.5 E
3.25(tap)-.234 G(erfect solution, b)-3.25 E(ut it w)-.26 E(orks f)-.13 E
(airly well in reality)-.13 E(.)-.845 E .248(In languages lik)33.336 708
R 3.498(eC)-.13 G .248(++, which tak)-3.498 F .248(es name o)-.13 F
-.195(ve)-.195 G .248(rloading to an e).195 F .248
(xtreme, the identi\214ed names)-.195 F 1.478
(used in the source code are)33.336 723 R F3(name-mangled)4.728 E F1
1.478(to be non-con\215icting when placed into the)4.728 F(global link)
33.336 738 Q(er namespace.)-.13 E 0 Cg EP
%%Page: 56 56
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 56)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 1.124(Global v)33.336 120 R 1.124
(ariable and function names that are intended to remain pri)-.325 F
-.325(va)-.325 G 1.124(te to the).325 F/F2 13/Courier@0 SF(.c)4.374 E F1
1.125(\214le in)4.374 F .615(which the)33.336 135 R 3.865(ya)-.195 G
.615(re declared should be protected with the)-3.865 F F2(static)3.865 E
F1 .615(storage class \(see belo)3.865 F(w\).)-.325 E F2(static)33.336
150 Q F1 .965(symbols still require the assistance of the link)4.215 F
.965(er to be relocated.)-.13 F(Ho)7.465 E(we)-.325 E -.195(ve)-.325 G
2.005 -.52(r, t).195 H(he).52 E .953(use of)33.336 165 R F2(static)4.203
E F1 .952
(causes the compiler and the assembler to \215ag that symbol as a LOCAL)
4.203 F 5.837(symbol. The)33.336 180 R(link)5.837 E 2.587
(er will then enter the symbol into a pri)-.13 F -.325(va)-.325 G 2.587
(te namespace just for the).325 F 2.002
(corresponding object \214le, and the symbol will ne)33.336 195 R -.195
(ve)-.325 G 5.252(rc).195 G 2.002(on\215ict with symbols from other)
-5.252 F(object \214les.)33.336 210 Q .214(There are rare cases where i\
t is useful to deliberately rede\214ne a symbol.)33.336 240 R -.195(Fo)
6.714 G 3.464(ri).195 G .215(nstance, we)-3.464 F 1.643
(may need to change ho)33.336 255 R 4.893(wap)-.325 G 1.643
(iece of code, a)-4.893 F -.325(va)-.26 G 1.643
(ilable only in library or object \214le form,).325 F .823
(calls another function.)33.336 270 R .823(This all f)7.323 F .823
(alls under the heading of "wild and crazy ld tricks" and)-.13 F 1.765
(will not be discussed further)33.336 285 R 8.265(.J)-.715 G 1.765
(ust remember that an)-8.265 F 5.015(yd)-.195 G 1.764
(uplicate symbol de\214nitions are)-5.015 F(generally wrong.)33.336 300
Q .496(There is one antiquated e)33.336 330 R .496(xception which)-.195
F F2(ld)3.746 E F1 .496(still honors: the so-called COMMON block,)3.746
F 3.012(which is a hango)33.336 345 R -.195(ve)-.195 G 6.262(rf).195 G
3.012(rom FOR)-6.262 F 6.262(TRAN. If)-.78 F 3.012
(there are multiple de\214ning instances of a)6.262 F -.325(va)33.336
360 S .716(riable in the bss section \(i.e.).325 F 3.966(ag)7.216 G .716
(lobal v)-3.966 F .716(ariable without an initializer\),)-.325 F F2(ld)
3.966 E F1 .716(will look the)3.966 F .269(other w)33.336 375 R(ay)-.13
E 6.769(.T)-.845 G .268(his is because there really isn')-6.769 F 3.518
(taf)-.234 G .268(atal con\215ict.)-3.648 F .268
(As long as the de\214nitions all)6.768 F(gi)33.336 390 Q 2.131 -.195
(ve t)-.325 H 1.741
(he same size and all agree that it is a bss symbol, there').195 F 4.992
(sn)-.715 G 4.992(ow)-4.992 G 1.742(orry about which)-5.122 F .492
(de\214nition is the correct one.)33.336 405 R .491(All are equi)6.991 F
-.325(va)-.325 G 3.741(lent. So,).325 F .491
(if one accidentally declares a global)3.741 F(uninitialized v)33.336
420 Q(ariable twice, the program will compile \214ne.)-.325 E
(It is slopp)6.5 E 1.69 -.845(y, h)-.13 H -.325(ow).845 G -2.795 -.325
(ev e).325 H -.715(r.).325 G .655(Frequently symbols ha)33.336 450 R
1.045 -.195(ve a d)-.26 H .655(e\214ning instance, b).195 F .655(ut the)
-.26 F 3.906(ya)-.195 G .656(re ne)-3.906 F -.195(ve)-.325 G 3.906(ra)
.195 G .656(ctually referenced.)-3.906 F -.195(Fo)7.156 G(r).195 E -.195
(ex)33.336 465 S 2.373(ample, the programmer may write a function, b)
.195 F 2.372(ut ne)-.26 F -.195(ve)-.325 G 5.622(rc).195 G 2.372
(all it, or declare a global)-5.622 F -.325(va)33.336 480 S
(riable, yet ne).325 E -.195(ve)-.325 G 3.25(ru).195 G(se it in an e)
-3.25 E 3.25(xpression. The)-.195 F(link)3.25 E(er doesn')-.13 E 3.25
(tc)-.234 G(are about this.)-3.25 E(Ho)33.336 510 Q(we)-.325 E -.195(ve)
-.325 G 4.764 -.52(r, i).195 H 6.974(tc).52 G 3.724
(ares deeply about the opposite case: a symbol that is referenced \(by)
-6.974 F 1.941(appearing in a relocations table\) b)33.336 525 R 1.941
(ut which has no de\214ning instance.)-.26 F 1.941(Such a situation)
8.441 F(mak)33.336 540 Q .721(es it impossible for the link)-.13 F .722
(er to complete its task of creating an absolute e)-.13 F -.195(xe)-.195
G(cutable).195 E 1.24(\214le with no dangling references.)33.336 555 R
1.24(Therefore, it will stop with a f)7.74 F 1.239(atal error)-.13 F
4.489(,r)-.52 G 1.239(eporting the)-4.489 F(unde\214ned symbol and the \
object \214le or \214les in which it is referenced.)33.336 570 Q 2.377
(Once all of the symbol de\214nitions and references are resolv)33.336
600 R(ed,)-.195 E F2(ld)5.627 E F1 2.377(will assemble the)5.627 F F2
(a.out)33.336 615 Q F1 3.627(\214le by)3.627 F .376
(concatenating all of the te)3.627 F .376
(xt sections of all of the object \214les, forming the)-.195 F(single)
33.336 630 Q F2(.text)5.047 E F1 1.797(section of the)5.047 F F2(a.out)
5.048 E F1 8.298(.I)C 5.048(nd)-8.298 G 1.798(oing so, the te)-5.048 F
1.798(xt sections are relocated.)-.195 F(An)8.298 E .742
(instruction which w)33.336 645 R .742(as at of)-.13 F .742
(fset 10 in a particular object \214le')-.325 F 3.992(st)-.715 G -.195
(ex)-3.992 G 3.992(ts).195 G .742(ection may no)-3.992 F 3.991(wb)-.325
G 3.991(ea)-3.991 G(t)-3.991 E(of)33.336 660 Q(fset 1034 in the)-.325 E
F2(a.out)3.25 E F1(.)A(Furthermore,)33.336 690 Q F2(ld)3.889 E F1 .64
(has a concept of the)3.889 F F2 .64(load address)3.89 F F1 .64
(of the program, i.e. the memory)3.89 F .771
(address at which the \214rst byte of the)33.336 705 R F2(.text)4.02 E
F1 .77(section of the)4.02 F F2(a.out)4.02 E F1 .77(will be loaded.)4.02
F(This)7.27 E(kno)33.336 720 Q .276(wledge is part of con\214guring)
-.325 F F2(ld)3.526 E F1 .276
(for a particular operating system and processor type,)3.526 F 2.486
(and is not normally something that the programmer needs to w)33.336 735
R 2.486(orry about.)-.13 F 2.486(The load)8.986 F 0 Cg EP
%%Page: 57 57
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 57)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF 2.53(address is also placed in the)33.336
120 R/F2 13/Courier@0 SF(a.out)5.78 E F1 2.53
(\214le so the operating system is sure to load the)5.78 F 1.465
(program at the address for which it w)33.336 135 R 1.465(as link)-.13 F
4.715(ed. Kno)-.13 F 1.464(wing the size of each object \214le')-.325 F
(s)-.715 E F2(.text)33.336 150 Q F1(section,)5.527 E F2(ld)5.527 E F1
2.278(can calculate the absolute address that it will occup)5.527 F
5.528(yi)-.13 G 5.528(nt)-5.528 G 2.278(he \214nal)-5.528 F 1.794
(image, and can thus complete the symbol table, assigning absolute v)
33.336 165 R 1.794(alues to each te)-.325 F(xt)-.195 E(symbol.)33.336
180 Q 3.975(As)33.336 210 S .725(imilar process is undertak)-3.975 F
.725(en for the)-.13 F F2(data)3.975 E F1(and)3.975 E F2(bss)3.975 E F1
(sections.)3.975 E F2(ld)7.225 E F1 .726(assigns an absolute)3.976 F
1.703(address to each)33.336 225 R F2(data)4.952 E F1(or)4.952 E F2(bss)
4.952 E F1 1.702
(symbol, based on the con\214gured starting address of the)4.952 F F2
(data)33.336 240 Q F1(and)3.669 E F2(bss)3.669 E F1 .419(memory re)3.669
F 3.669(gions. In)-.195 F .419(the case of)3.669 F F2(data)3.669 E F1
.419(symbols, the initializers contained)3.669 F .335(in the indi)33.336
255 R .335(vidual object \214les are concatenated, forming the)-.325 F
F2(.data)3.585 E F1 .335(section of the)3.585 F F2(a.out)3.585 E F1(,)A
.805(which will thus contain the byte-for)33.336 270 R .805
(-byte image of what that section will look lik)-.26 F 4.056(ew)-.13 G
(hen)-4.056 E .433(the program starts.)33.336 285 R -.195(Fo)6.933 G(r)
.195 E F2(bss)3.683 E F1 .433(symbols, there are ob)3.683 F .433
(viously no initializers.)-.195 F F2(ld)6.933 E F1 -.13(ke)3.683 G .433
(eps track).13 F 1.711(of the total number of)33.336 300 R F2(bss)4.961
E F1 1.712(bytes needed, and places that information into the)4.961 F F2
(a.out)4.962 E F1 2.007(header so the operating system can allocate the\
 memory when the program is loaded.)33.336 315 R 1.649
(During this process, each)33.336 330 R F2(data)4.899 E F1(or)4.899 E F2
(bss)4.899 E F1 1.649(symbol is assigned an absolute address in the)
4.899 F(symbol table.)33.336 345 Q(No)33.336 375 Q(w)-.325 E F2(ld)3.378
E F1 .128(concatenates the v)3.378 F .127
(arious object \214les, processing the relocation records, replacing)
-.325 F 1.707(each "placeholder" with the actual, absolute address that\
 the associated symbol is no)33.336 390 R(w)-.325 E(kno)33.336 405 Q
2.383(wn to ha)-.325 F -.195(ve)-.26 G 8.883(.I).195 G 5.633(nt)-8.883 G
2.383(he case of Program-Counter)-5.633 F(-Relati)-.26 E 2.772 -.195
(ve r)-.325 H 2.382(elocation types, the proper).195 F(of)33.336 420 Q(\
fset is calculated with respect to the absolute address of the placehol\
der in question.)-.325 E/F3 13/Times-Bold@0 SF(Libraries)241.336 450 Q
F1 2.583(When you write a C program, you e)33.336 480 R 2.583
(xpect certain functions, such as)-.195 F F2(printf)5.834 E F1 5.834(,t)
C 5.834(ob)-5.834 G(e)-5.834 E -.26(av)33.336 495 S 3.656
(ailable. These)-.065 F .406(are supplied in the form of a)3.656 F F3
(library)3.656 E F1 6.905(.A)C .405(library is basically a collection)
-3.25 F(of)33.336 510 Q F2(.o)4.855 E F1 1.605(\214les, or)4.855 F -.065
(ga)-.234 G 1.605(nized together under a common wrapper format called a)
.065 F F2(.a)4.855 E F1 4.855(\214le. It)4.855 F(is)4.856 E
(similar to a "tar" or "zip" archi)33.336 525 Q .39 -.195(ve \()-.325 H
(although no compression is pro).195 E(vided\).)-.195 E(Con)33.336 555 Q
-.195(ve)-.52 G 1.166(ntion is that a library).195 F/F4 13
/Times-Italic@0 SF(ZZZ)4.416 E F1 1.165
(is contained in the library \214le:)4.415 F F2(libZZZ.a)4.415 E F1
7.665(.U)C 1.165(sing the)-7.665 F F2(-l)33.336 570 Q F1 .874(option to)
4.124 F F2(cc)4.124 E F1 .874(tells the)4.124 F F2(cc)4.124 E F1 .874
(program to ask the link)4.124 F .874
(er to link with the speci\214ed library)-.13 F(.)-.845 E -.195(Fo)
33.336 585 S 4.488(re).195 G(xample:)-4.683 E F2 1.238(cc myprog.c -lm)
4.488 F F1 1.238(asks for the system library \214le)4.488 F F2(libm.a)
4.488 E F1 1.238(\(the math)4.488 F 2.232
(library\) to be additionally link)33.336 600 R 5.482(ed. By)-.13 F(def)
5.482 E(ault,)-.13 E F2(cc)5.482 E F1(al)5.482 E -.13(wa)-.13 G 2.232
(ys links the standard C library).13 F F2(libc.a)33.336 615 Q F1 6.5(.T)
C(hese libraries are located in a system directory)-6.5 E 3.25(,t)-.845
G(ypically)-3.25 E F2(/usr/lib)3.25 E F1(.)A 1.183
(Although a library embodies a collection of object \214les, the beha)
33.336 645 R 1.183(vior when linking to a)-.26 F .418
(library is slightly dif)33.336 660 R .418(ferent than if one just link)
-.325 F .419(ed in all of the object \214les indi)-.13 F(vidually)-.325
E 6.919(.I)-.845 G(n)-6.919 E .802(the latter case, the)33.336 675 R F2
(.text)4.052 E F1(and)4.052 E F2(.data)4.052 E F1 .802
(sections of each object \214le w)4.052 F .802(ould wind up in the)-.13
F F2(a.out)33.336 690 Q F1 5.579(,r)C -2.925 -.195(eg a)-5.579 H 2.329
(rdless of whether or not an).195 F 2.329
(ything in a particular object \214le w)-.195 F 2.329(as actually)-.13 F
4.583(used. W)33.336 705 R 1.333(ith a library)-.52 F(,)-.845 E F2(ld)
4.583 E F1 -.26(bu)4.583 G 1.333
(ilds a symbol table of all the object \214les in the library).26 F
4.582(,a)-.845 G(nd)-4.582 E 4.032(then only selects those object \214l\
es that are actually needed for inclusion into the)33.336 720 R -.195
(exe)33.336 735 S(cutable.).195 E 0 Cg EP
%%Page: 58 58
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 58)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Bold@0 SF(Dynamic Linking)218.755 120 Q/F2 13
/Times-Roman@0 SF .663
(When dynamic \(shared\) libraries are used, there are tw)33.336 150 R
3.913(op)-.13 G .663(arts to the linkage process.)-3.913 F(At)7.163 E
.151(compile time,)33.336 165 R/F3 13/Courier@0 SF(ld)3.401 E F2 .151
(links ag)3.401 F .151(ainst the dynamic library \(which has a)-.065 F
F3(.so)3.402 E F2 -.195(ex)3.402 G .152(tension in UNIX\)).195 F .772
(for the purpose of learning which symbols are de\214ned by it.)33.336
180 R(Ho)7.271 E(we)-.325 E -.195(ve)-.325 G 1.811 -.52(r, n).195 H .771
(one of the code).52 F 3.422(or data initializers from the dynamic libr\
ary are actually included in the a.out \214le.)33.336 195 R(Instead,)
33.336 210 Q F3(ld)3.25 E F2(records which dynamic libraries were link)
3.25 E(ed ag)-.13 E(ainst.)-.065 E .794(At e)33.336 240 R -.195(xe)-.195
G .794(cution time, the second phase tak).195 F .794
(es place before the)-.13 F F3(main)4.044 E F2 .794(gets in)4.044 F -.26
(vo)-.52 G -.13(ke).26 G 4.044(d. A).13 F(small)4.043 E 3.339
(helper program called)33.336 255 R F3(ld.so)6.589 E F2(\(typically)6.59
E 6.59(,a)-.845 G 3.34(ctual names v)-6.59 F 3.34
(ary depending on operating)-.325 F 1.197(system b)33.336 270 R 1.197
(uild\) is loaded into the process address space by the k)-.26 F 1.197
(ernel and e)-.13 F -.195(xe)-.195 G 4.446(cuted. The).195 F(interv)
33.336 285 Q 2.437(ention of)-.195 F F3(ld.so)5.687 E F2 2.437
(is made possible by the binary interpreter feature of the ELF)5.687 F
.957(\(Extensible Link)33.336 300 R .957(er F)-.13 F .957
(ormat\) a.out format.)-.195 F(Lik)7.457 E 4.207(et)-.13 G .957(he #!)
-4.207 F .957(method for shell script \(and other)7.457 F 2.646
(languages\) interpreters, a \215ag in the a.out header informs the k)
33.336 315 R 2.647(ernel that it needs to)-.13 F 1.887(actually load)
33.336 330 R F3(ld.so)5.137 E F2 5.137(,w)C 1.887
(hich is passed the absolute pathname of the)-5.137 F F3(a.out)5.137 E
F2 1.886(\214le as an)5.137 F(ar)33.336 345 Q(gument.)-.234 E F3(ld.so)
8.169 E F2 1.669(then does a series of mmap calls to establish the te)
4.919 F 1.67(xt, data and bss)-.195 F(re)33.336 360 Q 1.836
(gions for the con)-.195 F -.195(ve)-.52 G 1.836
(ntional \(statically link).195 F 1.836
(ed\) part of the program, based on the a.out)-.13 F 5.163
(header information.)33.336 375 R 5.163
(It then locates each of the required dynamic libraries \(also)11.663 F
.381
(information from the header\) and for each one, mmaps that library')
33.336 390 R 3.63(st)-.715 G -.195(ex)-3.63 G .38(t, data and bss \(if)
.195 F(needed\) re)33.336 405 Q(gions.)-.195 E 1.799(When using)33.336
435 R F3(strace)5.049 E F2 1.8
(on Linux to trace system calls and we are tracing the e)5.049 F -.195
(xe)-.195 G 5.05(co).195 G 5.05(fa)-5.05 G .292(dynamically link)33.336
450 R .292(ed program, we')-.13 F .292(ll see the e)-.13 F -.195(xe)
-.195 G(cv).195 E 3.542(eo)-.195 G 3.542(ft)-3.542 G .292(hat program.)
-3.542 F 2.372 -1.04(We w)6.792 H(on').91 E 3.542(ts)-.234 G(ee)-3.542 E
F3(ld.so)3.542 E F2 2.266
(getting loaded because that happens as an internal k)33.336 465 R 2.266
(ernel function, not a system call.)-.13 F(Then ne)33.336 480 Q(xt we')
-.195 E(ll see the v)-.13 E(arious opens and mmaps.)-.325 E 2.478(Some \
additional magic is required to link the static and the dynamic portion\
s of the)33.336 510 R -.195(exe)33.336 525 S 6.429(cutable. This).195 F
3.179(aspect is e)6.429 F 3.179
(xtremely speci\214c to the operating system and processor)-.195 F 3.462
(architecture. In)33.336 540 R .212
(general, for functions which are de\214ned in a shared library)3.462 F
3.462(,d)-.845 G .212(ummy stubs)-3.462 F 2.477(are pro)33.336 555 R
2.477(vided in what is kno)-.195 F 2.477(wn as a)-.325 F F1(Pr)5.727 E
(ocedur)-.234 E 5.727(eL)-.234 G 2.477(inkage T)-5.727 F(able)-1.196 E
F2 8.977(.T)C 2.477(hese stubs contain)-8.977 F .587
(jumps to addresses which are \214lled in by the dynamic link)33.336 570
R(er)-.13 E 7.087(.T)-.715 G .586(his allo)-7.087 F .586
(ws the static code)-.325 F 2.125(to mak)33.336 585 R 5.375(ef)-.13 G
2.125(unction calls without being dynamic-a)-5.375 F -.13(wa)-.195 G
5.376(re. Lik).13 F -.325(ew)-.13 G 2.126(ise, a table kno).325 F 2.126
(wn as the)-.325 F F1 1.009(Global Offset T)33.336 600 R(able)-1.196 E
F2(pro)4.259 E 1.009(vides transparent access to an)-.195 F 4.258(yg)
-.195 G 1.008(lobal v)-4.258 F 1.008(ariables which a shared)-.325 F
1.518(library e)33.336 615 R 4.768(xports. The)-.195 F 1.518
(dynamic libraries themselv)4.768 F 1.518
(es need to be compiled in such as w)-.195 F(ay)-.13 E 2.728(that the)
33.336 630 R 5.978(ya)-.195 G 2.728(re capable of being loaded at an)
-5.978 F 5.977(yv)-.195 G 2.727(irtual address.)-5.977 F 2.727
(This is done with the)12.477 F F3(-fpic)33.336 645 Q F2 .013
(\(position independent code\) \215ag to the compiler)3.263 F 6.513(.T)
-.715 G(he)-6.513 E F3(ld.so)3.263 E F2 .013(dynamic link)3.263 F .013
(er \214lls)-.13 F .467(in the entries in the PL)33.336 660 R 3.717(Ta)
-1.196 G .467(nd GO)-3.717 F 3.717(Tb)-.52 G .466
(ased on the actual addresses that got assigned at run-)-3.717 F 4.577
(time. The)33.336 675 R 1.328(program is no)4.577 F 4.578(wc)-.325 G
1.328(ompleted link)-4.578 F 1.328(ed and ready to e)-.13 F -.195(xe)
-.195 G 1.328(cute, so).195 F F3(ld.so)4.578 E F2 1.328(jumps to)4.578 F
(the)33.336 690 Q F3(_start)4.873 E F2 1.622
(address contained in the a.out header)4.873 F 8.122(.S)-.715 G 1.622
(ince ld.so is designed to w)-8.122 F 1.622(ork in)-.13 F 1.851
(concert with the C library)33.336 705 R 5.101(,t)-.845 G 1.852
(his start function \(the code of which is located in the te)-5.101 F
(xt)-.195 E(re)33.336 720 Q 1.609(gion associated with)-.195 F F3
(libc.so)4.859 E F2 4.859(\)d)C 1.609(oes an munmap to destro)-4.859 F
4.859(yt)-.13 G 1.609(he te)-4.859 F 1.609(xt re)-.195 F 1.609
(gion that had)-.195 F(contained the)33.336 735 Q F3(ld.so)3.25 E F2
(code.)3.25 E 0 Cg EP
%%Page: 59 59
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 5/pg 59)71.748 E(\2512016 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF .7
(There is a slight performance penalty when using dynamic libraries.)
33.336 120 R .7(In additional to the)7.2 F .367(delay in e)33.336 135 R
-.195(xe)-.195 G .367(cuting the program imposed by needing to load and\
 link the libraries, calls to).195 F 2.505(functions in the dynamic lib\
rary require an additional branch, and accesses to global)33.336 150 R
3.543(symbols from within the shared library must use a position-indepe\
ndent addressing)33.336 165 R
(method, which generally requires an indirect addressing mode.)33.336
180 Q .48(One do)33.336 210 R .48(wn-side of dynamic linking is that a \
missing dynamic library \(".so" \214les in UNIX)-.325 F .321
(terms, or "DLL"s in W)33.336 225 R(indo)-.52 E .321
(ws-speak\) will pre)-.325 F -.195(ve)-.325 G .32
(nt a program from running, e).195 F -.195(ve)-.325 G 3.57(ni).195 G
3.57(fi)-3.57 G 3.57(tw)-3.57 G(as)-3.7 E 5.019
(complete and correct at compile time.)33.336 240 R(Ho)11.519 E(we)-.325
E -.195(ve)-.325 G 6.059 -.52(r, t).195 H 5.019(his disadv).52 F 5.02
(antage is more than)-.325 F 2.398(outweighed by the reduction in e)
33.336 255 R -.195(xe)-.195 G 2.398(cutable size and the con).195 F
-.195(ve)-.52 G 2.398(nience of being able to).195 F .833
(correct errors in system libraries on the \215y)33.336 270 R 4.083(,w)
-.845 G .833(ithout ha)-4.083 F .833(ving to locate and recompile each)
-.26 F(and e)33.336 285 Q -.195(ve)-.325 G(ry e).195 E -.195(xe)-.195 G
(cutable based on the f).195 E(aulty library)-.13 E(.)-.845 E 3.012
(The program)33.336 315 R/F2 13/Courier@0 SF(ldd)6.262 E F1 3.012
(can be used to deb)6.262 F 3.011
(ug dynamic library resolution problems.)-.26 F(This)9.511 E -.195(ex)
33.336 330 S(ample sho).195 E
(ws the dynamic libraries that are needed for)-.325 E F2(ls)3.25 E F1
(on a 32-bit Linux system:)3.25 E/F3 10/Courier@0 SF 6($l)33.336 342 S
(dd /bin/ls)-6 E(linux-gate.so.1 =>)81.336 354 Q(\(0xb77c4000\))12 E
(librt.so.1 => /lib/librt.so.1 \(0xb77b6000\))81.336 366 Q
(libacl.so.1 => /lib/libacl.so.1 \(0xb77ad000\))81.336 378 Q
(libc.so.6 => /lib/libc.so.6 \(0xb765b000\))81.336 390 Q
(libpthread.so.0 => /lib/libpthread.so.0 \(0xb7642000\))81.336 402 Q
(/lib/ld-linux.so.2 \(0xb77c5000\))81.336 414 Q
(libattr.so.1 => /lib/libattr.so.1 \(0xb763b000\))81.336 426 Q F1 2.259
(The numbers in parentheses are the addresses at which each of the dyna\
mic libraries)33.336 441 R -.13(wo)33.336 456 S
(uld load if the program were actually being e).13 E -.195(xe)-.195 G
(cuted.).195 E 6.767
(Under certain circumstances, such as security-sensiti)33.336 486 R
7.157 -.195(ve a)-.325 H 6.767(pplications, it may be).195 F 1.571
(appropriate to use static linkage.)33.336 501 R 1.571
(This ensures that the program will al)8.071 F -.13(wa)-.13 G 1.572
(ys be able to).13 F(run, and will al)33.336 516 Q -.13(wa)-.13 G
(ys run with e).13 E(xactly the e)-.195 E(xpected code.)-.195 E 0 Cg EP
%%Trailer
end
%%EOF
